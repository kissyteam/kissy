/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: Jun 17 23:59
*/
KISSY.add("scrollview/base/render",function(f,o,p){var n,l={_onSetScrollLeft:function(d){this.get("contentEl")[0].style.left=-d+"px"},_onSetScrollTop:function(d){this.get("contentEl")[0].style.top=-d+"px"}};f.Features.isTransformSupported()&&(n=f.Features.getTransformProperty(),l._onSetScrollLeft=function(d){var f=this.get("scrollTop");this.get("contentEl")[0].style[n]="translate3d("+-d+"px,"+-f+"px,0)"},l._onSetScrollTop=function(d){var f=this.get("scrollLeft");this.get("contentEl")[0].style[n]=
"translate3d("+-f+"px,"+-d+"px,0)"});return o.Render.extend([p.ContentRender],l,{ATTRS:{scrollLeft:{value:0},scrollTop:{value:0}}})},{requires:["component/base","component/extension"]});
KISSY.add("scrollview/base",function(f,o,p,n,l){var d=d,q=f.all,f=f.Features.isTouchEventSupported(),k=o.KeyCode;return p.Controller.extend({bindUI:function(){var a=this.get("el");a.on("mousewheel",this._onMouseWheel,this);a.on("scroll",this._onElScroll,this)},syncUI:function(){var a=this.get("el")[0],c=this.get("contentEl"),b=c[0],d=Math.max(a.scrollHeight,b.scrollHeight),e=Math.max(a.scrollWidth,b.scrollWidth),b=a.clientHeight,i,j=a.clientWidth;this.scrollHeight=d;this.scrollWidth=e;this.clientHeight=
b;this.clientWidth=j;var h=c.offset();i=this._allowScroll={};d>b&&(i.top=1);e>j&&(i.left=1);this.minScroll={left:0,top:0};var f,k;this.maxScroll={left:f=e-j,top:k=d-b};a=q(a.ownerDocument);this.scrollStep={top:Math.max(0.7*b*b/a.height(),20),left:Math.max(0.7*j*j/a.width(),20)};b=this.get("snap");a=this.get("scrollLeft");d=this.get("scrollTop");if(b){var c=this._pages="string"==typeof b?c.all(b):c.children(),b=this.get("pageIndex"),m=this._pagesXY=[];c.each(function(a,b){var c=a.offset(),d=c.left-
h.left,c=c.top-h.top;d<=f&&c<=k&&(m[b]={x:d,y:c,index:b})});if(b){this.scrollToPage(b);return}}this.scrollTo(a,d)},_onElScroll:function(){var a=this.get("el")[0],c=a.scrollTop,b=a.scrollLeft;c&&this.set("scrollTop",c+this.get("scrollTop"));b&&this.set("scrollLeft",b+this.get("scrollLeft"));a.scrollTop=a.scrollLeft=0},handleKeyEventInternal:function(a){var c=q(a.target),b=c.nodeName();if("input"==b||"textarea"==b||"select"==b||c.hasAttr("contenteditable"))return d;var a=a.keyCode,g=this.isAxisEnabled("x"),
e=this.isAxisEnabled("y"),c=this.minScroll,b=this.maxScroll,i=this.scrollStep,j,h=d;if(e){var f=i.top,l=this.clientHeight,m=this.get("scrollTop"),e=m==b.top;j=m==c.top;if(a==k.DOWN){if(e)return d;this.scrollTo(d,m+f);h=!0}else if(a==k.UP){if(j)return d;this.scrollTo(d,m-f);h=!0}else if(a==k.PAGE_DOWN){if(e)return d;this.scrollTo(d,m+l);h=!0}else if(a==k.PAGE_UP){if(j)return d;this.scrollTo(d,m-l);h=!0}}if(g)if(g=i.left,i=this.get("scrollLeft"),e=i==b.left,j=i==c.left,a==k.RIGHT){if(e)return d;this.scrollTo(i+
g);h=!0}else if(a==k.LEFT){if(j)return d;this.scrollTo(i-g);h=!0}return h},_onMouseWheel:function(a){if(!this.get("disabled")){var c,b,g=this.scrollStep,e,i=this.maxScroll,f=this.minScroll;if((e=a.deltaY)&&this.isAxisEnabled("y")){var h=this.get("scrollTop");c=i.top;b=f.top;h<=b&&0<e||h>=c&&0>e||(this.scrollTo(d,h-a.deltaY*g.top),a.preventDefault())}if((e=a.deltaX)&&this.isAxisEnabled("x"))h=this.get("scrollLeft"),c=i.left,b=f.left,h<=b&&0<e||h>=c&&0>e||(this.scrollTo(h-a.deltaX*g.left),a.preventDefault())}},
isAxisEnabled:function(a){return this._allowScroll["x"==a?"left":"top"]},stopAnimation:function(){this.get("contentEl").stop();var a=this.maxScroll,c=this.minScroll;this.set("scrollTop",Math.min(Math.max(this.get("scrollTop"),c.top),a.top));this.set("scrollLeft",Math.min(Math.max(this.get("scrollLeft"),c.left),a.left))},_uiSetPageIndex:function(a){this.scrollToPage(a)},_getPageIndexFromXY:function(a,c,b){var g=this._pagesXY.concat([]),e=c?"x":"y";g.sort(function(a,b){return a[e]-b[e]});if(0<b)for(c=
0;c<g.length;c++){if(b=g[c],b[e]>=a)return b.index}else for(c=g.length-1;0<=c;c--)if(b=g[c],b[e]<=a)return b.index;return d},scrollToPage:function(a,c){var b;if((b=this._pagesXY)&&b[a])this.setInternal("pageIndex",a),this.scrollTo(b[a].x,b[a].y,c)},scrollTo:function(a,c,b){var g=this;if(b){var e=g.get("scrollLeft"),f=g.get("scrollTop");g.get("contentEl").animate({xx:{fx:{frame:function(b,h){a!==d&&g.set("scrollLeft",e+h.pos*(a-e));c!==d&&g.set("scrollTop",f+h.pos*(c-f))}}}},b)}else a!==d&&g.set("scrollLeft",
a),c!==d&&g.set("scrollTop",c)}},{ATTRS:{contentEl:{view:1},scrollLeft:{view:1},scrollTop:{view:1},focusable:{value:!f},allowTextSelection:{value:!0},handleMouseEvents:{value:!1},snap:{value:!1},snapDuration:{value:0.3},snapEasing:{value:"easeOut"},pageIndex:{value:0},xrender:{value:l}}},{xclass:"scrollview"})},{requires:["node","component/base","component/extension","./base/render"]});
