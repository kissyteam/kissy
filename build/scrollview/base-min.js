/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: Apr 17 00:22
*/
KISSY.add("scrollview/base",function(c,l,p,q,h,m){var b=b,n=c.all,c=c.Features.isTouchSupported(),j=m.KeyCodes;return p.Controller.extend({bindUI:function(){var a=this.get("el");a.on("mousewheel",this._onMouseWheel,this);a.on("scroll",this._onElScroll,this)},_onElScroll:function(){var a=this.get("el")[0],i=a.scrollTop,b=a.scrollLeft;i&&this.set("scrollTop",i+this.get("scrollTop"));b&&this.set("scrollLeft",b+this.get("scrollLeft"));a.scrollTop=a.scrollLeft=0},handleKeyEventInternal:function(a){var i=
a.target,d=l.nodeName(i);if("input"==d||"textarea"==d||"select"==d||l.hasAttr(i,"contenteditable"))return b;var a=a.keyCode,o=this.isAxisEnabled("x"),e=this.isAxisEnabled("y"),i=this.minScroll,d=this.maxScroll,f=this.scrollStep,c,g=b;if(e){var h=f.top,n=this.clientHeight,k=this.get("scrollTop"),e=k==d.top;c=k==i.top;if(a==j.DOWN){if(e)return b;this.scrollTo(b,k+h);g=!0}else if(a==j.UP){if(c)return b;this.scrollTo(b,k-h);g=!0}else if(a==j.PAGE_DOWN){if(e)return b;this.scrollTo(b,k+n);g=!0}else if(a==
j.PAGE_UP){if(c)return b;this.scrollTo(b,k-n);g=!0}}if(o)if(o=f.left,f=this.get("scrollLeft"),e=f==d.left,c=f==i.left,a==j.RIGHT){if(e)return b;this.scrollTo(f+o);g=!0}else if(a==j.LEFT){if(c)return b;this.scrollTo(f-o);g=!0}return g},_onMouseWheel:function(a){if(!this.get("disabled")){var i,d,c=this.scrollStep,e,f=this.maxScroll,h=this.minScroll;if((e=a.deltaY)&&this.isAxisEnabled("y")){var g=this.get("scrollTop");i=f.top;d=h.top;g<=d&&0<e||g>=i&&0>e||(this.scrollTo(b,g-a.deltaY*c.top),a.preventDefault())}if((e=
a.deltaX)&&this.isAxisEnabled("x"))g=this.get("scrollLeft"),i=f.left,d=h.left,g<=d&&0<e||g>=i&&0>e||(this.scrollTo(g-a.deltaX*c.left),a.preventDefault())}},syncUI:function(){var a=this.get("el")[0],b=this.get("contentEl")[0],d=Math.max(a.scrollHeight,b.scrollHeight),c=Math.max(a.scrollWidth,b.scrollWidth),b=a.clientHeight,e,f=a.clientWidth;this.scrollHeight=d;this.scrollWidth=c;this.clientHeight=b;this.clientWidth=f;e=this._allowScroll={};d>b&&(e.top=1);c>f&&(e.left=1);this.minScroll={left:0,top:0};
this.maxScroll={left:c-f,top:d-b};a=n(a.ownerDocument);this.scrollStep={top:Math.max(0.7*b*b/a.height(),20),left:Math.max(0.7*f*f/a.width(),20)};a=this.get("scrollLeft");d=this.get("scrollTop");this.scrollTo(a,d)},isAxisEnabled:function(a){return this._allowScroll["x"==a?"left":"top"]},stopAnimation:function(){this.get("contentEl").stop()},scrollTo:function(a,c){var d=this.maxScroll,h=this.minScroll;this.stopAnimation();a!=b&&(a=Math.min(Math.max(a,h.left),d.left),this.set("scrollLeft",a));c!=b&&
(c=Math.min(Math.max(c,h.top),d.top),this.set("scrollTop",c))}},{ATTRS:{scrollLeft:{view:1},scrollTop:{view:1},focusable:{value:!c},allowTextSelection:{value:!0},handleMouseEvents:{value:!1},xrender:{value:h}}},{xclass:"scrollview"})},{requires:["dom","component/base","component/extension","./base/render","event"]});
KISSY.add("scrollview/base/render",function(c,l,p){var q=c.Features.isTransformSupported(),c=c.Features.getTransformPrefix(),h={renderUI:function(){this._contentEl=this.get("contentEl")[0]},_onSetScrollLeft:function(b){this._contentEl.style.left=-b+"px"},_onSetScrollTop:function(b){this._contentEl.style.top=-b+"px"}},m=c?c+"Transform":"transform";q&&(h._onSetScrollLeft=function(b){var c=this.get("scrollTop");this._contentEl.style[m]="translate3d("+-b+"px,"+-c+"px,0)"},h._onSetScrollTop=function(b){var c=
this.get("scrollLeft");this._contentEl.style[m]="translate3d("+-c+"px,"+-b+"px,0)"});return l.Render.extend([p.ContentBox.Render],h,{ATTRS:{scrollLeft:{value:0},scrollTop:{value:0}}})},{requires:["component/base","component/extension"]});
