/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: Apr 17 00:23
*/
KISSY.add("scrollview/plugin/scrollbar/control",function(d,k,h,j,i){return j.Controller.extend({bindUI:function(){var a=this,b;b=a.get("autoHide");a.get("scrollview");a._xAxis="x"==a.get("axis");b?a._hideFn=function(){a.hide()}:(d.each([a.get("downBtn"),a.get("upBtn")],function(c){c.on("mousedown",a._onUpDownBtnMouseDown,a).on("mouseup",a._onUpDownBtnMouseUp,a)}),a.get("trackEl").on(k.Gesture.start,a._onTrackElMouseDown,a),b=a.dd=new h.Draggable({node:a.get("dragEl"),groups:!1,halt:!0}),b.on("drag",
a._onDrag,a).on("dragstart",a._onDragStart,a))},syncUI:function(){var a=this.get("scrollview"),b=this.get("trackEl");this.get("dragEl");var c,e,g=this.get("rendered");this._unBindScrollView();this.scrollview=a;if(this._xAxis){if(g&&!a.isAxisEnabled("x")){this.hide();return}this._scrollLength=a.scrollWidth;c=this._trackElSize=b.width();b=a.clientWidth/this._scrollLength;this.set("dragWidth",this.barSize=b*c);g&&(e=a.get("scrollLeft"))}else{if(g&&!a.isAxisEnabled("y")){this.hide();return}this._scrollLength=
a.scrollHeight;c=this._trackElSize=b.height();b=a.clientHeight/this._scrollLength;this.set("dragHeight",this.barSize=b*c);g&&(e=a.get("scrollTop"))}this._bindScrollView();e&&this.afterScrollChange({newVal:e})},destructor:function(){this._unBindScrollView();this._clearHideTimer()},_unBindScrollView:function(){this.get("scrollview").detach(".ks-scrollbar")},_bindScrollView:function(){this.get("scrollview").on("afterScroll"+(this._xAxis?"Left":"Top")+"Change.ks-scrollbar",this.afterScrollChange,this).on("scrollEnd.ks-scrollbar",
this._onScrollEnd,this).on("afterDisabledChange",this._onScrollViewDisabled,this)},_onScrollViewDisabled:function(a){this.set("disabled",a.newVal)},_onDragStart:function(){var a=this.scrollview,b=this._xAxis;this._startMousePos=this.dd.get("startMousePos")[b?"left":"top"];this._startScroll=a.get(b?"scrollLeft":"scrollTop")},_onDrag:function(a){var b=this._xAxis,c=this.scrollview,a=this._startScroll+(a[b?"pageX":"pageY"]-this._startMousePos)/this._trackElSize*this._scrollLength;b?c.scrollTo(a):c.scrollTo(void 0,
a)},_startHideTimer:function(){this._clearHideTimer();this._hideTimer=setTimeout(this._hideFn,1E3*this.get("hideDelay"))},_clearHideTimer:function(){this._hideTimer&&(clearTimeout(this._hideTimer),this._hideTimer=null)},_onUpDownBtnMouseDown:function(a){if(!this.get("disabled")){a.halt();var b=this.scrollview,c=this._xAxis,e=c?"scrollLeft":"scrollTop",g=b.scrollStep[c?"left":"top"],f=this.get("downBtn"),a=a.target,d=a==f[0]||f.contains(a)?1:-1,c=c?function(){b.scrollTo(b.get(e)+d*g)}:function(){b.scrollTo(void 0,
b.get(e)+d*g)};clearInterval(this.mouseInterval);this.mouseInterval=setInterval(c,100);c()}},_onTrackElMouseDown:function(a){if(!this.get("disabled")){var b=this._xAxis,c=b?"left":"top",e=b?"pageX":"pageY",g=this.get("trackEl");this.get("dragEl");var f=this.scrollview,c=Math.max(0,(a[e]-g.offset()[c]-this.barSize/2)/this._trackElSize)*this._scrollLength;b?f.scrollTo(c):f.scrollTo(void 0,c);a.halt()}},_onUpDownBtnMouseUp:function(){clearInterval(this.mouseInterval)},_onScrollEnd:function(a){this._hideFn&&
this.get("axis")==a.axis&&this._startHideTimer()},afterScrollChange:function(a){var b=this._xAxis,c=this.scrollview;this._clearHideTimer();this.show();this._hideFn&&!c.dd.get("dragging")&&this._startHideTimer();var e=b?"dragLeft":"dragTop",g=b?"dragWidth":"dragHeight",f=this.barSize,d=this._scrollLength,h=this._trackElSize,a=a.newVal,i=c.maxScroll,c=c.minScroll,c=b?c.left:c.top,b=b?i.left:i.top;a>b?(d=b/d*h,this.set(g,f-(a-b)),this.set(e,d+f-this.get(g))):a<c?(d=c/d*h,this.set(g,f-(c-a)),this.set(e,
d)):(this.set(e,a/d*h),this.set(g,f))},_onSetDisabled:function(a){this.dd&&this.dd.set("disabled",a)}},{ATTRS:{allowTextSelection:{value:!0},minLength:{value:20},scrollview:{view:1},axis:{view:1},autoHide:{value:d.UA.ios},visible:{valueFn:function(){return!this.get("autoHide")}},hideDelay:{value:0.1},dragWidth:{setter:function(a){var b=this.get("minLength");return a<b?b:a},view:1},dragHeight:{setter:function(a){var b=this.get("minLength");return a<b?b:a},view:1},dragLeft:{view:1},dragTop:{view:1},
dragEl:{view:1},downBtn:{view:1},upBtn:{view:1},trackEl:{view:1},focusable:{value:!1},xrender:{value:i}}},{xclass:"scrollbar"})},{requires:["event","dd/base","component/base","./render"]});
KISSY.add("scrollview/plugin/scrollbar/render",function(d,k){function h(a,b,g,f){return(f||"")+d.substitute(a,{prefix:b,axis:g})}var j=d.Features.isTransformSupported(),i=d.Features.getTransformPrefix(),a={createDom:function(){this.get("el").addClass(this.get("prefixCls")+"scrollbar-"+this.get("axis"))},renderUI:function(){var a=this.get("el"),b=this.get("axis"),d,f=this.get("prefixCls");a.html(h('<div class="{prefix}scrollbar-{axis}-track"><div class="{prefix}scrollbar-{axis}-drag"><div class="{prefix}scrollbar-{axis}-drag-top"></div><div class="{prefix}scrollbar-{axis}-drag-center"></div><div class="{prefix}scrollbar-{axis}-drag-bottom"></div></div></div><div class="{prefix}scrollbar-{axis}-arrow-up" ><a href="javascript:void(\'up\')">up</a></div><div class="{prefix}scrollbar-{axis}-arrow-down" ><a href="javascript:void(\'down\')">down</a></div>',
f,b));this.set("dragEl",d=a.one(h("{prefix}scrollbar-{axis}-drag",f,b,".")));this.set("downBtn",a.one(h("{prefix}scrollbar-{axis}-arrow-down",f,b,".")));this.set("upBtn",a.one(h("{prefix}scrollbar-{axis}-arrow-up",f,b,".")));this.set("trackEl",a.one(h("{prefix}scrollbar-{axis}-track",f,b,".")));this.domDragEl=d[0]},_onSetDragHeight:function(a){this.domDragEl.style.height=a+"px"},_onSetDragWidth:function(a){this.domDragEl.style.width=a+"px"},_onSetDragLeft:function(a){this.domDragEl.style.left=a+"px"},
_onSetDragTop:function(a){this.domDragEl.style.top=a+"px"}},b=i?i+"Transform":"transform";j&&(a._onSetDragLeft=function(a){this.domDragEl.style[b]="translateX("+a+"px) translateZ(0)"},a._onSetDragTop=function(a){this.domDragEl.style[b]="translateY("+a+"px) translateZ(0)"});return k.Render.extend(a,{ATTRS:{scrollview:{},dragWidth:{},dragHeight:{},dragLeft:{},dragTop:{},dragEl:{},downBtn:{},upBtn:{},trackEl:{}}})},{requires:["component/base"]});
KISSY.add("scrollview/plugin/scrollbar",function(d,k,h){function j(){j.superclass.constructor.apply(this,arguments)}d.extend(j,k,{pluginId:"scrollview/plugin/scrollbar",pluginSyncUI:function(i){var a=this.get("minLength"),b=this.get("autoHideX"),c=this.get("autoHideY"),e={scrollview:i,elBefore:i.get("contentEl")};void 0!==a&&(e.minLength=a);this.scrollBarX?this.scrollBarX.sync():i.isAxisEnabled("x")&&(a={axis:"x"},void 0!==b&&(e.autoHide=b),this.scrollBarX=(new h(d.merge(e,a))).render());this.scrollBarY?
this.scrollBarY.sync():i.isAxisEnabled("y")&&(a={axis:"y"},void 0!==c&&(e.autoHide=c),this.scrollBarY=(new h(d.merge(e,a))).render())},pluginDestructor:function(){this.scrollBarX&&(this.scrollBarX.destroy(),this.scrollBarX=null);this.scrollBarY&&(this.scrollBarY.destroy(),this.scrollBarY=null)}});return j},{requires:["base","./scrollbar/control"]});
