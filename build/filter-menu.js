/*
Copyright 2014, KISSY v5.0.0
MIT Licensed
build time: Jul 18 14:03
*/
KISSY.add("filter-menu",["menu","./filter-menu/render-xtpl","component/extension/content-box","util"],function(j,h,k,i){var j=h("menu"),k=h("./filter-menu/render-xtpl"),d=h("component/extension/content-box"),b=h("util");i.exports=j.extend([d],{bindUI:function(){this.get("filterInput").on("input",this.handleFilterEvent,this)},handleMouseEnterInternal:function(c){this.callSuper(c);this.getKeyEventTarget()[0].select()},handleFilterEvent:function(){var c;c=this.get("filterInput");var b=this.get("highlightedItem");
this.set("filterStr",c.val());c=c.val();this.get("allowMultiple")&&(c=c.replace(/^.+,/,""));if(!c&&b)b.set("highlighted",!1);else if(c&&(!b||!b.get("visible")))(b=this._getNextEnabledHighlighted(0,1))&&b.set("highlighted",!0)},_onSetFilterStr:function(b){this.filterItems(b)},_onSetPlaceholder:function(b){this.get("placeholderEl").html(b)},getKeyEventTarget:function(){return this.get("filterInput")},filterItems:function(c){var f=this.get("prefixCls"),a=this.get("placeholderEl"),e=this.get("filterInput");
a[c?"hide":"show"]();if(this.get("allowMultiple")){var a=[],d;d=c.match(/(.+)[,\uff0c]\s*([^\uff0c,]*)/);var g=[];d&&(g=d[1].split(/[,\uff0c]/));/[,\uff0c]$/.test(c)?(a=[],d&&(a=g,d=g[g.length-1],(g=(g=this.get("highlightedItem"))&&g.get("content"))&&-1<g.indexOf(d)&&d&&(a[a.length-1]=g),e.val(a.join(",")+",")),c=""):(d&&(c=d[2]||""),a=g);this.get("enteredItems").length!==a.length&&this.set("enteredItems",a)}var e=this.get("children"),h=c&&RegExp(b.escapeRegExp(c),"ig");b.each(e,function(a){var b=
a.get("content");c?-1<b.indexOf(c)?(a.set("visible",!0),a.get("el").html(b.replace(h,function(a){return'<span class="'+f+'menuitem-hit">'+a+"</span>"}))):a.set("visible",!1):(a.get("el").html(b),a.set("visible",!0))})},reset:function(){this.set("filterStr","");this.set("enteredItems",[]);this.get("filterInput").val("")}},{ATTRS:{handleGestureEvents:{value:!0},focusable:{value:!0},allowTextSelection:{value:!0},contentTpl:{value:k},filterInput:{selector:function(){return"."+this.getBaseCssClass("input")}},
filterInputWrap:{selector:function(){return"."+this.getBaseCssClass("input-wrap")}},placeholder:{render:1,sync:0,parse:function(){var b=this.get("placeholderEl");return b&&b.html()}},placeholderEl:{selector:function(){return"."+this.getBaseCssClass("placeholder")}},filterStr:{},enteredItems:{value:[]},allowMultiple:{value:!1}},xclass:"filter-menu"})});
KISSY.add("filter-menu/render-xtpl",[],function(j,h,k,i){i.exports=function(d,b,c){var f=this.root.utils.callFn;b.write('<div class="',0);var a={escape:1},e=[];e.push("input-wrap");a.params=e;if((a=f(this,d,a,b,["getBaseCssClasses"],0,1))&&a.isBuffer)b=a,a=c;b.write(a,!0);b.write('">\r\n    <div class="',0);a={escape:1};e=[];e.push("placeholder");a.params=e;if((a=f(this,d,a,b,["getBaseCssClasses"],0,2))&&a.isBuffer)b=a,a=c;b.write(a,!0);b.write('">\r\n        ',0);a=d.resolve(["placeholder"],0);b.write(a,
!0);b.write('\r\n    </div>\r\n    <input class="',0);a={escape:1};e=[];e.push("input");a.params=e;if((a=f(this,d,a,b,["getBaseCssClasses"],0,5))&&a.isBuffer)b=a,a=c;b.write(a,!0);b.write('"\r\n            autocomplete="off"/>\r\n</div>\r\n<div class="',0);a={escape:1};e=[];e.push("content");a.params=e;if((f=f(this,d,a,b,["getBaseCssClasses"],0,8))&&f.isBuffer)b=f,f=c;b.write(f,!0);b.write('">',0);d=d.resolve(["content"],0);b.write(d,!1);b.write("</div>",0);return b};i.exports.TPL_NAME=i.name});
