/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: Jul 3 14:38
*/
KISSY.add("component/extension/align",function(j,n){function o(a){var c=a.ownerDocument.body,d=i(a).css("position");if(!("fixed"==d||"absolute"==d))return"html"==a.nodeName.toLowerCase()?null:a.parentNode;for(a=a.parentNode;a&&a!=c;a=a.parentNode)if(d=i(a).css("position"),"static"!=d)return a;return null}function p(a){var c,d,b={left:0,right:Infinity,top:0,bottom:Infinity},g;g=a.ownerDocument;d=i(g).getWindow();c=g.body;for(g=g.documentElement;a=o(a);)if((!u.ie||0!=a.clientWidth)&&a!=c&&a!=g&&"visible"!=
i(a).css("overflow")){var e=i(a).offset();e.left+=a.clientLeft;e.top+=a.clientTop;b.top=Math.max(b.top,e.top);b.right=Math.min(b.right,e.left+a.clientWidth);b.bottom=Math.min(b.bottom,e.top+a.clientHeight);b.left=Math.max(b.left,e.left)}g=d.scrollLeft();a=d.scrollTop();b.left=Math.max(b.left,g);b.top=Math.max(b.top,a);c=d.width();d=d.height();b.right=Math.min(b.right,g+c);b.bottom=Math.min(b.bottom,a+d);return 0<=b.top&&0<=b.left&&b.bottom>b.top&&b.right>b.left?b:null}function q(a,c,d,b){var g,e;
g=a.left;e=a.top;c=r(c,d[0]);a=r(a,d[1]);a=[a.left-c.left,a.top-c.top];return{left:g-a[0]+ +b[0],top:e-a[1]+ +b[1]}}function s(a,c,d){var b=[];j.each(a,function(a){b.push(a.replace(c,function(a){return d[a]}))});return b}function l(){}function t(a){var c,d;c=a[0];j.isWindow(c)?(a=i(c).getWindow(),c={left:a.scrollLeft(),top:a.scrollTop()},d=a.width(),a=a.height()):(c=a.offset(),d=a.outerWidth(),a=a.outerHeight());c.width=d;c.height=a;return c}function r(a,c){var d=c.charAt(0),b=c.charAt(1),g=a.width,
e=a.height,f,h;f=a.left;h=a.top;"c"===d?h+=e/2:"b"===d&&(h+=e);"c"===b?f+=g/2:"r"===b&&(f+=g);return{left:f,top:h}}function v(a){a.target==this&&a.newVal&&m.call(this)}function w(){this.get("visible")&&m.call(this)}function m(){this._onSetAlign(this.get("align"))}var x=j.Env.host,i=n.all,u=j.UA;l.__getOffsetParent=o;l.__getVisibleRectForElement=p;l.ATTRS={align:{value:{}}};l.prototype={__bindUI:function(){this.on("beforeVisibleChange",v,this);this.$el.getWindow().on("resize",w,this)},_onSetAlign:function(a){a&&
a.points&&this.align(a.node,a.points,a.offset,a.overflow)},align:function(a,c,d,b){var a=n.one(a||x),d=d&&[].concat(d)||[0,0],b=b||{},g=this.$el,e=0,f=p(g[0]),h=t(g),i=t(a),a=q(h,i,c,d),k=j.merge(h,a);if(f&&(b.adjustX||b.adjustY)){if(a.left<f.left||a.left+h.width>f.right)e=1,c=s(c,/[lr]/ig,{l:"r",r:"l"}),d[0]=-d[0];if(a.top<f.top||a.top+h.height>f.bottom)e=1,c=s(c,/[tb]/ig,{t:"b",b:"t"}),d[1]=-d[1];e&&(a=q(h,i,c,d),j.mix(k,a));c={};c.adjustX=b.adjustX&&(a.left<f.left||a.left+h.width>f.right);c.adjustY=
b.adjustY&&(a.top<f.top||a.top+h.height>f.bottom);if(c.adjustX||c.adjustY)b=j.clone(a),e={width:h.width,height:h.height},c.adjustX&&b.left<f.left&&(b.left=f.left),c.resizeWidth&&b.left>=f.left&&b.left+e.width>f.right&&(e.width-=b.left+e.width-f.right),c.adjustX&&b.left+e.width>f.right&&(b.left=Math.max(f.right-e.width,f.left)),c.adjustY&&b.top<f.top&&(b.top=f.top),c.resizeHeight&&b.top>=f.top&&b.top+e.height>f.bottom&&(e.height-=b.top+e.height-f.bottom),c.adjustY&&b.top+e.height>f.bottom&&(b.top=
Math.max(f.bottom-e.height,f.top)),k=j.mix(b,e)}this.set({x:k.left,y:k.top},{force:1});k.width!=h.width&&this.set("width",g.width()+k.width-h.width);k.height!=h.height&&this.set("height",g.height()+k.height-h.height);return this},center:function(a){this.set("align",{node:a,points:["cc","cc"],offset:[0,0]});return this},__destructor:function(){this.$el&&this.$el.getWindow().detach("resize",m,this)}};return l},{requires:["node"]});
