/*
Copyright 2013, KISSY v1.40dev
MIT Licensed
build time: Sep 17 17:00
*/
KISSY.add("component/control/process",function(c,l,d){function e(f){f.fire("beforeSyncUI");f.syncUI();f.__callPluginsMethod("pluginSyncUI");f.fire("afterSyncUI")}var i=d.Defer,d=l.prototype.__getHook,c=c.noop,j=l.extend({bindInternal:c,syncInternal:c,initializer:function(){this._renderedDefer=new i},createDom:c,renderUI:c,bindUI:c,syncUI:c,onRendered:function(f){return this._renderedDefer.promise.then(f)},create:function(){this.get("created")||(this.fire("beforeCreateDom"),this.createInternal(),this.__callPluginsMethod("pluginCreateDom"),
this.fire("afterCreateDom"),this.setInternal("created",!0));return this},createInternal:function(){this.createDom()},render:function(){this.get("rendered")||(this.create(),this.fire("beforeRenderUI"),this.renderUI(),this.__callPluginsMethod("pluginRenderUI"),this.fire("afterRenderUI"),this.fire("beforeBindUI"),j.superclass.bindInternal.call(this),this.bindUI(),this.__callPluginsMethod("pluginBindUI"),this.fire("afterBindUI"),j.superclass.syncInternal.call(this),e(this),this.setInternal("rendered",
!0));return this},sync:function(){e(this)},plug:function(f){var c=this.get("plugins");this.callSuper(f);f=c[c.length-1];this.get("rendered")?(f.pluginCreateDom&&f.pluginCreateDom(this),f.pluginRenderUI&&f.pluginRenderUI(this),f.pluginBindUI&&f.pluginBindUI(this),f.pluginSyncUI&&f.pluginSyncUI(this)):this.get("created")&&f.pluginCreateDom&&f.pluginCreateDom(this);return this}},{__hooks__:{createDom:d("__createDom"),renderUI:d("__renderUI"),bindUI:d("__bindUI"),syncUI:d("__syncUI")},name:"ComponentProcess",
ATTRS:{rendered:{value:!1,setter:function(c){c&&this._renderedDefer.resolve(this)}},created:{value:!1}}});return j},{requires:["base","promise"]});
KISSY.add("component/control/render-xtpl",function(){return function(c,l,d){var e,i=this;e=this.config.utils;var l=e.runBlockCommand,j=e.getExpression,f=e.getPropertyOrRunCommand;e='<div id="';var h=f(i,c,{},"id",0,1,d,!1);e+=j(h,!0);e+='"\r\n class="';var h={},k=[];k.push("");h.params=k;h=f(i,c,h,"getBaseCssClasses",0,2,!0,d);e=e+h+"\r\n";var h={},k=[],m=f(i,c,{},"elCls",0,3,d,!0);k.push(m);h.params=k;h.fn=function(a){var b;b="\r\n ";a=f(i,a,{},".",0,4,d,!1);b+=j(a,!0);return b+"  \r\n"};e+=l(i,
c,h,"each",3);e+='\r\n"\r\n\r\n';h={};k=[];m=f(i,c,{},"elAttrs",0,8,d,!0);k.push(m);h.params=k;h.fn=function(a){var b;b=" \r\n ";var c=f(i,a,{},"xindex",0,9,d,!1);b+=j(c,!0);b+='="';a=f(i,a,{},".",0,9,d,!1);b+=j(a,!0);return b+'"\r\n'};e+=l(i,c,h,"each",8);e+='\r\n\r\nstyle="\r\n';h={};k=[];m=f(i,c,{},"elStyle",0,13,d,!0);k.push(m);h.params=k;h.fn=function(a){var b;b=" \r\n ";var c=f(i,a,{},"xindex",0,14,d,!1);b+=j(c,!0);b+=":";a=f(i,a,{},".",0,14,d,!1);b+=j(a,!0);return b+";\r\n"};e+=l(i,c,h,"each",
13);return e+'\r\n">'}});
KISSY.add("component/control/render",function(c,l,d,e,i,j){function f(g){"number"==typeof g&&(g+="px");return g}function h(g){g||(g=[""]);"string"==typeof g&&(g=g.split(/\s+/));return g}function k(g,a,b){for(var c="",f=0,e=b.length,a=g+a;f<e;f++)g=(g=b[f])?"-"+g:g,c+=" "+a+g;return c}function m(g){var a;g.target==this.control&&(a=this[o+g.type.slice(5).slice(0,-6)],a.call(this,g.newVal,g))}function a(g,a){return this.config.view.getBaseCssClasses(a.params[0])}function b(g,a){return this.config.view.getBaseCssClass(a.params[0])}
var o="_onSet",p=c.trim,r=l.all,q=c.UA,s=c.Env.host.document;return e.extend({isRender:!0,createInternal:function(){var g=this.control.get("srcNode");g?this.decorateDom(g):this.callSuper()},beforeCreateDom:function(g){var a=this.control,b,c,e,h=a.get("elAttrs"),i=a.get("elCls"),d;b=a.getAttrs();d=a.get("elStyle");var k=a.get("elCls");for(c in b)e=b[c],e.view&&(g[c]=a.get(c));b=g.width;c=g.height;e=g.visible;g=g.zIndex;b&&(d.width=f(b));c&&(d.height=f(c));g&&(d["z-index"]=g);e||k.push(this.getBaseCssClasses("hidden"));
if(d=a.get("disabled"))i.push(this.getBaseCssClasses("disabled")),h["aria-disabled"]="true";a.get("highlighted")&&i.push(this.getBaseCssClasses("hover"));a.get("focusable")&&(q.ie&&(h.hideFocus="true"),h.tabindex=d?"-1":"0")},createDom:function(){this.beforeCreateDom(this.renderData={},this.childrenElSelectors={},this.renderCommands={getBaseCssClasses:a,getBaseCssClass:b});var g=this.control,n;n=this.renderTpl(i)+this.renderTpl(this.get("contentTpl"))+"</div>";g.setInternal("el",this.$el=r(n));this.el=
this.$el[0];this.fillChildrenElsBySelectors()},decorateDom:function(a){var b=this.control;a.attr("id")||a.attr("id",b.get("id"));var e=this.constructor.HTML_PARSER,f,d;for(f in e)d=e[f],"function"===typeof d?(d=d.call(this,a),void 0!==d&&b.setInternal(f,d)):"string"==typeof d?b.setInternal(f,a.one(d)):c.isArray(d)&&d[0]&&b.setInternal(f,a.all(d[0]));b.setInternal("el",this.$el=a);this.el=a[0]},renderUI:function(){var a=this.control,b=this.$el;if(!a.get("srcNode")){var c=a.get("render");(a=a.get("elBefore"))?
b.insertBefore(a,void 0):c?b.appendTo(c,void 0):b.appendTo(s.body,void 0)}},bindUI:function(){var a=this.control,b=a.getAttrs(),f,e;for(f in b){e=b[f];var d=c.ucfirst(f),h=this[o+d];if(e.view&&h)a.on("after"+d+"Change",m,this)}},destructor:function(){this.$el&&this.$el.remove()},$:function(a){return this.$el.all(a)},fillChildrenElsBySelectors:function(a){var b=this.$el,f=this.control,e,d,a=a||this.childrenElSelectors;for(e in a)d=a[e],"function"===typeof d?f.setInternal(e,d(b)):f.setInternal(e,this.$(c.substitute(d,
this.renderData))),delete a[e]},renderTpl:function(a,b,c){b=b||this.renderData;c=c||this.renderCommands;return(new (this.get("xtemplate"))(a,{control:this.control,view:this,commands:c})).render(b)},getComponentConstructorByNode:function(a,b){var c=b[0].className;return c?(c=c.replace(RegExp("\\b"+a,"ig"),""),j.getConstructorByXClass(c)):null},getComponentCssClasses:function(){if(this.componentCssClasses)return this.componentCssClasses;for(var a=this.control.constructor,b,c=[];a&&!a.prototype.hasOwnProperty("isControl");)(b=
a.xclass)&&c.push(b),a=a.superclass&&a.superclass.constructor;return this.componentCssClasses=c},getBaseCssClasses:function(a){for(var a=h(a),b=this.getComponentCssClasses(),c=0,e=this.get("control"),f="",d=b.length,e=e.get("prefixCls");c<d;c++)f+=k(e,b[c],a);return p(f)},getBaseCssClass:function(a){return p(k(this.control.get("prefixCls"),this.getComponentCssClasses()[0],h(a)))},getKeyEventTarget:function(){return this.$el},_onSetWidth:function(a){this.$el.width(a)},_onSetHeight:function(a){this.$el.height(a)},
_onSetContent:function(a){var b=this.$el;b.html(a);9>q.ie&&!this.get("allowTextSelection")&&b.unselectable()},_onSetVisible:function(a){var b=this.$el,c=this.getBaseCssClasses("hidden");a?b.removeClass(c):b.addClass(c)},_onSetHighlighted:function(a){var b=this.getBaseCssClasses("hover");this.$el[a?"addClass":"removeClass"](b)},_onSetDisabled:function(a){var b=this.control,c=this.getBaseCssClasses("disabled");this.$el[a?"addClass":"removeClass"](c).attr("aria-disabled",a);b.get("focusable")&&this.getKeyEventTarget().attr("tabindex",
a?-1:0)},_onSetActive:function(a){var b=this.getBaseCssClasses("active");this.$el[a?"addClass":"removeClass"](b).attr("aria-pressed",!!a)},_onSetFocused:function(a){var b=this.$el,c=this.getBaseCssClasses("focused");b[a?"addClass":"removeClass"](c)},_onSetZIndex:function(a){this.$el.css("z-index",a)}},{__hooks__:{decorateDom:e.prototype.__getHook("__decorateDom"),beforeCreateDom:e.prototype.__getHook("__beforeCreateDom")},extend:function n(a,b,f){var d,h={};d=e.extend.apply(this,arguments);d.HTML_PARSER=
d.HTML_PARSER||{};c.isArray(a)&&(c.each(a.concat(d),function(a){a&&c.each(a.HTML_PARSER,function(a,b){h[b]=a})}),d.HTML_PARSER=h);c.mix(d.HTML_PARSER,this.HTML_PARSER,!1);d.extend=n;return d},ATTRS:{control:{setter:function(a){this.control=a}},xtemplate:{value:d},contentTpl:{value:function(a){return a&&a[a.length-1].content||""}}},HTML_PARSER:{id:function(a){return(a=a[0].id)?a:void 0},content:function(a){return a.html()},disabled:function(a){return a.hasClass(this.getBaseCssClass("disabled"))}},
name:"render"})},{requires:["node","xtemplate/runtime","./process","./render-xtpl","component/manager"]});
KISSY.add("component/control",function(c,l,d,e,i,j){function f(){var a,b=this;do a=b.ATTRS,b=b.superclass;while(!a||!a.xrender);return a.xrender.value}var h=c.Env.host.document.documentMode||c.UA.ie,k=l.Gesture,m=c.Features.isTouchEventSupported(),i=d.extend({isControl:!0,createDom:function(){var a=this.get("xrender"),b=this.get("view"),c=this.get("id");b?b.set("control",this):this.set("view",this.view=b=new a({control:this}));b.create();a=b.getKeyEventTarget();this.get("allowTextSelection")||a.unselectable();
e.addComponent(c,this)},renderUI:function(){this.view.render()},bindUI:function(){var a=this.view.getKeyEventTarget();if(this.get("focusable"))a.on("focus",this.handleFocus,this).on("blur",this.handleBlur,this).on("keydown",this.handleKeydown,this);if(this.get("handleMouseEvents")){a=this.$el;if(!m)a.on("mouseenter",this.handleMouseEnter,this).on("mouseleave",this.handleMouseLeave,this).on("contextmenu",this.handleContextMenu,this);a.on(k.start,this.handleMouseDown,this).on(k.end,this.handleMouseUp,
this).on(k.tap,this.handleClick,this);if(k.cancel)a.on(k.cancel,this.handleMouseUp,this);if(h&&9>h)a.on("dblclick",this.handleDblClick,this)}},sync:function(){this.fire("beforeSyncUI");this.syncUI();this.view.sync();this.__callPluginsMethod("pluginSyncUI");this.fire("afterSyncUI")},createComponent:function(a,b){return e.createComponent(a,b||this)},_onSetFocused:function(a){var b=this.view.getKeyEventTarget()[0];a?b.focus():b.ownerDocument.activeElement==b&&b.ownerDocument.body.focus()},_onSetX:function(a){this.$el.offset({left:a})},
_onSetY:function(a){this.$el.offset({top:a})},_onSetVisible:function(a){this.fire(a?"show":"hide")},show:function(){this.render();this.set("visible",!0);return this},hide:function(){this.set("visible",!1);return this},focus:function(){this.get("focusable")&&this.set("focused",!0)},blur:function(){this.get("focusable")&&this.set("focused",!1)},move:function(a,b){this.set({x:a,y:b})},handleDblClick:function(a){this.get("disabled")||this.handleDblClickInternal(a)},handleDblClickInternal:function(a){this.handleClickInternal(a)},
handleMouseEnter:function(a){this.get("disabled")||this.handleMouseEnterInternal(a)},handleMouseEnterInternal:function(a){this.set("highlighted",!!a)},handleMouseLeave:function(a){this.get("disabled")||this.handleMouseLeaveInternal(a)},handleMouseLeaveInternal:function(a){this.set("active",!1);this.set("highlighted",!a)},handleMouseDown:function(a){this.get("disabled")||this.handleMouseDownInternal(a)},handleMouseDownInternal:function(a){var b;if(1==a.which||m)this.get("activeable")&&this.set("active",
!0),this.get("focusable")&&this.focus(),this.get("allowTextSelection")||(b=(b=a.target.nodeName)&&b.toLowerCase(),"input"!=b&&"textarea"!=b&&a.preventDefault())},handleMouseUp:function(a){this.get("disabled")||this.handleMouseUpInternal(a)},handleMouseUpInternal:function(a){this.get("active")&&(1==a.which||m)&&this.set("active",!1)},handleContextMenu:function(a){this.get("disabled")||this.handleContextMenuInternal(a)},handleContextMenuInternal:function(){},handleFocus:function(){this.get("disabled")||
this.handleFocusInternal()},handleFocusInternal:function(){this.focus();this.fire("focus")},handleBlur:function(){this.get("disabled")||this.handleBlurInternal()},handleBlurInternal:function(){this.blur();this.fire("blur")},handleKeydown:function(a){return!this.get("disabled")&&this.handleKeyDownInternal(a)?(a.halt(),!0):j},handleKeyDownInternal:function(a){return a.keyCode==l.KeyCode.ENTER?this.handleClickInternal(a):j},handleClick:function(a){this.get("disabled")||this.handleClickInternal(a)},handleClickInternal:function(){},
destructor:function(){e.removeComponent(this.get("id"));this.view&&this.view.destroy()}},{name:"control",ATTRS:{id:{view:1,valueFn:function(){return c.guid("ks-component")}},content:{view:1,value:""},width:{view:1},height:{view:1},elCls:{view:1,value:[],setter:function(a){"string"==typeof a&&(a=a.split(/\s+/));return a||[]}},elStyle:{view:1,value:{}},elAttrs:{view:1,value:{}},elBefore:{},el:{setter:function(a){this.$el=a;this.el=a[0]}},x:{},y:{},xy:{setter:function(a){var b=c.makeArray(a);b.length&&
(b[0]&&this.set("x",b[0]),b[1]&&this.set("y",b[1]));return a},getter:function(){return[this.get("x"),this.get("y")]}},zIndex:{view:1},render:{},visible:{sync:0,value:!0,view:1},srcNode:{setter:function(a){return l.all(a)}},handleMouseEvents:{value:!0},focusable:{value:!0,view:1},allowTextSelection:{value:!1},activeable:{value:!0},focused:{view:1},active:{view:1,value:!1},highlighted:{view:1,value:!1},prefixCls:{view:1,value:c.config("component/prefixCls")||"ks-"},prefixXClass:{},parent:{setter:function(a,
b){(b=this.get("parent"))&&this.removeTarget(b);a&&this.addTarget(a)}},disabled:{view:1,value:!1},xrender:{value:i},view:{setter:function(a){this.view=a}}}});i.getDefaultRender=f;i.extend=function b(h,i,k){var j=c.makeArray(arguments),l,g=j[j.length-1];if(l=g.xclass)g.name=l;j=d.extend.apply(this,j);l&&e.setConstructorByXClass(l,j);j.extend=b;j.getDefaultRender=f;return j};return i},{requires:["node","./control/process","component/manager","./control/render"]});
