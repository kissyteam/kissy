/*
Copyright 2012, KISSY UI Library v1.40dev
MIT Licensed
build time: Oct 17 17:25
*/
KISSY.add("base/attribute",function(h,i){function l(a,b){return"string"==typeof b?a[b]:b}function k(a,b,c,d,e,g,f){f=f||c;return a.fire(b+h.ucfirst(c)+"Change",{attrName:f,subAttrName:g,prevVal:d,newVal:e})}function m(a,b,c){var d=a[b]||{};c&&(a[b]=d);return d}function f(a){return m(a,"__attrs",!0)}function n(a){return m(a,"__attrVals",!0)}function q(a,b){for(var c=0,d=b.length;a!=i&&c<d;c++)a=a[b[c]];return a}function r(a,b){var c;!a.hasAttr(b)&&-1!==b.indexOf(".")&&(c=b.split("."),b=c.shift());
return{path:c,name:b}}function s(a,b,c){var d=c;if(b){var a=d=a===i?{}:h.clone(a),e=b.length-1;if(0<=e){for(var g=0;g<e;g++)a=a[b[g]];a!=i&&(a[b[g]]=c)}}return d}function t(a,b,c,d,e){var d=d||{},g,f,j;j=r(a,b);var h=b,b=j.name;g=j.path;j=a.get(b);g&&(f=q(j,g));if(!g&&j===c||g&&f===c)return i;c=s(j,g,c);if(!d.silent&&!1===k(a,"before",b,j,c,h))return!1;c=a.setInternal(b,c,d);if(!1===c)return c;d.silent||(c=n(a)[b],k(a,"after",b,j,c,h),e?e.push({prevVal:j,newVal:c,attrName:b,subAttrName:h}):k(a,"",
"*",[j],[c],[h],[b]));return a}function o(){}function p(a,b){var c=f(a),d=m(c,b),e=d.valueFn;if(e&&(e=l(a,e)))e=e.call(a),e!==i&&(d.value=e),delete d.valueFn,c[b]=d;return d.value}function u(a,b,c,d){var e,g;e=r(a,b);b=e.name;if(e=e.path)g=a.get(b),c=s(g,e,c);if((e=m(f(a),b,!0).validator)&&(e=l(a,e)))if(a=e.call(a,c,b,d),a!==i&&!0!==a)return a;return i}o.INVALID={};var v=o.INVALID;o.prototype={getAttrs:function(){return f(this)},getAttrVals:function(){var a={},b,c=f(this);for(b in c)a[b]=this.get(b);
return a},addAttr:function(a,b,c){var d=f(this),b=h.clone(b);d[a]?h.mix(d[a],b,c):d[a]=b;return this},addAttrs:function(a,b){var c=this;h.each(a,function(a,b){c.addAttr(b,a)});b&&c.set(b);return c},hasAttr:function(a){return f(this).hasOwnProperty(a)},removeAttr:function(a){this.hasAttr(a)&&(delete f(this)[a],delete n(this)[a]);return this},set:function(a,b,c){if(h.isPlainObject(a)){var c=b,b=Object(a),d=[],e,g=[];for(a in b)(e=u(this,a,b[a],b))!==i&&g.push(e);if(g.length)return c&&c.error&&c.error(g),
!1;for(a in b)t(this,a,b[a],c,d);var f=[],j=[],m=[],n=[];h.each(d,function(a){j.push(a.prevVal);m.push(a.newVal);f.push(a.attrName);n.push(a.subAttrName)});f.length&&k(this,"","*",j,m,n,f);return this}return t(this,a,b,c)},setInternal:function(a,b,c){var d,e,g=m(f(this),a,!0).setter;e=u(this,a,b);if(e!==i)return c.error&&c.error(e),!1;if(g&&(g=l(this,g)))d=g.call(this,b,a);if(d===v)return!1;d!==i&&(b=d);n(this)[a]=b},get:function(a){var b,c=this.hasAttr(a),d=n(this),e;!c&&-1!==a.indexOf(".")&&(b=
a.split("."),a=b.shift());c=m(f(this),a).getter;e=a in d?d[a]:p(this,a);if(c&&(c=l(this,c)))e=c.call(this,e,a);!(a in d)&&e!==i&&(d[a]=e);b&&(e=q(e,b));return e},reset:function(a,b){if("string"==typeof a)return this.hasAttr(a)?this.set(a,p(this,a),b):this;var b=a,c=f(this),d={};for(a in c)d[a]=p(this,a);this.set(d,b);return this}};return o});
KISSY.add("base",function(h,i,l){function k(h){for(var f=this.constructor;f;){var i=f.ATTRS;if(i){var k=void 0;for(k in i)this.addAttr(k,i[k],!1)}f=f.superclass?f.superclass.constructor:null}if(h)for(var l in h)this.setInternal(l,h[l])}h.augment(k,l.Target,i);k.Attribute=i;return h.Base=k},{requires:["base/attribute","event"]});
