/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: Aug 19 17:23
*/
KISSY.add("date/format",function(x,c,z){function q(b,a,f){f.push({field:b,count:a})}function p(b,a,f,e){e=e||[];f=f||A;if(0<=b){if(100>b&&1<=a&&2>=a)return 10>b&&2==a&&e.push(C),e.push(b),e.join("");if(1E3<=b&&1E4>b){if(4==a)return e.push(b),e.join("");if(2==a&&2==f)return p(b%100,2,2,e)}}e.push(b+"");return e.join("")}function s(b,a,f){this.locale=a||z;for(var a=b.length,e=!1,c=[],d=null,n=0,k=-1,g=0;g<a;g++){var j=b.charAt(g);if("'"==j){if(g+1<a&&(j=b.charAt(g+1),"'"==j)){g++;0!=n&&(q(k,n,c),k=
-1,n=0);e&&(d+=j);continue}e?(c.push({text:d}),e=!1):(0!=n&&(q(k,n,c),k=-1,n=0),d="",e=!0)}else if(e)d+=j;else if("a"<=j&&"z">=j||"A"<=j&&"Z">=j){if(-1==h.indexOf(j))throw Error("Illegal pattern character '"+j+"'");-1==k||k==j?(k=j,n++):(q(k,n,c),k=j,n=1)}else 0!=n&&(q(k,n,c),k=-1,n=0),c.push({text:j})}if(e)throw Error("Unterminated quote");0!=n&&q(k,n,c);this.pattern=c;this.timezoneOffset=f}function D(b,a,f,e){switch(b){case "G":b=0<e.get(c.YEAR)?1:0;a=f.eras[b];break;case "y":b=e.get(c.YEAR);0>=
b&&(b=1-b);a=p(b,2,2!=a?A:2);break;case "M":b=e.get(c.MONTH);a=4<=a?f.months[b]:3==a?f.shortMonths[b]:p(b+1,a);break;case "k":a=p(e.get(c.HOUR_OF_DAY)||24,a);break;case "E":b=e.get(c.DAY_OF_WEEK);a=4<=a?f.weekdays[b]:f.shortWeekdays[b];break;case "a":a=f.ampms[12<=e.get(c.HOUR_OF_DAY)?1:0];break;case "h":a=p(e.get(c.HOUR_OF_DAY)%12||12,a);break;case "K":a=p(e.get(c.HOUR_OF_DAY)%12,a);break;case "Z":a=e.getTimezoneOffset();f=[0>a?"-":"+"];a=Math.abs(a);f.push(p(Math.floor(a/60)%100,2),p(a%60,2));a=
f.join("");break;default:b=e.get(y[b]),a=p(b,a)}return a}function w(b,a,f){var e=-1,c=-1,d,h=f.length;for(d=0;d<h;d++){var k=f[d],g=k.length,j;if(j=g>e)a:{j=b;for(var p=a,o=g,i=0;i<o;i++)if(j.charAt(p+i)!=k.charAt(i)){j=!1;break a}j=!0}j&&(e=g,c=d)}return 0<=c?{value:c,startIndex:a+e}:null}function t(b,a,f,e){var c=b;if(e){if(b.length<=a+f)return null;c=b.substring(a,f);if(!c.match(/^\d+$/))return null}else c=c.substring(a);b=parseInt(c,10);if(isNaN(b))a=null;else{for(var d=c.length,f=0;f<d&&!(e=
c.charAt(f),"0">e||"9"<e);f++);a={value:b,startIndex:a+f}}return a}var A=Number.MAX_VALUE,h=Array(c.DAY_OF_WEEK_IN_MONTH+2).join("1"),y={},h=h.split("");h[0]="G";h[c.YEAR]="y";h[c.MONTH]="M";h[c.DAY_OF_MONTH]="d";h[c.HOUR_OF_DAY]="H";h[c.MINUTE]="m";h[c.SECOND]="s";h[c.MILLISECOND]="S";h[c.WEEK_OF_YEAR]="w";h[c.WEEK_OF_MONTH]="W";h[c.DAY_OF_YEAR]="D";h[c.DAY_OF_WEEK_IN_MONTH]="F";x.each(h,function(b,a){y[b]=a});var h=h.join("")+"ahkKZE",C="0";s.prototype={format:function(b){var a=b.getTimeInMillis(),
b=new c(this.timezoneOffset,this.locale);b.setTimeInMillis(a);for(var f=[],e=this.pattern,h=e.length,a=0;a<h;a++){var d=e[a];d.text?f.push(d.text):"field"in d&&f.push(D(d.field,d.count,this.locale,b))}return f.join("")},parse:function(b){var a=new c(this.timezoneOffset,this.locale),f,e,h={},d=!1,n=b.length,k=-1,g=0;e=0;var j=this.pattern,p=j.length;a:for(f=0;0>k&&f<p;f++){var o=j[f],i,l;e=g;if(i=o.text)if(l=i.length,l+g>n)k=g;else{for(e=0;e<l;e++)if(i.charAt(e)!=b.charAt(e+g)){k=g;break a}g+=l}else if("field"in
o){d=!1;if(i=j[f+1])"field"in i?d=!0:(i=i.text.charAt(0),"0"<=i&&"9">=i&&(d=!0));i=a;l=b;var r=o.field,o=o.count,q=this.locale,u=d,v=h,m=d=void 0,m=void 0;if(!(l.length<=g)){switch(r){case "G":if(d=w(l,g,q.eras))i.isSet(c.YEAR)?0==d.value&&(m=i.get(c.YEAR),i.set(c.YEAR,1-m)):v.era=d.value;break;case "y":if(d=t(l,g,o,u))m=d.value,"era"in v&&0===v.era&&(m=1-m),i.set(c.YEAR,m);break;case "M":r=void 0;if(3<=o){if(d=w(l,g,q[3==o?"shortMonths":"months"]))r=d.value}else if(d=t(l,g,o,u))r=d.value-1;d&&i.set(c.MONTH,
r);break;case "k":(d=t(l,g,o,u))&&i.set(c.HOUR_OF_DAY,d.value%24);break;case "E":(d=w(l,g,q[3<o?"weekdays":"shortWeekdays"]))&&i.set(c.DAY_OF_WEEK,d.value);break;case "a":if(d=w(l,g,q.ampms))i.isSet(c.HOUR_OF_DAY)?d.value&&(m=i.get(c.HOUR_OF_DAY),12>m&&i.set(c.HOUR_OF_DAY,(m+12)%24)):v.ampm=d.value;break;case "h":if(d=t(l,g,o,u))m=d.value%=12,v.ampm&&(m+=12),i.set(c.HOUR_OF_DAY,m);break;case "K":if(d=t(l,g,o,u))m=d.value,v.ampm&&(m+=12),i.set(c.HOUR_OF_DAY,m);break;case "Z":if(l)var s=l.charAt(g);
if("-"==s)g++;else if("+"==s)g++;else break;if(d=t(l,g,2,!0)){r=60*d.value;g=d.startIndex;if(d=t(l,g,2,!0))r+=d.value;i.setTimezoneOffset(r)}break;default:(d=t(l,g,o,u))&&i.set(y[r],d.value)}d&&(g=d.startIndex)}g==e&&(k=g)}}if(0<=k)throw Error("error when parsing date");return a}};var B=s.Style={FULL:0,LONG:1,MEDIUM:2,SHORT:3};x.mix(s,{getInstance:function(b,a){return this.getDateTimeInstance(B.SHORT,B.SHORT,b,a)},getDateInstance:function(b,a,c){return this.getDateTimeInstance(b,void 0,a,c)},getDateTimeInstance:function(b,
a,c,e){var c=c||z,h="";void 0!==b&&(h=c.datePatterns[b]);b="";void 0!==a&&(b=c.timePatterns[a]);a=h;b&&(a=h?x.substitute(c.dateTimePattern,{date:h,time:b}):b);return new s(a,c,e)},getTimeInstance:function(b,a,c){return this.getDateTimeInstance(void 0,b,a,c)}});return s},{requires:["date/gregorian","i18n!date"]});
