/*
Copyright 2012, KISSY UI Library v1.40dev
MIT Licensed
build time: Oct 10 13:59
*/
KISSY.add("menu/base",function(e,c,f,b){function a(){this.set("highlightedItem",null)}var g=c.KeyCodes,d=f.Container.extend({_uiSetHighlightedItem:function(a,b){var g=b&&b.prevVal;g&&g.set("highlighted",!1);a&&a.set("highlighted",!0);this.set("activeItem",a)},handleBlur:function(a){d.superclass.handleBlur.call(this,a);this.set("highlightedItem",null)},_getNextEnabledHighlighted:function(a,b){var g=this.get("children"),e=g.length,c=a;do{var d=g[a];if(!d.get("disabled")&&!1!==d.get("visible"))return g[a];
a=(a+b+e)%e}while(a!=c)},handleKeyEventInternal:function(a){var b=this.get("highlightedItem");if(b&&b.handleKeydown(a))return!0;var c=this.get("children"),d=c.length;if(0!==d){switch(a.keyCode){case g.ESC:return;case g.HOME:this.set("highlightedItem",this._getNextEnabledHighlighted(0,1));break;case g.END:this.set("highlightedItem",this._getNextEnabledHighlighted(d-1,-1));break;case g.UP:b?(a=e.indexOf(b,c),d=(a-1+d)%d):d-=1;this.set("highlightedItem",this._getNextEnabledHighlighted(d,-1));break;case g.DOWN:b?
(a=e.indexOf(b,c),d=(a+1+d)%d):d=0;this.set("highlightedItem",this._getNextEnabledHighlighted(d,1));break;default:return}return!0}},bindUI:function(){this.on("hide",a,this)},containsElement:function(a){if(!1===this.get("visible")||!this.get("view"))return!1;if(this.get("view").containsElement(a))return!0;for(var b=this.get("children"),g=0,d=b.length;g<d;g++){var e=b[g];if("function"==typeof e.containsElement&&e.containsElement(a))return!0}return!1}},{ATTRS:{highlightedItem:{},activeItem:{view:1},
xrender:{value:b}}},{xclass:"menu",priority:10});return d},{requires:["event","component","./menuRender","./submenu"]});
KISSY.add("menu/filtermenu",function(e,c,f){var b=c.extend({bindUI:function(){this.get("view").get("filterInput").on("keyup",this.handleFilterEvent,this)},handleMouseEnter:function(){b.superclass.handleMouseEnter.apply(this,arguments);this.getKeyEventTarget()[0].select()},handleFilterEvent:function(){var a=this.get("view").get("filterInput"),b=this.get("highlightedItem");this.set("filterStr",a.val());(!b||!b.get("visible"))&&this.set("highlightedItem",this._getNextEnabledHighlighted(0,1))},_uiSetFilterStr:function(a){this.filterItems(a)},
filterItems:function(a){var b=this.get("prefixCls"),d=this.get("view"),c=d.get("labelEl"),d=d.get("filterInput");c[a?"hide":"show"]();if(this.get("allowMultiple")){var c=[],f;f=a.match(/(.+)[,\uff0c]\s*([^\uff0c,]*)/);var h=[];f&&(h=f[1].split(/[,\uff0c]/));/[,\uff0c]$/.test(a)?(c=[],f&&(c=h,f=h[h.length-1],(h=(h=this.get("highlightedItem"))&&h.get("content"))&&-1<h.indexOf(f)&&f&&(c[c.length-1]=h),d.val(c.join(",")+",")),a=""):(f&&(a=f[2]||""),c=h);this.get("enteredItems").length!=c.length&&this.set("enteredItems",
c)}var d=this.get("children"),k=a&&RegExp(a.replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08"),"ig");e.each(d,function(c){var d=c.get("content");a?-1<d.indexOf(a)?(c.set("visible",!0),c.get("el").html(d.replace(k,function(a){return"<span class='"+b+"menuitem-hit'>"+a+"</span>"}))):c.set("visible",!1):(c.get("el").html(d),c.set("visible",!0))})},decorateInternal:function(a){var b=this.get("prefixCls");this.set("el",a);this.decorateChildren(a.one("."+b+"menu-content"))},reset:function(){var a=
this.get("view");this.set("filterStr","");this.set("enteredItems",[]);(a=a&&a.get("filterInput"))&&a.val("")},destructor:function(){var a=this.get("view");(a=a&&a.get("filterInput"))&&a.detach()}},{ATTRS:{allowTextSelection:{value:!0},label:{view:1},filterStr:{},enteredItems:{value:[]},allowMultiple:{value:!1},xrender:{value:f}}},{xclass:"filter-menu",priority:20});return b},{requires:["./base","./filtermenuRender"]});
KISSY.add("menu/filtermenuRender",function(e,c,f){var b=c.all;return f.extend({getContentElement:function(){return this.get("menuContent")},getKeyEventTarget:function(){return this.get("filterInput")},createDom:function(){var a=this.get("prefixCls"),c=f.prototype.getContentElement.call(this),d=this.get("filterWrap");d||this.set("filterWrap",d=b("<div class='"+a+"menu-filter'/>").appendTo(c,void 0));this.get("labelEl")||this.set("labelEl",b("<div class='"+a+"menu-filter-label'/>").appendTo(d,void 0));
this.get("filterInput")||this.set("filterInput",b("<input autocomplete='off'/>").appendTo(d,void 0));this.get("menuContent")||this.set("menuContent",b("<div class='"+a+"menu-content'/>").appendTo(c,void 0))},_uiSetLabel:function(a){this.get("labelEl").html(a)}},{ATTRS:{label:{}},HTML_PARSER:{labelEl:function(a){return a.one("."+this.get("prefixCls")+"menu-filter").one("."+this.get("prefixCls")+"menu-filter-label")},filterWrap:function(a){return a.one("."+this.get("prefixCls")+"menu-filter")},menuContent:function(a){return a.one("."+
this.get("prefixCls")+"menu-content")},filterInput:function(a){return a.one("."+this.get("prefixCls")+"menu-filter").one("input")}}})},{requires:["node","./menuRender"]});KISSY.add("menu",function(e,c,f,b,a,g,d,i,j,h){c.Render=f;c.Item=b;b.Render=a;c.SubMenu=g;g.Render=d;c.PopupMenu=i;i.Render=j;c.FilterMenu=h;return c},{requires:"menu/base,menu/menuRender,menu/menuitem,menu/menuitemRender,menu/submenu,menu/submenuRender,menu/popupmenu,menu/popupmenuRender,menu/filtermenu".split(",")});
KISSY.add("menu/menuRender",function(e,c,f){return f.Render.extend({renderUI:function(){var b=this.get("el");b.attr("role","menu").attr("aria-haspopup",!0);b.attr("id")||b.attr("id",e.guid("ks-menu"))},_uiSetActiveItem:function(b){var a=this.get("el");b?(b=b.get("el").attr("id"),a.attr("aria-activedescendant",b)):a.attr("aria-activedescendant","")},containsElement:function(b){var a=this.get("el");return a[0]===b||a.contains(b)}},{ATTRS:{activeItem:{}}})},{requires:["ua","component"]});
KISSY.add("menu/menuitem",function(e,c,f){var b=e.all,a=c.Controller.extend({bindUI:function(){this.publish("click",{bubbles:1})},handleMouseEnter:function(b){if(a.superclass.handleMouseEnter.call(this,b))return!0;this.get("parent").set("highlightedItem",this)},handleMouseLeave:function(b){if(a.superclass.handleMouseLeave.call(this,b))return!0;this.get("parent").set("highlightedItem",null)},performActionInternal:function(){this.get("selectable")&&this.set("selected",!0);this.get("checkable")&&this.set("checked",
!this.get("checked"));this.fire("click");return!0},_uiSetHighlighted:function(a){if(a){var a=this.get("el"),c=a.parent(function(a){return"visible"!=b(a).css("overflow")},this.get("parent").get("el").parent());c&&a.scrollIntoView(c,void 0,void 0,!0)}},containsElement:function(a){return this.get("view")&&this.get("view").containsElement(a)}},{ATTRS:{focusable:{value:!1},handleMouseEvents:{value:!1},selectable:{view:1},checkable:{view:1},value:{},checked:{view:1},selected:{view:1},xrender:{value:f}}},
{xclass:"menuitem",priority:10});return a},{requires:["component","./menuitemRender"]});
KISSY.add("menu/menuitemRender",function(e,c,f){return f.Render.extend({_uiSetChecked:function(b){var a=this.get("el"),c=this.getComponentCssClassWithState("-checked");a[b?"addClass":"removeClass"](c)},_uiSetSelected:function(b){var a=this.get("el"),c=this.getComponentCssClassWithState("-selected");a[b?"addClass":"removeClass"](c)},_uiSetSelectable:function(b){this.get("el").attr("role",b?"menuitemradio":"menuitem")},_uiSetCheckable:function(b){if(b){var a=this.get("el"),e=this.get("prefixCls"),d=
a.one("."+e+"menuitem-checkbox");d||(d=(new c("<div class='"+e+"menuitem-checkbox'/>")).prependTo(a),d.unselectable())}this.get("el").attr("role",b?"menuitemcheckbox":"menuitem")},containsElement:function(b){var a=this.get("el");return a&&(a[0]==b||a.contains(b))}},{ATTRS:{checkable:{},elAttrs:{valueFn:function(){return{role:"menuitem",id:e.guid("ks-menuitem")}}},selected:{},checked:{}},HTML_PARSER:{selectable:function(b){var a=this.getCssClassWithPrefix("menuitem-selectable");return b.hasClass(a)},
checkable:function(b){var a=this.getCssClassWithPrefix("menuitem-checkable");return b.hasClass(a)}}})},{requires:["node","component"]});
KISSY.add("menu/popupmenu",function(e,c,f,b){var e=c.UIBase,a=f.extend([e.ContentBox,e.Position,e.Align],{handleMouseLeave:function(){this.get("autoHideOnMouseLeave")&&this.get("parent").hideParentMenusBuffer()},handleBlur:function(){a.superclass.handleBlur.apply(this,arguments);this.hide()}},{ATTRS:{focusable:{value:!1},autoHideOnMouseLeave:{},xrender:{value:b}}},{xclass:"popupmenu",priority:20});return a},{requires:["component","./base","./popupmenuRender"]});
KISSY.add("menu/popupmenuRender",function(e,c,f,b){e=f.UIBase;return b.extend([e.ContentBox.Render,e.Position.Render,6===c.ie?e.Shim.Render:null])},{requires:["ua","component","./menuRender"]});
KISSY.add("menu/submenu",function(e,c,f,b,a){function g(a,b){var c=a.get("menu");if(c&&c.xclass)if(b)c=f.create(c,a),a.setInternal("menu",c);else return null;return c}function d(a){var b=g(this),a=a.target,c=this.get("parent");this.get("el");c.containsElement(a)||(b&&b.hide(),this.get("parent").set("highlightedItem",null))}function i(){var a=g(this,1);if(a){this.bindSubMenu();var b=e.clone(a.get("align"));b.node=this.get("el");b.points=b.points||["tr","tl"];a.set("align",b);a.show();this.get("el").attr("aria-haspopup",
a.get("el").attr("id"))}}function j(){var a=g(this);a&&a.hide()}function h(a){a.newVal&&(this.clearSubMenuTimers(),this.get("parent").set("highlightedItem",this))}function k(){var a=g(this);a&&a.hide()}var m=c.KeyCodes,n=e.Env.host.document,l=b.extend([f.DecorateChild],{bindSubMenu:function(){var a=this,b=a.get("menu"),f=a.get("parent");f&&(f.on("hide",k,a),f.__bindDocClickToHide||(c.on(n,"click",d,a),f.__bindDocClickToHide=1,b.__bindDocClickToHide=1),b.on("afterActiveItemChange",function(a){f.set("activeItem",
a.newVal)}),b.on("afterHighlightedItemChange",function(b){b.newVal&&a.set("highlighted",true)}),a.bindSubMenu=e.noop);b.on("beforeHighlightedItemChange",h,a)},handleMouseEnter:function(a){if(l.superclass.handleMouseEnter.call(this,a))return!0;this.clearSubMenuTimers();this.showTimer_=e.later(i,1E3*this.get("menuDelay"),!1,this)},_uiSetHighlighted:function(a){a||(this.dismissTimer_=e.later(j,1E3*this.get("menuDelay"),!1,this))},clearSubMenuTimers:function(){var a;if(a=this.dismissTimer_)a.cancel(),
this.dismissTimer_=null;if(a=this.showTimer_)a.cancel(),this.showTimer_=null},performActionInternal:function(){this.clearSubMenuTimers();i.call(this);l.superclass.performActionInternal.apply(this,arguments)},handleKeydown:function(a){var b=g(this),d=b&&b.get("visible"),e=a.keyCode;if(d){if(!b.handleKeydown(a))if(e==m.LEFT)j.call(this),this.get("parent").set("activeItem",this);else return}else if(e==m.RIGHT){if(i.call(this),b=g(this))a=b.get("children"),a[0]&&b.set("highlightedItem",a[0])}else{if(a.keyCode==
c.KeyCodes.ENTER)return this.performActionInternal(a);return}return!0},hideParentMenusBuffer:function(){var a=this,b=a.get("parent");a.dismissTimer_=e.later(function(){for(var c=a,d=a.get("menu");d.get("autoHideOnMouseLeave");){c.set("highlighted",!1);if(b.get("highlightedItem")!=c)break;c=b.get("parent");if(!c)break;b=c.get("parent");d=c.get("menu")}},1E3*a.get("menuDelay"),!1,a)},containsElement:function(a){var b=g(this);return b&&b.containsElement(a)},decorateChildrenInternal:function(a,b){b.css("visibility",
"hidden");e.one(b[0].ownerDocument.body).prepend(b);this.setInternal("menu",new a({srcNode:b,prefixCls:this.get("prefixCls")}))},destructor:function(){var a=this.get("parent"),b=g(this);this.clearSubMenuTimers();b&&b.__bindDocClickToHide&&(b.__bindDocClickToHide=0,c.remove(n,"click",d,this));a&&a.detach("hide",k,this);b&&b.destroy&&b.destroy()}},{ATTRS:{menuDelay:{value:0.15},menu:{setter:function(a){a instanceof f.Controller&&a.setInternal("parent",this)}},decorateChildCls:{valueFn:function(){return this.get("prefixCls")+
"popupmenu"}},xrender:{value:a}}},{xclass:"submenu",priority:20});return l},{requires:["event","component","./menuitem","./submenuRender"]});
KISSY.add("menu/submenuRender",function(e,c){return c.extend({createDom:function(){this.get("el").attr("aria-haspopup","true").append(e.substitute('<span class="{prefixCls}submenu-arrow">\u25ba</span>',{prefixCls:this.get("prefixCls")}))}},{ATTRS:{arrowEl:{},contentEl:{valueFn:function(){return e.all(e.substitute('<span class="{prefixCls}menuitem-content"></span>',{prefixCls:this.get("prefixCls")}))}}},HTML_PARSER:{contentEl:function(c){return c.children("."+this.get("prefixCls")+"menuitem-content")}}})},
{requires:["./menuitemRender"]});
