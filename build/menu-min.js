/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: Aug 14 23:59
*/
KISSY.add("menu/menu-render",function(g,a){return a.getDefaultRender().extend({beforeCreateDom:function(a){a.elAttrs.role="menu"},containsElement:function(a){var d=this.$el;return d&&(d[0]===a||d.contains(a))}})},{requires:["component/container"]});
KISSY.add("menu/control",function(g,a,c,d,b,i){function j(f){f.target.isMenu&&(f=f.newVal,this.el.setAttribute("aria-activedescendant",f&&f.el.id||""))}var h=a.KeyCode;return c.extend([d],{isMenu:1,_onSetHighlightedItem:function(f,b){var d;f&&b&&(d=b.prevVal)&&d.set("highlighted",!1,{data:{byPassSetHighlightedItem:1}})},_onSetVisible:function(f,b){this.callSuper(b);var d;!f&&(d=this.get("highlightedItem"))&&d.set("highlighted",!1)},bindUI:function(){this.on("afterHighlightedItemChange",j,this)},getRootMenu:function(){return this},
handleMouseEnterInternal:function(f){this.callSuper(f);if((f=this.getRootMenu())&&f._popupAutoHideTimer)clearTimeout(f._popupAutoHideTimer),f._popupAutoHideTimer=null;this.focus()},handleBlurInternal:function(f){this.callSuper(f);var b;(b=this.get("highlightedItem"))&&b.set("highlighted",!1)},_getNextEnabledHighlighted:function(f,b){var d=this.get("children"),a=d.length,c=f;do{var j=d[f];if(!j.get("disabled")&&!1!==j.get("visible"))return d[f];f=(f+b+a)%a}while(f!=c);return i},handleKeyDownInternal:function(f){var b=
this.get("highlightedItem");if(b&&b.handleKeyDownInternal(f))return!0;var d=this.get("children"),a=d.length;if(0===a)return i;var c;switch(f.keyCode){case h.ESC:(b=this.get("highlightedItem"))&&b.set("highlighted",!1);break;case h.HOME:c=this._getNextEnabledHighlighted(0,1);break;case h.END:c=this._getNextEnabledHighlighted(a-1,-1);break;case h.UP:b?(f=g.indexOf(b,d),a=(f-1+a)%a):a-=1;c=this._getNextEnabledHighlighted(a,-1);break;case h.DOWN:b?(f=g.indexOf(b,d),a=(f+1+a)%a):a=0,c=this._getNextEnabledHighlighted(a,
1)}return c?(c.set("highlighted",!0,{data:{fromKeyboard:1}}),!0):i},containsElement:function(f){if(!this.get("visible")||!this.$el)return!1;if(this.view.containsElement(f))return!0;for(var b=this.get("children"),a=0,d=b.length;a<d;a++){var c=b[a];if(c.containsElement&&c.containsElement(f))return!0}return!1}},{ATTRS:{highlightedItem:{value:null},xrender:{value:b},defaultChildCfg:{value:{xclass:"menuitem"}}},xclass:"menu"})},{requires:["node","component/container","component/extension/delegate-children",
"./menu-render"]});
KISSY.add("menu/menuitem-render",function(g,a,c){return c.getDefaultRender().extend({beforeCreateDom:function(a){a.elAttrs.role=a.selectable?"menuitemradio":"menuitem";a.selected&&a.elCls.push(this.getBaseCssClasses("selected"))},_onSetSelected:function(a){var b=this.getBaseCssClasses("selected");this.$el[a?"addClass":"removeClass"](b)},containsElement:function(a){var b=this.$el;return b&&(b[0]==a||b.contains(a))}},{HTML_PARSER:{selectable:function(a){return a.hasClass(this.getBaseCssClass("selectable"))}}})},{requires:["node",
"component/control"]});
KISSY.add("menu/menuitem",function(g,a,c){var d=g.all;return a.extend({isMenuItem:1,handleMouseDownInternal:function(b){this.callSuper(b);this.set("highlighted",!0)},handleClickInternal:function(){this.get("selectable")&&this.set("selected",!0);this.fire("click");return!0},_onSetHighlighted:function(b,a){var c=this.get("parent");if(!a||!a.byPassSetHighlightedItem)this.get("rendered")?c.set("highlightedItem",b?this:null):b&&c.set("highlightedItem",this);if(b){var h=this.$el;(c=h.parent(function(f){return"visible"!=
d(f).css("overflow")},c.get("el").parent()))&&h.scrollIntoView(c,{alignWithTop:!0,allowHorizontalScroll:!0,onlyScrollIfNeeded:!0})}},containsElement:function(a){return this.view.containsElement(a)}},{ATTRS:{focusable:{value:!1},handleMouseEvents:{value:!1},selectable:{view:1},value:{},selected:{view:1},xrender:{value:c}},xclass:"menuitem"})},{requires:["component/control","./menuitem-render"]});KISSY.add("menu/check-menuitem-tpl","<div class=\"{{getBaseCssClasses 'checkbox'}}\">\n</div>\n{{{include 'component/extension/content-render/content-tpl'}}}");
KISSY.add("menu/check-menuitem-render",function(g,a,c,d){return a.extend([c],{beforeCreateDom:function(a){a.checked&&a.elCls.push(self.getBaseCssClasses("checked"))},_onSetChecked:function(a){var c=this.getBaseCssClasses("checked");this.$el[a?"addClass":"removeClass"](c)}},{ATTRS:{contentTpl:{value:d}}})},{requires:["./menuitem-render","component/extension/content-render","./check-menuitem-tpl"]});
KISSY.add("menu/check-menuitem",function(g,a,c){return a.extend({handleClickInternal:function(){this.set("checked",!this.get("checked"));this.fire("click");return!0}},{ATTRS:{checked:{view:1},xrender:{value:c}},xclass:"check-menuitem"})},{requires:["./menuitem","./check-menuitem-render"]});KISSY.add("menu/submenu-tpl","{{{include 'component/extension/content-render/content-tpl'}}}\n<span class=\"{{prefixCls}}submenu-arrow\">\u25ba</span>");
KISSY.add("menu/submenu-render",function(g,a,c,d){return c.extend([d],{decorateDom:function(a){var c=this.control,d=c.get("prefixCls"),a=a.one("."+d+"popupmenu"),h=a[0].ownerDocument.body;h.insertBefore(a[0],h.firstChild);h=this.getComponentConstructorByNode(d,a);c.setInternal("menu",new h({srcNode:a,prefixCls:d}))}},{ATTRS:{contentTpl:{value:a}}})},{requires:["./submenu-tpl","./menuitem-render","component/extension/content-render"]});
KISSY.add("menu/submenu",function(g,a,c,d){function b(a){var b=a.target;b!==this&&b.isMenuItem&&a.newVal&&(this.clearHidePopupMenuTimers(),this.get("highlighted")||(this.set("highlighted",!0),b.set("highlighted",!1),b.set("highlighted",!0)))}function i(){var a=this.get("menu"),b={node:this.$el,points:["tr","tl"],overflow:{adjustX:1,adjustY:1}};g.mix(a.get("align"),b,!1);a.show();this.el.setAttribute("aria-haspopup",a.get("el").attr("id"))}function j(){this.get("menu").hide()}var h=a.KeyCode;return c.extend({isSubMenu:1,
clearShowPopupMenuTimers:function(){var a;if(a=this._showTimer)a.cancel(),this._showTimer=null},clearHidePopupMenuTimers:function(){var a;if(a=this._dismissTimer)a.cancel(),this._dismissTimer=null},clearSubMenuTimers:function(){this.clearHidePopupMenuTimers();this.clearShowPopupMenuTimers()},bindUI:function(){this.on("afterHighlightedChange",b,this)},handleMouseLeaveInternal:function(){this.set("highlighted",!1,{data:{fromMouse:1}});this.clearSubMenuTimers();this.get("menu").get("visible")&&(this._dismissTimer=
g.later(j,1E3*this.get("menuDelay"),!1,this))},handleMouseEnterInternal:function(){this.set("highlighted",!0,{data:{fromMouse:1}});this.clearSubMenuTimers();this.get("menu").get("visible")||(this._showTimer=g.later(i,1E3*this.get("menuDelay"),!1,this))},_onSetHighlighted:function(a,b){b&&(this.callSuper(b),b.fromMouse||(a&&!b.fromKeyboard?i.call(this):a||j.call(this)))},handleClickInternal:function(){i.call(this);this.callSuper(e)},handleKeyDownInternal:function(a){var b=this.get("menu"),c,d=b.get("visible"),
g=a.keyCode;if(d){if(!b.handleKeyDownInternal(a))if(g==h.LEFT)this.set("highlighted",!1),this.set("highlighted",!0,{data:{fromKeyboard:1}});else return}else if(g==h.RIGHT)i.call(this),a=b.get("children"),(c=a[0])&&c.set("highlighted",!0,{data:{fromKeyboard:1}});else{if(g==h.ENTER)return this.handleClickInternal(a);return}return!0},containsElement:function(a){return this.get("menu").containsElement(a)},destructor:function(){var a=this.get("menu");this.clearSubMenuTimers();a.destroy()}},{ATTRS:{menuDelay:{value:0.15},
menu:{value:{},getter:function(a){a.isControl||(a.xclass=a.xclass||"popupmenu",a=this.createComponent(a),this.setInternal("menu",a));return a},setter:function(a){a.isControl&&a.setInternal("parent",this)}},xrender:{value:d}},xclass:"submenu"})},{requires:["node","./menuitem","./submenu-render"]});KISSY.add("menu/popupmenu-render",function(g,a,c,d){return d.extend([a,c])},{requires:["component/extension/content-render","component/extension/shim-render","./menu-render"]});
KISSY.add("menu/popupmenu",function(g,a,c,d){return c.extend([a],{getRootMenu:function(){var a=this,c;do c=a,a=a.get("parent");while(a&&(a.isMenuItem||a.isMenu));return c===this?null:c},handleMouseLeaveInternal:function(a){this.callSuper(a);if(this.get("autoHideOnMouseLeave")){var c=this.getRootMenu();c&&(clearTimeout(c._popupAutoHideTimer),c._popupAutoHideTimer=setTimeout(function(){var a;(a=c.get("highlightedItem"))&&a.set("highlighted",!1)},1E3*this.get("parent").get("menuDelay")))}},isPopupMenu:1,
handleBlurInternal:function(a){this.callSuper(a);this.hide()}},{ATTRS:{focusable:{value:!1},autoHideOnMouseLeave:{},contentEl:{},visible:{value:!1},xrender:{value:d}},xclass:"popupmenu"})},{requires:["component/extension/align","./control","./popupmenu-render"]});KISSY.add("menu",function(g,a,c,d,b,i){a.Item=c;a.CheckItem=d;a.SubMenu=b;a.PopupMenu=i;return a},{requires:["menu/control","menu/menuitem","menu/check-menuitem","menu/submenu","menu/popupmenu"]});
