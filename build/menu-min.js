/*
Copyright 2013, KISSY v1.40dev
MIT Licensed
build time: Sep 17 23:08
*/
KISSY.add("menu/menu-render",function(f,c){return c.getDefaultRender().extend({beforeCreateDom:function(c){c.elAttrs.role="menu"},containsElement:function(c){var b=this.$el;return b&&(b[0]===c||b.contains(c))}})},{requires:["component/container"]});
KISSY.add("menu/control",function(f,c,h,b,a,i){function g(d){d.target.isMenu&&(d=d.newVal,this.el.setAttribute("aria-activedescendant",d&&d.el.id||""))}var j=c.KeyCode;return h.extend([b],{isMenu:1,_onSetHighlightedItem:function(d,a){var b;d&&a&&(b=a.prevVal)&&b.set("highlighted",!1,{data:{byPassSetHighlightedItem:1}})},_onSetVisible:function(d,a){this.callSuper(a);var b;!d&&(b=this.get("highlightedItem"))&&b.set("highlighted",!1)},bindUI:function(){this.on("afterHighlightedItemChange",g,this)},getRootMenu:function(){return this},
handleMouseEnterInternal:function(d){this.callSuper(d);if((d=this.getRootMenu())&&d._popupAutoHideTimer)clearTimeout(d._popupAutoHideTimer),d._popupAutoHideTimer=null;this.focus()},handleBlurInternal:function(d){this.callSuper(d);var a;(a=this.get("highlightedItem"))&&a.set("highlighted",!1)},_getNextEnabledHighlighted:function(d,a){var b=this.get("children"),c=b.length,f=d;do{var g=b[d];if(!g.get("disabled")&&!1!==g.get("visible"))return b[d];d=(d+a+c)%c}while(d!=f);return i},handleKeyDownInternal:function(d){var a=
this.get("highlightedItem");if(a&&a.handleKeyDownInternal(d))return!0;var b=this.get("children"),c=b.length;if(0===c)return i;var g;switch(d.keyCode){case j.ESC:(a=this.get("highlightedItem"))&&a.set("highlighted",!1);break;case j.HOME:g=this._getNextEnabledHighlighted(0,1);break;case j.END:g=this._getNextEnabledHighlighted(c-1,-1);break;case j.UP:a?(d=f.indexOf(a,b),c=(d-1+c)%c):c-=1;g=this._getNextEnabledHighlighted(c,-1);break;case j.DOWN:a?(d=f.indexOf(a,b),c=(d+1+c)%c):c=0,g=this._getNextEnabledHighlighted(c,
1)}return g?(g.set("highlighted",!0,{data:{fromKeyboard:1}}),!0):i},containsElement:function(d){if(!this.get("visible")||!this.$el)return!1;if(this.view.containsElement(d))return!0;for(var a=this.get("children"),b=0,c=a.length;b<c;b++){var i=a[b];if(i.containsElement&&i.containsElement(d))return!0}return!1}},{ATTRS:{highlightedItem:{value:null},xrender:{value:a},defaultChildCfg:{value:{xclass:"menuitem"}}},xclass:"menu"})},{requires:["node","component/container","component/extension/delegate-children",
"./menu-render"]});
KISSY.add("menu/menuitem-render",function(f,c,h){return h.getDefaultRender().extend({beforeCreateDom:function(b){b.elAttrs.role=b.selectable?"menuitemradio":"menuitem";b.selected&&b.elCls.push(this.getBaseCssClasses("selected"))},_onSetSelected:function(b){var a=this.getBaseCssClasses("selected");this.$el[b?"addClass":"removeClass"](a)},containsElement:function(b){var a=this.$el;return a&&(a[0]==b||a.contains(b))}},{HTML_PARSER:{selectable:function(b){return b.hasClass(this.getBaseCssClass("selectable"))}}})},{requires:["node",
"component/control"]});
KISSY.add("menu/menuitem",function(f,c,h){var b=f.all;return c.extend({isMenuItem:1,handleMouseDownInternal:function(a){this.callSuper(a);this.set("highlighted",!0)},handleClickInternal:function(){this.get("selectable")&&this.set("selected",!0);this.fire("click");return!0},_onSetHighlighted:function(a,c){var g=this.get("parent");if(!c||!c.byPassSetHighlightedItem)this.get("rendered")?g.set("highlightedItem",a?this:null):a&&g.set("highlightedItem",this);if(a){var f=this.$el;(g=f.parent(function(d){return"visible"!=
b(d).css("overflow")},g.get("el").parent()))&&f.scrollIntoView(g,{alignWithTop:!0,allowHorizontalScroll:!0,onlyScrollIfNeeded:!0})}},containsElement:function(a){return this.view.containsElement(a)}},{ATTRS:{focusable:{value:!1},handleMouseEvents:{value:!1},selectable:{view:1},value:{},selected:{view:1},xrender:{value:h}},xclass:"menuitem"})},{requires:["component/control","./menuitem-render"]});
KISSY.add("menu/check-menuitem-xtpl",function(){return function(f,c,h){var b=this.config.utils.getPropertyOrRunCommand,c='<div class="',a={},i=[];i.push("checkbox");a.params=i;a=b(this,f,a,"getBaseCssClasses",0,1,!0,h);c=c+a+'">\r\n</div>\r\n';a={};i=[];i.push("component/extension/content-render/content-xtpl");a.params=i;f=b(this,f,a,"include",0,3,!1,h);return c+f}});
KISSY.add("menu/check-menuitem-render",function(f,c,h,b){return c.extend([h],{beforeCreateDom:function(a){a.checked&&a.elCls.push(self.getBaseCssClasses("checked"))},_onSetChecked:function(a){var b=this.getBaseCssClasses("checked");this.$el[a?"addClass":"removeClass"](b)}},{ATTRS:{contentTpl:{value:b}}})},{requires:["./menuitem-render","component/extension/content-render","./check-menuitem-xtpl"]});
KISSY.add("menu/check-menuitem",function(f,c,h){return c.extend({handleClickInternal:function(){this.set("checked",!this.get("checked"));this.fire("click");return!0}},{ATTRS:{checked:{view:1},xrender:{value:h}},xclass:"check-menuitem"})},{requires:["./menuitem","./check-menuitem-render"]});
KISSY.add("menu/submenu-xtpl",function(){return function(f,c,h){var b;b=this.config.utils;var c=b.getExpression,a=b.getPropertyOrRunCommand;b="";var i={},g=[];g.push("component/extension/content-render/content-xtpl");i.params=g;i=a(this,f,i,"include",0,1,!1,h);b=b+i+'\r\n<span class="';f=a(this,f,{},"prefixCls",0,2,h,!1);b+=c(f,!0);return b+'submenu-arrow">\u25ba</span>'}});
KISSY.add("menu/submenu-render",function(f,c,h,b){return h.extend([b],{decorateDom:function(a){var b=this.control,c=b.get("prefixCls"),a=a.one("."+c+"popupmenu"),f=a[0].ownerDocument.body;f.insertBefore(a[0],f.firstChild);f=this.getComponentConstructorByNode(c,a);b.setInternal("menu",new f({srcNode:a,prefixCls:c}))}},{ATTRS:{contentTpl:{value:c}}})},{requires:["./submenu-xtpl","./menuitem-render","component/extension/content-render"]});
KISSY.add("menu/submenu",function(f,c,h,b){function a(d){var a=d.target;a!==this&&a.isMenuItem&&d.newVal&&(this.clearHidePopupMenuTimers(),this.get("highlighted")||(this.set("highlighted",!0),a.set("highlighted",!1),a.set("highlighted",!0)))}function i(){var d=this.get("menu"),a={node:this.$el,points:["tr","tl"],overflow:{adjustX:1,adjustY:1}};f.mix(d.get("align"),a,!1);d.show();this.el.setAttribute("aria-haspopup",d.get("el").attr("id"))}function g(){this.get("menu").hide()}var j=c.KeyCode;return h.extend({isSubMenu:1,
clearShowPopupMenuTimers:function(){var a;if(a=this._showTimer)a.cancel(),this._showTimer=null},clearHidePopupMenuTimers:function(){var a;if(a=this._dismissTimer)a.cancel(),this._dismissTimer=null},clearSubMenuTimers:function(){this.clearHidePopupMenuTimers();this.clearShowPopupMenuTimers()},bindUI:function(){this.on("afterHighlightedChange",a,this)},handleMouseLeaveInternal:function(){this.set("highlighted",!1,{data:{fromMouse:1}});this.clearSubMenuTimers();this.get("menu").get("visible")&&(this._dismissTimer=
f.later(g,1E3*this.get("menuDelay"),!1,this))},handleMouseEnterInternal:function(){this.set("highlighted",!0,{data:{fromMouse:1}});this.clearSubMenuTimers();this.get("menu").get("visible")||(this._showTimer=f.later(i,1E3*this.get("menuDelay"),!1,this))},_onSetHighlighted:function(a,b){b&&(this.callSuper(b),b.fromMouse||(a&&!b.fromKeyboard?i.call(this):a||g.call(this)))},handleClickInternal:function(){i.call(this);this.callSuper(e)},handleKeyDownInternal:function(a){var b=this.get("menu"),c,f=b.get("visible"),
g=a.keyCode;if(f){if(!b.handleKeyDownInternal(a))if(g==j.LEFT)this.set("highlighted",!1),this.set("highlighted",!0,{data:{fromKeyboard:1}});else return}else if(g==j.RIGHT)i.call(this),a=b.get("children"),(c=a[0])&&c.set("highlighted",!0,{data:{fromKeyboard:1}});else{if(g==j.ENTER)return this.handleClickInternal(a);return}return!0},containsElement:function(a){return this.get("menu").containsElement(a)},destructor:function(){var a=this.get("menu");this.clearSubMenuTimers();a.destroy()}},{ATTRS:{menuDelay:{value:0.15},
menu:{value:{},getter:function(a){a.isControl||(a.xclass=a.xclass||"popupmenu",a=this.createComponent(a),this.setInternal("menu",a));return a},setter:function(a){a.isControl&&a.setInternal("parent",this)}},xrender:{value:b}},xclass:"submenu"})},{requires:["node","./menuitem","./submenu-render"]});KISSY.add("menu/popupmenu-render",function(f,c,h){return h.extend([c])},{requires:["component/extension/content-render","./menu-render"]});
KISSY.add("menu/popupmenu",function(f,c,h,b,a){return b.extend([h,c],{getRootMenu:function(){var a=this,b;do b=a,a=a.get("parent");while(a&&(a.isMenuItem||a.isMenu));return b===this?null:b},handleMouseLeaveInternal:function(a){this.callSuper(a);if(this.get("autoHideOnMouseLeave")){var b=this.getRootMenu();b&&(clearTimeout(b._popupAutoHideTimer),b._popupAutoHideTimer=setTimeout(function(){var a;(a=b.get("highlightedItem"))&&a.set("highlighted",!1)},1E3*this.get("parent").get("menuDelay")))}},isPopupMenu:1,
handleBlurInternal:function(a){this.callSuper(a);this.hide()}},{ATTRS:{focusable:{value:!1},autoHideOnMouseLeave:{},contentEl:{},visible:{value:!1},xrender:{value:a}},xclass:"popupmenu"})},{requires:["component/extension/align","component/extension/shim","./control","./popupmenu-render"]});KISSY.add("menu",function(f,c,h,b,a,i){c.Item=h;c.CheckItem=b;c.SubMenu=a;c.PopupMenu=i;return c},{requires:["menu/control","menu/menuitem","menu/check-menuitem","menu/submenu","menu/popupmenu"]});
