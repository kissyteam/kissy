/*
Copyright 2013, KISSY v1.40dev
MIT Licensed
build time: Oct 25 16:49
*/
KISSY.add("editor/iframe-content-tpl",'<!doctype html>\n<html>\n<head>{doctype}\n    <title>{title}</title>\n    {style}\n    {links}\n    </head> \n<body class="ks-editor">\n{data}\n{script}\n</body> \n</html>');
KISSY.add("editor/render-xtpl",function(){return function(a,b,p){var l=this,b=this.config.utils,m=b.runBlockCommand,t=b.getExpression,k=b.getPropertyOrRunCommand,b='<div class="',g=k(l,a,{},"prefixCls",0,1,p,!1),b=b+t(g,!0),b=b+'editor-tools"\r\n     id="ks-editor-tools-',g=k(l,a,{},"id",0,2,p,!1),b=b+t(g,!0),b=b+'">\r\n\r\n</div>\r\n\r\n<\!--\r\nhttp://johanbrook.com/browsers/native-momentum-scrolling-ios-5/\r\nios \u4e0d\u80fd\u653e\u5728 iframe \u4e0a\uff01\r\n--\>\r\n\r\n<div class="',g=k(l,a,{},"prefixCls",0,11,p,!1),b=b+
t(g,!0),b=b+'editor-textarea-wrap"\r\n\r\n',g={},q=[],r=k(l,a,{},"mobile",0,13,p,!0);q.push(r);g.params=q;g.fn=function(){return'\r\nstyle="overflow:scroll;-webkit-overflow-scrolling:touch;"\r\n'};b+=m(l,a,g,"if",13);b+='\r\n\r\nid="ks-editor-textarea-wrap-';g=k(l,a,{},"id",0,17,p,!1);b+=t(g,!0);b+='"\r\n>\r\n\r\n<textarea\r\n        id="ks-editor-textarea-';g=k(l,a,{},"id",0,21,p,!1);b+=t(g,!0);b+='"\r\n        class="';g=k(l,a,{},"prefixCls",0,22,p,!1);b+=t(g,!0);b+='editor-textarea"\r\n\r\n';g=
{};q=[];r=k(l,a,{},"textareaAttrs",0,24,p,!0);q.push(r);g.params=q;g.fn=function(a){var n;n="\r\n";var g=k(l,a,{},"xindex",0,25,p,!1);n+=t(g,!0);n+='="';a=k(l,a,{},".",0,25,p,!1);n+=t(a,!0);return n+'"\r\n'};b+=m(l,a,g,"each",24);b+="\r\n\r\n";g={};q=[];r=k(l,a,{},"mode",0,28,p,!0);q.push(r);g.params=q;g.fn=function(){return'\r\nstyle="display:none"\r\n'};b+=m(l,a,g,"if",28);b+="\r\n\r\n>";m=k(l,a,{},"data",0,32,p,!1);b+=t(m,!0);b+='</textarea>\r\n\r\n</div>\r\n\r\n<div class="';m=k(l,a,{},"prefixCls",
0,36,p,!1);b+=t(m,!0);b+='editor-status"\r\n     id="ks-editor-status-';a=k(l,a,{},"id",0,37,p,!1);b+=t(a,!0);return b+'">\r\n\r\n</div>'}});KISSY.add("editor/render",function(a,b,p){return b.getDefaultRender().extend({beforeCreateDom:function(b,m){a.mix(b,{mobile:a.UA.mobile});a.mix(m,{textarea:"#ks-editor-textarea-{id}",toolBarEl:"#ks-editor-tools-{id}",statusBarEl:"#ks-editor-status-{id}"})}},{ATTRS:{contentTpl:{value:p}}})},{requires:["component/control","./render-xtpl"]});
KISSY.add("editor/base",function(a,b,p,l){return p.extend({},{Config:{},XHTML_DTD:b.DTD,ATTRS:{textarea:{},textareaAttrs:{view:1},iframe:{},window:{},document:{},toolBarEl:{},statusBarEl:{},handleMouseEvents:{value:!1},focusable:{value:!1},mode:{view:1,value:1},data:{view:1},customStyle:{value:""},customLink:{value:[]},xrender:{value:l}},xclass:"editor"})},{requires:["html-parser","component/control","./render"]});
KISSY.add("editor/utils",function(a,b){var p=a.Node,l=a.DOM,m=a.UA,t={debugUrl:function(k){var g=a.Config;g.debug||(k=k.replace(/\.(js|css)/i,"-min.$1"));-1==k.indexOf("?t")&&(k=-1!=k.indexOf("?")?k+"&":k+"?",k+="t="+encodeURIComponent(g.tag));return g.base+"editor/"+k},lazyRun:function(a,g,b){var r=a[g],l=a[b];a[g]=function(){r.apply(this,arguments);a[g]=a[b];return l.apply(this,arguments)}},getXY:function(a,g){var b=a.left,r=a.top,m=g.get("window")[0],b=b-l.scrollLeft(m),r=r-l.scrollTop(m),m=g.get("iframe").offset(),
b=b+m.left,r=r+m.top;return{left:b,top:r}},tryThese:function(a){for(var g,b=0,r=arguments.length;b<r;b++){var l=arguments[b];try{g=l();break}catch(n){}}return g},clearAllMarkers:function(a){for(var g in a)a[g]._4e_clearMarkers(a,!0,void 0)},ltrim:function(a){return a.replace(/^\s+/,"")},rtrim:function(a){return a.replace(/\s+$/,"")},isNumber:function(k){return/^\d+(.\d+)?$/.test(a.trim(k))},verifyInputs:function(k){for(var g=0;g<k.length;g++){var b=new p(k[g]),r=a.trim(t.valInput(b)),l=b.attr("data-verify"),
b=b.attr("data-warning");if(l&&!RegExp(l).test(r))return alert(b),!1}return!0},sourceDisable:function(a,b){a.on("sourceMode",b.disable,b);a.on("wysiwygMode",b.enable,b)},resetInput:function(a){var b=a.attr("placeholder");b&&m.ie?(a.addClass("ks-editor-input-tip"),a.val(b)):m.ie||a.val("")},valInput:function(a,b){if(void 0===b)return a.hasClass("ks-editor-input-tip")?"":a.val();a.removeClass("ks-editor-input-tip");a.val(b)},placeholder:function(b,g){b.attr("placeholder",g);m.ie&&(b.on("blur",function(){a.trim(b.val())||
(b.addClass("ks-editor-input-tip"),b.val(g))}),b.on("focus",function(){b.removeClass("ks-editor-input-tip");a.trim(b.val())==g&&b.val("")}))},normParams:function(b){var b=a.clone(b),g;for(g in b){var q=b[g];"function"===typeof q&&(b[g]=q())}return b},ieEngine:document.documentMode||m.ie,preventFocus:function(a){m.ie?a.unselectable():a.attr("onmousedown","return false;")},injectDom:function(b){a.mix(l,b);for(var g in b)(function(g){p.prototype[g]=function(){var r=[].slice.call(arguments,0);r.unshift(this[0]);
return(r=b[g].apply(null,r))&&(r.nodeType||a.isWindow(r))?new p(r):a.isArray(r)&&(r.__IS_NODELIST||r[0]&&r[0].nodeType)?new p(r):r}})(g)},addRes:function(){var b=this.__res=this.__res||[];b.push.apply(b,a.makeArray(arguments))},destroyRes:function(){for(var a=this.__res||[],b=0;b<a.length;b++){var q=a[b];"function"===typeof q?q():q.destroy?q.destroy():q.remove&&q.remove()}this.__res=[]},getQueryCmd:function(a){return"query"+("-"+a).replace(/-(\w)/g,function(a,b){return b.toUpperCase()})+"Value"}};
return b.Utils=t},{requires:["./base","node"]});
KISSY.add("editor/dom",function(a,b,p){function l(a,f){var d=a[f?"next":"prev"](m,1);if(d&&d[0].nodeType==g.ELEMENT_NODE){for(var c=[];d.attr("_ke_bookmark")||d._4e_isEmptyInlineRemovable(m);)if(c.push(d),d=f?d.next(m,1):d.prev(m,1),!d)return;if(a._4e_isIdentical(d,m)){for(var j=new r(f?a[0].lastChild:a[0].firstChild);c.length;)c.shift()._4e_move(a,!f,m);d._4e_moveChildren(a,!f,m);d.remove();j[0]&&j[0].nodeType==g.ELEMENT_NODE&&j._4e_mergeSiblings()}}}var m=m,t=b.XHTML_DTD,k=a.DOM,g=k.NodeType,q=
a.UA,r=a.Node,v={a:1,abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};b.PositionType={POSITION_IDENTICAL:0,POSITION_DISCONNECTED:1,POSITION_FOLLOWING:2,POSITION_PRECEDING:4,POSITION_IS_CONTAINED:8,POSITION_CONTAINS:16};var n=b.PositionType,w={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,
"table-column":1,"table-cell":1,"table-caption":1},x={hr:1},i=function(a){return a&&(a[0]||a)};p.injectDom({_4e_sameLevel:function(a,f){var f=i(f),d=a.parentNode;return d&&d==f.parentNode},_4e_isBlockBoundary:function(o,f){var d=a.merge(x,f);return!(!w[k.css(o,"display")]&&!d[k.nodeName(o)])},_4e_index:function(a,f){for(var d=a.parentNode.childNodes,c,j=-1,e=0;e<d.length;e++)if(c=d[e],!f||!(3==c.nodeType&&c.previousSibling&&3==c.previousSibling.nodeType))if(j++,c===a)return j;return-1},_4e_move:function(a,
f,d){f=i(f);d?f.insertBefore(a,f.firstChild):f.appendChild(a)},_4e_isIdentical:function(a,f){if(!f)return!1;f=i(f);if(k.nodeName(a)!=k.nodeName(f))return!1;var d=a.attributes,c=f.attributes,j=d.length,e=c.length;if(j!=e)return!1;for(var h=0;h<j;h++){var b=d[h],u=b.name;if(b.specified&&k.attr(a,u)!=k.attr(f,u))return!1}if(8>p.ieEngine)for(h=0;h<e;h++)if(b=c[h],u=b.name,b.specified&&k.attr(a,u)!=k.attr(f,u))return!1;return!0},_4e_isEmptyInlineRemovable:function(o){if(!t.$removeEmpty[k.nodeName(o)])return!1;
for(var o=o.childNodes,f=0,d=o.length;f<d;f++){var c=o[f],j=c.nodeType;if(!(j==g.ELEMENT_NODE&&c.getAttribute("_ke_bookmark"))&&(j==g.ELEMENT_NODE&&!k._4e_isEmptyInlineRemovable(c)||j==k.NodeType.TEXT_NODE&&a.trim(c.nodeValue)))return!1}return!0},_4e_moveChildren:function(a,f,d){f=i(f);if(a!=f)if(d)for(;d=a.lastChild;)f.insertBefore(a.removeChild(d),f.firstChild);else for(;d=a.firstChild;)f.appendChild(a.removeChild(d))},_4e_mergeSiblings:function(a){a=new r(a);v[a.nodeName()]&&(l(a,!0),l(a))},_4e_splitText:function(a,
f){var d=a.ownerDocument;if(a.nodeType==k.NodeType.TEXT_NODE){if(q.ie&&f==a.nodeValue.length){var c=d.createTextNode("");k.insertAfter(c,a);return c}c=a.splitText(f);d.documentMode&&(d=d.createTextNode(""),k.insertAfter(d,c),k.remove(d));return c}},_4e_parents:function(a,f){var d=[];d.__IS_NODELIST=1;do d[f?"push":"unshift"](a);while(a=a.parentNode);return d},_4e_nextSourceNode:function(a,f,d,c){if(c&&!c.call)var j=i(c),c=function(a){return a!==j};var f=!f&&a.firstChild,e=a;if(!f){if(a.nodeType==
g.ELEMENT_NODE&&c&&!1===c(a,!0))return null;f=a.nextSibling}for(;!f&&(e=e.parentNode);){if(c&&!1===c(e,!0))return null;f=e.nextSibling}return!f||c&&!1===c(f)?null:d&&d!=f.nodeType?k._4e_nextSourceNode(f,!1,d,c):f},_4e_previousSourceNode:function(a,f,d,c){if(c&&!c.call)var j=i(c),c=function(a){return a!==j};var f=!f&&a.lastChild,e=a;if(!f){if(a.nodeType==g.ELEMENT_NODE&&c&&!1===c(a,!0))return null;f=a.previousSibling}for(;!f&&(e=e.parentNode);){if(c&&!1===c(e,!0))return null;f=e.previousSibling}return!f||
c&&!1===c(f)?null:d&&f.nodeType!=d?k._4e_previousSourceNode(f,!1,d,c):f},_4e_commonAncestor:function(a,f){f=i(f);if(a===f)return a;if(k.contains(f,a))return f;var d=a;do if(k.contains(d,f))return d;while(d=d.parentNode);return null},_4e_hasAttributes:9>p.ieEngine?function(a){for(var f=a.attributes,d=0;d<f.length;d++){var c=f[d];switch(c.name){case "class":if(a.getAttribute("class"))return!0;break;default:if(c.specified)return!0}}return!1}:function(a){q.gecko&&a.removeAttribute("_moz_dirty");return a.hasAttributes()},
_4e_position:function(a,f){var d=i(f);if(a.compareDocumentPosition)return a.compareDocumentPosition(d);if(a==d)return n.POSITION_IDENTICAL;if(a.nodeType==g.ELEMENT_NODE&&d.nodeType==g.ELEMENT_NODE){if(k.contains(a,d))return n.POSITION_CONTAINS+n.POSITION_PRECEDING;if(k.contains(d,a))return n.POSITION_IS_CONTAINED+n.POSITION_FOLLOWING;if("sourceIndex"in a)return 0>a.sourceIndex||0>d.sourceIndex?n.POSITION_DISCONNECTED:a.sourceIndex<d.sourceIndex?n.POSITION_PRECEDING:n.POSITION_FOLLOWING}for(var c=
k._4e_address(a),d=k._4e_address(d),j=Math.min(c.length,d.length),e=0;e<=j-1;e++)if(c[e]!=d[e])return c[e]<d[e]?n.POSITION_PRECEDING:n.POSITION_FOLLOWING;return c.length<d.length?n.POSITION_CONTAINS+n.POSITION_PRECEDING:n.POSITION_IS_CONTAINED+n.POSITION_FOLLOWING},_4e_address:function(a,f){for(var d=[],c=a.ownerDocument.documentElement,j=a;j&&j!=c;)d.unshift(k._4e_index(j,f)),j=j.parentNode;return d},_4e_remove:function(a,f){var d=a.parentNode;if(d){if(f)for(var c;c=a.firstChild;)d.insertBefore(a.removeChild(c),
a);d.removeChild(a)}return a},_4e_trim:function(a){k._4e_ltrim(a);k._4e_rtrim(a)},_4e_ltrim:function(a){for(var f;f=a.firstChild;){if(f.nodeType==k.NodeType.TEXT_NODE){var d=p.ltrim(f.nodeValue),c=f.nodeValue.length;if(d)d.length<c&&(k._4e_splitText(f,c-d.length),a.removeChild(a.firstChild));else{a.removeChild(f);continue}}break}},_4e_rtrim:function(a){for(var f;f=a.lastChild;){if(f.type==k.NodeType.TEXT_NODE){var d=p.rtrim(f.nodeValue),c=f.nodeValue.length;if(d)d.length<c&&(k._4e_splitText(f,d.length),
a.removeChild(a.lastChild));else{a.removeChild(f);continue}}break}!q.ie&&!q.opera&&(f=a.lastChild)&&1==f.nodeType&&"br"==k.nodeName(f)&&a.removeChild(f)},_4e_appendBogus:function(b){for(var f=b.lastChild;f&&f.nodeType==k.NodeType.TEXT_NODE&&!a.trim(f.nodeValue);)f=f.previousSibling;if(!f||f.nodeType==k.NodeType.TEXT_NODE||"br"!==k.nodeName(f))f=q.opera?b.ownerDocument.createTextNode(""):b.ownerDocument.createElement("br"),b.appendChild(f)},_4e_setMarker:function(b,f,d,c){var b=new r(b),j=b.data("list_marker_id")||
b.data("list_marker_id",a.guid()).data("list_marker_id"),e=b.data("list_marker_names")||b.data("list_marker_names",{}).data("list_marker_names");f[j]=b;e[d]=1;return b.data(d,c)},_4e_clearMarkers:function(a,f,d){var a=new r(a),c=a.data("list_marker_names"),j=a.data("list_marker_id"),e;for(e in c)a.removeData(e);a.removeData("list_marker_names");d&&(a.removeData("list_marker_id"),delete f[j])},_4e_copyAttributes:function(a,f,d){for(var f=new r(f),c=a.attributes,d=d||{},j=0;j<c.length;j++){var e=c[j],
h=e.name.toLowerCase(),b;if(!(h in d))if("checked"==h&&(b=k.attr(a,h)))f.attr(h,b);else if(e.specified||q.ie&&e.value&&"value"==h)b=k.attr(a,h),null===b&&(b=e.nodeValue),f.attr(h,b)}""!==a.style.cssText&&(f[0].style.cssText=a.style.cssText)},_4e_isEditable:function(a){a=k.nodeName(a);return(a=!t.$nonEditable[a]&&(t[a]||t.span))&&a["#text"]},_4e_getByAddress:function(a,f,d){for(var a=a.documentElement,c=0;a&&c<f.length;c++){var j=f[c];if(d)for(var e=-1,h=0;h<a.childNodes.length;h++){var b=a.childNodes[h];
if(!(!0===d&&3==b.nodeType&&b.previousSibling&&3==b.previousSibling.nodeType)&&(e++,e==j)){a=b;break}}else a=a.childNodes[j]}return a}})},{requires:["./base","./utils","node"]});
KISSY.add("editor/focusManager",function(a,b){function p(){var a=this;a.__iframeFocus=q;k=a;t&&clearTimeout(t);t=setTimeout(function(){a.fire("focus")},30)}function l(){var a=this;a.__iframeFocus=r;k=v;t&&clearTimeout(t);t=setTimeout(function(){a.fire("blur")},30)}var m={},t,k,g={currentInstance:function(){return k},getInstance:function(a){return m[a]},register:function(a){m[a.get("id")]=a},add:function(a){this.register(a);a.get("window").on("focus",p,a).on("blur",l,a)},remove:function(a){delete m[a.get("id")];
a.get("window").detach("focus",p,a).detach("blur",l,a)}},q=!0,r=!1,v=null;b.focusManager=g;b.getInstances=function(){return m};return g},{requires:["./base","./dom"]});
KISSY.add("editor/walker",function(a,b){function p(a,d){if(this._.end)return g;var c,j=this.range,e,h=this.guard,b=this.type,u=a?"_4e_previousSourceNode":"_4e_nextSourceNode";if(!this._.start&&(this._.start=1,j.trim(),j.collapsed))return this.end(),g;if(!a&&!this._.guardLTR){var i=j.endContainer[0],l=i.childNodes[j.endOffset];this._.guardLTR=function(a,c){return c&&(i==a||"body"==r.nodeName(a))?!1:a!=l}}if(a&&!this._.guardRTL){var q=j.startContainer[0],o=0<j.startOffset&&q.childNodes[j.startOffset-
1]||null;this._.guardRTL=function(a,c){return c&&(q==a||"body"==r.nodeName(a))?!1:a!=o}}var z=a?this._.guardRTL:this._.guardLTR;e=h?function(a,c){return z(a,c)===k?k:h(a,c)}:z;this.current?c=this.current[u](k,b,e):a?(c=j.endContainer,0<j.endOffset?(c=new n(c[0].childNodes[j.endOffset-1]),e(c[0])===k&&(c=g)):c=e(c,t)===k?g:c._4e_previousSourceNode(t,b,e,void 0)):(c=j.startContainer,c=new n(c[0].childNodes[j.startOffset]),c.length?e(c[0])===k&&(c=g):c=e(j.startContainer,t)===k?g:j.startContainer._4e_nextSourceNode(t,
b,e,void 0));for(;c&&!this._.end;){this.current=c;if(!this.evaluator||this.evaluator(c[0])!==k){if(!d)return c}else if(d&&this.evaluator)return k;c=c[u](k,b,e)}this.end();return this.current=g}function l(a){for(var d,c=g;d=p.call(this,a);)c=d;return c}function m(a){this.range=a;this.guard=this.evaluator=g;this._={}}var t=!0,k=!1,g=null,q=a.UA,r=a.DOM,v=b.XHTML_DTD,n=a.Node;a.augment(m,{end:function(){this._.end=1},next:function(){return p.call(this)},previous:function(){return p.call(this,t)},checkForward:function(){return p.call(this,
k,t)!==k},checkBackward:function(){return p.call(this,t,t)!==k},lastForward:function(){return l.call(this)},lastBackward:function(){return l.call(this,t)},reset:function(){delete this.current;this._={}},_iterator:p});a.mix(m,{blockBoundary:function(a){return function(d){return!(d.nodeType==r.NodeType.ELEMENT_NODE&&r._4e_isBlockBoundary(d,a))}},bookmark:function(a,d){function c(a){return"span"==r.nodeName(a)&&r.attr(a,"_ke_bookmark")}return function(j){var e,h;e=j.nodeType==r.NodeType.TEXT_NODE&&(h=
j.parentNode)&&c(h);e=a?e:e||c(j);return!!(d^e)}},whitespaces:function(f){return function(d){d=d.nodeType==r.NodeType.TEXT_NODE&&!a.trim(d.nodeValue);return!!(f^d)}},invisible:function(a){var d=m.whitespaces();return function(c){c=d(c)||c.nodeType==r.NodeType.ELEMENT_NODE&&!c.offsetHeight;return!!(a^c)}}});var w=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,x=m.whitespaces(),i=m.bookmark(),o=function(a){var d=r.nodeName(a);return i(a)||x(a)||1==a.nodeType&&d in v.$inline&&!(d in v.$empty)};b.Utils.injectDom({_4e_getBogus:function(a){a=
new n(a);do a=a._4e_previousSourceNode();while(a&&o(a[0]));return a&&(!q.ie?"br"==a.nodeName():3==a[0].nodeType&&w.test(a.text()))?a[0]:!1}});return b.Walker=m},{requires:["./base","./utils","./dom","node"]});
KISSY.add("editor/elementPath",function(a,b){function p(a){for(var b=t,p=t,n=[];a;){if(a[0].nodeType==l.NodeType.ELEMENT_NODE){this.lastElement||(this.lastElement=a);var w=a.nodeName();if(!p&&(!b&&k[w]&&(b=a),g[w])){var x;if(x=!b)if(x="div"==w){a:{x=a[0].childNodes;for(var i=0,o=x.length;i<o;i++){var f=x[i];if(f.nodeType==l.NodeType.ELEMENT_NODE&&m.$block[f.nodeName.toLowerCase()]){x=!0;break a}}x=!1}x=!x}x?b=a:p=a}n.push(a);if("body"==w)break}a=a.parent()}this.block=b;this.blockLimit=p;this.elements=
n}var l=a.DOM,m=b.XHTML_DTD,t=null,k={address:1,blockquote:1,dl:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,li:1,dt:1,dd:1},g={body:1,div:1,table:1,tbody:1,tr:1,td:1,th:1,caption:1,form:1};p.prototype={constructor:p,compare:function(a){var b=this.elements,a=a&&a.elements;if(!a||b.length!=a.length)return!1;for(var g=0;g<b.length;g++)if(!l.equals(b[g],a[g]))return!1;return!0},contains:function(a){for(var b=this.elements,g=0;g<b.length;g++)if(b[g].nodeName()in a)return b[g];return t},toString:function(){var a=
this.elements,b,g=[];for(b=0;b<a.length;b++)g.push(a[b].nodeName());return g.toString()}};return b.ElementPath=p},{requires:["./base","./dom","node"]});
KISSY.add("editor/range",function(a,b,p,l,m){function t(z){var e=z.nodeType!=f.NodeType.TEXT_NODE&&f.nodeName(z)in c.$removeEmpty,d=z.nodeType==f.NodeType.TEXT_NODE&&!a.trim(z.nodeValue),z=!!z.parentNode.getAttribute("_ke_bookmark");return e||d||z}function k(a){return!u(a)&&!D(a)}function g(c){var e=w;return function(j){if(D(j))return n;if(j.nodeType==f.NodeType.TEXT_NODE){if(a.trim(j.nodeValue).length)return w}else if(j.nodeType==f.NodeType.ELEMENT_NODE&&(j=f.nodeName(j),!K[j]))if(!c&&!d.ie&&"br"==
j&&!e)e=n;else return w;return n}}function q(a,c){var e=a.startContainer,s=a.endContainer,d=a.startOffset,b=a.endOffset,u,y=w,g=w,i=void 0,k=a.document,R;0<c&&(i=k.createDocumentFragment());if(a.collapsed)return i;a.optimizeBookmark();s[0].nodeType==f.NodeType.TEXT_NODE?(g=n,s=s._4e_splitText(b)):0<s[0].childNodes.length&&(b>=s[0].childNodes.length?(s=new j(s[0].appendChild(k.createTextNode(""))),R=n):s=new j(s[0].childNodes[b]));e[0].nodeType==f.NodeType.TEXT_NODE?(y=n,e._4e_splitText(d)):d?d>=e[0].childNodes.length?
(e=new j(e[0].appendChild(k.createTextNode(""))),u=n):e=new j(e[0].childNodes[d].previousSibling):(u=new j(k.createTextNode("")),e.prepend(u),e=u,u=n);var H=e._4e_parents(),J=s._4e_parents();H.each(function(a,c){H[c]=a});J.each(function(a,c){J[c]=a});for(var F,N,k=0;k<H.length&&!(F=H[k],N=J[k],!F.equals(N));k++);for(var d=i,B,l,o=k;o<H.length;o++){B=H[o];b=0<c&&!B.equals(e)?d.appendChild(B.clone()[0]):null;B=B[0].nextSibling;l=J[o];for(var m=s[0],D=l&&l[0];B&&!(D==B||m==B);){l=B.nextSibling;if(2==
c)d.appendChild(B.cloneNode(n));else{if(h[B.nodeName.toLowerCase()]){var p=B.cloneNode(n);B.innerHTML="";B=p}else f._4e_remove(B);1==c&&d.appendChild(B)}B=l}b&&(d=b)}for(d=i;k<J.length;k++){B=J[k];b=0<c&&!B.equals(s)?d.appendChild(B.clone()[0]):null;if(!H[k]||!B._4e_sameLevel(H[k]))for(B=B[0].previousSibling;B;)l=B.previousSibling,2==c?d.insertBefore(B.cloneNode(n),d.firstChild):(f._4e_remove(B),1==c&&d.insertBefore(B,d.firstChild)),B=l;b&&(d=b)}if(2==c){if(y&&(F=e[0],F.nodeType==f.NodeType.TEXT_NODE&&
F.nextSibling&&F.nextSibling.nodeType==f.NodeType.TEXT_NODE&&(F.data+=F.nextSibling.data,F.parentNode.removeChild(F.nextSibling))),g)g=s[0],g.nodeType==f.NodeType.TEXT_NODE&&g.previousSibling&&g.previousSibling.nodeType==f.NodeType.TEXT_NODE&&(g.previousSibling.data+=g.data,g.parentNode.removeChild(g))}else{if(F&&N&&(!e._4e_sameLevel(F)||!s._4e_sameLevel(N)))g=F._4e_index(),u&&F._4e_sameLevel(e)&&g--,a.setStart(F.parent(),g+1);a.collapse(n)}u&&e.remove();R&&s.remove();return i}function r(a){a.collapsed=
a.startContainer&&a.endContainer&&a.startContainer[0]==a.endContainer[0]&&a.startOffset==a.endOffset}function v(a){this.endOffset=this.endContainer=this.startOffset=this.startContainer=x;this.collapsed=n;this.document=a}b.RangeType={POSITION_AFTER_START:1,POSITION_BEFORE_END:2,POSITION_BEFORE_START:3,POSITION_AFTER_END:4,ENLARGE_ELEMENT:1,ENLARGE_BLOCK_CONTENTS:2,ENLARGE_LIST_ITEM_CONTENTS:3,START:1,END:2,SHRINK_ELEMENT:1,SHRINK_TEXT:2};var n=!0,w=!1,x=null,i=b.RangeType,o=b.PositionType,f=a.DOM,
d=a.UA,c=b.XHTML_DTD,j=a.Node,e=j.all,h={td:1},y={area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1},u=new l.whitespaces,D=new l.bookmark,E=l.whitespaces(n),C=l.bookmark(!1,!0),K={abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};a.augment(v,{toString:function(){var a=[],c=this.startContainer[0],e=this.endContainer[0];a.push((c.id||c.nodeName)+":"+this.startOffset);
a.push((e.id||e.nodeName)+":"+this.endOffset);return a.join("<br/>")},optimize:function(){var a=this.startContainer,c=this.startOffset;a[0].nodeType!=f.NodeType.ELEMENT_NODE&&(c?c>=a[0].nodeValue.length&&this.setStartAfter(a):this.setStartBefore(a));a=this.endContainer;c=this.endOffset;a[0].nodeType!=f.NodeType.ELEMENT_NODE&&(c?c>=a[0].nodeValue.length&&this.setEndAfter(a):this.setEndBefore(a))},setStartAfter:function(a){this.setStart(a.parent(),a._4e_index()+1)},setStartBefore:function(a){this.setStart(a.parent(),
a._4e_index())},setEndAfter:function(a){this.setEnd(a.parent(),a._4e_index()+1)},setEndBefore:function(a){this.setEnd(a.parent(),a._4e_index())},optimizeBookmark:function(){var a=this.startContainer,c=this.endContainer;a&&"span"==a.nodeName()&&a.attr("_ke_bookmark")&&this.setStartBefore(a);c&&"span"==c.nodeName()&&c.attr("_ke_bookmark")&&this.setEndAfter(c)},setStart:function(a,c){a[0].nodeType==f.NodeType.ELEMENT_NODE&&y[a.nodeName()]&&(a=a.parent(),c=a._4e_index());this.startContainer=a;this.startOffset=
c;this.endContainer||(this.endContainer=a,this.endOffset=c);r(this)},setEnd:function(a,c){a[0].nodeType==f.NodeType.ELEMENT_NODE&&y[a.nodeName()]&&(a=a.parent(),c=a._4e_index()+1);this.endContainer=a;this.endOffset=c;this.startContainer||(this.startContainer=a,this.startOffset=c);r(this)},setStartAt:function(a,c){switch(c){case i.POSITION_AFTER_START:this.setStart(a,0);break;case i.POSITION_BEFORE_END:a[0].nodeType==f.NodeType.TEXT_NODE?this.setStart(a,a[0].nodeValue.length):this.setStart(a,a[0].childNodes.length);
break;case i.POSITION_BEFORE_START:this.setStartBefore(a);break;case i.POSITION_AFTER_END:this.setStartAfter(a)}r(this)},setEndAt:function(a,c){switch(c){case i.POSITION_AFTER_START:this.setEnd(a,0);break;case i.POSITION_BEFORE_END:a[0].nodeType==f.NodeType.TEXT_NODE?this.setEnd(a,a[0].nodeValue.length):this.setEnd(a,a[0].childNodes.length);break;case i.POSITION_BEFORE_START:this.setEndBefore(a);break;case i.POSITION_AFTER_END:this.setEndAfter(a)}r(this)},cloneContents:function(){return q(this,2)},
deleteContents:function(){return q(this,0)},extractContents:function(){return q(this,1)},collapse:function(a){a?(this.endContainer=this.startContainer,this.endOffset=this.startOffset):(this.startContainer=this.endContainer,this.startOffset=this.endOffset);this.collapsed=n},clone:function(){var a=new v(this.document);a.startContainer=this.startContainer;a.startOffset=this.startOffset;a.endContainer=this.endContainer;a.endOffset=this.endOffset;a.collapsed=this.collapsed;return a},getEnclosedNode:function(){var a=
this.clone();a.optimize();if(a.startContainer[0].nodeType!=f.NodeType.ELEMENT_NODE||a.endContainer[0].nodeType!=f.NodeType.ELEMENT_NODE)return x;var c=new l(a);c.evaluator=function(a){return E(a)&&C(a)};a=c.next();c.reset();c=c.previous();return a&&a.equals(c)?a:x},shrink:function(a,c){if(!this.collapsed){var a=a||i.SHRINK_TEXT,e=this.clone(),s=this.startContainer,d=this.endContainer,j=this.startOffset,b=this.endOffset,h=n,u,g,y=n;s&&s[0].nodeType==f.NodeType.TEXT_NODE&&(j?j>=s[0].nodeValue.length?
e.setStartAfter(s):(e.setStartBefore(s),h=w):e.setStartBefore(s));d&&d[0].nodeType==f.NodeType.TEXT_NODE&&(b?b>=d[0].nodeValue.length?e.setEndAfter(d):(e.setEndAfter(d),y=w):e.setEndBefore(d));if(h||y)g=new l(e),g.evaluator=function(c){return c.nodeType==(a==i.SHRINK_ELEMENT?f.NodeType.ELEMENT_NODE:f.NodeType.TEXT_NODE)},g.guard=function(c,e){if(a==i.SHRINK_ELEMENT&&c.nodeType==f.NodeType.TEXT_NODE||e&&c==u)return w;!e&&c.nodeType==f.NodeType.ELEMENT_NODE&&(u=c);return n};h&&(e=g[a==i.SHRINK_ELEMENT?
"lastForward":"next"]())&&this.setStartAt(e,c?i.POSITION_AFTER_START:i.POSITION_BEFORE_START);y&&(g.reset(),(g=g[a==i.SHRINK_ELEMENT?"lastBackward":"previous"]())&&this.setEndAt(g,c?i.POSITION_BEFORE_END:i.POSITION_AFTER_END));return h||y}},createBookmark2:function(a){var c=this.startContainer,e=this.endContainer,s=this.startOffset,d=this.endOffset,b,h;if(!c||!e)return{start:0,end:0};if(a){if(c[0].nodeType==f.NodeType.ELEMENT_NODE&&(b=new j(c[0].childNodes[s]))&&b[0]&&b[0].nodeType==f.NodeType.TEXT_NODE&&
0<s&&b[0].previousSibling.nodeType==f.NodeType.TEXT_NODE)c=b,s=0;for(;c[0].nodeType==f.NodeType.TEXT_NODE&&(h=c.prev(void 0,1))&&h[0].nodeType==f.NodeType.TEXT_NODE;)c=h,s+=h[0].nodeValue.length;if(!this.collapsed){if(e[0].nodeType==f.NodeType.ELEMENT_NODE&&(b=new j(e[0].childNodes[d]))&&b[0]&&b[0].nodeType==f.NodeType.TEXT_NODE&&0<d&&b[0].previousSibling.nodeType==f.NodeType.TEXT_NODE)e=b,d=0;for(;e[0].nodeType==f.NodeType.TEXT_NODE&&(h=e.prev(void 0,1))&&h[0].nodeType==f.NodeType.TEXT_NODE;)e=h,
d+=h[0].nodeValue.length}}return{start:c._4e_address(a),end:this.collapsed?x:e._4e_address(a),startOffset:s,endOffset:d,normalized:a,is2:n}},createBookmark:function(c){var e,d,s,b,h=this.collapsed;e=new j("<span>",x,this.document);e.attr("_ke_bookmark",1);e.css("display","none");e.html("&nbsp;");c&&(s=a.guid("ke_bm_"),e.attr("id",s+"S"));h||(d=e.clone(),d.html("&nbsp;"),c&&d.attr("id",s+"E"),b=this.clone(),b.collapse(),b.insertNode(d));b=this.clone();b.collapse(n);b.insertNode(e);d?(this.setStartAfter(e),
this.setEndBefore(d)):this.moveToPosition(e,i.POSITION_AFTER_END);return{startNode:c?s+"S":e,endNode:c?s+"E":d,serializable:c,collapsed:h}},moveToPosition:function(a,c){this.setStartAt(a,c);this.collapse(n)},trim:function(a,c){var e=this.startContainer,d=this.startOffset,b=this.collapsed;if((!a||b)&&e[0]&&e[0].nodeType==f.NodeType.TEXT_NODE){if(d)if(d>=e[0].nodeValue.length)d=e._4e_index()+1,e=e.parent();else{var j=e._4e_splitText(d),d=e._4e_index()+1,e=e.parent();f.equals(this.startContainer,this.endContainer)?
this.setEnd(j,this.endOffset-this.startOffset):f.equals(e,this.endContainer)&&(this.endOffset+=1)}else d=e._4e_index(),e=e.parent();this.setStart(e,d);if(b){this.collapse(n);return}}e=this.endContainer;d=this.endOffset;!c&&!b&&e[0]&&e[0].nodeType==f.NodeType.TEXT_NODE&&(d?(d>=e[0].nodeValue.length||e._4e_splitText(d),d=e._4e_index()+1):d=e._4e_index(),e=e.parent(),this.setEnd(e,d))},insertNode:function(a){this.optimizeBookmark();this.trim(w,n);var c=this.startContainer;c[0].insertBefore(a[0],c[0].childNodes[this.startOffset]||
null);c[0]==this.endContainer[0]&&this.endOffset++;this.setStartBefore(a)},moveToBookmark:function(c){var d=e(this.document);if(c.is2){var b=d._4e_getByAddress(c.start,c.normalized),s=c.startOffset,d=c.end&&d._4e_getByAddress(c.end,c.normalized),c=c.endOffset;this.setStart(b,s);d?this.setEnd(d,c):this.collapse(n)}else b=(s=c.serializable)?a.one("#"+c.startNode,d):c.startNode,c=s?a.one("#"+c.endNode,d):c.endNode,this.setStartBefore(b),b._4e_remove(),c&&c[0]?(this.setEndBefore(c),c._4e_remove()):this.collapse(n)},
getCommonAncestor:function(a,c){var e=this.startContainer,d=this.endContainer,e=e[0]==d[0]?a&&e[0].nodeType==f.NodeType.ELEMENT_NODE&&this.startOffset==this.endOffset-1?new j(e[0].childNodes[this.startOffset]):e:e._4e_commonAncestor(d);return c&&e[0].nodeType==f.NodeType.TEXT_NODE?e.parent():e},enlarge:function(){function a(c,d,b,j){var h=c[d?"startContainer":"endContainer"],g,y=d?0:1,i=0,k=d?"previousSibling":"nextSibling";g=c[d?"startOffset":"endOffset"];if(h[0].nodeType==f.NodeType.TEXT_NODE){if(d){if(g)return}else if(g<
h[0].nodeValue.length)return;g=h[0][k];h=h[0].parentNode}else g=h[0].childNodes[g+(d?-1:1)]||null,h=h[0];for(;h;){for(;g;)if(u(g)||D(g))g=g[k];else break;if(g){if(!i)c[d?"setStartAfter":"setEndBefore"](e(g));break}h=e(h);if("body"==h.nodeName())break;if(i||h.equals(j))b[y]=h,i=1;else c[d?"setStartBefore":"setEndAfter"](h);g=h[0][k];h=h[0].parentNode}}return function(c){switch(c){case i.ENLARGE_ELEMENT:if(this.collapsed)break;var c=this.getCommonAncestor(),d=[];a(this,1,d,c);a(this,0,d,c);d[0]&&d[1]&&
(c=d[0].contains(d[1])?d[1]:d[0],this.setStartBefore(c),this.setEndAfter(c));break;case i.ENLARGE_BLOCK_CONTENTS:case i.ENLARGE_LIST_ITEM_CONTENTS:var b=new v(this.document),d=new j(this.document.body);b.setStartAt(d,i.POSITION_AFTER_START);b.setEnd(this.startContainer,this.startOffset);var b=new l(b),h,g,u=l.blockBoundary(c==i.ENLARGE_LIST_ITEM_CONTENTS?{br:1}:x),y=function(a){var c=u(a);c||(h=e(a));return c},k=function(a){var c=y(a);!c&&"br"==f.nodeName(a)&&(g=e(a));return c};b.guard=y;b=b.lastBackward();
h=h||d;this.setStartAt(h,"br"!=h.nodeName()&&(!b&&this.checkStartOfBlock()||b&&h.contains(b))?i.POSITION_AFTER_START:i.POSITION_AFTER_END);b=this.clone();b.collapse();b.setEndAt(d,i.POSITION_BEFORE_END);b=new l(b);b.guard=c==i.ENLARGE_LIST_ITEM_CONTENTS?k:y;h=x;b=b.lastForward();h=h||d;this.setEndAt(h,!b&&this.checkEndOfBlock()||b&&h.contains(b)?i.POSITION_BEFORE_END:i.POSITION_BEFORE_START);g&&this.setEndAfter(g)}}}(),checkStartOfBlock:function(){var c=this.startContainer,e=this.startOffset;if(e&&
c[0].nodeType==f.NodeType.TEXT_NODE&&a.trim(c[0].nodeValue.substring(0,e)).length)return w;this.trim();c=new m(this.startContainer);e=this.clone();e.collapse(n);e.setStartAt(c.block||c.blockLimit,i.POSITION_AFTER_START);c=new l(e);c.evaluator=g(n);return c.checkBackward()},checkEndOfBlock:function(){var c=this.endContainer,e=this.endOffset;if(c[0].nodeType==f.NodeType.TEXT_NODE&&a.trim(c[0].nodeValue.substring(e)).length)return w;this.trim();c=new m(this.endContainer);e=this.clone();e.collapse(w);
e.setEndAt(c.block||c.blockLimit,i.POSITION_BEFORE_END);c=new l(e);c.evaluator=g(w);return c.checkForward()},checkBoundaryOfElement:function(a,c){var e=this.clone();e[c==i.START?"setStartAt":"setEndAt"](a,c==i.START?i.POSITION_AFTER_START:i.POSITION_BEFORE_END);e=new l(e);e.evaluator=t;return e[c==i.START?"checkBackward":"checkForward"]()},getBoundaryNodes:function(){var a=this.startContainer,c=this.endContainer,d=this.startOffset,b=this.endOffset,h;if(a[0].nodeType==f.NodeType.ELEMENT_NODE)if(h=
a[0].childNodes.length,h>d)a=e(a[0].childNodes[d]);else if(0==h)a=a._4e_previousSourceNode();else{for(a=a[0];a.lastChild;)a=a.lastChild;a=e(a);a=a._4e_nextSourceNode()||a}if(c[0].nodeType==f.NodeType.ELEMENT_NODE)if(h=c[0].childNodes.length,h>b)c=e(c[0].childNodes[b])._4e_previousSourceNode(n);else if(0==h)c=c._4e_previousSourceNode();else{for(c=c[0];c.lastChild;)c=c.lastChild;c=e(c)}a._4e_position(c)&o.POSITION_FOLLOWING&&(a=c);return{startNode:a,endNode:c}},fixBlock:function(a,c){var b=this.createBookmark(),
h=e(this.document.createElement(c));this.collapse(a);this.enlarge(i.ENLARGE_BLOCK_CONTENTS);h[0].appendChild(this.extractContents());h._4e_trim();d.ie||h._4e_appendBogus();this.insertNode(h);this.moveToBookmark(b);return h},splitBlock:function(c){var e=new m(this.startContainer),b=new m(this.endContainer),h=e.block,j=b.block,f=x;if(!e.blockLimit.equals(b.blockLimit))return x;"br"!=c&&(h||(h=this.fixBlock(n,c),j=(new m(this.endContainer)).block),j||(j=this.fixBlock(w,c)));c=h&&this.checkStartOfBlock();
e=j&&this.checkEndOfBlock();this.deleteContents();h&&h[0]==j[0]&&(e?(f=new m(this.startContainer),this.moveToPosition(j,i.POSITION_AFTER_END),j=x):c?(f=new m(this.startContainer),this.moveToPosition(h,i.POSITION_BEFORE_START),h=x):(j=this.splitElement(h),!d.ie&&!a.inArray(h.nodeName(),["ul","ol"])&&h._4e_appendBogus()));return{previousBlock:h,nextBlock:j,wasStartOfBlock:c,wasEndOfBlock:e,elementPath:f}},splitElement:function(a){if(!this.collapsed)return x;this.setEndAt(a,i.POSITION_BEFORE_END);var c=
this.extractContents(),e=a.clone(w);e[0].appendChild(c);e.insertAfter(a);this.moveToPosition(a,i.POSITION_AFTER_END);return e},moveToElementEditablePosition:function(a,c){for(var e=0;a;){if(a[0].nodeType==f.NodeType.TEXT_NODE){this.moveToPosition(a,c?i.POSITION_AFTER_END:i.POSITION_BEFORE_START);e=1;break}a[0].nodeType==f.NodeType.ELEMENT_NODE&&a._4e_isEditable()&&(this.moveToPosition(a,c?i.POSITION_BEFORE_END:i.POSITION_AFTER_START),e=1);var d=a,b=e,h=void 0;d[0].nodeType==f.NodeType.ELEMENT_NODE&&
d._4e_isEditable()&&(h=d[c?"last":"first"](k,1));!b&&!h&&(h=d[c?"prev":"next"](k,1));a=h}return!!e},selectNodeContents:function(a){var c=a[0];this.setStart(a,0);this.setEnd(a,c.nodeType==f.NodeType.TEXT_NODE?c.nodeValue.length:c.childNodes.length)},insertNodeByDtd:function(a){var e,d,h,b=a.nodeName();e=c.$block[b];this.deleteContents();if(e){for(e=this.getCommonAncestor(w,n);(d=c[e.nodeName()])&&(!d||!d[b]);){var j=e.parent();this.checkStartOfBlock()&&this.checkEndOfBlock()?(this.setStartBefore(e),
this.collapse(n),e.remove()):h=e;e=j}h&&this.splitElement(h)}this.insertNode(a)}});p.injectDom({_4e_breakParent:function(a,c){var c=e(c),a=e(a),d,h=new b.Range(a[0].ownerDocument);h.setStartAfter(a);h.setEndAfter(c);d=h.extractContents();h.insertNode(a.remove());a.after(d)}});return b.Range=v},{requires:"./base,./utils,./walker,./elementPath,./dom,node".split(",")});
KISSY.add("editor/selection",function(a,b){function p(a){this.document=a;this._={cache:{}};if(n)try{var d=this.getNative().createRange();if(!d||d.item&&d.item(0).ownerDocument!=a||d.parentElement&&d.parentElement().ownerDocument!=a)this.isInvalid=m}catch(e){this.isInvalid=m}}function l(a){a=new p(a);return!a||a.isInvalid?t:a}b.SelectionType={SELECTION_NONE:1,SELECTION_TEXT:2,SELECTION_ELEMENT:3};var m=!0,t=null,k=a.UA,g=a.DOM,q=a.Node,r=b.SelectionType,v=b.RangeType,n=k.ie,w=b.Walker,x=b.Range,i=
{img:1,hr:1,li:1,table:1,tr:1,td:1,th:1,embed:1,object:1,ol:1,ul:1,a:1,input:1,form:1,select:1,textarea:1,button:1,fieldset:1,thead:1,tfoot:1};a.augment(p,{getNative:!n?function(){var a=this._.cache;return a.nativeSel||(a.nativeSel=g.getWindow(this.document).getSelection())}:function(){var a=this._.cache;return a.nativeSel||(a.nativeSel=this.document.selection)},getType:!n?function(){var a=this._.cache;if(a.type)return a.type;var d=r.SELECTION_TEXT,e=this.getNative();if(e){if(1==e.rangeCount){var e=
e.getRangeAt(0),h=e.startContainer;h==e.endContainer&&h.nodeType==g.NodeType.ELEMENT_NODE&&1==Number(e.endOffset-e.startOffset)&&i[h.childNodes[e.startOffset].nodeName.toLowerCase()]&&(d=r.SELECTION_ELEMENT)}}else d=r.SELECTION_NONE;return a.type=d}:function(){var a=this._.cache;if(a.type)return a.type;var d=r.SELECTION_NONE;try{var e=this.getNative(),h=e.type;"Text"==h&&(d=r.SELECTION_TEXT);"Control"==h&&(d=r.SELECTION_ELEMENT);e.createRange().parentElement&&(d=r.SELECTION_TEXT)}catch(b){}return a.type=
d},getRanges:n?function(){var a=function(a,c){a=a.duplicate();a.collapse(c);for(var d=a.parentElement(),b=d.childNodes,f,i=0;i<b.length;i++){var k=b[i];if(k.nodeType==g.NodeType.ELEMENT_NODE){f=a.duplicate();f.moveToElementText(k);var k=f.compareEndPoints("StartToStart",a),n=f.compareEndPoints("EndToStart",a);f.collapse();if(0<k)break;else{if(!k||1==n&&-1==k)return{container:d,offset:i};if(!n)return{container:d,offset:i+1}}f=t}}f||(f=a.duplicate(),f.moveToElementText(d),f.collapse(!1));f.setEndPoint("StartToStart",
a);f=(""+f.text).replace(/\r\n|\r/g,"\n").length;try{for(;0<f;)f-=b[--i].nodeValue.length}catch(l){f=0}return 0===f?{container:d,offset:i}:{container:b[i],offset:-f}};return function(d){var e=this._.cache;if(e.ranges&&!d)return e.ranges;var b=this.getNative(),d=b&&b.createRange(),f=this.getType();if(!b)return[];if(f==r.SELECTION_TEXT)return b=new x(this.document),f=a(d,m),b.setStart(new q(f.container),f.offset),f=a(d),b.setEnd(new q(f.container),f.offset),e.ranges=[b];if(f==r.SELECTION_ELEMENT){e=
e.ranges=[];for(f=0;f<d.length;f++){for(var g=d.item(f),i=g.parentNode,k=0,b=new x(this.document);k<i.childNodes.length&&i.childNodes[k]!=g;k++);b.setStart(new q(i),k);b.setEnd(new q(i),k+1);e.push(b)}return e}return e.ranges=[]}}():function(a){var d=this._.cache;if(d.ranges&&!a)return d.ranges;var a=[],e=this.getNative();if(!e)return[];for(var b=0;b<e.rangeCount;b++){var f=e.getRangeAt(b),g=new x(this.document);g.setStart(new q(f.startContainer),f.startOffset);g.setEnd(new q(f.endContainer),f.endOffset);
a.push(g)}return d.ranges=a},getStartElement:function(){var a=this._.cache;if(void 0!==a.startElement)return a.startElement;var d,e=this.getNative();switch(this.getType()){case r.SELECTION_ELEMENT:return this.getSelectedElement();case r.SELECTION_TEXT:var b=this.getRanges()[0];if(b&&!b.collapsed){for(b.optimize();m;)if(d=b.startContainer,b.startOffset==(d[0].nodeType===g.NodeType.ELEMENT_NODE?d[0].childNodes.length:d[0].nodeValue.length)&&!d._4e_isBlockBoundary())b.setStartAfter(d);else break;d=b.startContainer;
if(d[0].nodeType!=g.NodeType.ELEMENT_NODE)return d.parent();d=new q(d[0].childNodes[b.startOffset]);if(!d[0]||d[0].nodeType!=g.NodeType.ELEMENT_NODE)return b.startContainer;for(b=d[0].firstChild;b&&b.nodeType==g.NodeType.ELEMENT_NODE;)d=new q(b),b=b.firstChild;return d}if(n)b=e.createRange(),b.collapse(m),d=new q(b.parentElement());else{if((d=e.anchorNode)&&d.nodeType!=g.NodeType.ELEMENT_NODE)d=d.parentNode;d&&(d=new q(d))}}return a.startElement=d},getSelectedElement:function(){var a,d=this._.cache;
if(void 0!==d.selectedElement)return d.selectedElement;n&&(a=this.getNative().createRange(),a=a.item&&a.item(0));var e;if(a)e=new q(a);else{a=this.getRanges()[0];for(var b,f=2;f&&(!(e=a.getEnclosedNode())||!(e[0].nodeType==g.NodeType.ELEMENT_NODE&&i[e.nodeName()]&&(b=e)));f--)a.shrink(v.SHRINK_ELEMENT);e=b}return d.selectedElement=e},reset:function(){this._.cache={}},selectElement:function(a){var d,e=this.document;if(n)try{d=e.body.createControlRange(),d.addElement(a[0]),d.select()}catch(b){d=e.body.createTextRange(),
d.moveToElementText(a[0]),d.select()}finally{}else d=e.createRange(),d.selectNode(a[0]),a=this.getNative(),a.removeAllRanges(),a.addRange(d);this.reset()},selectRanges:function(a){if(n){if(1<a.length){var d=a[a.length-1];a[0].setEnd(d.endContainer,d.endOffset);a.length=1}a[0]&&a[0].select()}else{d=this.getNative();if(!d)return;d.removeAllRanges();for(var e=0;e<a.length;e++){var b=a[e],f=this.document.createRange(),i=b.startContainer;if(b.collapsed&&(k.gecko&&1.09>k.gecko||k.opera||k.webkit)&&i[0].nodeType==
g.NodeType.ELEMENT_NODE&&!i[0].childNodes.length)i[0].appendChild(this.document.createTextNode(k.webkit?"\u200b":"")),b.startOffset++,b.endOffset++;f.setStart(i[0],b.startOffset);f.setEnd(b.endContainer[0],b.endOffset);d.addRange(f)}}this.reset()},createBookmarks2:function(a){for(var d=[],e=this.getRanges(),b=0;b<e.length;b++)d.push(e[b].createBookmark2(a));return d},createBookmarks:function(d,b){for(var e=[],h=this.document,f,b=b||this.getRanges(),i=b.length,k=0;k<i;k++){e.push(f=b[k].createBookmark(d,
m));var n=(d=f.serializable)?a.one("#"+f.startNode,h):f.startNode;f=d?a.one("#"+f.endNode,h):f.endNode;for(var l=k+1;l<i;l++){var o=b[l],p=o.startContainer,r=o.endContainer;g.equals(p,n.parent())&&o.startOffset++;g.equals(p,f.parent())&&o.startOffset++;g.equals(r,n.parent())&&o.endOffset++;g.equals(r,f.parent())&&o.endOffset++}}return e},selectBookmarks:function(a){for(var d=[],e=0;e<a.length;e++){var b=new x(this.document);b.moveToBookmark(a[e]);d.push(b)}this.selectRanges(d);return this},getCommonAncestor:function(){var a=
this.getRanges();return a[0].startContainer._4e_commonAncestor(a[a.length-1].endContainer)},scrollIntoView:function(){var a=this.getStartElement();a&&a.scrollIntoView(void 0,{alignWithTop:!1,allowHorizontalScroll:!0,onlyScrollIfNeeded:!0})},removeAllRanges:function(){var a=this.getNative();n?a&&a.clear():a&&a.removeAllRanges()}});var o={table:1,tbody:1,tr:1},f=w.whitespaces(m),d=/\ufeff|\u00a0/;x.prototype.select=x.prototype.select=!n?function(){var a=this.startContainer;this.collapsed&&a[0].nodeType==
g.NodeType.ELEMENT_NODE&&!a[0].childNodes.length&&(a[0].appendChild(this.document.createTextNode(k.webkit?"\u200b":"")),this.startOffset++,this.endOffset++);var d=this.document.createRange();d.setStart(a[0],this.startOffset);try{d.setEnd(this.endContainer[0],this.endOffset)}catch(e){if(0<=e.toString().indexOf("NS_ERROR_ILLEGAL_VALUE"))this.collapse(m),d.setEnd(this.endContainer[0],this.endOffset);else throw e;}a=l(this.document).getNative();a.removeAllRanges();a.addRange(d)}:function(a){var b=this.collapsed,
e,h;if(this.startContainer[0]===this.endContainer[0]&&1==this.endOffset-this.startOffset){var i=this.startContainer[0].childNodes[this.startOffset];if(i.nodeType==g.NodeType.ELEMENT_NODE){(new p(this.document)).selectElement(new q(i));return}}(this.startContainer[0].nodeType==g.NodeType.ELEMENT_NODE&&this.startContainer.nodeName()in o||this.endContainer[0].nodeType==g.NodeType.ELEMENT_NODE&&this.endContainer.nodeName()in o)&&this.shrink(v.SHRINK_ELEMENT,m);var k=this.createBookmark(),i=k.startNode,
n;b||(n=k.endNode);k=this.document.body.createTextRange();k.moveToElementText(i[0]);k.moveStart("character",1);if(n)a=this.document.body.createTextRange(),a.moveToElementText(n[0]),k.setEndPoint("EndToEnd",a),k.moveEnd("character",-1);else{for(e=i[0].nextSibling;e&&!f(e);)e=e.nextSibling;e=!(e&&e.nodeValue&&e.nodeValue.match(d))&&(a||!i[0].previousSibling||i[0].previousSibling&&"br"==g.nodeName(i[0].previousSibling));h=new q(this.document.createElement("span"));h.html("&#65279;");h.insertBefore(i);
e&&g.insertBefore(this.document.createTextNode("\ufeff"),i[0]||i)}this.setStartBefore(i);i._4e_remove();if(b){if(e?(k.moveStart("character",-1),k.select(),this.document.selection.clear()):k.select(),h)this.moveToPosition(h,v.POSITION_BEFORE_START),h._4e_remove()}else this.setEndBefore(n),n._4e_remove(),k.select()};p.getSelection=l;return b.Selection=p},{requires:["./base","./walker","./range","./dom","node"]});
KISSY.add("editor/domIterator",function(a,b){function p(a){1>arguments.length||(this.range=a,this.forceBrBreak=m,this.enlargeBr=l,this.enforceRealBlocks=m,this._||(this._={}))}var l=!0,m=!1,t=a.UA,k=b.Walker,g=b.Range,q=b.RangeType,r=b.ElementPath,v=a.Node,n=a.DOM,w=/^[\r\n\t ]*$/;a.augment(p,{getNextParagraph:function(b){var i,o,f,d,c;if(!this._.lastNode){o=this.range.clone();o.shrink(q.SHRINK_ELEMENT,l);o.enlarge(this.forceBrBreak||!this.enlargeBr?q.ENLARGE_LIST_ITEM_CONTENTS:q.ENLARGE_BLOCK_CONTENTS);
var j=new k(o),e=k.bookmark(l,l);j.evaluator=e;this._.nextNode=j.next();j=new k(o);j.evaluator=e;j=j.previous();this._.lastNode=j._4e_nextSourceNode(l);this._.lastNode&&this._.lastNode[0].nodeType==n.NodeType.TEXT_NODE&&!a.trim(this._.lastNode[0].nodeValue)&&this._.lastNode.parent()._4e_isBlockBoundary()&&(e=new g(o.document),e.moveToPosition(this._.lastNode,q.POSITION_AFTER_END),e.checkEndOfBlock()&&(e=new r(e.endContainer),this._.lastNode=(e.block||e.blockLimit)._4e_nextSourceNode(l)));this._.lastNode||
(this._.lastNode=this._.docEndMarker=new v(o.document.createTextNode("")),n.insertAfter(this._.lastNode[0],j[0]));o=null}e=this._.nextNode;j=this._.lastNode;for(this._.nextNode=null;e;){var h=m,y=e[0].nodeType!=n.NodeType.ELEMENT_NODE,u=m;if(y)e[0].nodeType==n.NodeType.TEXT_NODE&&w.test(e[0].nodeValue)&&(y=m);else{var p=e.nodeName();if(e._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){if("br"==p)y=l;else if(!o&&!e[0].childNodes.length&&"hr"!=p){i=e;f=e.equals(j);break}o&&(o.setEndAt(e,q.POSITION_BEFORE_START),
"br"!=p&&(this._.nextNode=e));h=l}else{if(e[0].firstChild){o||(o=new g(this.range.document),o.setStartAt(e,q.POSITION_BEFORE_START));e=new v(e[0].firstChild);continue}y=l}}y&&!o&&(o=new g(this.range.document),o.setStartAt(e,q.POSITION_BEFORE_START));f=(!h||y)&&e.equals(j);if(o&&!h)for(;!e[0].nextSibling&&!f;){p=e.parent();if(p._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){h=l;f||p.equals(j);break}e=p;y=l;f=e.equals(j);u=l}y&&o.setEndAt(e,q.POSITION_AFTER_END);e=e._4e_nextSourceNode(u,null,j);if((f=
!e)||h&&o)break}if(!i){if(!o)return this._.docEndMarker&&this._.docEndMarker._4e_remove(),this._.nextNode=null;i=new r(o.startContainer);e=i.blockLimit;h={div:1,th:1,td:1};i=i.block;if((!i||!i[0])&&!this.enforceRealBlocks&&h[e.nodeName()]&&o.checkStartOfBlock()&&o.checkEndOfBlock())i=e;else if(!i||this.enforceRealBlocks&&"li"==i.nodeName())i=new v(this.range.document.createElement(b||"p")),i[0].appendChild(o.extractContents()),i._4e_trim(),o.insertNode(i),d=c=l;else if("li"!=i.nodeName()){if(!o.checkStartOfBlock()||
!o.checkEndOfBlock())i=i.clone(m),i[0].appendChild(o.extractContents()),i._4e_trim(),c=o.splitBlock(),d=!c.wasStartOfBlock,c=!c.wasEndOfBlock,o.insertNode(i)}else f||(this._.nextNode=i.equals(j)?null:o.getBoundaryNodes().endNode._4e_nextSourceNode(l,null,j))}d&&(o=new v(i[0].previousSibling),o[0]&&o[0].nodeType==n.NodeType.ELEMENT_NODE&&("br"==o.nodeName()?o._4e_remove():o[0].lastChild&&"br"==n.nodeName(o[0].lastChild)&&n._4e_remove(o[0].lastChild)));c&&(o=k.bookmark(m,l),d=new v(i[0].lastChild),
d[0]&&d[0].nodeType==n.NodeType.ELEMENT_NODE&&"br"==d.nodeName()&&(t.ie||d.prev(o,1)||d.next(o,1))&&d.remove());this._.nextNode||(this._.nextNode=f||i.equals(j)?null:i._4e_nextSourceNode(l,null,j));return i}});g.prototype.createIterator=function(){return new p(this)};return p},{requires:["./base","./range","./elementPath","./walker","node"]});
KISSY.add("editor/styles",function(a,b){function p(a){return!E.attr(a,"_ke_bookmark")}function l(a,d){for(var e in a)"string"==typeof a[e]?a[e]=a[e].replace(S,function(a,e){return d[e]}):l(a[e],d)}function m(d,e){e&&(d=a.clone(d),l(d,e));var b=this.element=this.element=(d.element||"*").toLowerCase();this.type=this.type="#text"==b||I[b]?G.STYLE_BLOCK:P[b]?G.STYLE_OBJECT:G.STYLE_INLINE;this._={definition:d}}function t(a,d){var e=d?this.removeFromRange:this.applyToRange;a.body.focus();for(var b=new K(a),
c=b.getRanges(),f=0;f<c.length;f++)e.call(this,c[f]);b.selectRanges(c)}function k(a,d,e){var b=a.element;"*"==b&&(b="span");d=new s(d.createElement(b));e&&e._4e_copyAttributes(d);e=a._.definition;a=e.attributes;e=m.getStyleText(e);if(a)for(var c in a)d.attr(c,a[c]);e&&(d[0].style.cssText=e);return d}function g(a){var d=a.createBookmark(h),e=a.createIterator();e.enforceRealBlocks=h;e.enlargeBr=h;for(var b,c=a.document;b=e.getNextParagraph();){var f=k(this,c,b),g=f,f="pre"==g.nodeName,i="pre"==b.nodeName,
j=!f&&i;f&&!i?(i=b,j=i.html(),j=q(j,/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,""),j=j.replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,"$1"),j=j.replace(/([ \t\n\r]+|&nbsp;)/g," "),j=j.replace(/<br\b[^>]*>/gi,"\n"),M.ie?(i=i[0].ownerDocument.createElement("div"),i.appendChild(g[0]),g.outerHtml("<pre>"+j+"</pre>"),g=new s(i.firstChild),g._4e_remove()):g.html(j)):j?g=v(r(b),g):b._4e_moveChildren(g);b[0].parentNode.replaceChild(g[0],b[0]);if(f&&(b=g,f=void 0,(f=b._4e_previousSourceNode(h,E.NodeType.ELEMENT_NODE))&&
"pre"==f.nodeName()))g=q(f.html(),/\n$/,"")+"\n\n"+q(b.html(),/^\n/,""),M.ie?b.outerHtml("<pre>"+g+"</pre>"):b.html(g),f._4e_remove()}a.moveToBookmark(d)}function q(a,d,e){var b="",c="",a=a.replace(/(^<span[^>]+_ke_bookmark.*?\/span>)|(<span[^>]+_ke_bookmark.*?\/span>$)/gi,function(a,d,e){d&&(b=d);e&&(c=e);return""});return b+a.replace(d,e)+c}function r(a){var d=[];q(a.outerHtml(),/(\S\s*)\n(?:\s|(<span[^>]+_ck_bookmark.*?\/span>))*\n(?!$)/gi,function(a,d,e){return d+"</pre>"+e+"<pre>"}).replace(/<pre\b.*?>([\s\S]*?)<\/pre>/gi,
function(a,e){d.push(e)});return d}function v(a,d){for(var e=d[0].ownerDocument.createDocumentFragment(),b=0;b<a.length;b++){var c=a[b],c=c.replace(/(\r\n|\r)/g,"\n"),c=q(c,/^[ \t]*\n/,""),c=q(c,/\n$/,""),c=q(c,/^[ \t]+|[ \t]+$/g,function(a,d){return 1==a.length?"&nbsp;":d?" "+Array(a.length).join("&nbsp;"):Array(a.length).join("&nbsp;")+" "}),c=c.replace(/\n/g,"<br>"),c=c.replace(/[ \t]{2,}/g,function(a){return Array(a.length).join("&nbsp;")+" "}),f=d.clone();f.html(c);e.appendChild(f[0])}return e}
function n(a){var d=a.document;if(a.collapsed)d=k(this,d,void 0),a.insertNode(d),a.moveToPosition(d,C.POSITION_BEFORE_END);else{var e=this.element,b=this._.definition,f,g=L[e];g||(f=h,g=L.span);var i=a.createBookmark();a.enlarge(C.ENLARGE_ELEMENT);a.trim();for(var j=a.createBookmark(),n=j.startNode,j=j.endNode,l=n,o;l&&l[0];){var A=y;if(E.equals(l,j))l=u,A=h;else{var m=l[0].nodeType,r=m==E.NodeType.ELEMENT_NODE?l.nodeName():u;if(r&&l.attr("_ke_bookmark")){l=l._4e_nextSourceNode(h);continue}if(!r||
g[r]&&(l._4e_position(j)|z.POSITION_PRECEDING|z.POSITION_IDENTICAL|z.POSITION_IS_CONTAINED)==z.POSITION_PRECEDING+z.POSITION_IDENTICAL+z.POSITION_IS_CONTAINED&&(!b.childRule||b.childRule(l))){var q=l.parent();if(q&&"a"==e&&q.nodeName()==e)m=k(this,d,void 0),q._4e_moveChildren(m),q[0].parentNode.replaceChild(m[0],q[0]),m._4e_mergeSiblings();else if(q&&q[0]&&((L[q.nodeName()]||L.span)[e]||f)&&(!b.parentRule||b.parentRule(q))){if(!o&&(!r||!L.$removeEmpty[r]||(l._4e_position(j)|z.POSITION_PRECEDING|z.POSITION_IDENTICAL|
z.POSITION_IS_CONTAINED)==z.POSITION_PRECEDING+z.POSITION_IDENTICAL+z.POSITION_IS_CONTAINED))o=new O(d),o.setStartBefore(l);if(m==E.NodeType.TEXT_NODE||m==E.NodeType.ELEMENT_NODE&&!l[0].childNodes.length){q=l;for(m=null;(A=!q.next(p,1))&&(m=q.parent())&&g[m.nodeName()]&&(m._4e_position(n)|z.POSITION_FOLLOWING|z.POSITION_IDENTICAL|z.POSITION_IS_CONTAINED)==z.POSITION_FOLLOWING+z.POSITION_IDENTICAL+z.POSITION_IS_CONTAINED&&(!b.childRule||b.childRule(m));)q=m;o.setEndAfter(q)}}else A=h}else A=h;l=l._4e_nextSourceNode()}if(A&&
o&&!o.collapsed){for(var A=k(this,d,void 0),q=o.getCommonAncestor(),m={},r={},I,w=null,D;A&&q&&A[0]&&q[0];){if(q.nodeName()==e){for(I in b.attributes)if(!r[I]&&(D=q.attr(w)))A.attr(I)==D?A.removeAttr(I):r[I]=1;for(w in b.styles)if(!m[w]&&(D=q.style(w)))A.style(w)==D?A.style(w,""):m[w]=1;if(!A._4e_hasAttributes()){A=u;break}}q=q.parent()}A?(A[0].appendChild(o.extractContents()),c(this,A),o.insertNode(A),A._4e_mergeSiblings(),M.ie||A[0].normalize()):(A=new s(d.createElement("span")),A[0].appendChild(o.extractContents()),
o.insertNode(A),c(this,A),A._4e_remove(!0));o=u}}n._4e_remove();j._4e_remove();a.moveToBookmark(i);a.shrink(C.SHRINK_TEXT)}}function w(a){a.enlarge(C.ENLARGE_ELEMENT);var d=a.createBookmark(),e=d.startNode;if(a.collapsed){for(var b=new A(e.parent()),c,h=0,g;h<b.elements.length&&(g=b.elements[h])&&!(g==b.block||g==b.blockLimit);h++)if(this.checkElementRemovable(g)){var i=a.checkBoundaryOfElement(g,C.END),k=!i&&a.checkBoundaryOfElement(g,C.START);k||i?(c=g,c.match=k?"start":"end"):(g._4e_mergeSiblings(),
g.nodeName()!=this.element?(i=o(this),j(g,i[g.nodeName()]||i["*"])):f(this,g))}if(c){g=e;for(h=0;;h++){i=b.elements[h];if(i.equals(c))break;else if(i.match)continue;else i=i.clone();i[0].appendChild(g[0]);g=i}g["start"==c.match?"insertBefore":"insertAfter"](c);b=c.html();!b||"\u200b"==b?c.remove():M.webkit&&D(a.document.createTextNode("\u200b")).insertBefore(g)}}else{var n=d.endNode,l=this;c=function(){for(var a=new A(e.parent()),d=new A(n.parent()),b=u,c=u,f=0;f<a.elements.length;f++){var h=a.elements[f];
if(h==a.block||h==a.blockLimit)break;l.checkElementRemovable(h)&&(b=h)}for(f=0;f<d.elements.length;f++){h=d.elements[f];if(h==d.block||h==d.blockLimit)break;l.checkElementRemovable(h)&&(c=h)}c&&n._4e_breakParent(c);b&&e._4e_breakParent(b)};c();for(b=new s(e[0].nextSibling);b[0]!==n[0];){h=b._4e_nextSourceNode();if(b[0]&&b[0].nodeType==E.NodeType.ELEMENT_NODE&&this.checkElementRemovable(b)&&(b.nodeName()==this.element?f(this,b):(g=o(this),j(b,g[b.nodeName()]||g["*"])),h[0].nodeType==E.NodeType.ELEMENT_NODE&&
h.contains(e)))c(),h=new s(e[0].nextSibling);b=h}}a.moveToBookmark(d)}function x(a){var d={};(""+a).replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(a,b,e){d[b]=e});return d}function i(a,d){var b="";d!==y?(b=document.createElement("span"),b.style.cssText=a,b=b.style.cssText||""):b=a;return b.replace(/\s*([;:])\s*/,"$1").replace(/([^\s;])$/,"$1;").replace(/,\s+/g,",").toLowerCase()}function o(d){if(d._.overrides)return d._.overrides;var b=d._.overrides={},e=d._.definition.overrides;
if(e){a.isArray(e)||(e=[e]);for(var c=0;c<e.length;c++){var f=e[c],h,g,s;"string"==typeof f?h=f.toLowerCase():(h=f.element?f.element.toLowerCase():d.element,g=f.attributes,s=f.styles);f=b[h]||(b[h]={});if(g){h=f.attributes=f.attributes||[];for(var i in g)h.push([i.toLowerCase(),g[i]])}if(s){var f=f.styles=f.styles||[],j;for(j in s)f.push([j.toLowerCase(),s[j]])}}}return b}function f(b,c){var f=b._.definition,g=o(b),s=a.merge(f.attributes,(g[c.nodeName()]||g["*"]||{}).attributes),f=a.merge(f.styles,
(g[c.nodeName()]||g["*"]||{}).styles),g=a.isEmptyObject(s)&&a.isEmptyObject(f),i;for(i in s)("class"==i||b._.definition.fullMatch)&&c.attr(i)!=d(i,s[i])||(g=g||!!c.hasAttr(i),c.removeAttr(i));for(var j in f)b._.definition.fullMatch&&c.style(j)!=d(j,f[j],h)||(g=g||!!c.style(j),c.style(j,""));e(c)}function d(a,d,b){var e=new s("<span>");e[b?"style":"attr"](a,d);return e[b?"style":"attr"](a)}function c(a,d){for(var b=o(a),e=d.all(a.element),c=e.length;0<=--c;)f(a,new s(e[c]));for(var h in b)if(h!=a.element){e=
d.all(h);for(c=e.length-1;0<=c;c--){var g=new s(e[c]);j(g,b[h])}}}function j(a,d){var b,c=d&&d.attributes;if(c)for(b=0;b<c.length;b++){var f=c[b][0],h;if(h=a.attr(f)){var g=c[b][1];(g===u||g.test&&g.test(h)||"string"==typeof g&&h==g)&&a[0].removeAttribute(f)}}if(c=d&&d.styles)for(b=0;b<c.length;b++)if(f=c[b][0],g=a.css(f)){var s=c[b][1];(s===u||s.test&&s.test(h)||"string"==typeof s&&g==s)&&a.css(f,"")}e(a)}function e(a){if(!a._4e_hasAttributes()){var d=a[0].firstChild,b=a[0].lastChild;a._4e_remove(h);
d&&(d.nodeType==E.NodeType.ELEMENT_NODE&&E._4e_mergeSiblings(d),b&&d!=b&&b.nodeType==E.NodeType.ELEMENT_NODE&&E._4e_mergeSiblings(b))}}var h=!0,y=!1,u=null,D=a.all,E=a.DOM,C=b.RangeType,K=b.Selection,z=b.PositionType,O=b.Range,G,s=a.Node,M=a.UA,A=b.ElementPath,I={address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1},L=b.XHTML_DTD,P={embed:1,hr:1,img:1,li:1,object:1,ol:1,table:1,td:1,tr:1,th:1,ul:1,dl:1,dt:1,dd:1,form:1},Q=/\s*(?:;\s*|$)/g,S=/#\((.+?)\)/g;b.StyleType=G={STYLE_BLOCK:1,STYLE_INLINE:2,
STYLE_OBJECT:3};m.prototype={constructor:m,apply:function(a){t.call(this,a,y)},remove:function(a){t.call(this,a,h)},applyToRange:function(a){return(this.applyToRange=this.type==G.STYLE_INLINE?n:this.type==G.STYLE_BLOCK?g:u).call(this,a)},removeFromRange:function(a){return(this.removeFromRange=this.type==G.STYLE_INLINE?w:u).call(this,a)},checkElementRemovable:function(a,d){if(!a)return y;var b=this._.definition,e;if(a.nodeName()==this.element){if(!d&&!a._4e_hasAttributes())return h;var c=b._AC;if(c)b=
c;else{var c={},f=0,g=b.attributes;if(g)for(var s in g)f++,c[s]=g[s];if(g=m.getStyleText(b))c.style||f++,c.style=g;c._length=f;b=b._AC=c}if(b._length){for(var j in b)if("_length"!=j){f=a.attr(j)||"";if("style"==j)a:{c=b[j];f=i(f,y);"string"==typeof c&&(c=x(c));"string"==typeof f&&(f=x(f));g=void 0;for(g in c)if(!(g in f&&(f[g]==c[g]||"inherit"==c[g]||"inherit"==f[g]))){c=y;break a}c=h}else c=b[j]==f;if(c){if(!d)return h}else if(d)return y}if(d)return h}else return h}j=o(this);if(j=j[a.nodeName()]||
j["*"]){if(!(b=j.attributes)&&!(e=j.styles))return h;if(b)for(c=0;c<b.length;c++)if(j=b[c][0],j=a.attr(j))if(f=b[c][1],f===u||"string"==typeof f&&j==f||f.test&&f.test(j))return h;if(e)for(c=0;c<e.length;c++)if(j=a.css(e[c][0]))if(b=e[c][1],b===u||"string"==typeof b&&j==b||b.test&&b.test(j))return h}return y},checkActive:function(a){switch(this.type){case G.STYLE_BLOCK:return this.checkElementRemovable(a.block||a.blockLimit,h);case G.STYLE_OBJECT:case G.STYLE_INLINE:for(var d=a.elements,b=0,c;b<d.length;b++)if(c=
d[b],!(this.type==G.STYLE_INLINE&&(E.equals(c,a.block)||E.equals(c,a.blockLimit))))if((this.type!=G.STYLE_OBJECT||c.nodeName()in P)&&this.checkElementRemovable(c,h))return h}return y}};m.getStyleText=function(a){var d=a._ST;if(d)return d;var d=a.styles,b=a.attributes&&a.attributes.style||"",c="";b.length&&(b=b.replace(Q,";"));for(var e in d){var f=d[e],h=(e+":"+f).replace(Q,";");"inherit"==f?c+=h:b+=h}b.length&&(b=i(b));return a._ST=b+c};return b.Style=m},{requires:"./base,./range,./selection,./domIterator,./elementPath,node".split(",")});
KISSY.add("editor/z-index-manager",function(a,b){var p=b.ZIndexManager={BUBBLE_VIEW:1100,POPUP_MENU:1200,STORE_FLASH_SHOW:99999,MAXIMIZE:900,OVERLAY:9999,LOADING:11E3,LOADING_CANCEL:12E3,SELECT:1200};b.baseZIndex=function(a){return(b.Config.baseZIndex||1E4)+a};return p},{requires:["./base"]});
KISSY.add("editor/clipboard",function(a,b,p,l){function m(a){this.editor=a;this._init()}function t(a){var b=a.get("document")[0],f=a.getSelection(),e;if(f.getType()==l.SELECTION_ELEMENT&&(e=f.getSelectedElement())){var a=f.getRanges()[0],h=r(b.createTextNode(""));h.insertBefore(e);a.setStartBefore(h);a.setEndAfter(e);f.selectRanges([a]);setTimeout(function(){e.parent()&&(h.remove(),f.selectElement(e))},0)}}function k(a){if(v.webkit){if(!a.match(/^[^<]*$/g)&&!a.match(/^(<div><br( ?\/)?><\/div>|<div>[^<]*<\/div>)*$/gi))return 0}else if(v.ie){if(!a.match(/^([^<]|<br( ?\/)?>)*$/gi)&&
!a.match(/^(<p>([^<]|<br( ?\/)?>)*<\/p>|(\r\n))*$/gi))return 0}else if(v.gecko||v.opera){if(!a.match(/^([^<]|<br( ?\/)?>)*$/gi))return 0}else return 0;return 1}function g(a){a=a.replace(/\s+/g," ").replace(/> +</g,"><").replace(/<br ?\/>/gi,"<br>");if(a.match(/^[^<]$/))return a;if(v.webkit&&-1<a.indexOf("<div>"))a.match(/<div>(?:<br>)?<\/div>/)&&(a=a.replace(/<div>(?:<br>)?<\/div>/g,function(){return"<p></p>"}),a=a.replace(/<\/p><div>/g,"</p><p>").replace(/<\/div><p>/g,"</p><p>").replace(/^<div>/,
"<p>").replace(/^<\/div>/,"</p>")),a.match(/<\/div><div>/)&&(a=a.replace(/<\/div><div>/g,"</p><p>").replace(/^<div>/,"<p>").replace(/^<\/div>/,"</p>"));else if(v.gecko||v.opera)v.gecko&&(a=a.replace(/^<br><br>$/,"<br>")),-1<a.indexOf("<br><br>")&&(a="<p>"+a.replace(/<br><br>/g,function(){return"</p><p>"})+"</p>");return a}function q(a){var b=0,a=a.replace(/<span[^>]+_ke_bookmark[^<]*?<\/span>(&nbsp;)*/ig,"");-1!=a.indexOf("Apple-")&&(a=a.replace(/<span class="Apple-converted-space">&nbsp;<\/span>/gi,
" "),a=a.replace(/<span class="Apple-tab-span"[^>]*>([^<]*)<\/span>/gi,function(a,b){return b.replace(/\t/g,Array(5).join("&nbsp;"))}),-1<a.indexOf('<br class="Apple-interchange-newline">')&&(b=1,a=a.replace(/<br class="Apple-interchange-newline">/,"")),a=a.replace(/(<[^>]+) class="Apple-[^"]*"/gi,"$1"));!b&&k(a)&&(a=g(a));return a}var r=a.all,v=a.UA,n=v.ie?"beforepaste":"paste",w=b.RangeType;a.augment(m,{_init:function(){var a=this,b=a.editor,f=b.get("document"),e=f.one("body"),h=function(a){this.type=
a};h.prototype={exec:function(b){var c=this.type;b.focus();setTimeout(function(){v.ie&&("cut"==c?t(b):"paste"==c&&(a._preventPasteEvent(),a._getClipboardDataFromPasteBin()));i(b,c)||alert(o[c])},0)}};e.on(n,a._getClipboardDataFromPasteBin,a);v.ie&&(e.on("paste",a._iePaste,a),f.on("keydown",a._onKeyDown,a),f.on("contextmenu",function(){a._isPreventBeforePaste=1;setTimeout(function(){a._isPreventBeforePaste=0},0)}));b.addCommand("copy",new h("copy"));b.addCommand("cut",new h("cut"));b.addCommand("paste",
new h("paste"))},_onKeyDown:function(a){this.editor.get("mode")==b.Mode.WYSIWYG_MODE&&(a.ctrlKey&&86==a.keyCode||a.shiftKey&&45==a.keyCode)&&this._preventPasteEvent()},_stateFromNamedCommand:function(a){var b,f=this.editor;if("paste"==a){this._isPreventBeforePaste=1;try{b=f.get("document")[0].queryCommandEnabled(a)}catch(e){}this._isPreventBeforePaste=0}else b=(a=(a=f.getSelection())&&a.getRanges())&&!(1==a.length&&a[0].collapsed);return b},_preventPasteEvent:function(){var a=this;a._preventPasteTimer&&
clearTimeout(a._preventPasteTimer);a._isPreventPaste=1;a._preventPasteTimer=setTimeout(function(){a._isPreventPaste=0},70)},_iePaste:function(a){var b=this.editor;this._isPreventPaste||(a.preventDefault(),b.execCommand("paste"))},_getClipboardDataFromPasteBin:function(){if(!this._isPreventBeforePaste){n+":  paste event happen";var b=this.editor,c=b.get("document")[0];if(c.getElementById("ke-paste-bin"))n+": trigger more than once ...";else{var f=b.getSelection(),e=new p(c),h=r(v.webkit?"<body></body>":
"<div></div>",c);h.attr("id","ke-paste-bin");v.webkit&&h[0].appendChild(c.createTextNode("\u200b"));c.body.appendChild(h[0]);h.css({position:"absolute",top:f.getStartElement().offset().top+"px",width:"1px",height:"1px",overflow:"hidden"});h.css("left","-1000px");var g=f.createBookmarks();e.setStartAt(h,w.POSITION_AFTER_START);e.setEndAt(h,w.POSITION_BEFORE_END);e.select(!0);setTimeout(function(){var c,e=h;h=v.webkit&&(c=h.first())&&c.hasClass("Apple-style-span")?c:h;f.selectBookmarks(g);var i=h.html();
e.remove();if(i=q(i))"paste "+i,c=b.fire("paste",{html:i}),!1!==c&&(void 0!==c&&(i=c),/(class="?Mso|style="[^"]*\bmso\-|w:WordDocument)/.test(i)?a.use("editor/plugin/word-filter",function(a,c){b.insertHtml(c.toDataFormat(i,b))}):b.insertHtml(i))},0)}}}});var x=function(a,b){var f=a.get("document")[0],e=r(f.body),h=!1,g=function(){h=!0};e.on(b,g);(7<v.ie?f:f.selection.createRange()).execCommand(b);e.detach(b,g);return h},i=v.ie?function(a,b){return x(a,b)}:function(a,b){try{return a.get("document")[0].execCommand(b)}catch(f){return!1}},
o={cut:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u526a\u5207\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+X)\u6765\u5b8c\u6210",copy:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u590d\u5236\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+C)\u6765\u5b8c\u6210",paste:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u7c98\u8d34\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+V)\u6765\u5b8c\u6210"},f={copy:"\u590d\u5236",paste:"\u7c98\u8d34",cut:"\u526a\u5207"};return{init:function(a){var b;a.docReady(function(){b=new m(a)});var g={copy:1,cut:1,paste:1},e=["copy","cut","paste"];a.on("contextmenu",function(h){var i=h.contextmenu;if(!i.__copy_fix){i.__copy_fix=1;for(h=0;h<e.length;h++)i.addChild({content:f[e[h]],value:e[h]});i.on("click",function(b){var c=
b.target.get("value");g[c]&&(i.hide(),setTimeout(function(){a.execCommand("save");a.execCommand(c);setTimeout(function(){a.execCommand("save")},10)},30))})}for(var k=i.get("children"),h=k.length-1;h--;0<=h){var n=k[h],l;l=n.get?n.get("value"):n.value;g[l]&&(l=!b._stateFromNamedCommand(l),n.set?n.set("disabled",l):n.disabled=l)}})}}},{requires:["./base","./range","./selection","node"]});
KISSY.add("editor/enterKey",function(a,b,p,l,m){function t(b){var k;k=b.getSelection().getRanges();for(var m=k.length-1;0<m;m--)k[m].deleteContents();k=k[0];m=k.document;if(k.checkStartOfBlock()&&k.checkEndOfBlock()){var i=(new l(k.startContainer)).block;if(i&&("li"==i.nodeName()||"li"==i.parent().nodeName()))return b.hasCommand("outdent")?(b.execCommand("save"),b.execCommand("outdent"),b.execCommand("save"),!0):!1}var o=k.splitBlock("p");if(!o)return!0;var b=o.previousBlock,i=o.nextBlock,f=o.wasStartOfBlock,
d=o.wasEndOfBlock,c;if(i)c=i.parent(),"li"==c.nodeName()&&(i._4e_breakParent(c),i._4e_move(i.next(),!0));else if(b&&(c=b.parent())&&"li"==c.nodeName())b._4e_breakParent(c),k.moveToElementEditablePosition(b.next()),b._4e_move(b.prev());if(!f&&!d){if("li"==i.nodeName()&&(c=i.first(p.invisible(!0)))&&a.inArray(c.nodeName(),["ul","ol"]))(g.ie?new v(m.createTextNode("\u00a0")):new v(m.createElement("br"))).insertBefore(c);i&&k.moveToElementEditablePosition(i)}else{var j;if(b){if("li"==b.nodeName()||!q.test(b.nodeName()))j=
b.clone()}else i&&(j=i.clone());j||(j=new v("<p>",null,m));if(c=o.elementPath)for(var o=0,e=c.elements.length;o<e;o++){var h=c.elements[o];if(h.equals(c.block)||h.equals(c.blockLimit))break;r.$removeEmpty[h.nodeName()]&&(h=h.clone(),j._4e_moveChildren(h),j.append(h))}g.ie||j._4e_appendBogus();k.insertNode(j);if(g.ie&&f&&(!d||!b[0].childNodes.length))k.moveToElementEditablePosition(d?b:j),k.select();k.moveToElementEditablePosition(f&&!d?i:j)}g.ie||(i?(j=new v(m.createElement("span")),j.html("&nbsp;"),
k.insertNode(j),j.scrollIntoView(void 0,{alignWithTop:!1,allowHorizontalScroll:!0,onlyScrollIfNeeded:!0}),k.deleteContents()):j.scrollIntoView(void 0,{alignWithTop:!1,allowHorizontalScroll:!0,onlyScrollIfNeeded:!0}));k.select();return!0}function k(a){var b=a.get("document")[0];m.on(b,"keydown",function(b){if(13===b.keyCode&&!b.shiftKey&&!b.ctrlKey&&!b.metaKey){a.execCommand("save");var g=a.execCommand("enterBlock");a.execCommand("save");!1!==g&&b.preventDefault()}})}var g=a.UA,q=/^h[1-6]$/,r=b.XHTML_DTD,
v=a.Node;return{init:function(a){a.addCommand("enterBlock",{exec:t});a.docReady(function(){k(a)})}}},{requires:["./base","./walker","./elementPath","node","event"]});
KISSY.add("editor/htmlDataProcessor",function(a,b,p){return{init:function(l){function m(b){var b=b.childNodes,c,d,f,g=b.length;if(g){f=1;for(c=0;c<g;c++)if(d=b[c],d.nodeType!=a.DOM.NodeType.TEXT_NODE||d.nodeValue){f=0;break}return f?!1:void 0}return!1}function t(a){return a.replace(w,function(a,b,c){return"<"+b+c.replace(x,function(a,b){return-1==c.indexOf("_ke_saved_"+b)?" _ke_saved_"+a+" "+a:a})+">"})}function k(a){return a.replace(o,function(a){return"<ke:encoded>"+encodeURIComponent(a)+"</ke:encoded>"})}
function g(b){return b.replace(f,function(b,c){return a.urlDecode(c)})}var q=a.Node,r=a.UA,v=new p.Filter,n=new p.Filter;(function(){function b(a){a=p.serialize(a);return new p.Comment(i+encodeURIComponent(a).replace(/--/g,"%2D%2D"))}var c={tagNames:[[/^\?xml.*$/i,""],[/^.*namespace.*$/i,""]],attributeNames:[[/^on/,"ke_on"],[/^lang$/,""]],tags:{script:b,noscript:b,span:m}},d={tagNames:[[/^ke:/,""],[/^\?xml:namespace$/,""]],tags:{$:function(a){if(a.attributes.length)for(var b=["name","href","src"],
c,e=0;e<b.length;e++)c="_ke_saved_"+b[e],a.getAttribute(c)&&a.removeAttribute(b[e]);return a},embed:function(a){var b=a.parentNode;if(b&&"object"==b.nodeName){var c=b.getAttribute("width"),b=b.getAttribute("height");c&&a.setAttribute("width",c);b&&a.setAttribute("width",b)}},a:function(a){if(!a.childNodes.length&&!a.attributes.length)return!1},span:m,strong:m,em:m,del:m,u:m},attributes:{style:function(b){if(!a.trim(b))return!1}},attributeNames:[[/^_ke_saved_/,""],[/^ke_on/,"on"],[/^_ke.*/,""],[/^ke:.*$/,
""],[/^_ks.*/,""]],comment:function(b){if(b.substr(0,i.length)==i)return b=a.trim(a.urlDecode(b.substr(i.length))),p.parse(b).childNodes[0]}};r.ie&&(d.attributes.style=function(a){return a.replace(/(^|;)([^:]+)/g,function(a){return a.toLowerCase()})});v.addRules(d);n.addRules(c)})();(function(){function c(b){for(var b=b.childNodes,e=b.length,d=b[e-1];d&&3==d.nodeType&&!a.trim(d.nodeValue);)d=b[--e];return d}function d(a){var b=c(a);b&&(1==b.nodeType&&"br"==b.nodeName?a.removeChild(b):3==b.nodeType&&
j.test(b.nodeValue)&&a.removeChild(b))}function f(a){var b=c(a);return!b||"form"==a.nodeName&&"input"==b.nodeName}function g(a){d(a);f(a)&&(r.ie||a.appendChild(new p.Tag("br")))}function i(a){d(a);f(a)&&a.appendChild(new p.Text("\u00a0"))}var j=/^[\t\r\n ]*(?:&nbsp;|\xa0)[\t\r\n ]*$/,k=b.XHTML_DTD,l=a.merge(k.$block,k.$listItem,k.$tableContent),o;for(o in l)"br"in k[o]||delete l[o];delete l.pre;var k={tags:{}},m={tags:{}};for(o in l)k.tags[o]=g,m.tags[o]=i;n.addRules(k);v.addRules(m)})();v.addRules({text:function(a){return a.replace(/\xa0/g,
"&nbsp;")}});var w=/<(a|area|img|input)\b([^>]*)>/gi,x=/\b(href|src|name)\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|(?:[^ "'>]+))/gi,i="{ke_protected}",o=/(?:<textarea[^>]*>[\s\S]*<\/textarea>)|(?:<style[^>]*>[\s\S]*<\/style>)|(?:<script[^>]*>[\s\S]*<\/script>)|(?:<(:?link|meta|base)[^>]*>)/gi,f=/<ke:encoded>([^<]*)<\/ke:encoded>/gi,d=/(<\/?)((?:object|embed|param|html|body|head|title|noscript)[^>]*>)/gi,c=/(<\/?)ke:((?:object|embed|param|html|body|head|title|noscript)[^>]*>)/gi,j=/<ke:(param|embed)([^>]*?)\/?>(?!\s*<\/ke:\1)/gi;
l.htmlDataProcessor={dataFilter:n,htmlFilter:v,toHtml:function(a){r.webkit&&(a=a.replace(/\u200b/g,""));var b=new p.BeautifyWriter;(new p.Parser(a)).parse().writeHtml(b,v);return a=b.getHtml()},toDataFormat:function(a,b){var b=b||n,a=k(a),a=t(a),a=a.replace(d,"$1ke:$2"),a=a.replace(j,"<ke:$1$2></ke:$1>"),f=new q("<div>");f.html("a"+a);a=f.html().substr(1);a=a.replace(c,"$1$2");a=g(a);f=new p.BasicWriter;(new p.Parser(a)).parse().writeHtml(f,b);return a=f.getHtml()},toServer:function(a){var b=new p.MinifyWriter;
(new p.Parser(a)).parse().writeHtml(b,v);return b.getHtml()}}}}},{requires:["./base","html-parser"]});
KISSY.add("editor/selectionFix",function(a,b,p){function l(a){function b(a,c){var d=e.body.createTextRange();try{d.moveToPoint(a,c)}catch(f){d=r}return d}function f(){var a=e.selection.createRange();h&&!a.item&&0===a.compareEndPoints("StartToEnd",a)&&h.select();p.remove(e,"mouseup",f);p.remove(e,"mousemove",d);h=c=0}function d(a){if(a.button){if(a=b(a.pageX,a.pageY))0<a.compareEndPoints("StartToStart",h)?a.setEndPoint("StartToStart",h):a.setEndPoint("EndToEnd",h),a.select()}else f()}var c,g=a.get("window")[0],
e=a.get("document")[0],h;p.on(e,"mousedown contextmenu",function(a){var i=e.documentElement;if(a.target===i&&(c&&f(),!(i.scrollHeight>i.clientHeight)&&(c=1,h=b(a.pageX,a.pageY))))p.on(e,"mouseup",f),p.on(e,"mousemove",d),g.focus(),h.select()})}function m(a){function k(b){if(e){var c=a.getSelection(),d=c&&c.getType(),h=c&&f.selection;if(b&&h&&d==x.SELECTION_NONE&&!f.queryCommandEnabled("InsertImage"))setTimeout(function(){k(g)},50);else{var l;if(!h||!h.type||!("Control"!=h.type&&(l=h.createRange())&&
(l=l.parentElement())&&(l=l.nodeName)&&l.toLowerCase()in{input:1,textarea:1}))j=h&&c.getRanges()[0],a.checkSelectionChange()}}}var f=a.get("document")[0],d=new w(f.body),c=new w(f.documentElement);if(8>b.Utils.ieEngine)c.on("click",function(b){"html"===(new w(b.target)).nodeName()&&a.getSelection().getNative().createRange().select()});var j,e,h=g;c.on("mousedown",function(){h=q});c.on("mouseup",function(){h=g});d.on("focusin",function(a){if("body"==(new w(a.target)).nodeName()&&j){try{h&&j.select()}catch(b){}j=
r}});d.on("focus",function(){e=g;k()});d.on("beforedeactivate",function(a){a.relatedTarget||(e=q,h=g)});d.on("mousedown",function(){e=q});d.on("mouseup",function(){e=g;setTimeout(function(){k(g)},0)});d.on("keydown",function(){e=q});d.on("keyup",function(){e=g;setTimeout(function(){k()},0)})}function t(a){var b=a.get("document")[0];p.on(b,"mouseup keyup selectionchange",function(){a.checkSelectionChange()})}function k(a){function k(a){var c=b.XHTML_DTD;return a._4e_isBlockBoundary()&&c.$empty[a.nodeName()]}
function f(a){return c(a)&&j(a)}var d=/\s*<(p|div|address|h\d|center)[^>]*>\s*(?:<br[^>]*>|&nbsp;|\u00A0|&#160;|(<\!--[\s\S]*?--\>))?\s*(:?<\/\1>)?(?=\s*$|<\/body>)/gi,c=b.Walker.whitespaces(g),j=b.Walker.bookmark(q,g),e=function(a){return c(a)&&8!=a.nodeType};a.on("selectionChange",function(c){var j=c.path,l=new w(a.get("document")[0].body),c=(c=c.selection)&&c.getRanges()[0],m=j.blockLimit;if(v.gecko){var p=j.block||j.blockLimit,r=p&&p.last(f);p&&p._4e_isBlockBoundary()&&(!r||!(1==r[0].nodeType&&
r._4e_isBlockBoundary()))&&"pre"!=p.nodeName()&&!p._4e_getBogus()&&p._4e_appendBogus()}if(c&&c.collapsed&&!j.block){if("body"==m.nodeName()){if((j=c.fixBlock(g,"p"))&&j[0]!=l[0].lastChild&&j.outerHtml().match(d))if((m=j.next(e,1))&&m[0].nodeType==n.NodeType.ELEMENT_NODE&&!k[m])c.moveToElementEditablePosition(m),j._4e_remove();else if((m=j.prev(e,1))&&m[0].nodeType==n.NodeType.ELEMENT_NODE&&!k[m])c.moveToElementEditablePosition(m,m.outerHtml().match(d)?q:g),j._4e_remove();c.select();a.notifySelectionChange()}j=
a.get("document")[0];c=new b.Range(j);c.moveToElementEditablePosition(l,g);"body"!==(new b.ElementPath(c.startContainer)).blockLimit.nodeName()&&(l=(new w(j.createElement("p"))).appendTo(l),v.ie||l._4e_appendBogus())}})}var g=!0,q=!1,r=null,v=a.UA,n=a.DOM,w=a.Node,x=b.SelectionType;return{init:function(a){a.docReady(function(){v.ie?(l(a),m(a)):t(a)});k(a)}}},{requires:["./base","event","/selection","node"]});
KISSY.add("editor/plugin-meta",function(){(function(a){a({"editor/plugin/back-color":{requires:["editor","editor/plugin/color/btn","editor/plugin/back-color/cmd"]}});a({"editor/plugin/back-color/cmd":{requires:["editor/plugin/color/cmd"]}});a({"editor/plugin/bold":{requires:["editor","editor/plugin/font/ui","editor/plugin/bold/cmd"]}});a({"editor/plugin/bold/cmd":{requires:["editor","editor/plugin/font/cmd"]}});a({"editor/plugin/bubble":{requires:["overlay","editor"]}});a({"editor/plugin/button":{requires:["editor",
"button"]}});a({"editor/plugin/checkbox-source-area":{requires:["editor"]}});a({"editor/plugin/code":{requires:["editor","editor/plugin/dialog-loader"]}});a({"editor/plugin/code/dialog":{requires:["editor","editor/plugin/dialog","menubutton"]}});a({"editor/plugin/color/btn":{requires:["editor","editor/plugin/button","editor/plugin/overlay","editor/plugin/dialog-loader"]}});a({"editor/plugin/color/cmd":{requires:["editor"]}});a({"editor/plugin/color/dialog":{requires:["editor","editor/plugin/dialog"]}});
a({"editor/plugin/contextmenu":{requires:["editor","menu","editor/plugin/focus-fix","event"]}});a({"editor/plugin/dent-cmd":{requires:["editor","editor/plugin/list-utils"]}});a({"editor/plugin/dialog-loader":{requires:["overlay","editor"]}});a({"editor/plugin/dialog":{requires:["editor","overlay","editor/plugin/focus-fix","dd/plugin/constrain","component/plugin/drag"]}});a({"editor/plugin/draft":{requires:"event,json,editor,editor/plugin/local-storage,overlay,editor/plugin/menubutton".split(",")}});
a({"editor/plugin/drag-upload":{requires:["event","editor"]}});a({"editor/plugin/element-path":{requires:["editor"]}});a({"editor/plugin/fake-objects":{requires:["editor","html-parser"]}});a({"editor/plugin/flash-bridge":{requires:["swf","editor","event"]}});a({"editor/plugin/flash-common/base-class":{requires:"editor,base,editor/plugin/contextmenu,editor/plugin/bubble,editor/plugin/dialog-loader,editor/plugin/flash-common/utils".split(",")}});a({"editor/plugin/flash-common/utils":{requires:["swf"]}});
a({"editor/plugin/flash":{requires:["editor","editor/plugin/flash-common/base-class","editor/plugin/flash-common/utils","editor/plugin/fake-objects"]}});a({"editor/plugin/flash/dialog":{requires:["editor","editor/plugin/flash-common/utils","editor/plugin/dialog","editor/plugin/menubutton"]}});a({"editor/plugin/focus-fix":{requires:["editor"]}});a({"editor/plugin/font-family":{requires:["editor","editor/plugin/font/ui","editor/plugin/font-family/cmd"]}});a({"editor/plugin/font-family/cmd":{requires:["editor",
"editor/plugin/font/cmd"]}});a({"editor/plugin/font-size":{requires:["editor","editor/plugin/font/ui","editor/plugin/font-size/cmd"]}});a({"editor/plugin/font-size/cmd":{requires:["editor","editor/plugin/font/cmd"]}});a({"editor/plugin/font/cmd":{requires:["editor"]}});a({"editor/plugin/font/ui":{requires:["editor","editor/plugin/button","editor/plugin/menubutton"]}});a({"editor/plugin/fore-color":{requires:["editor","editor/plugin/color/btn","editor/plugin/fore-color/cmd"]}});a({"editor/plugin/fore-color/cmd":{requires:["editor/plugin/color/cmd"]}});
a({"editor/plugin/heading":{requires:["editor","editor/plugin/heading/cmd"]}});a({"editor/plugin/heading/cmd":{requires:["editor"]}});a({"editor/plugin/image":{requires:"event,editor,editor/plugin/button,editor/plugin/bubble,editor/plugin/contextmenu,editor/plugin/dialog-loader".split(",")}});a({"editor/plugin/image/dialog":{requires:["io","editor","editor/plugin/dialog","tabs","editor/plugin/menubutton"]}});a({"editor/plugin/indent":{requires:["editor","editor/plugin/indent/cmd"]}});a({"editor/plugin/indent/cmd":{requires:["editor",
"editor/plugin/dent-cmd"]}});a({"editor/plugin/italic":{requires:["editor","editor/plugin/font/ui","editor/plugin/italic/cmd"]}});a({"editor/plugin/italic/cmd":{requires:["editor","editor/plugin/font/cmd"]}});a({"editor/plugin/justify-center":{requires:["editor","editor/plugin/justify-center/cmd"]}});a({"editor/plugin/justify-center/cmd":{requires:["editor/plugin/justify-cmd"]}});a({"editor/plugin/justify-cmd":{requires:["editor"]}});a({"editor/plugin/justify-left":{requires:["editor","editor/plugin/justify-left/cmd"]}});
a({"editor/plugin/justify-left/cmd":{requires:["editor/plugin/justify-cmd"]}});a({"editor/plugin/justify-right":{requires:["editor","editor/plugin/justify-right/cmd"]}});a({"editor/plugin/justify-right/cmd":{requires:["editor/plugin/justify-cmd"]}});a({"editor/plugin/link":{requires:["editor","editor/plugin/bubble","editor/plugin/link/utils","editor/plugin/dialog-loader","editor/plugin/button"]}});a({"editor/plugin/link/dialog":{requires:["editor","editor/plugin/dialog","editor/plugin/link/utils"]}});
a({"editor/plugin/link/utils":{requires:["editor"]}});a({"editor/plugin/list-utils":{requires:["editor"]}});a({"editor/plugin/list-utils/btn":{requires:["editor","editor/plugin/button","editor/plugin/menubutton"]}});a({"editor/plugin/list-utils/cmd":{requires:["editor","editor/plugin/list-utils"]}});a({"editor/plugin/local-storage":{requires:["editor","overlay","editor/plugin/flash-bridge"]}});a({"editor/plugin/maximize":{requires:["editor","editor/plugin/maximize/cmd"]}});a({"editor/plugin/maximize/cmd":{requires:["event",
"editor"]}});a({"editor/plugin/menubutton":{requires:["editor","menubutton"]}});a({"editor/plugin/ordered-list":{requires:["editor","editor/plugin/list-utils/btn","editor/plugin/ordered-list/cmd"]}});a({"editor/plugin/ordered-list/cmd":{requires:["editor","editor/plugin/list-utils/cmd"]}});a({"editor/plugin/outdent":{requires:["editor","editor/plugin/outdent/cmd"]}});a({"editor/plugin/outdent/cmd":{requires:["editor","editor/plugin/dent-cmd"]}});a({"editor/plugin/overlay":{requires:["editor","overlay",
"editor/plugin/focus-fix"]}});a({"editor/plugin/page-break":{requires:["editor","editor/plugin/fake-objects"]}});a({"editor/plugin/progressbar":{requires:["base"]}});a({"editor/plugin/remove-format":{requires:["editor","editor/plugin/remove-format/cmd","editor/plugin/button"]}});a({"editor/plugin/remove-format/cmd":{requires:["editor"]}});a({"editor/plugin/resize":{requires:["editor","dd"]}});a({"editor/plugin/separator":{requires:["editor"]}});a({"editor/plugin/smiley":{requires:["editor","editor/plugin/overlay"]}});
a({"editor/plugin/source-area":{requires:["editor","editor/plugin/button"]}});a({"editor/plugin/strike-through":{requires:["editor","editor/plugin/font/ui","editor/plugin/strike-through/cmd"]}});a({"editor/plugin/strike-through/cmd":{requires:["editor","editor/plugin/font/cmd"]}});a({"editor/plugin/table":{requires:["editor","editor/plugin/dialog-loader","editor/plugin/contextmenu"]}});a({"editor/plugin/table/dialog":{requires:["editor","editor/plugin/dialog","editor/plugin/menubutton"]}});a({"editor/plugin/underline":{requires:["editor",
"editor/plugin/font/ui","editor/plugin/underline/cmd"]}});a({"editor/plugin/underline/cmd":{requires:["editor","editor/plugin/font/cmd"]}});a({"editor/plugin/undo":{requires:["editor","editor/plugin/undo/btn","editor/plugin/undo/cmd"]}});a({"editor/plugin/undo/btn":{requires:["editor","editor/plugin/button"]}});a({"editor/plugin/undo/cmd":{requires:["editor"]}});a({"editor/plugin/unordered-list":{requires:["editor","editor/plugin/list-utils/btn","editor/plugin/unordered-list/cmd"]}});a({"editor/plugin/unordered-list/cmd":{requires:["editor",
"editor/plugin/list-utils/cmd"]}});a({"editor/plugin/video":{requires:["editor","editor/plugin/flash-common/utils","editor/plugin/flash-common/base-class","editor/plugin/fake-objects"]}});a({"editor/plugin/video/dialog":{requires:["editor","editor/plugin/flash/dialog","editor/plugin/menubutton"]}});a({"editor/plugin/word-filter":{requires:["html-parser"]}});a({"editor/plugin/xiami-music":{requires:["editor","editor/plugin/flash-common/base-class","editor/plugin/flash-common/utils","editor/plugin/fake-objects"]}});
a({"editor/plugin/xiami-music/dialog":{requires:["editor","editor/plugin/flash/dialog","editor/plugin/menubutton"]}})})(function(a){KISSY.config("modules",a)},KISSY.Features,KISSY.UA)});
KISSY.add("editor",function(a,b,p,l,m,t,k,g,q,r,v,n){function w(a,b){var d=a.body;K(function(){a.designMode="on";setTimeout(function(){a.designMode="off";d.focus();arguments.callee.retry||(arguments.callee.retry=c)},50)},function(){a.designMode="off";d.setAttribute("contentEditable",!1);d.setAttribute("contentEditable",!0);!b&&w(a,1)})}function x(c){c.get("iframe");var d=c.get("textarea")[0],f=c.get("window"),g=c.get("document"),h=g[0];u.webkit&&(g.on("click",function(c){var d=new b(c.target);a.inArray(d.nodeName(),
["input","select"])&&c.preventDefault()}),g.on("mouseup",function(c){var d=new b(c.target);a.inArray(d.nodeName(),["input","textarea"])&&c.preventDefault()}));if(u.gecko||D||u.opera){var i;i=(new b('<span tabindex="-1" style="position:absolute; left:-10000" role="presentation"></span>')).insertAfter(d);i.on("focus",function(){c.focus()});c.activateGecko=function(){u.gecko&&c.__iframeFocus&&i[0].focus()};c.on("destroy",function(){i.detach();i.remove()})}f.on("focus",function(){u.gecko?w(h,e):u.opera&&
h.body.focus();c.notifySelectionChange()});if(u.gecko)g.on("mousedown",function(){c.__iframeFocus||w(h,e)});if(D&&(g.on("keydown",function(a){if(a.keyCode in{8:1,46:1}){var b=c.getSelection(),d=b.getSelectedElement();if(d){c.execCommand("save");var e=b.getRanges()[0].createBookmark();d.remove();b.selectBookmarks([e]);c.execCommand("save");a.preventDefault()}}}),"CSS1Compat"==h.compatMode)){var j={33:1,34:1};g.on("keydown",function(a){a.keyCode in j&&setTimeout(function(){c.getSelection().scrollIntoView()},
0)})}if(u.webkit)g.on("mousedown",function(d){d=new b(d.target);a.inArray(d.nodeName(),["img","hr","input","textarea","select"])&&c.getSelection().selectElement(d)});if(u.gecko)g.on("dragstart",function(a){var c=new b(a.target);c.nodeName()==="img"&&/ke_/.test(c[0].className)&&a.preventDefault()});t.add(c)}function i(b,c,d,e){var f="",g;g=m.debugUrl("theme/editor-iframe.css");d=d.concat([]);d.unshift(g);for(g=0;g<d.length;g++)f+=a.substitute('<link href="{href}" rel="stylesheet" />',{href:d[g]});
return a.substitute(p,{doctype:8===y.documentMode?'<meta http-equiv="X-UA-Compatible" content="IE=7" />':"",title:"{title}",links:f,style:"<style>"+c+"</style>",data:e||"",script:b?'<script id="ke_active_script">'+(C(h).isCustomDomain()?'document.domain="'+y.domain+'";':"")+'parent.KISSY.require("editor")._initIframe("'+b+'");<\/script>':""})}function o(a,c){function d(){j=h.document;a.setInternal("document",new b(j));a.setInternal("window",new b(h));e.detach();j.open("text/html","replace");j.write(f);
j.close()}var e=a.get("iframe"),f=i(a.get("id"),a.get("customStyle"),a.get("customLink"),c),g=e[0],h=g.contentWindow,j;e.__loaded=1;try{j=h.document}catch(k){if(g.src=g.src,7>D){setTimeout(d,10);return}}d()}function f(c,d){var e=C(h).getEmptyIframeSrc()||"";e&&(e=' src="'+e+'" ');var e=new b(a.substitute(z,{iframeSrc:e,prefixCls:c.get("prefixCls")})),f=c.get("textarea");f.hasAttr("tabindex")&&e.attr("tabindex",u.webkit?-1:f.attr("tabindex"));f.parent().prepend(e);c.set("iframe",e);c.__docReady=0;
if(u.gecko&&!e.__loaded)e.on("load",function(){o(c,d)},c);else o(c,d)}function d(b){if(b.get("iframe")){var c=b.get("iframe"),d=b.get("window"),b=b.get("document"),e=b[0],f=C(e.documentElement),e=C(e.body);a.each([b,f,e,d],function(a){a.detach()});c.remove()}}var c=!0,j=j,e=!1,h=a.Env.host,y=h.document,u=a.UA,D=u.ie,E=b.NodeType,C=b.all,K=m.tryThese,z='<iframe class="{prefixCls}editor-iframe" frameborder="0"  title="kissy-editor"  allowTransparency="true"  {iframeSrc} ></iframe>',O=/^(?:<(p)>)?(?:(?:&nbsp;)|\s|<br[^>]*>)*(?:<\/\1>)?$/i;
l.Mode={SOURCE_MODE:0,WYSIWYG_MODE:1};l.addMembers({initializer:function(){this.__commands={};this.__controls={};t.register(this)},renderUI:function(){q.init(this);r.init(this);v.init(this);n.init(this)},bindUI:function(){function a(){b.detach("docReady",a);if(b.get("focused"))b.focus();else{var c=b.getSelection();c&&c.removeAllRanges()}}var b=this,c,d=b.get("prefixCls"),e=b.get("textarea");if(b.get("attachForm")&&(c=e[0].form)&&(c=C(c)))c.on("submit",b.sync,b);b.on("docReady",a);b.on("blur",function(){b.$el.removeClass(d+
"editor-focused")});b.on("focus",function(){b.$el.addClass(d+"editor-focused")})},_onSetHeight:function(a){var b=this.get("textarea"),c=this.get("toolBarEl"),d=this.get("statusBarEl"),a=parseInt(a,10),a=a-((c&&c.outerHeight()||0)+(d&&d.outerHeight()||0));b.parent().css("height",a);b.css("height",a)},_onSetMode:function(a){var b=this.get("iframe"),c=this.get("textarea");1==a?(this.setData(c.val()),c.hide(),this.fire("wysiwygMode")):(b&&(c.val(this.getFormatData(1)),b.hide()),c.show(),this.fire("sourceMode"))},
_onSetFocused:function(a){a&&this.__docReady&&this.focus()},destructor:function(){var b,c=this.get("textarea"),d=this.get("document");this.get("attachForm")&&(b=c[0].form)&&(b=C(b))&&b.detach("submit",this.sync,this);if(d){b=C(d[0].body);var c=C(d[0].documentElement),e=this.get("window");t.remove(this);d.detach();c.detach();b.detach();e.detach()}a.each(this.__controls,function(a){a.destroy&&a.destroy()});this.__commands={};this.__controls={}},getControl:function(a){return this.__controls[a]},getControls:function(){return this.__controls},
addControl:function(a,b){this.__controls[a]=b},showDialog:function(a,b){var a=a+"/dialog",c=this.__controls[a];c.show(b);this.fire("dialogShow",{dialog:c.dialog,pluginDialog:c,dialogName:a})},addCommand:function(a,b){this.__commands[a]=b},hasCommand:function(a){return this.__commands[a]},execCommand:function(b){var c=this.__commands[b],d=a.makeArray(arguments);d.shift();d.unshift(this);if(c)return c.exec.apply(c,d);b+": command not found";return j},queryCommandValue:function(a){return this.execCommand(m.getQueryCmd(a))},
setData:function(a){var b,c=a;if(1!=this.get("mode"))this.get("textarea").val(a);else{if(b=this.htmlDataProcessor)c=b.toDataFormat(a);d(this);f(this,c)}},getData:function(b,c){var d=this.htmlDataProcessor,e;c==j&&(c=this.get("mode"));e=1==c&&this.isDocReady()?this.get("document")[0].body.innerHTML:d.toDataFormat(this.get("textarea").val());e=b?d.toHtml(e):d.toServer(e);e=a.trim(e);O.test(e)&&(e="");return e},getFormatData:function(a){return this.getData(1,a)},getDocHtml:function(){return i(0,this.get("customStyle"),
this.get("customLink"),this.getFormatData())},getSelection:function(){return l.Selection.getSelection(this.get("document")[0])},getSelectedHtml:function(){var a=this.getSelection().getRanges()[0],b="";a&&(a=a.cloneContents(),b=this.get("document")[0].createElement("div"),b.appendChild(a),b=b.innerHTML);return b},focus:function(){var a=this.get("window");if(a){var b=this.get("document")[0],a=a[0];u.ie||a&&a.parent&&a.parent.focus();a&&a.focus();try{b.body.focus()}catch(c){}this.notifySelectionChange()}},
blur:function(){this.get("window")[0].blur();this.get("document")[0].body.blur()},addCustomStyle:function(a,b){var c=this.get("window"),d=this.get("customStyle")||"";this.set("customStyle",d+("\n"+a));c&&c.addStyleSheet(c,a,b)},removeCustomStyle:function(a){this.get("document").on("#"+a).remove()},addCustomLink:function(a){var b=this.get("customLink"),c=this.get("document")[0];b.push(a);this.set("customLink",b);b=c.createElement("link");b.rel="stylesheet";c.getElementsByTagName("head")[0].appendChild(b);
b.href=a},removeCustomLink:function(b){this.get("document").all("link").each(function(a){a.attr("href")==b&&a.remove()});var c=this.get("customLink"),d=a.indexOf(b,c);-1!=d&&c.splice(d,1)},docReady:function(a){this.on("docReady",a);this.__docReady&&a.call(this)},isDocReady:function(){return this.__docReady},checkSelectionChange:function(){var a=this;a.__checkSelectionChangeId&&clearTimeout(a.__checkSelectionChangeId);a.__checkSelectionChangeId=setTimeout(function(){var b=a.getSelection();if(b&&!b.isInvalid){var c=
b.getStartElement(),d=new l.ElementPath(c);if(!a.__previousPath||!a.__previousPath.compare(d))a.__previousPath=d,a.fire("selectionChange",{selection:b,path:d,element:c})}},100)},notifySelectionChange:function(){this.__previousPath=null;this.checkSelectionChange()},insertElement:function(a){if(1!==this.get("mode"))return j;this.focus();var b,d=a.nodeName(),e=l.XHTML_DTD,f=e.$block[d],g=l.RangeType,h=(d=this.getSelection())&&d.getRanges(),i,k,m;if(!h||0==h.length)return j;this.execCommand("save");for(k=
h.length-1;0<=k;k--)i=h[k],b=!k&&a||a.clone(c),i.insertNodeByDtd(b),m||(m=b);if(!m)return j;i.moveToPosition(m,g.POSITION_AFTER_END);f&&(a=l.Walker.whitespaces(!0),(a=(m=m.next(a,1))&&m[0].nodeType==E.ELEMENT_NODE&&m.nodeName())&&e.$block[a]&&e[a]["#text"]&&i.moveToElementEditablePosition(m));d.selectRanges([i]);this.focus();b&&1==b[0].nodeType&&b.scrollIntoView(j,{alignWithTop:!1,allowHorizontalScroll:!0,onlyScrollIfNeeded:!0});G.call(this);return b},insertHtml:function(a,b){var c=this,d,f=c.get("document")[0];
if(1===c.get("mode")){if(d=c.htmlDataProcessor)a=d.toDataFormat(a,b);c.focus();c.execCommand("save");if(D){d=f.selection;"Control"==d.type&&d.clear();try{d.createRange().pasteHTML(a)}catch(g){"insertHtml error in ie"}}else try{f.execCommand("inserthtml",e,a)}catch(h){setTimeout(function(){if(0==c.getSelection().getRanges().length){var b=new l.Range(f),d=C(f.body).first(function(a){return 1==a.nodeType&&"br"!=a.nodeName.toLowerCase()});d||(d=C(f.createElement("p")),d._4e_appendBogus().appendTo(f.body));
b.setStartAt(d,l.RangeType.POSITION_AFTER_START);b.select()}f.execCommand("inserthtml",e,a)},50)}setTimeout(function(){c.getSelection().scrollIntoView()},50);G.call(c)}}});l.decorate=function(a,b){var b=b||{},a=C(a),c=b.textareaAttrs=b.textareaAttrs||{},d=a.style("width"),e=a.style("height"),f=a.attr("name");d&&(b.width=b.width||d);e&&(b.height=b.height||e);f&&(c.name=f);b.data=b.data||a.val();b.elBefore=a;c=(new l(b)).render();a.remove();return c};l._initIframe=function(a){var d=t.getInstance(a),
a=d.get("document"),f=a[0];a.one("#ke_active_script").remove();x(d);var g=f.body,h=C(g);D?(g.hideFocus=c,g.disabled=c,g.contentEditable=c,g.removeAttribute("disabled")):setTimeout(function(){u.gecko||u.opera?g.contentEditable=c:u.webkit?g.parentNode.contentEditable=c:f.designMode="on"},0);if(u.gecko||u.opera){var i=f.documentElement;C(i).on("mousedown",function(a){if(a.target==i){u.gecko&&w(f,e);d.activateGecko()}})}setTimeout(function(){D&&setTimeout(function(){if(f){g.runtimeStyle.marginBottom=
"0px";g.runtimeStyle.marginBottom=""}},1E3)},0);setTimeout(function(){d.__docReady=1;d.fire("docReady");var a=d.get("disableObjectResizing"),c=d.get("disableInlineTableEditing");if(a||c)try{f.execCommand("enableObjectResizing",e,!a);f.execCommand("enableInlineTableEditing",e,!c)}catch(g){h.on(D?"resizestart":"resize",function(d){var e=new b(d.target);(a||e.nodeName()==="table"&&c)&&d.preventDefault()})}},10)};var G=a.buffer(function(){this.execCommand("save")},50);return l},{requires:"node,editor/iframe-content-tpl,editor/base,editor/utils,editor/focusManager,editor/styles,editor/z-index-manager,editor/clipboard,editor/enterKey,editor/htmlDataProcessor,editor/selectionFix,editor/plugin-meta".split(",")});
