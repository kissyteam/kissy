/*
Copyright 2010, KISSY UI Library v1.0.5
MIT Licensed
build: 521 Apr 5 12:27
*/
(function(e,n,f){if(e[n]===f)e[n]={};n=e[n];var b=e.document,i=function(a,c,g,h){if(!c||!a)return a;if(g===f)g=true;var l,m,o;if(h&&(o=h.length))for(l=0;l<o;l++){m=h[l];if(m in c)if(g||!(m in a))a[m]=c[m]}else for(m in c)if(g||!(m in a))a[m]=c[m];return a},j=false,d=[],k=false;i(n,{version:"1.0.5",_init:function(){this.Env={mods:{}};this.Config={debug:true}},add:function(a,c){this.Env.mods[a]={name:a,fn:c};c(this);return this},ready:function(a){k||this._bindReady();j?a.call(e,this):d.push(a);
return this},_bindReady:function(){var a=this,c=b.documentElement.doScroll,g=c?"onreadystatechange":"DOMContentLoaded";k=true;if(b.attachEvent){if(e!=e.top){var h=function(){if(b.readyState==="complete"){b.detachEvent(g,h);a._fireReady()}};b.attachEvent(g,h)}else{var l=function(){try{c("left");a._fireReady()}catch(o){setTimeout(l,1)}};l()}e.attachEvent("onload",function(){a._fireReady()})}else{var m=function(){b.removeEventListener(g,m,false);a._fireReady()};b.addEventListener(g,m,false)}},_fireReady:function(){if(!j){j=
true;if(d){for(var a,c=0;a=d[c++];)a.call(e,this);d=null}}},mix:i,merge:function(){var a=arguments,c={},g,h=a.length;for(g=0;g<h;++g)i(c,a[g]);return c},extend:function(a,c,g,h){if(!c||!a)return a;var l=Object.prototype,m=c.prototype,o=function(p){function q(){}q.prototype=p;return new q}(m);a.prototype=o;o.constructor=a;a.superclass=m;if(c!==Object&&m.constructor===l.constructor)m.constructor=c;g&&i(o,g);h&&i(a,h);return a},augment:function(a,c,g,h){return i(a.prototype,c.prototype,g,h)},weave:function(a,
c,g,h){var l=[g[h],a];c==="before"&&l.reverse();g[h]=function(){for(var m=0,o;m<2;++m)o=l[m].apply(this,arguments);return o};return this},app:function(a){var c=e[a]||{};i(c,this,true,["_init","add","namespace"]);c._init();return e[a]=c},namespace:function(){var a=arguments,c=a.length,g=null,h,l,m;for(h=0;h<c;++h){m=(""+a[h]).split(".");g=this;for(l=e[m[0]]===g?1:0;l<m.length;++l)g=g[m[l]]=g[m[l]]||{}}return g},log:function(a,c,g){if(this.Config.debug){g&&(a=g+": "+a);if(e.console!==f&&console.log)console[c&&
console[c]?c:"log"](a)}return this},error:function(a){throw a;},now:function(){return(new Date).getTime()}});n._init()})(window,"KISSY");
KISSY.add("editor",function(e){function n(f,b){var i=n;if(!(this instanceof i))return new i(f,b);i._isReady||i._setup();return new i.Instance(f,b)}e.mix(n,{version:"1.0",lang:{},plugins:{},Env:{mods:{}},add:function(f,b,i){this.Env.mods[f]={name:f,fn:b,details:i||{}};return this},addPlugin:function(f,b){f=typeof f=="string"?[f]:f;var i=this.plugins,j,d,k;d=0;for(k=f.length;d<k;++d){j=f[d];i[j]||(i[j]=e.merge(b,{name:j}))}},_isReady:false,_setup:function(){this._loadModules();this._isReady=true},_attached:{},
_loadModules:function(){var f=KISSY.Editor.Env.mods,b=this._attached,i,j;for(i in f)if(j=f[i]){b[i]=j;j.fn&&j.fn(this)}}});e.Editor=n});
KISSY.Editor.add("config",function(e){e.config={base:"",language:"zh-cn",theme:"default",toolbar:["source","","fontName","fontSize","bold","italic","underline","strikeThrough","foreColor","backColor","","link","smiley","image","","insertOrderedList","insertUnorderedList","outdent","indent","justifyLeft","justifyCenter","justifyRight"],statusbar:["wordcount","resize"],pluginsConfig:{}}});
KISSY.Editor.add("lang~en",function(e){e.lang.en={source:{text:"Source",title:"Source"},undo:{text:"Undo",title:"Undo (Ctrl+Z)"},redo:{text:"Redo",title:"Redo (Ctrl+Y)"},fontName:{text:"Font Name",title:"Font Name",options:{Arial:"Arial","Times New Roman":"Times New Roman","Arial Black":"Arial Black","Arial Narrow":"Arial Narrow","Comic Sans MS":"Comic Sans MS","Courier New":"Courier New",Garamond:"Garamond",Georgia:"Georgia",Tahoma:"Tahoma","Trebuchet MS":"Trebuchet MS",Verdana:"Verdana"}},fontSize:{text:"Size",
title:"Font size",options:{"8":"1","10":"2","12":"3","14":"4","18":"5","24":"6","36":"7"}},bold:{text:"Bold",title:"Bold (Ctrl+B)"},italic:{text:"Italic",title:"Italick (Ctrl+I)"},underline:{text:"Underline",title:"Underline (Ctrl+U)"},strikeThrough:{text:"Strikeout",title:"Strikeout"},link:{text:"Link",title:"Insert/Edit link",href:"URL:",target:"Open link in new window",remove:"Remove link"},blockquote:{text:"Blockquote",title:"Insert blockquote"},smiley:{text:"Smiley",title:"Insert smiley"},image:{text:"Image",
title:"Insert image",tab_link:"Web Image",tab_local:"Local Image",tab_album:"Album Image",label_link:"Enter image web address:",label_local:"Browse your computer for the image file to upload:",label_album:"Select the image from your album:",uploading:"Uploading...",upload_error:"Exception occurs when uploading file.",upload_filter:"Only allow PNG, GIF, JPG image type.",upload_linkFilter:"The image link is not in our whitelist. Please upload as local image.",ok:"Insert"},insertOrderedList:{text:"Numbered List",
title:"Numbered List (Ctrl+7)"},insertUnorderedList:{text:"Bullet List",title:"Bullet List (Ctrl+8)"},outdent:{text:"Decrease Indent",title:"Decrease Indent"},indent:{text:"Increase Indent",title:"Increase Indent"},justifyLeft:{text:"Left Justify",title:"Left Justify (Ctrl+L)"},justifyCenter:{text:"Center Justify",title:"Center Justify (Ctrl+E)"},justifyRight:{text:"Right Justify",title:"Right Justify (Ctrl+R)"},foreColor:{text:"Text Color",title:"Text Color"},backColor:{text:"Text Background Color",
title:"Text Background Color"},maximize:{text:"Maximize",title:"Maximize"},removeformat:{text:"Remove Format",title:"Remove Format"},wordcount:{tmpl:"Remain %remain% words (include html code)"},resize:{larger_text:"Larger",larger_title:"Enlarge the editor",smaller_text:"Smaller",smaller_title:"Shrink the editor"},common:{ok:"OK",cancel:"Cancel"}}});
KISSY.Editor.add("lang~zh-cn",function(e){e.lang["zh-cn"]={source:{text:"\u6e90\u7801",title:"\u6e90\u7801"},undo:{text:"\u64a4\u9500",title:"\u64a4\u9500"},redo:{text:"\u91cd\u505a",title:"\u91cd\u505a"},fontName:{text:"\u5b57\u4f53",title:"\u5b57\u4f53",options:{"\u5b8b\u4f53":"\u5b8b\u4f53","\u9ed1\u4f53":"\u9ed1\u4f53","\u96b6\u4e66":"\u96b6\u4e66","\u6977\u4f53":"\u6977\u4f53_GB2312","\u5fae\u8f6f\u96c5\u9ed1":"\u5fae\u8f6f\u96c5\u9ed1",Georgia:"Georgia","Times New Roman":"Times New Roman",Impact:"Impact","Courier New":"Courier New",Arial:"Arial",Verdana:"Verdana",Tahoma:"Tahoma"}},fontSize:{text:"\u5927\u5c0f",title:"\u5927\u5c0f",options:{"8":"1","10":"2","12":"3","14":"4","18":"5","24":"6","36":"7"}},bold:{text:"\u7c97\u4f53",
title:"\u7c97\u4f53"},italic:{text:"\u659c\u4f53",title:"\u659c\u4f53"},underline:{text:"\u4e0b\u5212\u7ebf",title:"\u4e0b\u5212\u7ebf"},strikeThrough:{text:"\u5220\u9664\u7ebf",title:"\u5220\u9664\u7ebf"},link:{text:"\u94fe\u63a5",title:"\u63d2\u5165/\u7f16\u8f91\u94fe\u63a5",href:"URL:",target:"\u5728\u65b0\u7a97\u53e3\u6253\u5f00\u94fe\u63a5",remove:"\u79fb\u9664\u94fe\u63a5"},blockquote:{text:"\u5f15\u7528",title:"\u5f15\u7528"},smiley:{text:"\u8868\u60c5",title:"\u63d2\u5165\u8868\u60c5"},image:{text:"\u56fe\u7247",title:"\u63d2\u5165\u56fe\u7247",tab_link:"\u7f51\u7edc\u56fe\u7247",tab_local:"\u672c\u5730\u4e0a\u4f20",tab_album:"\u6211\u7684\u76f8\u518c",label_link:"\u8bf7\u8f93\u5165\u56fe\u7247\u5730\u5740\uff1a",label_local:"\u8bf7\u9009\u62e9\u672c\u5730\u56fe\u7247\uff1a",label_album:"\u8bf7\u9009\u62e9\u76f8\u518c\u56fe\u7247\uff1a",uploading:"\u6b63\u5728\u4e0a\u4f20...",upload_error:"\u5bf9\u4e0d\u8d77\uff0c\u4e0a\u4f20\u6587\u4ef6\u65f6\u53d1\u751f\u4e86\u9519\u8bef\uff1a",upload_filter:"\u4ec5\u652f\u6301 JPG, PNG \u548c GIF \u56fe\u7247\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u3002",
upload_linkFilter:'\u5bf9\u4e0d\u8d77\uff0c\u56fe\u7247\u6240\u5728\u7f51\u7ad9\u4e0d\u5728\u5141\u8bb8\u8303\u56f4\u5185\u3002\n\u8bf7\u4e0b\u8f7d\u5230\u672c\u5730\uff0c\u518d\u901a\u8fc7"\u672c\u5730\u4e0a\u4f20"\u4e0a\u4f20\u56fe\u7247\u3002',ok:"\u63d2\u5165"},insertOrderedList:{text:"\u6709\u5e8f\u5217\u8868",title:"\u6709\u5e8f\u5217\u8868"},insertUnorderedList:{text:"\u65e0\u5e8f\u5217\u8868",title:"\u65e0\u5e8f\u5217\u8868"},outdent:{text:"\u51cf\u5c11\u7f29\u8fdb",title:"\u51cf\u5c11\u7f29\u8fdb"},indent:{text:"\u589e\u52a0\u7f29\u8fdb",title:"\u589e\u52a0\u7f29\u8fdb"},justifyLeft:{text:"\u5de6\u5bf9\u9f50",title:"\u5de6\u5bf9\u9f50"},justifyCenter:{text:"\u5c45\u4e2d\u5bf9\u9f50",title:"\u5c45\u4e2d\u5bf9\u9f50"},justifyRight:{text:"\u53f3\u5bf9\u9f50",title:"\u53f3\u5bf9\u9f50"},foreColor:{text:"\u6587\u672c\u989c\u8272",title:"\u6587\u672c\u989c\u8272"},backColor:{text:"\u80cc\u666f\u989c\u8272",title:"\u80cc\u666f\u989c\u8272"},maximize:{text:"\u5168\u5c4f\u7f16\u8f91",title:"\u5168\u5c4f\u7f16\u8f91"},removeformat:{text:"\u6e05\u9664\u683c\u5f0f",title:"\u6e05\u9664\u683c\u5f0f"},wordcount:{tmpl:"\u8fd8\u53ef\u4ee5\u8f93\u5165 %remain% \u5b57\uff08\u542b html \u4ee3\u7801\uff09"},
resize:{larger_text:"\u589e\u5927",larger_title:"\u589e\u5927\u7f16\u8f91\u533a\u57df",smaller_text:"\u7f29\u5c0f",smaller_title:"\u7f29\u5c0f\u7f16\u8f91\u533a\u57df"},common:{ok:"\u786e\u5b9a",cancel:"\u53d6\u6d88"}}});KISSY.Editor.add("core~plugin",function(e){e.PLUGIN_TYPE={CUSTOM:0,TOOLBAR_SEPARATOR:1,TOOLBAR_BUTTON:2,TOOLBAR_MENU_BUTTON:4,TOOLBAR_SELECT:8,STATUSBAR_ITEM:16,FUNC:32}});
KISSY.Editor.add("core~dom",function(e){var n=YAHOO.env.ua;e.Dom={getText:function(f){return f?f.textContent||"":""},setItemUnselectable:function(f){var b,i,j,d,k;b=f.getElementsByTagName("*");i=-1;for(j=b.length;i<j;++i){k=i==-1?f:b[i];(d=k.nodeName)&&d!="INPUT"&&k.setAttribute("unselectable","on")}return f},BLOCK_ELEMENTS:{blockquote:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,p:1,address:1,center:1,pre:1,form:1,fieldset:1,caption:1,table:1,tbody:1,tr:1,th:1,td:1,ul:1,ol:1,dl:1,dt:1,dd:1,li:1}};
if(n.ie)e.Dom.getText=function(f){return f?f.innerText||"":""}});
KISSY.Editor.add("core~color",function(e){var n=parseInt,f=RegExp;e.Color={KEYWORDS:{black:"000",silver:"c0c0c0",gray:"808080",white:"fff",maroon:"800000",red:"f00",purple:"800080",fuchsia:"f0f",green:"008000",lime:"0f0",olive:"808000",yellow:"ff0",navy:"000080",blue:"00f",teal:"008080",aqua:"0ff"},re_RGB:/^rgb\(([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\)$/i,re_hex:/^#?([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})$/i,re_hex3:/([0-9A-F])/gi,toRGB:function(b){this.re_RGB.test(b)||(b=this.toHex(b));if(this.re_hex.exec(b))b=
"rgb("+[n(f.$1,16),n(f.$2,16),n(f.$3,16)].join(", ")+")";return b},toHex:function(b){b=this.KEYWORDS[b]||b;if(this.re_RGB.exec(b)){b=(f.$1>>0).toString(16);var i=(f.$2>>0).toString(16),j=(f.$3>>0).toString(16);b=[b.length==1?"0"+b:b,i.length==1?"0"+i:i,j.length==1?"0"+j:j].join("")}if(b.length<6)b=b.replace(this.re_hex3,"$1$1");if(b!=="transparent"&&b.indexOf("#")<0)b="#"+b;return b.toLowerCase()},int2hex:function(b){b>>=0;return this.toHex("rgb("+(b&255)+","+(b>>8&255)+","+(b>>16&255)+")")}}});
KISSY.Editor.add("core~command",function(e){var n=YAHOO.env.ua,f={backColor:n.gecko?"hiliteColor":"backColor"};e.Command={exec:function(b,i,j,d){i=f[i]||i;this._preExec(b,i,d);b.execCommand(i,false,j)},_preExec:function(b,i,j){if(n.gecko){i=typeof j==="undefined"?"bold,italic,underline,strikeThrough".indexOf(i)===-1:j;b.execCommand("styleWithCSS",false,i)}}}});
KISSY.Editor.add("core~range",function(e){var n=YAHOO.env.ua.ie;e.Range={getSelectionRange:function(f){var b=f.document,i;if(f.getSelection){f=f.getSelection();if(f.getRangeAt)i=f.getRangeAt(0);else{i=b.createRange();i.setStart(f.anchorNode,f.anchorOffset);i.setEnd(f.focusNode,f.focusOffset)}}else if(b.selection)i=b.selection.createRange();return i},getCommonAncestor:function(f){return f.startContainer||f.parentElement&&f.parentElement()||f.commonParentElement&&f.commonParentElement()},getSelectedText:function(f){if("text"in
f)return f.text;return f.toString?f.toString():""},saveRange:function(f){n&&f.contentWin.focus();return f.getSelectionRange()}}});
KISSY.Editor.add("core~instance",function(e){var n=YAHOO.util,f=n.Dom,b=n.Event,i=YAHOO.lang,j=YAHOO.env.ua,d=j.ie;e.Instance=function(k,a){this.textarea=f.get(k);this.config=i.merge(e.config,a||{});this.sourceMode=false;this.toolbar=new e.Toolbar(this);this.statusbar=new e.Statusbar(this);this._init()};i.augmentObject(e.Instance.prototype,{_init:function(){this._renderUI();this._initPlugins();this._initAutoFocus()},_renderUI:function(){this._renderContainer();this._setupContentPanel()},_initPlugins:function(){var k,
a;a=e.plugins;var c=[];for(k in a)c[k]=i.merge(a[k]);this.plugins=c;this.toolbar.init();this.statusbar.init();for(k in c){a=c[k];if(!a.inited)if(a.type===e.PLUGIN_TYPE.FUNC){a.editor=this;a.init&&a.init();a.inited=true}}},_renderContainer:function(){var k=this.textarea,a=f.getRegion(k),c=a.right-a.left-2+"px",g=a.bottom-a.top-2+"px";a=document.createElement("div");a.className="ks-editor";a.style.width=c;a.innerHTML='<div class="ks-editor-toolbar"></div><div class="ks-editor-content"><iframe frameborder="0" allowtransparency="1"></iframe></div><div class="ks-editor-statusbar"></div>';
c=a.childNodes[1];c.style.width="100%";c.style.height=g;c=c.childNodes[0];c.style.width="100%";c.style.height="100%";c.setAttribute("frameBorder",0);k.style.display="none";f.insertBefore(a,k);this.container=a;this.toolbar.domEl=a.childNodes[0];this.contentWin=c.contentWindow;this.contentDoc=c.contentWindow.document;this.statusbar.domEl=a.childNodes[2]},_setupContentPanel:function(){var k=this.contentDoc,a=this.config;a=a.base+"themes/"+a.theme+"/"+("content"+(a.debug?"":"-min")+".css");var c=this;
k.open();k.write('<!doctype html><html><head><title>Rich Text Area</title><meta charset="charset=gbk" /><link href="{CONTENT_CSS}" rel="stylesheet" /></head><body spellcheck="false" class="ks-editor-post">{CONTENT}</body></html>'.replace("{CONTENT_CSS}",a).replace("{CONTENT}",this.textarea.value));k.close();if(d)k.body.contentEditable="true";else k.designMode="on";d&&b.on(k,"click",function(){k.activeElement.parentNode.nodeType===9&&c._focusToEnd()})},_initAutoFocus:function(){this.config.autoFocus&&
this._focusToEnd()},_focusToEnd:function(){this.contentWin.focus();var k=this.contentDoc.body.lastChild,a=e.Range.getSelectionRange(this.contentWin);if(j.ie){try{a.moveToElementText(k)}catch(c){}a.collapse(false);a.select()}else{try{a.setEnd(k,k.childNodes.length)}catch(g){}a.collapse(false)}},focus:function(){this._focusToEnd()},execCommand:function(k,a,c){this.contentWin.focus();e.Command.exec(this.contentDoc,k,a,c)},getData:function(){if(this.sourceMode)return this.textarea.value;return this.getContentDocData()},
getContentDocData:function(){var k="",a=e.plugins.save;k=this.contentDoc.body.innerHTML;if(k=="<br>")k="";if(a&&a.filterData)k=a.filterData(k);return k},getSelectionRange:function(){return e.Range.getSelectionRange(this.contentWin)}})});
KISSY.Editor.add("core~toolbar",function(e){var n=YAHOO.util,f=n.Dom,b=n.Event,i=YAHOO.lang,j=YAHOO.env.ua.ie,d=j===6,k=e.PLUGIN_TYPE,a=document.createElement("div");e.Toolbar=function(c){this.editor=c;this.config=c.config;this.lang=e.lang[this.config.language];this.items=[];this.stateItems=[]};i.augmentObject(e.Toolbar.prototype,{init:function(){for(var c=this.config.toolbar,g=this.editor.plugins,h,l=0,m=c.length;l<m;++l)if(h=c[l]){if(h in g){h=g[h];this._addItem(h);this.items.push(h);"fontName,fontSize,bold,italic,underline,strikeThroughinsertOrderedList,insertUnorderedListjustifyLeft,justifyCenter,justifyRight".indexOf(h.name)!==
-1&&this.stateItems.push(h)}}else this._addSeparator();this._initUpdateState()},_addItem:function(c){var g,h=c.type;g=this.lang;if(!c.lang)c.lang=i.merge(g.common,this.lang[c.name]||{});g='<div class="ks-editor-toolbar-button ks-inline-block" title="{TITLE}"><div class="ks-editor-toolbar-button-outer-box"><div class="ks-editor-toolbar-button-inner-box"><span class="ks-editor-toolbar-item ks-editor-toolbar-{NAME}">{TEXT}</span></div></div></div>'.replace("{TITLE}",c.lang.title||"").replace("{NAME}",
c.name).replace("{TEXT}",c.lang.text||"");if(d)g=g.replace("outer-box","outer-box ks-inline-block").replace("inner-box","inner-box ks-inline-block");a.innerHTML=g;c.domEl=g=a.firstChild;if(h==k.TOOLBAR_MENU_BUTTON||h==k.TOOLBAR_SELECT){this._renderMenuButton(c);h==k.TOOLBAR_SELECT&&this._renderSelect(c)}this._bindItemUI(c);this._addToToolbar(g);c.editor=this.editor;c.init&&c.init();c.inited=true},_renderMenuButton:function(c){var g=c.domEl,h=g.getElementsByTagName("span")[0].parentNode;f.addClass(g,
"ks-editor-toolbar-menu-button");h.innerHTML='<div class="ks-editor-toolbar-menu-button-caption ks-inline-block"><span class="ks-editor-toolbar-item ks-editor-toolbar-{NAME}">{TEXT}</span></div><div class="ks-editor-toolbar-menu-button-dropdown ks-inline-block"></div>'.replace("{NAME}",c.name).replace("{TEXT}",c.lang.text||"")},_renderSelect:function(c){f.addClass(c.domEl,"ks-editor-toolbar-select")},_bindItemUI:function(c){var g=c.domEl;c.exec&&b.on(g,"click",function(){c.exec()});b.on(g,"mousedown",
function(){f.addClass(g,"ks-editor-toolbar-button-active")});b.on(g,"mouseup",function(){f.removeClass(g,"ks-editor-toolbar-button-active")});b.on(g,"mouseout",function(h){h=b.getRelatedTarget(h);var l;try{if(g.contains)l=g.contains(h);else if(g.compareDocumentPosition)l=g.compareDocumentPosition(h)&8}catch(m){l=false}l||f.removeClass(g,"ks-editor-toolbar-button-active")});if(d){b.on(g,"mouseenter",function(){f.addClass(g,"ks-editor-toolbar-button-hover")});b.on(g,"mouseleave",function(){f.removeClass(g,
"ks-editor-toolbar-button-hover")})}},_addSeparator:function(){a.innerHTML='<div class="ks-editor-stripbar-sep ks-inline-block"></div>';this._addToToolbar(a.firstChild)},_addToToolbar:function(c){if(j)c=e.Dom.setItemUnselectable(c);this.domEl.appendChild(c)},_initUpdateState:function(){var c=this.editor.contentDoc,g=this;b.on(c,"click",function(){g.updateState()});b.on(c,"keyup",function(h){h=h.keyCode;if(h>=33&&h<=40||h===8||h===13||h===46)g.updateState()})},updateState:function(c){var g=this.stateItems,
h;c=c?c.join("|"):"";for(var l=0,m=g.length;l<m;l++){h=g[l];c&&c.indexOf(h.name)===-1||(h.updateState?h.updateState():this.updateItemState(h))}},updateItemState:function(c){var g=this.editor.contentDoc;try{if(g.queryCommandEnabled(c.name))g.queryCommandState(c.name)?f.addClass(c.domEl,"ks-editor-toolbar-button-selected"):f.removeClass(c.domEl,"ks-editor-toolbar-button-selected")}catch(h){}}})});
KISSY.Editor.add("core~statusbar",function(e){var n=YAHOO.lang,f=YAHOO.env.ua.ie,b=document.createElement("div");e.Statusbar=function(i){this.editor=i;this.config=i.config;this.lang=e.lang[this.config.language]};n.augmentObject(e.Statusbar.prototype,{init:function(){for(var i=this.config.statusbar,j=this.editor.plugins,d,k=0,a=i.length;k<a;++k)if(d=i[k])d in j&&this._addItem(j[d]);else this._addSep()},_addItem:function(i){var j;j=this.lang;if(!i.lang)i.lang=n.merge(j.common,this.lang[i.name]||{});
b.innerHTML='<div class="ks-editor-statusbar-item ks-editor-{NAME} ks-inline-block"></div>'.replace("{NAME}",i.name);i.domEl=j=b.firstChild;this._addToToolbar(j);i.editor=this.editor;i.init&&i.init();i.inited=true},_addSep:function(){b.innerHTML='<div class="ks-editor-stripbar-sep kissy-inline-block"></div>';this._addToToolbar(b.firstChild)},_addToToolbar:function(i){if(f)i=e.Dom.setItemUnselectable(i);this.domEl.appendChild(i)}})});
KISSY.Editor.add("core~menu",function(e){var n=YAHOO.util,f=n.Dom,b=n.Event,i=YAHOO.env.ua,j;e.Menu={generateDropMenu:function(d,k,a){var c=document.createElement("div"),g=this;c.innerHTML='<div class="ks-editor-drop-menu-shadow"></div><div class="ks-editor-drop-menu-content"></div>';c.className="ks-editor-drop-menu";c.style.display="none";document.body.appendChild(c);b.on(k,"click",function(h){b.stopPropagation(h);d.activeDropMenu&&g._hide(d);if(d.activeDropMenu!=c){g._setDropMenuPosition(k,c,a);
d.activeDropMenu=c;d.activeDropButton=k;g._show(d)}else{d.activeDropMenu=null;d.activeDropButton=null}});b.on([document,d.contentDoc],"click",function(){if(d.activeDropMenu){g.hideActiveDropMenu(d);this==d.contentDoc&&d.contentWin.focus()}});this._initResizeEvent(k,c,a);return c.childNodes[1]},_setDropMenuPosition:function(d,k,a){var c=f.getRegion(d);d=c.left;c=c.bottom;if(a){d+=a[0];c+=a[1]}k.style.left=d+"px";k.style.top=c+"px"},_isVisible:function(d){if(!d)return false;return d.style.display!=
"none"},hideActiveDropMenu:function(d){this._hide(d);d.activeDropMenu=null;d.activeDropButton=null},_hide:function(d){var k=d.activeDropMenu;d=d.activeDropButton;if(k){j&&(j.style.display="none");k.style.display="none"}d&&f.removeClass(d,"ks-editor-toolbar-button-selected")},_show:function(d){var k=d.activeDropMenu;d=d.activeDropButton;if(k){k.style.display="";if(i.ie===6){this._updateShimRegion(k);j.style.display=""}}d&&f.addClass(d,"ks-editor-toolbar-button-selected")},_updateShimRegion:function(d){if(d)if(i.ie===
6){j||this._initShim();this._setShimRegion(d)}},_initResizeEvent:function(d,k,a){var c=this,g;b.on(window,"resize",function(){g&&clearTimeout(g);g=setTimeout(function(){c._isVisible(k)&&c._setDropMenuPosition(d,k,a)},50)})},_initShim:function(){j=document.createElement("iframe");j.src="about:blank";j.className="ks-editor-drop-menu-shim";j.style.position="absolute";j.style.display="none";j.style.border="none";document.body.appendChild(j)},_setShimRegion:function(d){if(j&&this._isVisible(d)){d=f.getRegion(d);
if(d.width>0){j.style.left=d.left+"px";j.style.top=d.top+"px";j.style.width=d.width-1+"px";j.style.height=d.height-1+"px"}}}}});KISSY.Editor.add("smilies~config~default",function(e){e.Smilies=e.Smilies||{};e.Smilies["default"]={name:"default",mode:"icons",cols:5,fileNames:["smile","confused","cool","cry","eek","angry","wink","sweat","lol","stun","razz","shy","rolleyes","sad","happy","yes","no","heart","idea","rose"],fileExt:"gif"}});
KISSY.Editor.add("smilies~config~wangwang",function(e){e.Smilies=e.Smilies||{};e.Smilies.wangwang={name:"wangwang",mode:"sprite",base:"http://a.tbcdn.cn/sys/wangwang/smiley/48x48/",spriteStyle:"background: url(http://a.tbcdn.cn/sys/wangwang/smiley/sprite.png) no-repeat -1px 0; width: 288px; height: 235px",unitStyle:"width: 24px; height: 24px",filePattern:{start:0,end:98,step:1},fileExt:"gif"}});
KISSY.Editor.add("plugins~base",function(e){var n=e.PLUGIN_TYPE;e.addPlugin("bold,italic,underline,strikeThrough,insertOrderedList,insertUnorderedList".split(","),{type:n.TOOLBAR_BUTTON,exec:function(){this.editor.execCommand(this.name);this.editor.toolbar.updateState()}})});
KISSY.Editor.add("plugins~color",function(e){var n=YAHOO.util,f=n.Dom,b=n.Event,i=YAHOO.env.ua.ie,j=["000","444","666","999","CCC","EEE","F3F3F3","FFF"],d=["F00","F90","FF0","0F0","0FF","00F","90F","F0F"],k=["F4CCCC","FCE5CD","FFF2CC","D9EAD3","D0E0E3","CFE2F3","D9D2E9","EAD1DC","EA9999","F9CB9C","FFE599","B6D7A8","A2C4C9","9FC5E8","B4A7D6","D5A6BD","E06666","F6B26B","FFD966","93C47D","76A5AF","6FA8DC","8E7CC3","C27BAD","CC0000","E69138","F1C232","6AA84F","45818E","3D85C6","674EA7","A64D79","990000",
"B45F06","BF9000","38761D","134F5C","0B5394","351C75","741B47","660000","783F04","7F6000","274E13","0C343D","073763","20124D","4C1130"];e.addPlugin(["foreColor","backColor"],{type:e.PLUGIN_TYPE.TOOLBAR_MENU_BUTTON,color:"",_indicator:null,swatches:null,dropMenu:null,range:null,init:function(){var a=this.domEl,c=a.getElementsByTagName("span")[0].parentNode;this.color=this._getDefaultColor();f.addClass(a,"ks-editor-toolbar-color-button");c.innerHTML='<div class="ks-editor-toolbar-color-button-indicator" style="border-bottom-color:'+
this.color+'">'+c.innerHTML+"</div>";this._indicator=c.firstChild;this._renderUI();this._bindUI();this.swatches=f.getElementsByClassName("ks-editor-palette-colorswatch","div",this.dropMenu)},_renderUI:function(){this.dropMenu=e.Menu.generateDropMenu(this.editor,this.domEl,[1,0]);this._generatePalettes();i&&e.Dom.setItemUnselectable(this.dropMenu)},_bindUI:function(){this._bindPickEvent();b.on(this.domEl,"click",function(){this.range=this.editor.getSelectionRange();i&&this.editor.contentDoc.selection.empty();
this._updateSelectedColor(this.color)},this,true)},_generatePalettes:function(){var a="";a+=this._getPaletteTable(j);a+=this._getPaletteTable(d);a+=this._getPaletteTable(k);this.dropMenu.innerHTML=a},_getPaletteTable:function(a){var c,g=a.length,h,l="<tr>";c=0;for(g=a.length;c<g;++c){if(c!=0&&c%8==0)l+="</tr><tr>";h=e.Color.toRGB("#"+a[c]).toUpperCase();l+='<td class="ks-editor-palette-cell"><div class="ks-editor-palette-colorswatch" title="{COLOR}" style="background-color:{COLOR}"></div></td>'.replace(/{COLOR}/g,
h)}l+="</tr>";return'<div class="ks-editor-palette-table"><table><tbody>{TR}</tbody></table></div>'.replace("{TR}",l)},_bindPickEvent:function(){var a=this;b.on(this.dropMenu,"click",function(c){var g=b.getTarget(c).getAttribute("title");g&&g.indexOf("RGB")===0&&a._doAction(g);b.stopPropagation(c);e.Menu.hideActiveDropMenu(a.editor)})},_doAction:function(a){if(a){this.setColor(e.Color.toHex(a));a=this.range;i&&a.select&&a.select();this.editor.execCommand(this.name,this.color)}},setColor:function(a){this.color=
a;this._updateIndicatorColor(a);this._updateSelectedColor(a)},_updateIndicatorColor:function(a){this._indicator.style.borderBottomColor=a},_updateSelectedColor:function(a){var c,g,h,l=this.swatches;c=0;for(g=l.length;c<g;++c){h=l[c];e.Color.toHex(h.style.backgroundColor)==a?f.addClass(h.parentNode,"ks-editor-palette-cell-selected"):f.removeClass(h.parentNode,"ks-editor-palette-cell-selected")}},_getDefaultColor:function(){return this.name=="foreColor"?"#000000":"#ffffff"}})});
KISSY.Editor.add("plugins~font",function(e){var n=YAHOO.util,f=n.Dom,b=n.Event,i=YAHOO.env.ua,j={"10px":1,"13px":2,"16px":3,"18px":4,"24px":5,"32px":6,"48px":7};e.addPlugin(["fontName","fontSize"],{type:e.PLUGIN_TYPE.TOOLBAR_SELECT,selectedValue:"",selectHead:null,selectList:null,options:[],items:null,selectedItem:null,range:null,init:function(){this.options=this.lang.options;this.selectHead=this.domEl.getElementsByTagName("span")[0];this._renderUI();this._bindUI()},_renderUI:function(){this.selectList=
e.Menu.generateDropMenu(this.editor,this.domEl,[1,0]);this._renderSelectList();this.items=this.selectList.getElementsByTagName("li")},_bindUI:function(){this._bindPickEvent();b.on(this.domEl,"click",function(){this.range=this.editor.getSelectionRange();i.ie&&this.editor.contentDoc.selection.empty();if(this.selectedValue)this._updateSelectedOption(this.selectedValue);else if(this.selectedItem){f.removeClass(this.selectedItem,"ks-editor-option-selected");this.selectedItem=null}},this,true)},_renderSelectList:function(){var d=
"",k=this.options,a,c;for(a in k){c=k[a];d+='<li class="ks-editor-option" data-value="{VALUE}"><span class="ks-editor-option-checkbox"></span><span style="{STYLE}">{KEY}</span></li>'.replace("{VALUE}",c).replace("{STYLE}",this._getOptionStyle(a,c)).replace("{KEY}",a)}this.selectList.innerHTML='<ul class="ks-editor-select-list">{LI}</ul>'.replace("{LI}",d);f.addClass(this.selectList,"ks-editor-drop-menu-"+this.name)},_bindPickEvent:function(){var d=this;b.on(this.selectList,"click",function(k){var a=
b.getTarget(k);if(a.nodeName!="LI")a=f.getAncestorByTagName(a,"li");if(a){d._doAction(a.getAttribute("data-value"));b.stopPropagation(k);e.Menu.hideActiveDropMenu(d.editor)}});if(i.ie===6){b.on(this.items,"mouseenter",function(){f.addClass(this,"ks-editor-option-hover")});b.on(this.items,"mouseleave",function(){f.removeClass(this,"ks-editor-option-hover")})}},_doAction:function(d){if(d){this.selectedValue=d;this._setOption(d);d=this.range;i.ie&&d.select&&d.select();this.editor.execCommand(this.name,
this.selectedValue)}},_setOption:function(d){this._updateHeadText(this._getOptionKey(d));this._updateSelectedOption(d)},_getOptionStyle:function(d,k){return this.name=="fontName"?"font-family:"+k:"font-size:"+d+"px"},_getOptionKey:function(d){var k=this.options,a;for(a in k)if(k[a]==d)return a;return null},_updateHeadText:function(d){this.selectHead.innerHTML=d},_updateSelectedOption:function(d){var k=this.items,a,c=k.length,g;for(a=0;a<c;++a){g=k[a];if(g.getAttribute("data-value")==d){f.addClass(g,
"ks-editor-option-selected");this.selectedItem=g}else f.removeClass(g,"ks-editor-option-selected")}},updateState:function(){var d=this.editor.contentDoc,k=this.options,a=this.name,c,g;try{if(d.queryCommandEnabled(a)){g=d.queryCommandValue(a);if(i.webkit&&a=="fontSize")g=this._getWebkitFontSize(g);g&&(c=this._getOptionKey(g));if(c in k){if(g!=this.selectedValue){this.selectedValue=g;this._updateHeadText(c)}}else{this.selectedValue="";this._updateHeadText(this.lang.text)}}}catch(h){}},_getWebkitFontSize:function(d){if(d in
j)return j[d];return null}})});
KISSY.Editor.add("plugins~image",function(e){var n=YAHOO.util,f=n.Dom,b=n.Event,i=n.Connect,j=YAHOO.lang,d=YAHOO.env.ua,k=d.ie,a="ks-editor-image-tab-selected",c=/^(?:.*?:\/\/)?(.*?)\/.*$/,g={local:'<li rel="local" class="'+a+'">{tab_local}</li>',link:'<li rel="link">{tab_link}</li>',album:'<li rel="album">{tab_album}</li>'},h={tabs:["link"],upload:{actionUrl:"",filter:"png|gif|jpg|jpeg",filterMsg:"",linkFilter:"",linkFilterMsg:"",enableXdr:false,connectionSwf:"http://a.tbcdn.cn/yui/2.8.0r4/build/connection/connection.swf",formatResponse:function(l){var m=
[];for(var o in l)m.push(l[o]);return m},extraCode:""}};e.addPlugin("image",{type:e.PLUGIN_TYPE.TOOLBAR_BUTTON,config:{},dialog:null,form:null,range:null,currentTab:null,currentPanel:null,uploadingPanel:null,actionsBar:null,init:function(){var l=this.editor.config.pluginsConfig[this.name]||{};h.upload.filterMsg=this.lang.upload_filter;h.upload.linkFilterMsg=this.lang.upload_linkFilter;this.config=j.merge(h,l);this.config.upload=j.merge(h.upload,l.upload||{});this._renderUI();this._bindUI();this.actionsBar=
f.getElementsByClassName("ks-editor-dialog-actions","div",this.dialog)[0];this.uploadingPanel=f.getElementsByClassName("ks-editor-image-uploading","div",this.dialog)[0];this.config.upload.enableXdr&&this._initXdrUpload()},_renderUI:function(){var l=e.Menu.generateDropMenu(this.editor,this.domEl,[1,0]),m=this.lang;m.local_extraCode=this.config.upload.extraCode;l.className+=" ks-editor-image";l.innerHTML='<form action="javascript: void(0)"><ul class="ks-editor-image-tabs ks-clearfix"></ul><div class="ks-editor-image-tab-content" rel="local" style="display: none"><label>{label_local}</label><input type="file" size="40" name="imgFile" unselectable="on" />{local_extraCode}</div><div class="ks-editor-image-tab-content" rel="link"><label>{label_link}</label><input name="imgUrl" size="50" /></div><div class="ks-editor-image-tab-content" rel="album" style="display: none"><label>{label_album}</label><p style="width: 300px">\u5c1a\u672a\u5b9e\u73b0...</p></div><div class="ks-editor-image-uploading" style="display: none"><p style="width: 300px">{uploading}</p></div><div class="ks-editor-dialog-actions"><button name="ok" class="ks-editor-btn-ok">{ok}</button><span class="ks-editor-btn-cancel">{cancel}</span></div></form>'.replace(/\{([^}]+)\}/g,
function(o,p){return p in m?m[p]:p});this.dialog=l;this.form=l.getElementsByTagName("form")[0];k&&e.Dom.setItemUnselectable(l);this._renderTabs()},_renderTabs:function(){function l(x){for(var r=0,y=x.getAttribute("rel"),s=0;s<z;s++){u[s]&&f.removeClass(u[s],a);q[s].style.display="none";if(q[s].getAttribute("rel")==y)r=s}d.ie===6&&e.Menu._updateShimRegion(o.dialog);f.addClass(x,a);q[r].style.display="";o.currentTab=x.getAttribute("rel");o.currentPanel=q[r]}for(var m=this.lang,o=this,p=f.getElementsByClassName("ks-editor-image-tabs",
"ul",this.dialog)[0],q=f.getElementsByClassName("ks-editor-image-tab-content","div",this.dialog),v=this.config.tabs,t="",w=0,A=v.length;w<A;w++)t+=g[v[w]];p.innerHTML=t.replace(/\{([^}]+)\}/g,function(x,r){return r in m?m[r]:r});var u=p.childNodes,z=q.length;u.length===1&&f.addClass(this.dialog,"ks-editor-image-no-tab");l(u[0]);b.on(u,"click",function(){l(this)})},_bindUI:function(){var l=this;b.on(this.domEl,"click",function(){if(l.dialog.style.visibility===k?"hidden":"visible")l._syncUI()});b.on(this.dialog,
"click",function(m){var o=b.getTarget(m),p=l.currentTab;switch(o.className){case "ks-editor-btn-ok":if(p==="local"){b.stopPropagation(m);l._insertLocalImage()}else l._insertWebImage();break;case "ks-editor-btn-cancel":break;default:b.stopPropagation(m)}})},_initXdrUpload:function(){for(var l=this.config.tabs,m=0,o=l.length;m<o;m++)if(l[m]==="local"){i.transport(this.config.upload.connectionSwf);break}},_insertLocalImage:function(){var l=this.form,m=this.config.upload,o=l.imgFile.value,p=m.actionUrl,
q=this;if(o&&p){if(m.filter!=="*"){o=o.substring(o.lastIndexOf(".")+1).toLowerCase();if(m.filter.indexOf(o)==-1){alert(m.filterMsg);q.form.reset();return}}this.uploadingPanel.style.display="";this.currentPanel.style.display="none";this.actionsBar.style.display="none";d.ie===6&&e.Menu._updateShimRegion(this.dialog);i.setForm(l,true);i.asyncRequest("post",p,{upload:function(v){try{var t=m.formatResponse(j.JSON.parse(v.responseText));if(t[0]=="0"){q._insertImage(t[1]);q._hideDialog()}else q._onUploadError(t[1])}catch(w){q._onUploadError(j.dump(w)+
"\no = "+j.dump(v)+"\n[from upload catch code]")}},xdr:m.enableXdr})}else q._hideDialog()},_onUploadError:function(l){alert(this.lang.upload_error+"\n\n"+l);this._hideDialog()},_insertWebImage:function(){var l=this.form.imgUrl.value||"",m=this.config.upload,o=m.linkFilter,p,q;if(p=c.exec(l))q=p[1];if(l&&q){if(o&&o!=="*")if(("|"+o.toLowerCase()+"|").indexOf("|"+q.toLowerCase()+"|")===-1){alert(m.linkFilterMsg);return}this._insertImage(l)}},_hideDialog:function(){var l=this.editor.activeDropMenu;l&&
f.isAncestor(l,this.dialog)&&e.Menu.hideActiveDropMenu(this.editor);this.editor.contentWin.focus()},_syncUI:function(){this.range=e.Range.saveRange(this.editor);this.form.reset();this.uploadingPanel.style.display="none";this.currentPanel.style.display="";this.actionsBar.style.display=""},_insertImage:function(l,m){l=j.trim(l);if(l.length!==0){var o=this.editor,p=this.range;if(window.getSelection){var q=o.contentDoc.createElement("img");q.src=l;m&&q.setAttribute("alt",m);p.deleteContents();p.insertNode(q);
if(d.webkit){m=o.contentWin.getSelection();m.addRange(p);m.collapseToEnd()}else p.setStartAfter(q);o.contentWin.focus()}else if(document.selection){o.contentWin.focus();if("text"in p){p.select();o='<img src="'+l+'"';m&&(o+=' "alt="'+m+'"');o+=">";p.pasteHTML(o)}else p.execCommand("insertImage",false,l)}}}})});KISSY.Editor.add("plugins~indent",function(e){e.addPlugin(["indent","outdent"],{type:e.PLUGIN_TYPE.TOOLBAR_BUTTON,exec:function(){this.editor.execCommand(this.name);this.editor.toolbar.updateState()}})});
KISSY.Editor.add("plugins~justify",function(e){var n=["justifyLeft","justifyCenter","justifyRight"];e.addPlugin(n,{type:e.PLUGIN_TYPE.TOOLBAR_BUTTON,exec:function(){this.editor.execCommand(this.name);this.editor.toolbar.updateState(n)}})});
KISSY.Editor.add("plugins~keystroke",function(e){var n=YAHOO.util.Event,f=YAHOO.env.ua;e.addPlugin("keystroke",{type:e.PLUGIN_TYPE.FUNC,init:function(){var b=this.editor;f.ie&&f.ie<8&&n.on(b.contentDoc,"keydown",function(j){j.keyCode==9&&this.selection.empty()});var i=b.textarea.form;i&&(new YAHOO.util.KeyListener(b.contentDoc,{ctrl:true,keys:13},{fn:function(){if(!b.sourceMode)b.textarea.value=b.getData();i.submit()}})).enable()}})});
KISSY.Editor.add("plugins~link",function(e){var n=YAHOO.util,f=n.Dom,b=n.Event,i=YAHOO.lang,j=YAHOO.env.ua,d=j.ie;n=e.PLUGIN_TYPE;var k=e.Range,a=(new Date).getTime(),c=/^\w+:\/\/.*|#.*$/,g=['<form onsubmit="return false"><ul><li class="ks-editor-link-href"><label>{href}</label><input name="href" style="width: 220px" value="http://" type="text" /></li><li class="ks-editor-link-target"><input name="target" id="target_"',a,' type="checkbox" /> <label for="target_"',a,'>{target}</label></li><li class="ks-editor-dialog-actions"><button name="ok" class="ks-editor-btn-ok">{ok}</button><span class="ks-editor-btn-cancel">{cancel}</span><span class="ks-editor-link-remove">{remove}</span></li></ul></form>'].join("");
e.addPlugin("link",{type:n.TOOLBAR_BUTTON,dialog:null,form:null,range:null,init:function(){this._renderUI();this._bindUI()},_renderUI:function(){var h=e.Menu.generateDropMenu(this.editor,this.domEl,[1,0]),l=this.lang;h.className+=" ks-editor-link";h.innerHTML=g.replace(/\{([^}]+)\}/g,function(m,o){return l[o]?l[o]:o});this.dialog=h;this.form=h.getElementsByTagName("form")[0];j.webkit&&(this.form.target.parentNode.style.display="none");d&&e.Dom.setItemUnselectable(h)},_bindUI:function(){var h=this.form,
l=this;b.on(this.domEl,"click",function(){if(l.dialog.style.visibility===d?"hidden":"visible")l._syncUI()});b.on(this.dialog,"click",function(m){switch(b.getTarget(m).className){case "ks-editor-btn-ok":l._createLink(h.href.value,h.target.checked);break;case "ks-editor-btn-cancel":break;case "ks-editor-link-remove":l._unLink();break;default:b.stopPropagation(m)}})},_syncUI:function(){this.range=e.Range.saveRange(this.editor);var h=this.form,l;l=k.getCommonAncestor(this.range);if(l=l.nodeName=="A"?
l:f.getAncestorByTagName(l,"A")){h.href.value=l.href;h.target.checked=l.target==="_blank";f.removeClass(h,"ks-editor-link-newlink-mode")}else{h.href.value="http://";h.target.checked=false;f.addClass(h,"ks-editor-link-newlink-mode")}setTimeout(function(){h.href.select()},50)},_createLink:function(h,l){h=this._getValidHref(h);if(h.length===0)this._unLink();else{var m=this.range,o=document.createElement("div"),p;p=k.getCommonAncestor(m);if(p=p.nodeName=="A"?p:f.getAncestorByTagName(p,"A")){p.href=h;
l?p.setAttribute("target","_blank"):p.removeAttribute("target")}else{p=document.createElement("a");p.href=h;l&&p.setAttribute("target","_blank");if(d){m.select&&m.select();if("text"in m){p.innerHTML=m.htmlText||h;o.innerHTML="";o.appendChild(p);m.pasteHTML(o.innerHTML)}else this.editor.execCommand("createLink",h)}else if(j.webkit)this.editor.execCommand("createLink",h);else{if(m.collapsed)p.innerHTML=h;else for(h=m.cloneContents();h.firstChild;)p.appendChild(h.firstChild);m.deleteContents();m.insertNode(p);
m.selectNode(p)}}}},_getValidHref:function(h){if((h=i.trim(h))&&!c.test(h))h="http://"+h;return h},_unLink:function(){var h=this.editor,l=this.range,m=k.getSelectedText(l),o=k.getCommonAncestor(l);if(!m&&o.nodeType==3){h=o.parentNode;h.nodeName=="A"&&h.parentNode.replaceChild(o,h)}else{l.select&&l.select();h.execCommand("unLink",null)}}})});
KISSY.Editor.add("plugins~resize",function(e){var n=YAHOO.util.Event;e.addPlugin("resize",{type:e.PLUGIN_TYPE.STATUSBAR_ITEM,contentEl:null,currentHeight:0,init:function(){this.contentEl=this.editor.container.childNodes[1];this.currentHeight=parseInt(this.contentEl.style.height);this.renderUI();this.bindUI()},renderUI:function(){var f=this.lang;this.domEl.innerHTML='<span class="ks-editor-resize-larger" title="{larger_title}">{larger_text}</span><span class="ks-editor-resize-smaller" title="{smaller_title}">{smaller_text}</span>'.replace(/\{([^}]+)\}/g,
function(b,i){return f[i]?f[i]:i})},bindUI:function(){var f=this.domEl.getElementsByTagName("span"),b=f[1];n.on(f[0],"click",function(){this.currentHeight+=100;this._doResize()},this,true);n.on(b,"click",function(){if(this.currentHeight<100)this.currentHeight=0;else this.currentHeight-=100;this._doResize()},this,true)},_doResize:function(){this.contentEl.style.height=this.currentHeight+"px";this.editor.textarea.style.height=this.currentHeight+"px"}})});
KISSY.Editor.add("plugins~save",function(e){var n=YAHOO.util.Event,f={b:{tag:"strong"},i:{tag:"em"},u:{tag:"span",style:"text-decoration:underline"},strike:{tag:"span",style:"text-decoration:line-through"}};e.addPlugin("save",{type:e.PLUGIN_TYPE.FUNC,init:function(){var b=this.editor,i=b.textarea,j=i.form;j&&n.on(j,"submit",function(){if(!b.sourceMode)i.value=b.getData()})},filterData:function(b){b=b.replace(/<(\/?)([^>\s]+)([^>]*)>/g,function(i,j,d,k){d=d.toLowerCase();i=f[d];d=d;if(i&&!k){d=i.tag;
if(!j&&i.style)d+=' style="'+i.style+'"'}return"<"+j+d+k+">"});if(b.indexOf("mso")>0)b=this.filterWord(b);return b},filterWord:function(b){b=b.replace(/<(\w[^>]*) onmouseover="([^\"]*)"([^>]*)/gi,"<$1$3");b=b.replace(/<(\w[^>]*) onmouseout="([^\"]*)"([^>]*)/gi,"<$1$3");b=b.replace(/<H(\d)([^>]*)>/gi,"<h$1>");b=b.replace(/<(H\d)><FONT[^>]*>([\s\S]*?)<\/FONT><\/\1>/gi,"<$1>$2</$1>");b=b.replace(/<(H\d)><EM>([\s\S]*?)<\/EM><\/\1>/gi,"<$1>$2</$1>");b=b.replace(/<meta[^>]*>/ig,"");b=b.replace(/<link rel="\S+" href="file:[^>]*">/ig,
"");b=b.replace(/<!--\[if gte mso [0-9]{1,2}\]>[\s\S]*?<!\[endif\]--\>/ig,"");b=b.replace(/<style>[\s\S]*?mso[\s\S]*?<\/style>/ig,"");b=b.replace(/ lang=".+?"/ig,"");b=b.replace(/<o:p><\/o:p>/ig,"");b=b.replace(/ class="Mso.+?"/ig,"");return b=b.replace(/<\\?\?xml[^>]*>/ig,"")}})});
KISSY.Editor.add("plugins~smiley",function(e){var n=YAHOO.util.Event,f=YAHOO.lang,b=YAHOO.env.ua,i={tabs:["default"]};e.addPlugin("smiley",{type:e.PLUGIN_TYPE.TOOLBAR_BUTTON,config:{},dialog:null,range:null,init:function(){this.config=f.merge(i,this.editor.config.pluginsConfig[this.name]||{});this._renderUI();this._bindUI()},_renderUI:function(){var j=e.Menu.generateDropMenu(this.editor,this.domEl,[1,0]);j.className+=" ks-editor-smiley-dialog";this.dialog=j;this._renderDialog();b.ie&&e.Dom.setItemUnselectable(j)},
_renderDialog:function(){var j=e.Smilies[this.config.tabs[0]],d=j.mode;if(d==="icons")this._renderIcons(j);else d==="sprite"&&this._renderSprite(j)},_renderIcons:function(j){var d=this.editor.config.base+"smilies/"+j.name+"/",k=j.fileNames,a="."+j.fileExt;j=j.cols;var c=[],g,h=k.length,l;c.push('<div class="ks-editor-smiley-icons">');for(g=0;g<h;g++){l=k[g];c.push('<img src="'+d+l+a+'" alt="'+l+'" title="'+l+'" />');g%j===j-1&&c.push("<br />")}c.push("</div");this.dialog.innerHTML=c.join("")},_renderSprite:function(j){var d=
j.base,k=j.filePattern,a="."+j.fileExt,c=k.end+1;k=k.step;var g,h=[];h.push('<div class="ks-editor-smiley-sprite ks-clearfix" style="'+j.spriteStyle+'">');for(g=0;g<c;g+=k)h.push('<span data-icon="'+d+g+a+'" style="'+j.unitStyle+'"></span>');h.push("</div");this.dialog.innerHTML=h.join("")},_bindUI:function(){var j=this;n.on(this.domEl,"click",function(){j.range=e.Range.saveRange(j.editor)});n.on(this.dialog,"click",function(d){var k=n.getTarget(d);switch(k.nodeName){case "IMG":j._insertImage(k.src,
k.getAttribute("alt"));break;case "SPAN":j._insertImage(k.getAttribute("data-icon"),"");break;default:n.stopPropagation(d)}})},_insertImage:function(j,d){j=f.trim(j);if(j.length!==0){var k=this.editor,a=this.range;if(window.getSelection){var c=k.contentDoc.createElement("img");c.src=j;c.setAttribute("alt",d);a.deleteContents();a.insertNode(c);if(b.webkit){j=k.contentWin.getSelection();j.addRange(a);j.collapseToEnd()}else a.setStartAfter(c);k.contentWin.focus()}else if(document.selection)"text"in a?
a.pasteHTML('<img src="'+j+'" alt="'+d+'" />'):k.execCommand("insertImage",j)}}})});
KISSY.Editor.add("plugins~source",function(e){var n=YAHOO.util.Dom,f=YAHOO.env.ua;e.addPlugin("source",{type:e.PLUGIN_TYPE.TOOLBAR_BUTTON,init:function(){var b=this.editor;this.iframe=b.contentWin.frameElement;this.textarea=b.textarea;this.iframe.parentNode.appendChild(b.textarea);n.addClass(this.domEl,"ks-editor-toolbar-source-button")},exec:function(){var b=this.editor,i=b.sourceMode;if(i)b.contentDoc.body.innerHTML=this.textarea.value;else this.textarea.value=b.getContentDocData();f.ie&&f.ie<8&&
b.contentDoc.selection.empty();this.textarea.style.display=i?"none":"";this.iframe.style.display=i?"":"none";b.sourceMode=!i;this._updateButtonState()},_updateButtonState:function(){var b=this.editor;if(b.sourceMode){n.addClass(b.container,"ks-editor-src-mode");n.addClass(this.domEl,"ks-editor-toolbar-button-selected")}else{n.removeClass(b.container,"ks-editor-src-mode");n.removeClass(this.domEl,"ks-editor-toolbar-button-selected")}}})});
KISSY.Editor.add("plugins~undo",function(e){e.addPlugin(["undo","redo"],{type:e.PLUGIN_TYPE.TOOLBAR_BUTTON,exec:function(){this.editor.execCommand(this.name)}})});
KISSY.Editor.add("plugins~wordcount",function(e){var n=YAHOO.util,f=n.Dom,b=n.Event,i=YAHOO.lang,j={total:5E4,threshold:100};e.addPlugin("wordcount",{type:e.PLUGIN_TYPE.STATUSBAR_ITEM,total:Infinity,remain:Infinity,threshold:0,remainEl:null,init:function(){var d=i.merge(j,this.editor.config.pluginsConfig[this.name]||{});this.total=d.total;this.threshold=d.threshold;this.renderUI();this.bindUI();var k=this;setTimeout(function(){k.syncUI()},50)},renderUI:function(){this.domEl.innerHTML=this.lang.tmpl.replace("%remain%",
"<em>"+this.total+"</em>");this.remainEl=this.domEl.getElementsByTagName("em")[0]},bindUI:function(){var d=this.editor;b.on(d.textarea,"keyup",this.syncUI,this,true);b.on(d.contentDoc,"keyup",this.syncUI,this,true);b.on(d.container,"click",this.syncUI,this,true)},syncUI:function(){this.remain=this.total-this.editor.getData().length;this.remainEl.innerHTML=this.remain;this.remain<=this.threshold?f.addClass(this.domEl,"ks-editor-wordcount-alarm"):f.removeClass(this.domEl,"ks-editor-wordcount-alarm")}})});
