/*
Copyright 2012, KISSY UI Library v1.30dev
MIT Licensed
build time: Jun 15 17:22
*/
KISSY.add("editor/core/clipboard",function(g,j){function m(a){this.editor=a;this._init()}function p(a){if(f.ie&&"BackCompat"!=a.get("document")[0].compatMode){var b=a.getSelection(),c;if(b.getType()==q.SELECTION_ELEMENT&&(c=b.getSelectedElement())){var e=b.getRanges()[0],d=k(a.get("document")[0].createTextNode(""));d.insertBefore(c);e.setStartBefore(d);e.setEndAfter(c);b.selectRanges([e]);setTimeout(function(){c.parent()&&(d.remove(),b.selectElement(c))},0)}}}var k=g.all,f=g.UA,r=j.Range,n=j.RANGE,
o=g.Event;g.augment(m,{_init:function(){var a=this.editor;o.on(a.get("document")[0].body,f.webkit?"paste":f.gecko?"paste":"beforepaste",this._paste,this);o.on(a.get("document")[0].body,"contextmenu",function(){l=1;setTimeout(function(){l=0},10)});a.addCommand("copy",new h("copy"));a.addCommand("cut",new h("cut"));a.addCommand("paste",new h("paste"))},_paste:function(){if(!l){var a=this.editor,b=a.get("document")[0];if(!b.getElementById("ke_pastebin")){var c=a.getSelection(),e=new r(b),d=k(f.webkit?
"<body></body>":"<div></div>",null,b);d.attr("id","ke_pastebin");f.webkit&&d[0].appendChild(b.createTextNode(" "));b.body.appendChild(d[0]);d.css({position:"absolute",top:c.getStartElement().offset().top+"px",width:"1px",height:"1px",overflow:"hidden"});d.css("left","-1000px");var i=c.createBookmarks();e.setStartAt(d,n.POSITION_AFTER_START);e.setEndAt(d,n.POSITION_BEFORE_END);e.select(!0);setTimeout(function(){d.remove();var b;d=f.webkit&&(b=d.first())&&b.hasClass("Apple-style-span")?b:d;c.selectBookmarks(i);
b=d.html();if(b=g.trim(b.replace(/<span[^>]+_ke_bookmark[^<]*?<\/span>(&nbsp;)*/ig,""))){var e=a.fire("paste",{html:b,holder:d});void 0!==e&&(b=e);e=null;/(class="?Mso|style="[^"]*\bmso\-|w:WordDocument)/.test(b)&&(e=a.htmlDataProcessor.wordFilter);a.insertHtml(b,e)}},0)}}}});var s=function(a,b){var c=a.get("document")[0],e=k(c.body),d=!1,i=function(){d=!0};e.on(b,i);(7<f.ie?c:c.selection.createRange()).execCommand(b);e.detach(b,i);return d},t=f.ie?function(a,b){return s(a,b)}:function(a,b){try{return a.get("document")[0].execCommand(b)}catch(c){return!1}},
u={cut:"您的浏览器安全设置不允许编辑器自动执行剪切操作，请使用键盘快捷键(Ctrl/Cmd+X)来完成",copy:"您的浏览器安全设置不允许编辑器自动执行复制操作，请使用键盘快捷键(Ctrl/Cmd+C)来完成",paste:"您的浏览器安全设置不允许编辑器自动执行粘贴操作，请使用键盘快捷键(Ctrl/Cmd+V)来完成"},h=function(a){this.type=a};h.prototype={exec:function(a){"cut"==this.type&&p(a);(a=t(a,this.type))||alert(u[this.type]);return a}};var q=j.Selection,v={copy:"复制",paste:"粘贴",cut:"剪切"},l;return{init:function(a){a.docReady(function(){new m(a)});var b={copy:1,cut:1,paste:1};a.on("contextmenu",function(c){c=c.contextmenu;if(!c.__copy_fix){c.__copy_fix=
1;for(var e in b)b.hasOwnProperty(e)&&c.addChild({xclass:"menuitem",content:v[e],value:e});c.on("click",function(d){var c=d.target.get("value");b[c]&&(this.hide(),setTimeout(function(){a.execCommand(c)},30))})}})}}},{requires:["./base"]});
