/*
Copyright 2012, KISSY UI Library v1.40dev
MIT Licensed
build time: Oct 10 13:59
*/
KISSY.add("editor/core/clipboard",function(g,o,p,q){function l(a){this.editor=a;this._init()}function r(a){if(f.ie&&"BackCompat"!=a.get("document")[0].compatMode){var b=a.getSelection(),c;if(b.getType()==q.SELECTION_ELEMENT&&(c=b.getSelectedElement())){var e=b.getRanges()[0],d=j(a.get("document")[0].createTextNode(""));d.insertBefore(c);e.setStartBefore(d);e.setEndAfter(c);b.selectRanges([e]);setTimeout(function(){c.parent()&&(d.remove(),b.selectElement(c))},0)}}}var j=g.all,f=g.UA,m=o.RANGE,n=g.Event;
g.augment(l,{_init:function(){var a=this.editor,b=a.get("document")[0].body;n.on(b,f.ie?"beforepaste":"paste",this._paste,this);n.on(b,"contextmenu",function(){k=1;setTimeout(function(){k=0},10)});a.addCommand("copy",new h("copy"));a.addCommand("cut",new h("cut"));a.addCommand("paste",new h("paste"))},_paste:function(){if(!k){var a=this.editor,b=a.get("document")[0];if(!b.getElementById("ke_pastebin")){var c=a.getSelection(),e=new p(b),d=j(f.webkit?"<body></body>":"<div></div>",null,b);d.attr("id",
"ke_pastebin");f.webkit&&d[0].appendChild(b.createTextNode(" "));b.body.appendChild(d[0]);d.css({position:"absolute",top:c.getStartElement().offset().top+"px",width:"1px",height:"1px",overflow:"hidden"});d.css("left","-1000px");var i=c.createBookmarks();e.setStartAt(d,m.POSITION_AFTER_START);e.setEndAt(d,m.POSITION_BEFORE_END);e.select(!0);setTimeout(function(){var b;d=f.webkit&&(b=d.first())&&b.hasClass("Apple-style-span")?b:d;c.selectBookmarks(i);d.remove();var e=d.html();if(e=g.trim(e.replace(/<span[^>]+_ke_bookmark[^<]*?<\/span>(&nbsp;)*/ig,
"")))b=a.fire("paste",{html:e,holder:d}),void 0!==b&&(e=b),/(class="?Mso|style="[^"]*\bmso\-|w:WordDocument)/.test(e)?g.use("editor/plugin/word-filter/dynamic/",function(b,d){a.insertHtml(d.toDataFormat(e,a))}):a.insertHtml(e)},0)}}}});var s=function(a,b){var c=a.get("document")[0],e=j(c.body),d=!1,i=function(){d=!0};e.on(b,i);(7<f.ie?c:c.selection.createRange()).execCommand(b);e.detach(b,i);return d},t=f.ie?function(a,b){return s(a,b)}:function(a,b){try{return a.get("document")[0].execCommand(b)}catch(c){return!1}},
u={cut:"您的浏览器安全设置不允许编辑器自动执行剪切操作，请使用键盘快捷键(Ctrl/Cmd+X)来完成",copy:"您的浏览器安全设置不允许编辑器自动执行复制操作，请使用键盘快捷键(Ctrl/Cmd+C)来完成",paste:"您的浏览器安全设置不允许编辑器自动执行粘贴操作，请使用键盘快捷键(Ctrl/Cmd+V)来完成"},h=function(a){this.type=a};h.prototype={exec:function(a){"cut"==this.type&&r(a);(a=t(a,this.type))||alert(u[this.type]);return a}};var v={copy:"复制",paste:"粘贴",cut:"剪切"},k;return{init:function(a){a.docReady(function(){new l(a)});var b={copy:1,cut:1,paste:1};a.on("contextmenu",function(c){c=c.contextmenu;if(!c.__copy_fix){c.__copy_fix=
1;for(var e in b)c.addChild({xclass:"menuitem",content:v[e],value:e});c.on("click",function(d){var c=d.target.get("value");b[c]&&(this.hide(),setTimeout(function(){a.execCommand(c)},30))})}})}}},{requires:["./base","./range","./selection"]});
