/*
Copyright 2012, KISSY UI Library v1.30dev
MIT Licensed
build time: Jun 5 21:37
*/
KISSY.add("editor/plugin/clipboard/index",function(h){function m(a){this.editor=a;this._init()}function p(a){if(g.ie&&"BackCompat"!=a.get("document")[0].compatMode){var b=a.getSelection(),e;if(b.getType()==q.SELECTION_ELEMENT&&(e=b.getSelectedElement())){var d=b.getRanges()[0],c=new i(a.get("document")[0].createTextNode(""));c.insertBefore(e);d.setStartBefore(c);d.setEndAfter(e);b.selectRanges([d]);setTimeout(function(){e.parent()&&(c.remove(),b.selectElement(e))},0)}}}var j=h.Editor,i=h.Node,g=h.UA,
r=j.Range,n=j.RANGE,o=h.Event;h.augment(m,{_init:function(){var a=this.editor;o.on(a.get("document")[0].body,g.webkit?"paste":g.gecko?"paste":"beforepaste",this._paste,this);o.on(a.get("document")[0].body,"contextmenu",function(){l=1;setTimeout(function(){l=0},10)});a.addCommand("copy",new k("copy"));a.addCommand("cut",new k("cut"));a.addCommand("paste",new k("paste"))},_paste:function(){if(!l){var a=this.editor,b=a.get("document")[0];if(!b.getElementById("ke_pastebin")){var e=a.getSelection(),d=
new r(b),c=new i(g.webkit?"<body></body>":"<div></div>",null,b);c.attr("id","ke_pastebin");g.webkit&&c[0].appendChild(b.createTextNode(" "));b.body.appendChild(c[0]);c.css({position:"absolute",top:e.getStartElement().offset().top+"px",width:"1px",height:"1px",overflow:"hidden"});c.css("left","-1000px");var f=e.createBookmarks();d.setStartAt(c,n.POSITION_AFTER_START);d.setEndAt(c,n.POSITION_BEFORE_END);d.select(!0);setTimeout(function(){c.remove();var b;c=g.webkit&&(b=c.first())&&b.hasClass("Apple-style-span")?
b:c;e.selectBookmarks(f);b=c.html();if(b=h.trim(b.replace(/<span[^>]+_ke_bookmark[^<]*?<\/span>(&nbsp;)*/ig,""))){var d=a.fire("paste",{html:b,holder:c});void 0!==d&&(b=d);d=null;/(class="?Mso|style="[^"]*\bmso\-|w:WordDocument)/.test(b)&&(d=a.htmlDataProcessor.wordFilter);a.insertHtml(b,d)}},0)}}}});var s=function(a,b){var e=a.get("document")[0],d=new i(e.body),c=!1,f=function(){c=!0};d.on(b,f);(7<g.ie?e:e.selection.createRange()).execCommand(b);d.detach(b,f);return c},t=g.ie?function(a,b){return s(a,
b)}:function(a,b){try{return a.get("document")[0].execCommand(b)}catch(e){return!1}},u={cut:"您的浏览器安全设置不允许编辑器自动执行剪切操作，请使用键盘快捷键(Ctrl/Cmd+X)来完成",copy:"您的浏览器安全设置不允许编辑器自动执行复制操作，请使用键盘快捷键(Ctrl/Cmd+C)来完成",paste:"您的浏览器安全设置不允许编辑器自动执行粘贴操作，请使用键盘快捷键(Ctrl/Cmd+V)来完成"},k=function(a){this.type=a};k.prototype={exec:function(a){"cut"==this.type&&p(a);(a=t(a,this.type))||alert(u[this.type]);return a}};var q=j.Selection,v={copy:"复制",paste:"粘贴",cut:"剪切"},l;j.on("contextmenu",function(a){var b=a.contextmenu,e=b.get("editor"),
d=b.menu.get("contentEl"),c={copy:0,cut:0,paste:0},f;for(f in c)c.hasOwnProperty(f)&&(c[f]=d.one(".ks-editor-paste-"+f),c[f]||function(a){var f=(new i("<a href='#'class='ks-editor-paste-"+a+"'>"+v[a]+"</a>")).appendTo(d);f.on("click",function(c){c.halt();b.hide();setTimeout(function(){e.execCommand(a)},30)});c[a]=f}(f))});return{init:function(a){a.docReady(function(){new m(a)})}}},{requires:["editor"]});
