/*
Copyright 2012, KISSY UI Library v1.40dev
MIT Licensed
build time: Jul 5 23:29
*/
KISSY.add("editor/plugin/clipboard/index",function(g){function m(a){this.editor=a;this._init()}function p(a){if(f.ie&&"BackCompat"!=a.get("document")[0].compatMode){var b=a.getSelection(),e;if(b.getType()==q.SELECTION_ELEMENT&&(e=b.getSelectedElement())){var c=b.getRanges()[0],d=k(a.get("document")[0].createTextNode(""));d.insertBefore(e);c.setStartBefore(d);c.setEndAfter(e);b.selectRanges([c]);setTimeout(function(){e.parent()&&(d.remove(),b.selectElement(e))},0)}}}var h=g.Editor,k=g.all,f=g.UA,r=
h.Range,n=h.RANGE,o=g.Event;g.augment(m,{_init:function(){var a=this.editor;o.on(a.get("document")[0].body,f.webkit?"paste":f.gecko?"paste":"beforepaste",this._paste,this);o.on(a.get("document")[0].body,"contextmenu",function(){l=1;setTimeout(function(){l=0},10)});a.addCommand("copy",new i("copy"));a.addCommand("cut",new i("cut"));a.addCommand("paste",new i("paste"))},_paste:function(){if(!l){var a=this.editor,b=a.get("document")[0];if(!b.getElementById("ke_pastebin")){var e=a.getSelection(),c=new r(b),
d=k(f.webkit?"<body></body>":"<div></div>",null,b);d.attr("id","ke_pastebin");f.webkit&&d[0].appendChild(b.createTextNode(" "));b.body.appendChild(d[0]);d.css({position:"absolute",top:e.getStartElement().offset().top+"px",width:"1px",height:"1px",overflow:"hidden"});d.css("left","-1000px");var j=e.createBookmarks();c.setStartAt(d,n.POSITION_AFTER_START);c.setEndAt(d,n.POSITION_BEFORE_END);c.select(!0);setTimeout(function(){d.remove();var b;d=f.webkit&&(b=d.first())&&b.hasClass("Apple-style-span")?
b:d;e.selectBookmarks(j);b=d.html();if(b=g.trim(b.replace(/<span[^>]+_ke_bookmark[^<]*?<\/span>(&nbsp;)*/ig,""))){var c=a.fire("paste",{html:b,holder:d});void 0!==c&&(b=c);c=null;/(class="?Mso|style="[^"]*\bmso\-|w:WordDocument)/.test(b)&&(c=a.htmlDataProcessor.wordFilter);a.insertHtml(b,c)}},0)}}}});var s=function(a,b){var e=a.get("document")[0],c=k(e.body),d=!1,j=function(){d=!0};c.on(b,j);(7<f.ie?e:e.selection.createRange()).execCommand(b);c.detach(b,j);return d},t=f.ie?function(a,b){return s(a,
b)}:function(a,b){try{return a.get("document")[0].execCommand(b)}catch(e){return!1}},u={cut:"您的浏览器安全设置不允许编辑器自动执行剪切操作，请使用键盘快捷键(Ctrl/Cmd+X)来完成",copy:"您的浏览器安全设置不允许编辑器自动执行复制操作，请使用键盘快捷键(Ctrl/Cmd+C)来完成",paste:"您的浏览器安全设置不允许编辑器自动执行粘贴操作，请使用键盘快捷键(Ctrl/Cmd+V)来完成"},i=function(a){this.type=a};i.prototype={exec:function(a){"cut"==this.type&&p(a);(a=t(a,this.type))||alert(u[this.type]);return a}};var q=h.Selection,v={copy:"复制",paste:"粘贴",cut:"剪切"},l;h.on("contextmenu",function(a){a=a.contextmenu;if(!a.__copy_fix){a.__copy_fix=
1;var b=a.get("editor"),e={copy:1,cut:1,paste:1},c;for(c in e)e.hasOwnProperty(c)&&a.addChild({xclass:"menuitem",content:v[c],value:c});a.on("click",function(a){var c=a.target.get("value");e[c]&&(this.hide(),setTimeout(function(){b.execCommand(c)},30))})}});return{init:function(a){a.docReady(function(){new m(a)})}}},{requires:["editor"]});
