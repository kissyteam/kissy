/*
Copyright 2012, KISSY UI Library v1.40dev
MIT Licensed
build time: Jul 10 10:41
*/
KISSY.add("editor/plugin/enterKey/index",function(j){function n(a){var b;b=a.getSelection().getRanges();for(var g=b.length-1;0<g;g--)b[g].deleteContents();b=b[0];g=b.document;if(b.checkStartOfBlock()&&b.checkEndOfBlock()){var c=(new o(b.startContainer)).block;if(c&&("li"==c.nodeName()||"li"==c.parent().nodeName()))return a.hasCommand("outdent")?(a.execCommand("save"),a.execCommand("outdent"),a.execCommand("save"),!0):!1}var f=b.splitBlock("p");if(!f)return!0;var a=f.previousBlock,c=f.nextBlock,i=
f.wasStartOfBlock,k=f.wasEndOfBlock,e;if(c)e=c.parent(),"li"==e.nodeName()&&(c._4e_breakParent(e),c._4e_move(c.next(),!0));else if(a&&(e=a.parent())&&"li"==e.nodeName())a._4e_breakParent(e),b.moveToElementEditablePosition(a.next()),a._4e_move(a.prev());if(!i&&!k){if("li"==c.nodeName()&&(e=c.first(p.invisible(!0)))&&j.inArray(e.nodeName(),["ul","ol"]))(l.ie?new m(g.createTextNode("Â ")):new m(g.createElement("br"))).insertBefore(e);c&&b.moveToElementEditablePosition(c)}else{var d;if(a){if("li"==a.nodeName()||
!q.test(a.nodeName()))d=a.clone()}else c&&(d=c.clone());d||(d=new m("<p>",null,g));if(e=f.elementPath)for(var f=0,n=e.elements.length;f<n;f++){var h=e.elements[f];if(h.equals(e.block)||h.equals(e.blockLimit))break;r.$removeEmpty[h.nodeName()]&&(h=h.clone(),d._4e_moveChildren(h),d.append(h))}l.ie||d._4e_appendBogus();b.insertNode(d);if(l.ie&&i&&(!k||!a[0].childNodes.length))b.moveToElementEditablePosition(k?a:d),b.select();b.moveToElementEditablePosition(i&&!k?c:d)}l.ie||(c?(d=new m(g.createElement("span")),
d.html("&nbsp;"),b.insertNode(d),d.scrollIntoView(void 0,!1),b.deleteContents()):d.scrollIntoView(void 0,!1));b.select();return!0}function s(a){var b=a.get("document")[0];t.on(b,"keydown",function(b){if(13===b.keyCode&&!b.shiftKey&&!b.ctrlKey&&!b.metaKey){a.execCommand("save");var c=a.execCommand("enterBlock");a.execCommand("save");!1!==c&&b.preventDefault()}})}var i=j.Editor,l=j.UA,q=/^h[1-6]$/,r=i.XHTML_DTD,m=j.Node,t=j.Event,p=i.Walker,o=i.ElementPath;return{init:function(a){a.addCommand("enterBlock",
{exec:n});a.docReady(function(){s(a)})}}},{requires:["editor"]});
