/*
Copyright 2012, KISSY UI Library v1.30dev
MIT Licensed
build time: May 29 18:24
*/
KISSY.add("editor/plugin/video/dialog",function(h,c,i,j){function d(){d.superclass.constructor.apply(this,arguments)}h.extend(d,i,{_config:function(){var b=this.editor.get("pluginConfig");this._cls="ke_video";this._type="video";this._title="视频";this._bodyHtml="<div style='padding:20px 20px 0 20px'><p><label>链接： <input class='ke-video-url ke-input' style='width:410px;vertical-align:middle;'/></label></p><table style='margin:10px 0 5px  40px;width:400px;'><tr><td><label>宽度：  <input  data-verify='^(自动|((?!0$)\\d+))?$'  data-warning='宽度请输入正整数' class='ke-video-width ke-input' style='width:60px;margin-left:2px;vertical-align:middle;' /> 像素</label></td><td><label> 高度：  <input  data-verify='^(自动|((?!0$)\\d+))?$'  data-warning='高度请输入正整数' class='ke-video-height ke-input' style='width:60px;vertical-align:middle;'/> 像素</label></td></tr><tr><td><label>对齐： <select class='ke-video-align' title='对齐'><option value='none'>无</option><option value='left'>左对齐</option><option value='right'>右对齐</option></select></td><td><label>间距： <input  data-verify='^\\d+$'  data-warning='间距请输入非负整数' class='ke-video-margin ke-input' style='width:60px;vertical-align:middle;' value='0'/> 像素</label></td></tr></table></div>";
this._footHtml="<div style='padding:5px 20px 20px;'><a class='ke-video-ok ke-button' style='margin-left:40px;margin-right:20px;'>确定</button> <a class='ke-video-cancel ke-button'>取消</a></div>";this.urlCfg=b.video&&b.video.urlCfg;this._urlTip=b.video&&b.video.urlTip||"请输入视频播放链接..."},_initD:function(){var b=this.dialog,a=b.get("el");this.dUrl=a.one(".ke-video-url");this.dAlign=j.decorate(a.one(".ke-video-align"));this.dMargin=a.one(".ke-video-margin");this.dWidth=a.one(".ke-video-width");this.dHeight=
a.one(".ke-video-height");var d=a.one(".ke-video-ok"),a=a.one(".ke-video-cancel");d.on("click",this._gen,this);a.on("click",function(a){b.hide();a.halt()});c.Utils.placeholder(this.dUrl,this._urlTip);c.Utils.placeholder(this.dWidth,"自动");c.Utils.placeholder(this.dHeight,"自动");this.addRes(d,a,this.dUrl,this.dWidth,this.dHeight)},_getDInfo:function(){var b=this.dUrl.val(),a=this.editor.get("pluginConfig");a.video=a.video||{};if(a=a.video.getProvider(b)){b=a.detect(b);if(!b){alert("不支持该链接，请直接输入该视频提供的分享链接");
return}return{url:b,attrs:{height:parseInt(this.dHeight.val())||a.height,width:parseInt(this.dWidth.val())||a.width,style:"margin:"+(parseInt(this.dMargin.val())||0)+"px;float:"+this.dAlign.val()+";"}}}alert("不支持该链接来源!")},_gen:function(b){var a=this,c=a.dUrl.val(),e=a.urlCfg;if(e)for(var f=0;f<e.length;f++){var g=e[f];if(g.reg.test(c)){a.dialog.loading();b={};b[g.paramName||"url"]=c;h.io({url:g.url,data:b,dataType:"jsonp",success:function(b){a._dynamicUrlPrepare(b[1])}});return}}d.superclass._gen.call(a);
b&&b.halt()},_dynamicUrlPrepare:function(b){this.dUrl.val(b);this.dialog.unloading();d.superclass._gen.call(this)},_updateD:function(){var b=this.editor,a=this.selectedFlash;a?(b=b.restoreRealElement(a),c.Utils.valInput(this.dUrl,this._getFlashUrl(b)),this.dAlign.val(a.css("float")),this.dMargin.val(parseInt(b.style("margin"))||0),c.Utils.valInput(this.dWidth,parseInt(a.css("width"))),c.Utils.valInput(this.dHeight,parseInt(a.css("height")))):(c.Utils.resetInput(this.dUrl),this.dAlign.val("none"),
this.dMargin.val(0),c.Utils.resetInput(this.dWidth),c.Utils.resetInput(this.dHeight))}});return d},{requires:["editor","../flash/dialog","../select/"]});
