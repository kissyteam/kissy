/*
Copyright 2014, KISSY v5.0.0
MIT Licensed
build time: Jun 13 11:49
*/
KISSY.add("editor/plugin/video/dialog",["util","editor","io","../flash/dialog","../menubutton"],function(h,d,l,i){function g(){g.superclass.constructor.apply(this,arguments)}var f=d("util"),c=d("editor"),j=d("io"),h=d("../flash/dialog"),k=d("../menubutton");f.extend(g,h,{_config:function(){var b=this.editor.get("prefixCls"),a=this.config;this._cls="ke_video";this._type="video";this._title="\u89c6\u9891";this._bodyHTML=f.substitute('<div style="padding:20px 20px 0 20px"><p><label>\u94fe\u63a5\uff1a <input class="{prefixCls}editor-video-url {prefixCls}editor-input" style="width:410px;"/></label></p><table style="margin:10px 0 5px  40px;width:400px;"><tr><td><label>\u5bbd\u5ea6\uff1a  <input  data-verify="^(\u81ea\u52a8|((?!0$)\\d+))?$"  data-warning="\u5bbd\u5ea6\u8bf7\u8f93\u5165\u6b63\u6574\u6570" class="{prefixCls}editor-video-width {prefixCls}editor-input" style="width:60px;" /> \u50cf\u7d20</label></td><td><label> \u9ad8\u5ea6\uff1a  <input  data-verify="^(\u81ea\u52a8|((?!0$)\\d+))?$"  data-warning="\u9ad8\u5ea6\u8bf7\u8f93\u5165\u6b63\u6574\u6570" class="{prefixCls}editor-video-height {prefixCls}editor-input" style="width:60px;"/> \u50cf\u7d20</label></td></tr><tr><td><label>\u5bf9\u9f50\uff1a <select class="{prefixCls}editor-video-align" title="\u5bf9\u9f50"><option value="none">\u65e0</option><option value="left">\u5de6\u5bf9\u9f50</option><option value="right">\u53f3\u5bf9\u9f50</option></select></td><td><label>\u95f4\u8ddd\uff1a <input  data-verify="^\\d+$"  data-warning="\u95f4\u8ddd\u8bf7\u8f93\u5165\u975e\u8d1f\u6574\u6570" class="{prefixCls}editor-video-margin {prefixCls}editor-input" style="width:60px;" value="0"/> \u50cf\u7d20</label></td></tr></table></div>',
{prefixCls:b});this._footHTML=f.substitute('<div style="padding:10px 0 35px 20px;"><a class="{prefixCls}editor-video-ok {prefixCls}editor-button ks-inline-block" style="margin-left:40px;margin-right:20px;">\u786e\u5b9a</button> <a class="{prefixCls}editor-video-cancel {prefixCls}editor-button ks-inline-block">\u53d6\u6d88</a></div>',{prefixCls:b});this.urlCfg=a.urlCfg;this._urlTip=a.urlTip||"\u8bf7\u8f93\u5165\u89c6\u9891\u64ad\u653e\u94fe\u63a5..."},_initD:function(){var b=this.dialog,a=this.editor.get("prefixCls"),e=b.get("el");this.dUrl=e.one("."+a+"editor-video-url");
this.dAlign=k.Select.decorate(e.one("."+a+"editor-video-align"),{prefixCls:a+"editor-big-",width:80,menuCfg:{prefixCls:a+"editor-",render:e}});this.dMargin=e.one("."+a+"editor-video-margin");this.dWidth=e.one("."+a+"editor-video-width");this.dHeight=e.one("."+a+"editor-video-height");var d=e.one("."+a+"editor-video-ok"),a=e.one("."+a+"editor-video-cancel");d.on("click",this._gen,this);a.on("click",function(a){b.hide();a.halt()});c.Utils.placeholder(this.dUrl,this._urlTip);c.Utils.placeholder(this.dWidth,
"\u81ea\u52a8");c.Utils.placeholder(this.dHeight,"\u81ea\u52a8");this.addRes(this.dAlign)},_getDInfo:function(){var b=this.dUrl.val(),a=this.config.getProvider(b);if(a){b=a.detect(b);if(!b){window.alert("\u4e0d\u652f\u6301\u8be5\u94fe\u63a5\uff0c\u8bf7\u76f4\u63a5\u8f93\u5165\u8be5\u89c6\u9891\u63d0\u4f9b\u7684\u5206\u4eab\u94fe\u63a5");return}return{url:b,attrs:{height:parseInt(this.dHeight.val(),10)||a.height,width:parseInt(this.dWidth.val(),10)||a.width,style:"margin:"+(parseInt(this.dMargin.val(),10)||0)+"px;float:"+this.dAlign.get("value")+";"}}}window.alert("\u4e0d\u652f\u6301\u8be5\u94fe\u63a5\u6765\u6e90!")},_gen:function(b){var a=this,e=a.dUrl.val(),c=a.urlCfg;
if(c)for(var d=0;d<c.length;d++){var f=c[d];if(f.reg.test(e)){a.dialog.loading();b={};b[f.paramName||"url"]=e;j({url:f.url,data:b,dataType:"jsonp",success:function(b){a._dynamicUrlPrepare(b[1])}});return}}g.superclass._gen.call(a,b);b&&b.halt()},_dynamicUrlPrepare:function(b){this.dUrl.val(b);this.dialog.unloading();g.superclass._gen.call(this)},_updateD:function(){var b=this.editor,a=this.selectedFlash;a?(b=b.restoreRealElement(a),c.Utils.valInput(this.dUrl,this._getFlashUrl(b)),this.dAlign.set("value",
a.css("float")),this.dMargin.val(parseInt(b.style("margin"),10)||0),c.Utils.valInput(this.dWidth,parseInt(a.css("width"),10)),c.Utils.valInput(this.dHeight,parseInt(a.css("height"),10))):(c.Utils.resetInput(this.dUrl),this.dAlign.set("value","none"),this.dMargin.val(0),c.Utils.resetInput(this.dWidth),c.Utils.resetInput(this.dHeight))}});i.exports=g});
