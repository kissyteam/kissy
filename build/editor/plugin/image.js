/*
Copyright 2014, KISSY v5.0.0
MIT Licensed
build time: Jun 13 11:46
*/
KISSY.add("editor/plugin/image","./button,editor,./bubble,./contextmenu,./dialog-loader,util,ua,node".split(","),function(p,c,q,n){function d(b){this.config=b||{}}c("./button");var i=c("editor");c("./bubble");c("./contextmenu");var o=c("./dialog-loader"),j=c("util"),k=c("ua"),e=c("node"),f=function(b){b=e(b);if(b.nodeName()==="img"&&!/(^|\s+)ke_/.test(b[0].className))return b};d.prototype={pluginRenderUI:function(b){function c(a){o.useDialog(b,"image",d.config,a)}var d=this,h=b.get("prefixCls");b.addButton("image",
{tooltip:"\u63d2\u5165\u56fe\u7247",listeners:{click:function(){c(null)}},mode:i.Mode.WYSIWYG_MODE});var l=[{content:"\u56fe\u7247\u5c5e\u6027",fn:function(){var a=f(this.get("editorSelectedEl"));if(a){this.hide();c(e(a))}}},{content:"\u63d2\u5165\u65b0\u884c",fn:function(){this.hide();var a=b.get("document")[0],c=e(a.createElement("p"));k.ie||c._4eAppendBogus(void 0);a=new i.Range(a);a.setStartAfter(this.get("editorSelectedEl"));a.select();b.insertElement(c);a.moveToElementEditablePosition(c,1);a.select()}}],m=[];j.each(l,function(a){m.push({content:a.content})});
b.addContextMenu("image",f,{width:120,children:m,listeners:{click:function(a){var b=this,c=a.target.get("content");j.each(l,function(a){a.content===c&&a.fn.call(b)})}}});b.docReady(function(){b.get("document").on("dblclick",function(a){a.halt();a=e(a.target);f(a)&&c(a)})});b.addBubble("image",f,{listeners:{afterRenderUI:function(){var a=this,g=a.get("contentEl");g.html(j.substitute('<a class="{prefixCls}editor-bubble-url" target="_blank" href="#">\u5728\u65b0\u7a97\u53e3\u67e5\u770b</a>  |  <a class="{prefixCls}editor-bubble-link {prefixCls}editor-bubble-change" href="#">\u7f16\u8f91</a>  |  <a class="{prefixCls}editor-bubble-link {prefixCls}editor-bubble-remove" href="#">\u5220\u9664</a>',
{prefixCls:h}));var d=g.one("."+h+"editor-bubble-url"),e=g.one("."+h+"editor-bubble-change"),f=g.one("."+h+"editor-bubble-remove");i.Utils.preventFocus(g);e.on("click",function(b){c(a.get("editorSelectedEl"));b.halt()});f.on("click",function(c){if(k.webkit){var d=b.getSelection().getRanges();if(d&&d[0]){d[0].collapse();d[0].select()}}a.get("editorSelectedEl").remove();a.hide();b.notifySelectionChange();c.halt()});a.on("show",function(){var b=a.get("editorSelectedEl");if(b){b=b.attr("_ke_saved_src")||
b.attr("src");d.attr("href",b)}})}}})}};n.exports=d});
