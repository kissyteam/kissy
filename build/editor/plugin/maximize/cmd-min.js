/*
Copyright 2012, KISSY UI Library v1.30dev
MIT Licensed
build time: May 29 14:52
*/
KISSY.add("editor/plugin/maximize/cmd",function(d,j){function k(a){this.editor=a}var e=d.UA,l=e.ie,f=document,m=d.Node,h=d.Event,g=d.DOM,i;d.augment(k,{restoreWindow:function(){var a=this,b=a.editor;!1!==b.fire("beforeRestoreWindow")&&a._resize&&(h.remove(window,"resize",a._resize),a._resize=0,a._saveEditorStatus(),a._restoreState(),setTimeout(function(){a._restoreEditorStatus();b.notifySelectionChange();b.fire("restoreWindow")},30))},_restoreState:function(){var a=this.editor,b=this._savedParents;
if(b){for(var c=0;c<b.length;c++){var d=b[c];d.el.css("position",d.position)}this._savedParents=null}a.get("iframeWrapEl").css({height:this.iframeHeight});g.css(f.body,{width:"",height:"",overflow:""});f.documentElement.style.overflow="";a=a.get("el")[0].style;a.position="static";a.width=this.editorElWidth;i.css({left:"-99999px",top:"-99999px"});window.scrollTo(this.scrollLeft,this.scrollTop);8>l&&this.editor.get("toolBarEl").removeClass("ke-toolbar-padding",void 0)},_saveSate:function(){var a=this.editor,
b=[],c=a.get("el");this.iframeHeight=a.get("iframeWrapEl").style("height");this.editorElWidth=c.style("width");this.scrollLeft=g.scrollLeft();this.scrollTop=g.scrollTop();window.scrollTo(0,0);for(a=c.parent();a;)c=a.css("position"),"static"!=c&&(b.push({el:a,position:c}),a.css("position","static")),a=a.parent();this._savedParents=b;8>l&&this.editor.get("toolBarEl").addClass("ke-toolbar-padding",void 0)},_saveEditorStatus:function(){var a=this.editor;this.savedRanges=null;e.gecko&&a.__iframeFocus&&
(this.savedRanges=(a=a.getSelection())&&a.getRanges())},_restoreEditorStatus:function(){var a=this.editor,b=a.getSelection(),c=this.savedRanges;e.gecko&&a.activateGecko();c&&b&&b.selectRanges(c);a.__iframeFocus&&b&&(a=b.getStartElement())&&a.scrollIntoView(void 0,!1)},_maximize:function(a){var b=this.editor,c=b.get("el"),d=g.viewportHeight(),e=g.viewportWidth(),h=b.get("statusBarEl")?b.get("statusBarEl")[0].offsetHeight:0,k=b.get("toolBarEl")[0].offsetHeight;l?f.body.style.overflow="hidden":g.css(f.body,
{width:0,height:0,overflow:"hidden"});f.documentElement.style.overflow="hidden";c.css({position:"absolute",zIndex:j.baseZIndex(j.zIndexManager.MAXIMIZE),width:e+"px"});i.css({zIndex:j.baseZIndex(j.zIndexManager.MAXIMIZE-5),height:d+"px",width:e+"px"});c.offset({left:0,top:0});i.css({left:0,top:0});b.get("iframeWrapEl").css({height:d-h-k+"px"});!0!==a&&arguments.callee.call(this,!0)},_real:function(){var a=this,b=a.editor;a._resize||(a._saveEditorStatus(),a._saveSate(),a._maximize(),a._resize||(a._resize=
d.buffer(function(){a._maximize();b.fire("maximizeWindow")},100)),h.on(window,"resize",a._resize),setTimeout(function(){a._restoreEditorStatus();b.notifySelectionChange();b.fire("maximizeWindow")},30))},maximizeWindow:function(){!1!==this.editor.fire("beforeMaximizeWindow")&&(i||(i=(new m("<iframe  class='ke-maximize-shim' style='position:absolute;top:-9999px;left:-9999px;' frameborder='0'>")).prependTo(f.body,void 0)),this._real())},destroy:function(){this._resize&&(h.remove(window,"resize",this._resize),
this._resize=0)}});return{init:function(a){if(!a.hasCommand("maximizeWindow")){var b=new k(a);a.addCommand("maximizeWindow",{exec:function(){b.maximizeWindow()}});a.addCommand("restoreWindow",{exec:function(){b.restoreWindow()}})}}}},{requires:["editor"]});
