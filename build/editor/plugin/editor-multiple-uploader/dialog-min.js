/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: May 15 16:34
*/
KISSY.add("editor/plugin/editor-multiple-uploader/dialog",function(d,h,f,i,j,k,l,m,n){function g(a,b){this.editor=a;this.config=b;f.Utils.lazyRun(this,"_prepareShow","_realShow")}d.augment(g,{addRes:f.Utils.addRes,destroy:f.Utils.destroyRes,show:function(){this.editor.get("prefixCls");this.dialog||(this.dialog=(new j({headerContent:"\u6279\u91cf\u4e0a\u4f20",mask:!1,plugins:[new i({handlers:[".ks-editor-stdmod-header"]})],focus4e:!1,width:"600px"})).render(),this.addRes(this.dialog),this._append());this.dialog.show();
this._renderUploader()},_append:function(){var a=this.dialog;if(!a)return this;var a=a.get("body"),b=this.config.tpl;if(!b)return this;a.html(b);return this},_renderUploader:function(){var a=this.config;if(this.uploader)return!1;var b=new k(a.target,a);this.uploader=b;b.theme(new l({queueTarget:a.queueTarget}));b.plug(new m(a.auth||{})).plug(new n({isHide:!1}));var a=d.Node.all,e=a(".J_UploaderQueueWrapper");a(".J_InsertContent").on("click",this._insertHandler,this);b.on("add",function(){"none"==
e.css("display")&&e.fadeIn(0.5)});b.on("remove",function(){b.get("queue").get("files").length||e.fadeOut(0.5)});var c=b.get("queue");a(".J_ClearQueue").on("click",function(a){a.preventDefault();c.clear()});a(".J_StartUpload").on("click",function(){b.uploadFiles("waiting")})},_insertHandler:function(){var a=this.editor,b=a.get("document")[0],e=this.uploader.get("queue"),c=e.getFiles("success");if(!c.length)return alert("\u4e0d\u5b58\u5728\u6210\u529f\u4e0a\u4f20\u7684\u56fe\u7247\uff01"),!1;d.each(c,function(c){var d=c.result.url;(new Image).src=d;a.insertElement(h("<p>&nbsp;<img src='"+
d+"'/>&nbsp;</p>",b));e.remove(c.id)})}});return g},{requires:"node,editor,component/plugin/drag,../dialog,gallery/uploader/1.4/,gallery/uploader/1.4/themes/editorMultipleUploader/,gallery/uploader/1.4/plugins/auth/auth,gallery/uploader/1.4/plugins/proBars/proBars,gallery/uploader/1.4/themes/editorMultipleUploader/style.css".split(",")});
