/*
Copyright 2014, KISSY v5.0.0
MIT Licensed
build time: Jun 13 11:44
*/
KISSY.add("editor/plugin/color/dialog",["editor","util","../dialog","dom","node"],function(j,d,y,r){function m(a){if(h.isArray(a))return a;var b=RegExp;if(/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i.test(a))return f([b.$1,b.$2,b.$3],function(a){return parseInt(a,16)});if(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(a))return f([b.$1,b.$2,b.$3],function(a){return parseInt(a+a,16)});if(/^rgb\((.*),(.*),(.*)\)$/i.test(a))return f([b.$1,b.$2,b.$3],function(a){return 0<a.indexOf("%")?2.55*parseFloat(a,
10):a|0})}function n(a){var a="0"+a,b=a.length;return a.slice(b-2,b)}function o(a){a=m(a);return"#"+n(a[0].toString(16))+n(a[1].toString(16))+n(a[2].toString(16))}function q(a){this.editor=a;this._init()}var j=d("editor"),h=d("util"),s=d("../dialog"),f=h.map,t=d("dom"),u=d("node"),p=function(){function a(a,i,c){for(var e=[],a=b(a),i=b(i),g=(i[0]-a[0])/c,k=(i[1]-a[1])/c,h=(i[2]-a[2])/c,l=0,d=a[0],j=a[1],a=a[2];l<c;l++)e[l]=[d,j,a],d+=g,j+=k,a+=h;e[l]=i;return f(e,function(a){return f(a,function(a){return Math.min(Math.max(0,
Math.floor(a)),255)})})}function b(a){var b=m(a);if(void 0===b){c||(c=document.createElement("textarea"),c.style.display="none",t.prepend(c,document.body));try{c.style.color=a}catch(d){return[0,0,0]}document.defaultView?b=m(document.defaultView.getComputedStyle(c,null).color):(a=c.createTextRange().queryCommandValue("ForeColor"),b=[a&255,(a&65280)>>>8,(a&16711680)>>>16])}return b}var c;return function(b,c){var d=[],e=b.length;void 0===c&&(c=20);if(1===e)d=a(b[0],b[0],c);else if(1<e)for(var g=0,e=
e-1;g<e;g++){var k=a(b[g],b[g+1],c[g]||c);g<e-1&&k.pop();d=d.concat(k)}return d}}(),v='<div class="{prefixCls}editor-color-advanced-picker"><div class="ks-clear"><div class="{prefixCls}editor-color-advanced-picker-left">'+("<ul>"+f(p("red,orange,yellow,green,cyan,blue,purple".split(","),5),function(a){return f(p(["white","rgb("+a.join(",")+")","black"],5),function(a){return'<li><a style="background-color:'+o(a)+'" href="#"></a></li>'}).join("")}).join("</ul><ul>")+"</ul>")+'</div><div class="{prefixCls}editor-color-advanced-picker-right"></div></div><div style="padding:10px;"><label>\u989c\u8272\u503c\uff1a <input style="width:100px" class="{prefixCls}editor-color-advanced-value"/></label><span class="{prefixCls}editor-color-advanced-indicator"></span></div></div>',
w=j.Utils.addRes,x=j.Utils.destroyRes;h.augment(q,{_init:function(){var a=this,b=a.editor.get("prefixCls");a.dialog=(new s({mask:!0,headerContent:"\u989c\u8272\u62fe\u53d6\u5668",bodyContent:h.substitute(v,{prefixCls:b}),footerContent:h.substitute('<div style="padding:5px 20px 20px;"><a class="{prefixCls}editor-button {prefixCls}editor-color-advanced-ok ks-inline-block">\u786e\u5b9a</a>&nbsp;&nbsp;&nbsp;<a class="{prefixCls}editor-button  {prefixCls}editor-color-advanced-cancel ks-inline-block">\u53d6\u6d88</a></div>',{prefixCls:b}),width:"550px"})).render();
var c=a.dialog,d=c.get("body"),i=c.get("footer"),f=d.one("."+b+"editor-color-advanced-indicator"),e=d.one("."+b+"editor-color-advanced-value"),g=d.one("."+b+"editor-color-advanced-picker-left"),c=i.one("."+b+"editor-color-advanced-ok"),b=i.one("."+b+"editor-color-advanced-cancel");c.on("click",function(b){var c=h.trim(e.val()),d=a.colorButtonArrow;/^#([a-f0-9]{1,2}){3,3}$/i.test(c)?(a.hide(),d.fire("selectColor",{color:e.val()}),b.halt()):alert("\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u989c\u8272\u4ee3\u7801")});e.on("change",function(){var a=h.trim(e.val());
/^#([a-f0-9]{1,2}){3,3}$/i.test(a)?f.css("background-color",a):alert("\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u989c\u8272\u4ee3\u7801")});b.on("click",function(b){a.hide();b.halt()});d.on("click",function(b){b.halt();b=u(b.target);if("a"===b.nodeName()){var c=o(b.css("background-color"));g.contains(b)&&a._detailColor(c);e.val(c);f.css("background-color",c)}});w.call(a,c,e,b,d,a.dialog);a._detailColor("#FF9900");e.val("#FF9900");f.css("background-color","#FF9900")},_detailColor:function(a){var b=this.dialog.get("body"),c=this.editor.get("prefixCls");
b.one("."+c+"editor-color-advanced-picker-right").html(f(p(["#ffffff",a,"#000000"],40),function(a){return'<a style="background-color:'+o(a)+'"></a>'}).join(""))},show:function(a){this.colorButtonArrow=a;this.dialog.show()},hide:function(){this.dialog.hide()},destroy:function(){x.call(this)}});r.exports=q});
