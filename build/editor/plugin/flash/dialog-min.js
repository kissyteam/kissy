/*
Copyright 2013, KISSY UI Library v1.30
MIT Licensed
build time: Feb 17 17:29
*/
KISSY.add("editor/plugin/flash/dialog",function(e,d,g,h,i){function f(b,a){this.editor=b;this.config=a||{};d.Utils.lazyRun(this,"_prepareShow","_realShow");this._config()}var j=h.Dialog;e.augment(f,{addRes:d.Utils.addRes,destroyRes:d.Utils.destroyRes,_config:function(){var b=this.editor.get("prefixCls");this._urlTip="请输入如 http://www.xxx.com/xxx.swf";this._type="flash";this._cls="ke_flash";this._config_dwidth="400px";this._title="Flash";this._bodyHtml=e.substitute("<div style='padding:20px 20px 0 20px'><p><label>网址： <input  data-verify='^https?://[^\\s]+$'  data-warning='网址格式为：http://' class='{prefixCls}editor-flash-url {prefixCls}editor-input' style='width:300px;' /></label></p><table style='margin:10px 0 5px  40px;width:300px;'><tr><td><label>宽度： <input  data-verify='^(?!0$)\\d+$'  data-warning='宽度请输入正整数' class='{prefixCls}editor-flash-width {prefixCls}editor-input' style='width:60px;' /> 像素 </label></td><td><label>高度： <input  data-verify='^(?!0$)\\d+$'  data-warning='高度请输入正整数' class='{prefixCls}editor-flash-height {prefixCls}editor-input' style='width:60px;' /> 像素 </label></td></tr><tr><td><label>对齐： </label><select class='{prefixCls}editor-flash-align' title='对齐'><option value='none'>无</option><option value='left'>左对齐</option><option value='right'>右对齐</option></select></td><td><label>间距： </label><input  data-verify='^\\d+$'  data-warning='间距请输入非负整数' class='{prefixCls}editor-flash-margin {prefixCls}editor-input' style='width:60px;' value='5'/> 像素</td></tr></table></div>",
{prefixCls:b});this._footHtml=e.substitute("<div style='padding:10px 0 35px 20px;'><a class='{prefixCls}editor-flash-ok {prefixCls}editor-button ks-inline-block' style='margin-left:40px;margin-right:20px;'>确定</a> <a class='{prefixCls}editor-flash-cancel {prefixCls}editor-button ks-inline-block'>取消</a></div>",{prefixCls:b})},_prepareShow:function(){this.dialog=(new j({headerContent:this._title,bodyContent:this._bodyHtml,footerContent:this._footHtml,width:this._config_dwidth||"500px",mask:!0})).render();
this.addRes(this.dialog);this._initD()},_realShow:function(){this._updateD();this.dialog.show()},_getFlashUrl:function(b){return g.getUrl(b)},_updateD:function(){var b=this.editor,a=this.config,c=this.selectedFlash;if(c){if(b=b.restoreRealElement(c))c.css("width")&&this.dWidth.val(parseInt(c.css("width"))),c.css("height")&&this.dHeight.val(parseInt(c.css("height"))),this.dAlign.set("value",c.css("float")),d.Utils.valInput(this.dUrl,this._getFlashUrl(b)),this.dMargin.val(parseInt(b.style("margin"))||
0)}else d.Utils.resetInput(this.dUrl),this.dWidth.val(a.defaultWidth||""),this.dHeight.val(a.defaultHeight||""),this.dAlign.set("value","none"),this.dMargin.val("5")},show:function(b){this.selectedFlash=b;this._prepareShow()},_initD:function(){var b=this.dialog,a=this.editor.get("prefixCls"),c=b.get("el");this.dHeight=c.one("."+a+"editor-flash-height");this.dWidth=c.one("."+a+"editor-flash-width");this.dUrl=c.one("."+a+"editor-flash-url");this.dAlign=i.Select.decorate(c.one("."+a+"editor-flash-align"),
{prefixCls:a+"editor-big-",width:80,menuCfg:{prefixCls:a+"editor-",render:c}});this.dMargin=c.one("."+a+"editor-flash-margin");var e=c.one("."+a+"editor-flash-ok"),a=c.one("."+a+"editor-flash-cancel");e.on("click",this._gen,this);a.on("click",function(a){b.hide();a&&a.halt()});d.Utils.placeholder(this.dUrl,this._urlTip);this.addRes(this.dAlign)},_getDInfo:function(){return{url:this.dUrl.val(),attrs:{width:this.dWidth.val(),height:this.dHeight.val(),style:"margin:"+(parseInt(this.dMargin.val())||0)+
"px;float:"+this.dAlign.get("value")+";"}}},_gen:function(b){b&&b.halt();var b=this.editor,a=this._getDInfo(),c=a&&e.trim(a.url),f=a&&a.attrs;a&&d.Utils.verifyInputs(this.dialog.get("el").all("input"))&&(this.dialog.hide(),a=g.insertFlash(b,c,f,this._cls,this._type),this.selectedFlash&&b.getSelection().selectElement(a),b.notifySelectionChange())},destroy:function(){this.destroyRes()}});return f},{requires:["editor","../flash-common/utils","../overlay/","../menubutton/"]});
