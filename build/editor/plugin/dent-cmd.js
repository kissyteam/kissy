/*
Copyright 2014, KISSY v5.0.0
MIT Licensed
build time: Jun 13 11:44
*/
KISSY.add("editor/plugin/dent-cmd",["editor","./list-utils","dom","node","ua"],function(B,k,C,v){function q(c){return c.nodeType===l.NodeType.ELEMENT_NODE&&"li"===l.nodeName(c)}function w(c,d,e){for(var f=c.startContainer,a=c.endContainer;f&&!f.parent().equals(d);)f=f.parent();for(;a&&!a.parent().equals(d);)a=a.parent();if(f&&a){for(var b=f,f=[],i=!1;!i;)b.equals(a)&&(i=!0),f.push(b),b=b.next();if(!(1>f.length)){var g=d._4eParents(!0,void 0);g.each(function(a,b){g[b]=a});for(a=0;a<g.length;a++)if(o[g[a].nodeName()]){d=
g[a];break}for(var b="indent"===e?1:-1,a=f[0],i=f[f.length-1],f={},h=r.listToArray(d,f),k=h[i.data("listarray_index")].indent,a=a.data("listarray_index");a<=i.data("listarray_index");a++){h[a].indent+=b;var n=h[a].parent;h[a].parent=s(n[0].ownerDocument.createElement(n.nodeName()))}for(a=i.data("listarray_index")+1;a<h.length&&h[a].indent>k;a++)h[a].indent+=b;var i=r.arrayToList(h,f,null,"p"),b=[],m;if("outdent"===e&&(m=d.parent())&&"li"===m.nodeName())for(var e=i.listNode.childNodes,j,a=e.length-
1;0<=a;a--)(j=s(e[a]))&&"li"===j.nodeName()&&b.push(j);i&&(l.insertBefore(i.listNode[0]||i.listNode,d[0]||d),d.remove());if(b&&b.length)for(a=0;a<b.length;a++){for(j=d=b[a];(j=j.next())&&j.nodeName()in o;)x.ie&&!d.first(function(a){return y(a)&&z(a)},1)&&d[0].appendChild(c.document.createTextNode("\u00a0")),d[0].appendChild(j[0]);l.insertAfter(d[0],m[0])}t.Utils.clearAllMarkers(f)}}}function u(c,d){var e=parseInt(c.style(m),10);isNaN(e)&&(e=0);e+=("indent"===d?1:-1)*p;if(0>e)return!1;e=Math.max(e,0);e=
Math.ceil(e/p)*p;c.css(m,e?e+A:"");""===c[0].style.cssText&&c.removeAttr("style");return!0}var t=k("editor"),r=k("./list-utils"),o={ol:1,ul:1},n=t.Walker,l=k("dom"),s=k("node"),x=k("ua"),y=n.whitespaces(!0),m="margin-left",p=40,A="px",z=n.bookmark(!1,!0);v.exports={checkOutdentActive:function(c){var d=c.blockLimit;return c.contains(o)?!0:(c=c.block||d)&&c.style(m)},addCommand:function(c,d){c.hasCommand(d)||c.addCommand(d,{exec:function(e){e.execCommand("save");var f=e.getSelection(),a=f&&f.getRanges()[0];
if(a){for(var b=a.startContainer,c=a.endContainer,g=a.getCommonAncestor();g&&!(g[0].nodeType===l.NodeType.ELEMENT_NODE&&o[g.nodeName()]);)g=g.parent();g&&b[0].nodeType===l.NodeType.ELEMENT_NODE&&b.nodeName()in o&&(b=new n(a),b.evaluator=q,a.startContainer=b.next());g&&c[0].nodeType===l.NodeType.ELEMENT_NODE&&c.nodeName()in o&&(b=new n(a),b.evaluator=q,a.endContainer=b.previous());c=f.createBookmarks(!0);if(g){for(b=g.first();b&&"li"!==b.nodeName();)b=b.next();var h=a.startContainer;(!(b[0]===h[0]||
b.contains(h))||!u(g,d))&&w(a,g,d)}else{a=a.createIterator();a.enforceRealBlocks=!0;for(a.enlargeBr=!0;g=a.getNextParagraph();)u(g,d)}f.selectBookmarks(c)}e.execCommand("save");e.notifySelectionChange()}})}}});
