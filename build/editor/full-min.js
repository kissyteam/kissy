/*
Copyright 2012, KISSY UI Library v1.30dev
MIT Licensed
build time: May 29 14:44
*/
/*
 thanks to CKSource's intelligent work on CKEditor
 @author yiminghe@gmail.com
*/
KISSY.add("editor/core/base",function(h,j,l){j=l.Controller.extend({initializer:function(){var c;this.__commands={};this.__dialogs={};if(c=this.get("textarea")){if(!this.get("render")&&!this.get("elBefore")){var f=c.next();f?this.__set("elBefore",f):this.__set("render",c.parent())}}else this.__editor_created_new=1},use:function(c,f){var a=this,i=a.__CORE_PLUGINS||["htmlDataProcessor","enterKey","clipboard","selection"];h.isString(c)&&(c=c.split(","));for(var e=c.length-1;0<=e;e--)c[e]||c.splice(e,
1);for(e=0;e<i.length;e++){var g=i[e];h.inArray(g,c)||c.unshift(g)}h.each(c,function(a,e){c[e]&&(c[e]="editor/plugin/"+a+"/")});h.use(c,function(){var e,g=h.makeArray(arguments);g.shift();for(var c=0;c<g.length;c++)g[c]&&g[c].init(a);f&&f.call(a);(e=a.get("height"))&&a._uiSetHeight(e)});a.__CORE_PLUGINS=[];return a}},{Config:{},XHTML_DTD:j.DTD,ATTRS:{textarea:{},iframe:{},window:{},document:{},iframeWrapEl:{},toolBarEl:{},statusBarEl:{},handleMouseEvents:{value:!1},focusable:{value:!1},mode:{value:1},
data:{getter:function(){return this._getData()},setter:function(c){return this._setData(c)}},formatData:{getter:function(){return this._getData(1)},setter:function(c){return this._setData(c)}},prefixCls:{value:"ke-"}}},{xclass:"editor"});h.mix(j,h.EventTarget);return KISSY.Editor=j},{requires:["htmlparser","component","core"]});
KISSY.add("editor/plugin/clipboard/index",function(h){function j(d){this.editor=d;this._init()}function l(b){if(a.ie&&"BackCompat"!=b.get("document")[0].compatMode){var e=b.getSelection(),g;if(e.getType()==d.SELECTION_ELEMENT&&(g=e.getSelectedElement())){var q=e.getRanges()[0],c=new f(b.get("document")[0].createTextNode(""));c.insertBefore(g);q.setStartBefore(c);q.setEndAfter(g);e.selectRanges([q]);setTimeout(function(){g.parent()&&(c.remove(),e.selectElement(g))},0)}}}var c=h.Editor,f=h.Node,a=h.UA,
i=c.Range,e=c.RANGE,g=h.Event;h.augment(j,{_init:function(){var d=this.editor;g.on(d.get("document")[0].body,a.webkit?"paste":a.gecko?"paste":"beforepaste",this._paste,this);g.on(d.get("document")[0].body,"contextmenu",function(){q=1;setTimeout(function(){q=0},10)});d.addCommand("copy",new o("copy"));d.addCommand("cut",new o("cut"));d.addCommand("paste",new o("paste"))},_paste:function(){if(!q){var d=this.editor,b=d.get("document")[0];if(!b.getElementById("ke_pastebin")){var g=d.getSelection(),c=
new i(b),k=new f(a.webkit?"<body></body>":"<div></div>",null,b);k.attr("id","ke_pastebin");a.webkit&&k[0].appendChild(b.createTextNode("\u00a0"));b.body.appendChild(k[0]);k.css({position:"absolute",top:g.getStartElement().offset().top+"px",width:"1px",height:"1px",overflow:"hidden"});k.css("left","-1000px");var n=g.createBookmarks();c.setStartAt(k,e.POSITION_AFTER_START);c.setEndAt(k,e.POSITION_BEFORE_END);c.select(!0);setTimeout(function(){k.remove();var b;k=a.webkit&&(b=k.first())&&b.hasClass("Apple-style-span")?
b:k;g.selectBookmarks(n);b=k.html();if(b=h.trim(b.replace(/<span[^>]+_ke_bookmark[^<]*?<\/span>(&nbsp;)*/ig,""))){var e=d.fire("paste",{html:b,holder:k});void 0!==e&&(b=e);e=null;/(class="?Mso|style="[^"]*\bmso\-|w:WordDocument)/.test(b)&&(e=d.htmlDataProcessor.wordFilter);d.insertHtml(b,e)}},0)}}}});var k=function(d,b){var e=d.get("document")[0],g=new f(e.body),q=!1,c=function(){q=!0};g.on(b,c);(7<a.ie?e:e.selection.createRange()).execCommand(b);g.detach(b,c);return q},p=a.ie?function(b,d){return k(b,
d)}:function(b,d){try{return b.get("document")[0].execCommand(d)}catch(a){return!1}},n={cut:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u526a\u5207\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+X)\u6765\u5b8c\u6210",copy:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u590d\u5236\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+C)\u6765\u5b8c\u6210",paste:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u7c98\u8d34\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+V)\u6765\u5b8c\u6210"},o=function(b){this.type=b};o.prototype={exec:function(b){"cut"==this.type&&l(b);(b=p(b,this.type))||alert(n[this.type]);return b}};var d=c.Selection,b={copy:"\u590d\u5236",paste:"\u7c98\u8d34",cut:"\u526a\u5207"},q;c.on("contextmenu",function(d){var a=d.contextmenu,e=a.get("editor"),
g=a.menu.get("contentEl"),q={copy:0,cut:0,paste:0},c;for(c in q)q.hasOwnProperty(c)&&(q[c]=g.one(".ke-paste-"+c),q[c]||function(d){var m=(new f("<a href='#'class='ke-paste-"+d+"'>"+b[d]+"</a>")).appendTo(g);m.on("click",function(b){b.halt();a.hide();setTimeout(function(){e.execCommand(d)},30)});q[d]=m}(c))});return{init:function(b){b.docReady(function(){new j(b)})}}},{requires:["editor"]});
KISSY.add("editor/core/dom",function(h){function j(d,b){var a=d[b?"next":"prev"]();if(a&&a[0].nodeType==f.ELEMENT_NODE){for(var e=[];a.attr("_ke_bookmark")||a._4e_isEmptyInlineRemovable(l);)if(e.push(a),a=b?a.next():a.prev(),!a)return;if(d._4e_isIdentical(a,l)){for(var g=new i(b?d[0].lastChild:d[0].firstChild);e.length;)e.shift()._4e_move(d,!b,l);a._4e_moveChildren(d,!b,l);a.remove();g[0]&&g[0].nodeType==f.ELEMENT_NODE&&g._4e_mergeSiblings()}}}var l=l,c=h.Editor,f=h.DOM,a=h.UA,i=h.Node,e=c.Utils,
g={a:1,abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};c.POSITION={POSITION_IDENTICAL:0,POSITION_DISCONNECTED:1,POSITION_FOLLOWING:2,POSITION_PRECEDING:4,POSITION_IS_CONTAINED:8,POSITION_CONTAINS:16};var k=c.POSITION,p={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,"table-column":1,
"table-cell":1,"table-caption":1},n={hr:1},o=function(d){return d&&(d[0]||d)};e.injectDom({_4e_sameLevel:function(d,b){var b=o(b),a=d.parentNode;return a&&a==b.parentNode},_4e_isBlockBoundary:function(d,b){var a=h.merge(n,b);return!(!p[f.css(d,"display")]&&!a[f.nodeName(d)])},_4e_getWin:f._getWin,_4e_index:function(d,b){for(var a=d.parentNode.childNodes,e,g=-1,c=0;c<a.length;c++)if(e=a[c],!b||!(3==e.nodeType&&e.previousSibling&&3==e.previousSibling.nodeType))if(g++,e===d)return g;return-1},_4e_move:function(d,
b,a){b=o(b);a?b.insertBefore(d,b.firstChild):b.appendChild(d)},_4e_isIdentical:function(d,b){if(!b)return!1;b=o(b);if(f.nodeName(d)!=f.nodeName(b))return!1;var a=d.attributes,g=b.attributes,c=a.length,k=g.length;if(c!=k)return!1;for(var i=0;i<c;i++){var h=a[i],n=h.name;if(h.specified&&f.attr(d,n)!=f.attr(b,n))return!1}if(8>e.ieEngine)for(i=0;i<k;i++)if(h=g[i],n=h.name,h.specified&&f.attr(d,n)!=f.attr(b,n))return!1;return!0},_4e_isEmptyInlineRemovable:function(d){for(var d=d.childNodes,b=0,a=d.length;b<
a;b++){var e=d[b],g=e.nodeType;if(!(g==f.ELEMENT_NODE&&e.getAttribute("_ke_bookmark"))&&(g==f.ELEMENT_NODE&&!f._4e_isEmptyInlineRemovable(e)||g==f.TEXT_NODE&&h.trim(e.nodeValue)))return!1}return!0},_4e_moveChildren:function(d,b,a){b=o(b);if(d!=b)if(a)for(;a=d.lastChild;)b.insertBefore(d.removeChild(a),b.firstChild);else for(;a=d.firstChild;)b.appendChild(d.removeChild(a))},_4e_mergeSiblings:function(d){d=new i(d);g[d.nodeName()]&&(j(d,!0),j(d))},_4e_splitText:function(d,b){var e=d.ownerDocument;if(d.nodeType==
f.TEXT_NODE){if(a.ie&&b==d.nodeValue.length){var g=e.createTextNode("");f.insertAfter(g,d);return g}g=d.splitText(b);e.documentMode&&(e=e.createTextNode(""),f.insertAfter(e,g),f.remove(e));return g}},_4e_parents:function(d,b){var a=[];a.__IS_NODELIST=1;do a[b?"push":"unshift"](d);while(d=d.parentNode);return a},_4e_nextSourceNode:function(d,b,a,e){if(e&&!e.call)var g=o(e),e=function(b){return b!==g};var b=!b&&d.firstChild,c=d;if(!b){if(d.nodeType==f.ELEMENT_NODE&&e&&!1===e(d,!0))return null;b=d.nextSibling}for(;!b&&
(c=c.parentNode);){if(e&&!1===e(c,!0))return null;b=c.nextSibling}return!b||e&&!1===e(b)?null:a&&a!=b.nodeType?f._4e_nextSourceNode(b,!1,a,e):b},_4e_previousSourceNode:function(d,b,a,e){if(e&&!e.call)var g=o(e),e=function(b){return b!==g};var b=!b&&d.lastChild,c=d;if(!b){if(d.nodeType==f.ELEMENT_NODE&&e&&!1===e(d,!0))return null;b=d.previousSibling}for(;!b&&(c=c.parentNode);){if(e&&!1===e(c,!0))return null;b=c.previousSibling}return!b||e&&!1===e(b)?null:a&&b.nodeType!=a?f._4e_previousSourceNode(b,
!1,a,e):b},_4e_commonAncestor:function(d,b){b=o(b);if(d===b)return d;if(f.contains(b,d))return b;var a=d;do if(f.contains(a,b))return a;while(a=a.parentNode);return null},_4e_hasAttributes:9>e.ieEngine?function(d){for(var b=d.attributes,a=0;a<b.length;a++){var e=b[a];switch(e.name){case "class":if(d.getAttribute("class"))return!0;break;default:if(e.specified)return!0}}return!1}:function(d){a.gecko&&d.removeAttribute("_moz_dirty");return d.hasAttributes()},_4e_position:function(d,b){var a=o(b);if(d.compareDocumentPosition)return d.compareDocumentPosition(a);
if(d==a)return k.POSITION_IDENTICAL;if(d.nodeType==f.ELEMENT_NODE&&a.nodeType==f.ELEMENT_NODE){if(f.contains(d,a))return k.POSITION_CONTAINS+k.POSITION_PRECEDING;if(f.contains(a,d))return k.POSITION_IS_CONTAINED+k.POSITION_FOLLOWING;if("sourceIndex"in d)return 0>d.sourceIndex||0>a.sourceIndex?k.POSITION_DISCONNECTED:d.sourceIndex<a.sourceIndex?k.POSITION_PRECEDING:k.POSITION_FOLLOWING}for(var e=f._4e_address(d),a=f._4e_address(a),g=Math.min(e.length,a.length),c=0;c<=g-1;c++)if(e[c]!=a[c])return e[c]<
a[c]?k.POSITION_PRECEDING:k.POSITION_FOLLOWING;return e.length<a.length?k.POSITION_CONTAINS+k.POSITION_PRECEDING:k.POSITION_IS_CONTAINED+k.POSITION_FOLLOWING},_4e_address:function(d,b){for(var a=[],e=d.ownerDocument.documentElement,g=d;g&&g!=e;)a.unshift(f._4e_index(g,b)),g=g.parentNode;return a},_4e_remove:function(d,b){var a=d.parentNode;if(a){if(b)for(var e;e=d.firstChild;)a.insertBefore(d.removeChild(e),d);a.removeChild(d)}return d},_4e_trim:function(d){f._4e_ltrim(d);f._4e_rtrim(d)},_4e_ltrim:function(d){for(var b;b=
d.firstChild;){if(b.nodeType==f.TEXT_NODE){var a=e.ltrim(b.nodeValue),g=b.nodeValue.length;if(a)a.length<g&&(f._4e_splitText(b,g-a.length),d.removeChild(d.firstChild));else{d.removeChild(b);continue}}break}},_4e_rtrim:function(d){for(var b;b=d.lastChild;){if(b.type==f.TEXT_NODE){var g=e.rtrim(b.nodeValue),c=b.nodeValue.length;if(g)g.length<c&&(f._4e_splitText(b,g.length),d.removeChild(d.lastChild));else{d.removeChild(b);continue}}break}!a.ie&&!a.opera&&(b=d.lastChild)&&1==b.nodeType&&"br"==f.nodeName(b)&&
d.removeChild(b)},_4e_appendBogus:function(d){for(var b=d.lastChild;b&&b.nodeType==f.TEXT_NODE&&!h.trim(b.nodeValue);)b=b.previousSibling;if(!b||b.nodeType==f.TEXT_NODE||"br"!==f.nodeName(b))b=a.opera?d.ownerDocument.createTextNode(""):d.ownerDocument.createElement("br"),a.gecko&&b.setAttribute("type","_moz"),d.appendChild(b)},_4e_outerHtml:function(d){if(d.outerHTML)return d.outerHTML.replace(/<\?[^>]*>/,"");var b=d.ownerDocument.createElement("div");b.appendChild(d.cloneNode(!0));return b.innerHTML},
_4e_setMarker:function(d,b,a,e){var d=new i(d),g=d.data("list_marker_id")||d.data("list_marker_id",h.guid()).data("list_marker_id"),c=d.data("list_marker_names")||d.data("list_marker_names",{}).data("list_marker_names");b[g]=d;c[a]=1;return d.data(a,e)},_4e_clearMarkers:function(d,b,a){var d=new i(d),e=d.data("list_marker_names"),g=d.data("list_marker_id"),c;for(c in e)e.hasOwnProperty(c)&&d.removeData(c);d.removeData("list_marker_names");a&&(d.removeData("list_marker_id"),delete b[g])},_4e_copyAttributes:function(d,
b,e){for(var b=new i(b),g=d.attributes,e=e||{},c=0;c<g.length;c++){var k=g[c],t=k.name.toLowerCase(),h;if(!(t in e))if("checked"==t&&(h=f.attr(d,t)))b.attr(t,h);else if(k.specified||a.ie&&k.value&&"value"==t)h=f.attr(d,t),null===h&&(h=k.nodeValue),b.attr(t,h)}""!==d.style.cssText&&(b[0].style.cssText=d.style.cssText)},_4e_isEditable:function(d){var d=f.nodeName(d),b=c.XHTML_DTD;return(d=!b.$nonEditable[d]&&(b[d]||b.span))&&d["#"]},_4e_getByAddress:function(d,b,a){for(var d=d.documentElement,e=0;d&&
e<b.length;e++){var g=b[e];if(a)for(var c=-1,k=0;k<d.childNodes.length;k++){var i=d.childNodes[k];if(!(!0===a&&3==i.nodeType&&i.previousSibling&&3==i.previousSibling.nodeType)&&(c++,c==g)){d=i;break}}else d=d.childNodes[g]}return d}})},{requires:["./base","./utils"]});
KISSY.add("editor/core/domIterator",function(h){function j(d){1>arguments.length||(this.range=d,this.forceBrBreak=c,this.enlargeBr=l,this.enforceRealBlocks=c,this._||(this._={}))}var l=!0,c=!1,f=h.Editor,a=h.UA,i=f.Walker,e=f.Range,g=f.RANGE,k=f.ElementPath,p=h.Node,n=h.DOM,o=/^[\r\n\t ]*$/;h.augment(j,{getNextParagraph:function(d){var b,f,m,j,u;if(!this._.lastNode){f=this.range.clone();f.shrink(g.SHRINK_ELEMENT,l);f.enlarge(this.forceBrBreak||!this.enlargeBr?g.ENLARGE_LIST_ITEM_CONTENTS:g.ENLARGE_BLOCK_CONTENTS);
var t=new i(f),r=i.bookmark(l,l);t.evaluator=r;this._.nextNode=t.next();t=new i(f);t.evaluator=r;t=t.previous();this._.lastNode=t._4e_nextSourceNode(l);this._.lastNode&&this._.lastNode[0].nodeType==n.TEXT_NODE&&!h.trim(this._.lastNode[0].nodeValue)&&this._.lastNode.parent()._4e_isBlockBoundary()&&(r=new e(f.document),r.moveToPosition(this._.lastNode,g.POSITION_AFTER_END),r.checkEndOfBlock()&&(r=new k(r.endContainer),this._.lastNode=(r.block||r.blockLimit)._4e_nextSourceNode(l)));this._.lastNode||
(this._.lastNode=this._.docEndMarker=new p(f.document.createTextNode("")),n.insertAfter(this._.lastNode[0],t[0]));f=null}r=this._.nextNode;t=this._.lastNode;for(this._.nextNode=null;r;){var x=c,y=r[0].nodeType!=n.ELEMENT_NODE,z=c;if(y)r[0].nodeType==n.TEXT_NODE&&o.test(r[0].nodeValue)&&(y=c);else{var v=r.nodeName();if(r._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){if("br"==v)y=l;else if(!f&&!r[0].childNodes.length&&"hr"!=v){b=r;m=r.equals(t);break}f&&(f.setEndAt(r,g.POSITION_BEFORE_START),"br"!=
v&&(this._.nextNode=r));x=l}else{if(r[0].firstChild){f||(f=new e(this.range.document),f.setStartAt(r,g.POSITION_BEFORE_START));r=new p(r[0].firstChild);continue}y=l}}y&&!f&&(f=new e(this.range.document),f.setStartAt(r,g.POSITION_BEFORE_START));m=(!x||y)&&r.equals(t);if(f&&!x)for(;!r[0].nextSibling&&!m;){v=r.parent();if(v._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){x=l;m||v.equals(t);break}r=v;y=l;m=r.equals(t);z=l}y&&f.setEndAt(r,g.POSITION_AFTER_END);r=r._4e_nextSourceNode(z,null,t);if((m=!r)||
x&&f)break}if(!b){if(!f)return this._.docEndMarker&&this._.docEndMarker._4e_remove(),this._.nextNode=null;b=new k(f.startContainer);r=b.blockLimit;x={div:1,th:1,td:1};b=b.block;if((!b||!b[0])&&!this.enforceRealBlocks&&x[r.nodeName()]&&f.checkStartOfBlock()&&f.checkEndOfBlock())b=r;else if(!b||this.enforceRealBlocks&&"li"==b.nodeName())b=new p(this.range.document.createElement(d||"p")),b[0].appendChild(f.extractContents()),b._4e_trim(),f.insertNode(b),j=u=l;else if("li"!=b.nodeName()){if(!f.checkStartOfBlock()||
!f.checkEndOfBlock())b=b.clone(c),b[0].appendChild(f.extractContents()),b._4e_trim(),u=f.splitBlock(),j=!u.wasStartOfBlock,u=!u.wasEndOfBlock,f.insertNode(b)}else m||(this._.nextNode=b.equals(t)?null:f.getBoundaryNodes().endNode._4e_nextSourceNode(l,null,t))}j&&(f=new p(b[0].previousSibling),f[0]&&f[0].nodeType==n.ELEMENT_NODE&&("br"==f.nodeName()?f._4e_remove():f[0].lastChild&&"br"==n.nodeName(f[0].lastChild)&&n._4e_remove(f[0].lastChild)));u&&(f=i.bookmark(c,l),j=new p(b[0].lastChild),j[0]&&j[0].nodeType==
n.ELEMENT_NODE&&"br"==j.nodeName()&&(a.ie||j.prev(f)||j.next(f))&&j.remove());this._.nextNode||(this._.nextNode=m||b.equals(t)?null:b._4e_nextSourceNode(l,null,t));return b}});e.prototype.createIterator=function(){return new j(this)}},{requires:["./base","./range","./elementPath","./walker"]});
KISSY.add("editor/core/elementPath",function(h){function j(g){for(var k=a,h=a,n=[];g;){if(g[0].nodeType==c.ELEMENT_NODE){this.lastElement||(this.lastElement=g);var o=g.nodeName();if(!h&&(!k&&i[o]&&(k=g),e[o])){var d;if(d=!k)if(d="div"==o){a:{d=g[0].childNodes;for(var b=0,j=d.length;b<j;b++){var m=d[b];if(m.nodeType==c.ELEMENT_NODE&&f.$block[m.nodeName.toLowerCase()]){d=!0;break a}}d=!1}d=!d}d?k=g:h=g}n.push(g);if("body"==o)break}g=g.parent()}this.block=k;this.blockLimit=h;this.elements=n}var l=h.Editor,
c=h.DOM,f=l.XHTML_DTD,a=null,i={address:1,blockquote:1,dl:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,li:1,dt:1,dd:1},e={body:1,div:1,table:1,tbody:1,tr:1,td:1,th:1,caption:1,form:1};j.prototype={compare:function(a){var e=this.elements,a=a&&a.elements;if(!a||e.length!=a.length)return!1;for(var f=0;f<e.length;f++)if(!c.equals(e[f],a[f]))return!1;return!0},contains:function(e){for(var c=this.elements,f=0;f<c.length;f++)if(c[f].nodeName()in e)return c[f];return a},toString:function(){var a=this.elements,
e,c=[];for(e=0;e<a.length;e++)c.push(a[e].nodeName());return c.toString()}};return l.ElementPath=j},{requires:["./base","./dom"]});
KISSY.add("editor/plugin/enterKey/index",function(h){function j(g){var c;c=g.getSelection().getRanges();for(var d=c.length-1;0<d;d--)c[d].deleteContents();c=c[0];d=c.document;if(c.checkStartOfBlock()&&c.checkEndOfBlock()){var b=(new p(c.startContainer)).block;if(b&&("li"==b.nodeName()||"li"==b.parent().nodeName()))return g.hasCommand("outdent")?(g.execCommand("save"),g.execCommand("outdent"),g.execCommand("save"),!0):!1}var j=c.splitBlock("p");if(!j)return!0;var g=j.previousBlock,b=j.nextBlock,m=
j.wasStartOfBlock,l=j.wasEndOfBlock,u;if(b)u=b.parent(),"li"==u.nodeName()&&(b._4e_breakParent(u),b._4e_move(b.next(),!0));else if(g&&(u=g.parent())&&"li"==u.nodeName())g._4e_breakParent(u),c.moveToElementEditablePosition(g.next()),g._4e_move(g.prev());if(!m&&!l){if("li"==b.nodeName()&&(u=b.first(k.invisible(!0)))&&h.inArray(u.nodeName(),["ul","ol"]))(f.ie?new e(d.createTextNode("\u00a0")):new e(d.createElement("br"))).insertBefore(u);b&&c.moveToElementEditablePosition(b)}else{var t;if(g){if("li"==g.nodeName()||
!a.test(g.nodeName()))t=g.clone()}else b&&(t=b.clone());t||(t=new e("<p>",null,d));if(u=j.elementPath)for(var j=0,r=u.elements.length;j<r;j++){var x=u.elements[j];if(x.equals(u.block)||x.equals(u.blockLimit))break;i.$removeEmpty[x.nodeName()]&&(x=x.clone(),t._4e_moveChildren(x),t.append(x))}f.ie||t._4e_appendBogus();c.insertNode(t);if(f.ie&&m&&(!l||!g[0].childNodes.length))c.moveToElementEditablePosition(l?g:t),c.select();c.moveToElementEditablePosition(m&&!l?b:t)}f.ie||(b?(t=new e(d.createElement("span")),
t.html("&nbsp;"),c.insertNode(t),t.scrollIntoView(void 0,!1),c.deleteContents()):t.scrollIntoView(void 0,!1));c.select();return!0}function l(a){var e=a.get("document")[0];g.on(e,"keydown",function(d){if(13===d.keyCode&&!d.shiftKey&&!d.ctrlKey&&!d.metaKey){a.execCommand("save");var b=a.execCommand("enterBlock");a.execCommand("save");!1!==b&&d.preventDefault()}})}var c=h.Editor,f=h.UA,a=/^h[1-6]$/,i=c.XHTML_DTD,e=h.Node,g=h.Event,k=c.Walker,p=c.ElementPath;return{init:function(a){a.addCommand("enterBlock",
{exec:j});a.docReady(function(){l(a)})}}},{requires:["editor"]});
KISSY.add("editor/core/focusManager",function(h){function j(){var a=this;a.__iframeFocus=k;g=a;e&&clearTimeout(e);e=setTimeout(function(){a.fire("focus")},100)}function l(){var a=this;a.__iframeFocus=p;g=n;e&&clearTimeout(e);e=setTimeout(function(){a.fire("blur")},100)}var c=h.Editor,f=h.DOM,a=h.Event,i={},e,g,h={refreshAll:function(){for(var a in i)if(i.hasOwnProperty(a)){var d=i[a].get("document")[0];d.designMode="off";d.designMode="on"}},currentInstance:function(){return g},getInstance:function(a){return i[a]},
add:function(e){var d=f._4e_getWin(e.get("document")[0]);a.on(d,"focus",j,e);a.on(d,"blur",l,e)},register:function(a){i[a._UUID]=a},remove:function(e){delete i[e._UUID];var d=f._4e_getWin(e.get("document")[0]);a.remove(d,"focus",j,e);a.remove(d,"blur",l,e)}},k=!0,p=!1,n=null;h.refreshAll=h.refreshAll;c.focusManager=h;c.getInstances=function(){return i};return h},{requires:["./base","./dom"]});
KISSY.add("editor/plugin/htmlDataProcessor/index",function(h){return{init:function(j){function l(a){return a.replace(d,function(a,d,e){return"<"+d+e.replace(b,function(b,a){return-1==e.indexOf("_ke_saved_"+a)?" _ke_saved_"+b+" "+b:b})+">"})}function c(b){return b.replace(/<\!--(?!{ke_protected})[\s\S]+?--\>/g,function(b){return"<\!--"+q+"{C}"+encodeURIComponent(b).replace(/--/g,"%2D%2D")+"--\>"})}function f(b){return b.replace(/<\!--\{ke_protected\}\{C\}([\s\S]+?)--\>/g,function(b,a){return decodeURIComponent(a)})}
var a=a,i=h.Editor,e=h.Node,g=h.UA,k=h.require("htmlparser"),p=new k.Filter,n=new k.Filter,o=new k.Filter;(function(){var b=function(b,a){return function(d,e){var g=[];(""+d).replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(d,c,f){c=c.toLowerCase();"font-family"==c&&(f=f.replace(/["']/g,""));for(var i,k,h,m=0;m<b.length;m++)if(b[m]&&(d=b[m][0],i=b[m][1],k=b[m][2],h=b[m][3],c.match(d)&&(!i||f.match(i)))){c=h||c;a&&(k=k||f);"function"==typeof k&&(k=k(f,e,c));k&&k.push&&
(c=k[0],k=k[1]);"string"==typeof k&&g.push([c,k]);return}!a&&g.push([c,f])});for(var c=0;c<g.length;c++)g[c]=g[c].join(":");return g.length?g.join(";")+";":!1}}([[/mso/i],[/w:WordDocument/i],[/^-ms/i],[/^-moz/i],[/^-webkit/i]],a),d={tagNames:[[/^script$/i,""],[/^iframe$/i,""],[/^style$/i,""],[/^link$/i,""],[/^meta$/i,""],[/^\?xml.*$/i,""],[/^.*namespace.*$/i,""]],root:function(b){b.filterChildren()},tags:{p:function(b){b.filterChildren()},$:function(b){var a=b.nodeName||"";if(-1!=a.indexOf(":")&&
!/^ke/.test(a))if("v:imagedata"==a){if(a=b.getAttribute("o:href"))b.setAttribute("src",a),b.removeAttribute("o:href");if(a=b.getAttribute("o:title"))b.setAttribute("title",a),b.removeAttribute("o:title");b.setTagName("img")}else b.setTagName("")}},attributes:{"class":function(b){return!b||/(^|\s+)Mso/.test(b)?!1:b},style:function(a){a=b(a);return!a?!1:a}},attributeNames:[[/^on/,"ke_on"],[/^lang$/,""]]},e={tagNames:[[/^ke:/,""],[/^\?xml:namespace$/,""]],tags:{$:function(b){if(b.attributes.length)for(var a=
["name","href","src"],d,e=0;e<a.length;e++)d="_ke_saved_"+a[e],b.getAttribute(d)&&b.removeAttribute(a[e]);return b},embed:function(b){var a=b.parentNode;if(a&&"object"==a.nodeName){var d=a.getAttribute("width"),a=a.getAttribute("height");d&&b.setAttribute("width",d);a&&b.setAttribute("width",a)}},a:function(b){if(!b.childNodes.length&&!b.attributes.length)return!1},span:function(b){if(!b.childNodes.length&&!b.attributes.length)return!1}},attributes:{style:function(b){if(!h.trim(b))return!1}},attributeNames:[[/^_ke_saved_/,
""],[/^ke_on/,"on"],[/^_ke.*/,""],[/^_ks.*/,""],[/^ke:.*$/,""]],comment:function(b){return b.substr(0,q.length)==q?(b="{C}"==b.substr(q.length,3)?b.substr(q.length+3):b.substr(q.length),new k.CData(decodeURIComponent(b))):b}};g.ie&&(e.attributes.style=function(b){return b.replace(/(^|;)([^:]+)/g,function(b){return b.toLowerCase()})});p.addRules(e);n.addRules(d);o.addRules(d)})();(function(){function b(a){for(var a=a.childNodes,d=a.length,e=a[d-1];e&&3==e.nodeType&&!h.trim(e.nodeValue);)e=a[--d];return e}
function a(d,e){var c=b(d);c&&((e||!g.ie)&&1==c.nodeType&&"br"==c.nodeName?d.removeChild(c):3==c.nodeType&&f.test(c.nodeValue)&&d.removeChild(c))}function d(a){var e=b(a);return!e||1==e.nodeType&&"br"==e.nodeName||"form"==a.nodeName&&"input"==e.nodeName}function e(b){a(b,!0);d(b)&&(g.ie?b.appendChild(new k.Text("\u00a0")):(b.appendChild(new k.Text("&nbsp;")),b.appendChild(new k.Tag("br"))))}function c(b){a(b,!1);d(b)&&b.appendChild(new k.Text("\u00a0"))}var f=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,j=i.XHTML_DTD,l=h.merge(j.$block,
j.$listItem,j.$tableContent),q;for(q in l)l.hasOwnProperty(q)&&("br"in j[q]||delete l[q]);delete l.td;delete l.pre;var j={tags:{}},s={tags:{}};for(q in l)l.hasOwnProperty(q)&&(j.tags[q]=e,s.tags[q]=c);n.addRules(j);p.addRules(s);o.addRules(j)})();(function(){p.addRules({text:function(b){return b.replace(/\xa0/g,"&nbsp;")}})})();var d=/<(a|area|img|input)\b([^>]*)>/gi,b=/\b(href|src|name)\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|(?:[^ "'>]+))/gi,q="{ke_protected}";j.htmlDataProcessor={wordFilter:o,dataFilter:n,
htmlFilter:p,toHtml:function(b){var a=new k.BeautifyWriter;(new k.Parser(b)).parse().writeHtml(a,p);return a.getHtml()},toDataFormat:function(b,a,d){d=d||n;g.gecko&&(b=b.replace(/(<\!--\[if[^<]*?\])--\>([\S\s]*?)<\!--(\[endif\]--\>)/gi,"$1$2$3"));b=l(b);a=new e("<div>");a.html("a"+b);b=a.html().substr(1);b=f(b);a=new k.BeautifyWriter;(new k.Parser(b)).parse().writeHtml(a,d);b=a.getHtml();return b=c(b)},toServer:function(b){var a=new k.MinifyWriter;(new k.Parser(b)).parse().writeHtml(a,p);return a.getHtml()}}}}},
{requires:["editor"]});
KISSY.add("editor/core/meta",function(){var h={backColor:["../color/btn","./cmd"],localStorage:["../flashBridge/"],bold:["../font/ui","./cmd"],draft:["../localStorage/","../select/"],flash:["../flashCommon/baseClass","../flashCommon/utils"],fontFamily:["../font/ui","./cmd"],fontSize:["../font/ui","./cmd"],foreColor:["../color/btn","./cmd"],heading:["./cmd"],image:["../button/","../bubbleview/","../contextmenu/","../dialogLoader/"],indent:["./cmd"],insertOrderedList:["../listUtils/btn","./cmd"],insertUnorderedList:["../listUtils/btn",
"./cmd"],italic:["../font/ui","./cmd"],justifyCenter:["./cmd"],justifyLeft:["./cmd"],justifyRight:["./cmd"],link:["../bubbleview/","./utils","../dialogLoader/"],maximize:["./cmd"],multipleUpload:["../dialogLoader/"],outdent:["./cmd"],overlay:["./focus","dd"],pageBreak:["../fakeObjects/"],removeFormat:["./cmd","../button/"],resize:["dd"],smiley:["../overlay/"],sourceArea:["../button/"],strikeThrough:["../font/ui","./cmd"],table:["../dialogLoader/","../contextmenu/"],underline:["../font/ui","./cmd"],
undo:["./btn","./cmd"],video:["../flashCommon/utils","../flashCommon/baseClass"],xiamiMusic:["../flashCommon/baseClass","../flashCommon/utils"]},j,l,c={"backColor/cmd":["../color/cmd"],"bold/cmd":["../font/cmd"],"color/btn":["../button/","../overlay/","../dialogLoader/"],"color/colorPicker/dialog":["../overlay/"],"dentUtils/cmd":["../listUtils/"],"flash/dialog":["../flashCommon/utils","../overlay/","../select/"],"flashCommon/baseClass":["../contextmenu/","../bubbleview/","../dialogLoader/","./utils"],
"font/ui":["../button/","../select/"],"fontFamily/cmd":["../font/cmd"],"fontSize/cmd":["../font/cmd"],"foreColor/cmd":["../color/cmd"],"image/dialog":["../overlay/","switchable","../select/"],"indent/cmd":["../dentUtils/cmd"],"insertOrderedList/cmd":["../listUtils/cmd"],"insertUnorderedList/cmd":["../listUtils/cmd.js"],"italic/cmd":["../font/cmd"],"justifyCenter/cmd":["../justifyUtils/cmd"],"justifyLeft/cmd":["../justifyUtils/cmd"],"justifyRight/cmd":["../justifyUtils/cmd"],"link/dialog":["../overlay/",
"./utils"],"listUtils/btn":["../button/"],"listUtils/cmd":["../listUtils/"],"multipleUpload/dialog":["../progressbar/","../overlay/","../flashBridge/","../localStorage/"],"outdent/cmd":["../dentUtils/cmd"],"strikeThrough/cmd":["../font/cmd"],"table/dialog":["../overlay/","../select/"],"underline/cmd":["../font/cmd"],"undo/btn":["../button/"],"video/dialog":["../flash/dialog","../select/"],"xiamiMusic/dialog":["../flash/dialog","../select/"]},f={};for(j in h)l="editor/plugin/"+j+"/index",f[l]={requires:h[j]};
for(j in c)l="editor/plugin/"+j,f[l]={requires:c[j]};KISSY.add(f)});
KISSY.add("editor/core/range",function(h,j,l,c,f){function a(b){var a=b.nodeType!=m.TEXT_NODE&&m.nodeName(b)in u.$removeEmpty,d=b.nodeType==m.TEXT_NODE&&!h.trim(b.nodeValue),b=!!b.parentNode.getAttribute("_ke_bookmark");return a||d||b}function i(b){return!y(b)&&!z(b)}function e(b){var a=o;return function(d){if(z(d))return n;if(d.nodeType==m.TEXT_NODE){if(h.trim(d.nodeValue).length)return o}else if(d.nodeType==m.ELEMENT_NODE&&(d=m.nodeName(d),!B[d]))if(!b&&!w.ie&&"br"==d&&!a)a=n;else return o;return n}}
function g(b,a){var d=b.startContainer,e=b.endContainer,g=b.startOffset,c=b.endOffset,f,k=o,i=o,h=void 0,j=b.document,u;if(b.collapsed)return h;0<a&&(h=j.createDocumentFragment());b.optimizeBookmark();e[0].nodeType==m.TEXT_NODE?(i=n,e=e._4e_splitText(c)):0<e[0].childNodes.length&&(c>=e[0].childNodes.length?(e=new t(e[0].appendChild(j.createTextNode(""))),u=n):e=new t(e[0].childNodes[c]));d[0].nodeType==m.TEXT_NODE?(k=n,d._4e_splitText(g)):g?g>=d[0].childNodes.length?(d=new t(d[0].appendChild(j.createTextNode(""))),
f=n):d=new t(d[0].childNodes[g].previousSibling):(f=new t(j.createTextNode("")),d.prepend(f),d=f,f=n);var r=d._4e_parents(),p=e._4e_parents();r.each(function(b,a){r[a]=b});p.each(function(b,a){p[a]=b});for(var y,l,j=0;j<r.length&&!(y=r[j],l=p[j],!y.equals(l));j++);for(var g=h,s,q,x=j;x<r.length;x++){s=r[x];c=0<a&&!s.equals(d)?g.appendChild(s.clone()[0]):null;s=s[0].nextSibling;q=p[x];for(var z=e[0],w=q&&q[0];s&&!(w==s||z==s);)q=s.nextSibling,2==a?g.appendChild(s.cloneNode(n)):(m._4e_remove(s),1==
a&&g.appendChild(s)),s=q;c&&(g=c)}for(g=h;j<p.length;j++){s=p[j];c=0<a&&!s.equals(e)?g.appendChild(s.clone()[0]):null;if(!r[j]||!s._4e_sameLevel(r[j]))for(s=s[0].previousSibling;s;)q=s.previousSibling,2==a?g.insertBefore(s.cloneNode(n),g.firstChild):(m._4e_remove(s),1==a&&g.insertBefore(s,g.firstChild)),s=q;c&&(g=c)}if(2==a){if(k&&(y=d[0],y.nodeType==m.TEXT_NODE&&y.nextSibling&&y.nextSibling.nodeType==m.TEXT_NODE&&(y.data+=y.nextSibling.data,y.parentNode.removeChild(y.nextSibling))),i)i=e[0],i.nodeType==
m.TEXT_NODE&&i.previousSibling&&i.previousSibling.nodeType==m.TEXT_NODE&&(i.previousSibling.data+=i.data,i.parentNode.removeChild(i))}else{if(y&&l&&(!d._4e_sameLevel(y)||!e._4e_sameLevel(l)))i=y._4e_index(),f&&y._4e_sameLevel(d)&&i--,b.setStart(y.parent(),i+1);b.collapse(n)}f&&d.remove();u&&e.remove();return h}function k(b){b.collapsed=b.startContainer&&b.endContainer&&b.startContainer[0]==b.endContainer[0]&&b.startOffset==b.endOffset}function p(b){this.endOffset=this.endContainer=this.startOffset=
this.startContainer=d;this.collapsed=n;this.document=b}j.RANGE={POSITION_AFTER_START:1,POSITION_BEFORE_END:2,POSITION_BEFORE_START:3,POSITION_AFTER_END:4,ENLARGE_ELEMENT:1,ENLARGE_BLOCK_CONTENTS:2,ENLARGE_LIST_ITEM_CONTENTS:3,START:1,END:2,SHRINK_ELEMENT:1,SHRINK_TEXT:2};var n=!0,o=!1,d=null,b=j.RANGE,q=j.POSITION,m=h.DOM,w=h.UA,u=j.XHTML_DTD,t=h.Node,r=t.all,x={area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1},y=new c.whitespaces,z=new c.bookmark,v=c.whitespaces(n),s=c.bookmark(!1,
!0),B={abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};h.augment(p,{toString:function(){var b=[],a=this.startContainer[0],d=this.endContainer[0];b.push((a.id||a.nodeName)+":"+this.startOffset);b.push((d.id||d.nodeName)+":"+this.endOffset);return b.join("<br/>")},optimize:function(){var b=this.startContainer,a=this.startOffset;b[0].nodeType!=m.ELEMENT_NODE&&(a?a>=b[0].nodeValue.length&&
this.setStartAfter(b):this.setStartBefore(b));b=this.endContainer;a=this.endOffset;b[0].nodeType!=m.ELEMENT_NODE&&(a?a>=b[0].nodeValue.length&&this.setEndAfter(b):this.setEndBefore(b))},setStartAfter:function(b){this.setStart(b.parent(),b._4e_index()+1)},setStartBefore:function(b){this.setStart(b.parent(),b._4e_index())},setEndAfter:function(b){this.setEnd(b.parent(),b._4e_index()+1)},setEndBefore:function(b){this.setEnd(b.parent(),b._4e_index())},optimizeBookmark:function(){var b=this.startContainer,
a=this.endContainer;b&&"span"==b.nodeName()&&b.attr("_ke_bookmark")&&this.setStartBefore(b);a&&"span"==a.nodeName()&&a.attr("_ke_bookmark")&&this.setEndAfter(a)},setStart:function(b,a){b[0].nodeType==m.ELEMENT_NODE&&x[b.nodeName()]&&(b=b.parent(),a=b._4e_index());this.startContainer=b;this.startOffset=a;this.endContainer||(this.endContainer=b,this.endOffset=a);k(this)},setEnd:function(b,a){b[0].nodeType==m.ELEMENT_NODE&&x[b.nodeName()]&&(b=b.parent(),a=b._4e_index()+1);this.endContainer=b;this.endOffset=
a;this.startContainer||(this.startContainer=b,this.startOffset=a);k(this)},setStartAt:function(a,d){switch(d){case b.POSITION_AFTER_START:this.setStart(a,0);break;case b.POSITION_BEFORE_END:a[0].nodeType==m.TEXT_NODE?this.setStart(a,a[0].nodeValue.length):this.setStart(a,a[0].childNodes.length);break;case b.POSITION_BEFORE_START:this.setStartBefore(a);break;case b.POSITION_AFTER_END:this.setStartAfter(a)}k(this)},setEndAt:function(a,d){switch(d){case b.POSITION_AFTER_START:this.setEnd(a,0);break;
case b.POSITION_BEFORE_END:a[0].nodeType==m.TEXT_NODE?this.setEnd(a,a[0].nodeValue.length):this.setEnd(a,a[0].childNodes.length);break;case b.POSITION_BEFORE_START:this.setEndBefore(a);break;case b.POSITION_AFTER_END:this.setEndAfter(a)}k(this)},cloneContents:function(){return g(this,2)},deleteContents:function(){return g(this,0)},extractContents:function(){return g(this,1)},collapse:function(b){b?(this.endContainer=this.startContainer,this.endOffset=this.startOffset):(this.startContainer=this.endContainer,
this.startOffset=this.endOffset);this.collapsed=n},clone:function(){var b=new p(this.document);b.startContainer=this.startContainer;b.startOffset=this.startOffset;b.endContainer=this.endContainer;b.endOffset=this.endOffset;b.collapsed=this.collapsed;return b},getEnclosedNode:function(){var b=this.clone();b.optimize();if(b.startContainer[0].nodeType!=m.ELEMENT_NODE||b.endContainer[0].nodeType!=m.ELEMENT_NODE)return d;var a=new c(b);a.evaluator=function(b){return v(b)&&s(b)};b=a.next();a.reset();a=
a.previous();return b&&b.equals(a)?b:d},shrink:function(a,d){if(!this.collapsed){var a=a||b.SHRINK_TEXT,e=this.clone(),g=this.startContainer,f=this.endContainer,i=this.startOffset,k=this.endOffset,h=n,j,u,r=n;g&&g[0].nodeType==m.TEXT_NODE&&(i?i>=g[0].nodeValue.length?e.setStartAfter(g):(e.setStartBefore(g),h=o):e.setStartBefore(g));f&&f[0].nodeType==m.TEXT_NODE&&(k?k>=f[0].nodeValue.length?e.setEndAfter(f):(e.setEndAfter(f),r=o):e.setEndBefore(f));if(h||r)u=new c(e),u.evaluator=function(d){return d.nodeType==
(a==b.SHRINK_ELEMENT?m.ELEMENT_NODE:m.TEXT_NODE)},u.guard=function(d,e){if(a==b.SHRINK_ELEMENT&&d.nodeType==m.TEXT_NODE||e&&d==j)return o;!e&&d.nodeType==m.ELEMENT_NODE&&(j=d);return n};h&&(e=u[a==b.SHRINK_ELEMENT?"lastForward":"next"]())&&this.setStartAt(e,d?b.POSITION_AFTER_START:b.POSITION_BEFORE_START);r&&(u.reset(),(u=u[a==b.SHRINK_ELEMENT?"lastBackward":"previous"]())&&this.setEndAt(u,d?b.POSITION_BEFORE_END:b.POSITION_AFTER_END));return h||r}},createBookmark2:function(b){var a=this.startContainer,
e=this.endContainer,g=this.startOffset,c=this.endOffset,f,i;if(!a||!e)return{start:0,end:0};if(b){if(a[0].nodeType==m.ELEMENT_NODE&&(f=new t(a[0].childNodes[g]))&&f[0]&&f[0].nodeType==m.TEXT_NODE&&0<g&&f[0].previousSibling.nodeType==m.TEXT_NODE)a=f,g=0;for(;a[0].nodeType==m.TEXT_NODE&&(i=a.prev())&&i[0].nodeType==m.TEXT_NODE;)a=i,g+=i[0].nodeValue.length;if(!this.collapsed){if(e[0].nodeType==m.ELEMENT_NODE&&(f=new t(e[0].childNodes[c]))&&f[0]&&f[0].nodeType==m.TEXT_NODE&&0<c&&f[0].previousSibling.nodeType==
m.TEXT_NODE)e=f,c=0;for(;e[0].nodeType==m.TEXT_NODE&&(i=e.prev())&&i[0].nodeType==m.TEXT_NODE;)e=i,c+=i[0].nodeValue.length}}return{start:a._4e_address(b),end:this.collapsed?d:e._4e_address(b),startOffset:g,endOffset:c,normalized:b,is2:n}},createBookmark:function(a){var e,g,c,f,i=this.collapsed;e=new t("<span>",d,this.document);e.attr("_ke_bookmark",1);e.css("display","none");e.html("&nbsp;");a&&(c=h.guid("ke_bm_"),e.attr("id",c+"S"));i||(g=e.clone(),g.html("&nbsp;"),a&&g.attr("id",c+"E"),f=this.clone(),
f.collapse(),f.insertNode(g));f=this.clone();f.collapse(n);f.insertNode(e);g?(this.setStartAfter(e),this.setEndBefore(g)):this.moveToPosition(e,b.POSITION_AFTER_END);return{startNode:a?c+"S":e,endNode:a?c+"E":g,serializable:a,collapsed:i}},moveToPosition:function(b,a){this.setStartAt(b,a);this.collapse(n)},trim:function(b,a){var d=this.startContainer,e=this.startOffset,g=this.collapsed;if((!b||g)&&d[0]&&d[0].nodeType==m.TEXT_NODE){if(e)if(e>=d[0].nodeValue.length)e=d._4e_index()+1,d=d.parent();else{var c=
d._4e_splitText(e),e=d._4e_index()+1,d=d.parent();m.equals(this.startContainer,this.endContainer)?this.setEnd(c,this.endOffset-this.startOffset):m.equals(d,this.endContainer)&&(this.endOffset+=1)}else e=d._4e_index(),d=d.parent();this.setStart(d,e);if(g){this.collapse(n);return}}d=this.endContainer;e=this.endOffset;!a&&!g&&d[0]&&d[0].nodeType==m.TEXT_NODE&&(e?(e>=d[0].nodeValue.length||d._4e_splitText(e),e=d._4e_index()+1):e=d._4e_index(),d=d.parent(),this.setEnd(d,e))},insertNode:function(b){this.optimizeBookmark();
this.trim(o,n);var a=this.startContainer;a[0].insertBefore(b[0],a[0].childNodes[this.startOffset]||null);a[0]==this.endContainer[0]&&this.endOffset++;this.setStartBefore(b)},moveToBookmark:function(b){var a=r(this.document);if(b.is2){var d=a._4e_getByAddress(b.start,b.normalized),e=b.startOffset,a=b.end&&a._4e_getByAddress(b.end,b.normalized),b=b.endOffset;this.setStart(d,e);a?this.setEnd(a,b):this.collapse(n)}else d=(e=b.serializable)?h.one("#"+b.startNode,a):b.startNode,b=e?h.one("#"+b.endNode,
a):b.endNode,this.setStartBefore(d),d._4e_remove(),b&&b[0]?(this.setEndBefore(b),b._4e_remove()):this.collapse(n)},getCommonAncestor:function(b,a){var d=this.startContainer,e=this.endContainer,d=d[0]==e[0]?b&&d[0].nodeType==m.ELEMENT_NODE&&this.startOffset==this.endOffset-1?new t(d[0].childNodes[this.startOffset]):d:d._4e_commonAncestor(e);return a&&d[0].nodeType==m.TEXT_NODE?d.parent():d},enlarge:function(){function a(b,d,e,g){var c=b[d?"startContainer":"endContainer"],f,i=d?0:1,k=0,h=d?"previousSibling":
"nextSibling";f=b[d?"startOffset":"endOffset"];if(c[0].nodeType==m.TEXT_NODE){if(d){if(f)return}else if(f<c[0].nodeValue.length)return;f=c[0][h];c=c[0].parentNode}else f=c[0].childNodes[f+(d?-1:1)]||null,c=c[0];for(;c;){for(;f;)if(y(f)||z(f))f=f[h];else break;if(f){if(!k)b[d?"setStartAfter":"setEndBefore"](r(f));break}c=r(c);if("body"==c.nodeName())break;if(k||c.equals(g))e[i]=c,k=1;else b[d?"setStartBefore":"setEndAfter"](c);f=c[0][h];c=c[0].parentNode}}return function(e){switch(e){case b.ENLARGE_ELEMENT:if(this.collapsed)break;
var e=this.getCommonAncestor(),g=[];a(this,1,g,e);a(this,0,g,e);g[0]&&g[1]&&(e=g[0].contains(g[1])?g[1]:g[0],this.setStartBefore(e),this.setEndAfter(e));break;case b.ENLARGE_BLOCK_CONTENTS:case b.ENLARGE_LIST_ITEM_CONTENTS:var f=new p(this.document),g=new t(this.document.body);f.setStartAt(g,b.POSITION_AFTER_START);f.setEnd(this.startContainer,this.startOffset);var f=new c(f),i,k,h=c.blockBoundary(e==b.ENLARGE_LIST_ITEM_CONTENTS?{br:1}:d),j=function(b){var a=h(b);a||(i=r(b));return a},u=function(b){var a=
j(b);!a&&"br"==m.nodeName(b)&&(k=r(b));return a};f.guard=j;f=f.lastBackward();i=i||g;this.setStartAt(i,"br"!=i.nodeName()&&(!f&&this.checkStartOfBlock()||f&&i.contains(f))?b.POSITION_AFTER_START:b.POSITION_AFTER_END);f=this.clone();f.collapse();f.setEndAt(g,b.POSITION_BEFORE_END);f=new c(f);f.guard=e==b.ENLARGE_LIST_ITEM_CONTENTS?u:j;i=d;f=f.lastForward();i=i||g;this.setEndAt(i,!f&&this.checkEndOfBlock()||f&&i.contains(f)?b.POSITION_BEFORE_END:b.POSITION_BEFORE_START);k&&this.setEndAfter(k)}}}(),
checkStartOfBlock:function(){var a=this.startContainer,d=this.startOffset;if(d&&a[0].nodeType==m.TEXT_NODE&&h.trim(a[0].nodeValue.substring(0,d)).length)return o;this.trim();a=new f(this.startContainer);d=this.clone();d.collapse(n);d.setStartAt(a.block||a.blockLimit,b.POSITION_AFTER_START);a=new c(d);a.evaluator=e(n);return a.checkBackward()},checkEndOfBlock:function(){var a=this.endContainer,d=this.endOffset;if(a[0].nodeType==m.TEXT_NODE&&h.trim(a[0].nodeValue.substring(d)).length)return o;this.trim();
a=new f(this.endContainer);d=this.clone();d.collapse(o);d.setEndAt(a.block||a.blockLimit,b.POSITION_BEFORE_END);a=new c(d);a.evaluator=e(o);return a.checkForward()},checkBoundaryOfElement:function(d,e){var g=this.clone();g[e==b.START?"setStartAt":"setEndAt"](d,e==b.START?b.POSITION_AFTER_START:b.POSITION_BEFORE_END);g=new c(g);g.evaluator=a;return g[e==b.START?"checkBackward":"checkForward"]()},getBoundaryNodes:function(){var b=this.startContainer,a=this.endContainer,d=this.startOffset,e=this.endOffset,
g;if(b[0].nodeType==m.ELEMENT_NODE)if(g=b[0].childNodes.length,g>d)b=r(b[0].childNodes[d]);else if(0==g)b=b._4e_previousSourceNode();else{for(b=b[0];b.lastChild;)b=b.lastChild;b=r(b);b=b._4e_nextSourceNode()||b}if(a[0].nodeType==m.ELEMENT_NODE)if(g=a[0].childNodes.length,g>e)a=r(a[0].childNodes[e])._4e_previousSourceNode(n);else if(0==g)a=a._4e_previousSourceNode();else{for(a=a[0];a.lastChild;)a=a.lastChild;a=r(a)}b._4e_position(a)&q.POSITION_FOLLOWING&&(b=a);return{startNode:b,endNode:a}},fixBlock:function(a,
d){var e=this.createBookmark(),g=r(this.document.createElement(d));this.collapse(a);this.enlarge(b.ENLARGE_BLOCK_CONTENTS);g[0].appendChild(this.extractContents());g._4e_trim();w.ie||g._4e_appendBogus();this.insertNode(g);this.moveToBookmark(e);return g},splitBlock:function(a){var e=new f(this.startContainer),g=new f(this.endContainer),c=e.block,i=g.block,k=d;if(!e.blockLimit.equals(g.blockLimit))return d;"br"!=a&&(c||(c=this.fixBlock(n,a),i=(new f(this.endContainer)).block),i||(i=this.fixBlock(o,
a)));a=c&&this.checkStartOfBlock();e=i&&this.checkEndOfBlock();this.deleteContents();c&&c[0]==i[0]&&(e?(k=new f(this.startContainer),this.moveToPosition(i,b.POSITION_AFTER_END),i=d):a?(k=new f(this.startContainer),this.moveToPosition(c,b.POSITION_BEFORE_START),c=d):(i=this.splitElement(c),!w.ie&&!h.inArray(c.nodeName(),["ul","ol"])&&c._4e_appendBogus()));return{previousBlock:c,nextBlock:i,wasStartOfBlock:a,wasEndOfBlock:e,elementPath:k}},splitElement:function(a){if(!this.collapsed)return d;this.setEndAt(a,
b.POSITION_BEFORE_END);var e=this.extractContents(),g=a.clone(o);g[0].appendChild(e);g.insertAfter(a);this.moveToPosition(a,b.POSITION_AFTER_END);return g},moveToElementEditablePosition:function(a,d){for(var e=0;a;){if(a[0].nodeType==m.TEXT_NODE){this.moveToPosition(a,d?b.POSITION_AFTER_END:b.POSITION_BEFORE_START);e=1;break}a[0].nodeType==m.ELEMENT_NODE&&a._4e_isEditable()&&(this.moveToPosition(a,d?b.POSITION_BEFORE_END:b.POSITION_AFTER_START),e=1);var g=a,c=e,f=void 0;g[0].nodeType==m.ELEMENT_NODE&&
g._4e_isEditable()&&(f=g[d?"last":"first"](i));!c&&!f&&(f=g[d?"prev":"next"](i));a=f}return!!e},selectNodeContents:function(b){var a=b[0];this.setStart(b,0);this.setEnd(b,a.nodeType==m.TEXT_NODE?a.nodeValue.length:a.childNodes.length)},insertNodeByDtd:function(b){var a,d,e,g=b.nodeName();a=u.$block[g];this.deleteContents();if(a){for(a=this.getCommonAncestor(o,n);(d=u[a.nodeName()])&&(!d||!d[g]);){var c=a.parent();this.checkStartOfBlock()&&this.checkEndOfBlock()?(this.setStartBefore(a),this.collapse(n),
a.remove()):e=a;a=c}e&&this.splitElement(e)}this.insertNode(b)}});l.injectDom({_4e_breakParent:function(b,a){var a=r(a),b=r(b),d,e=new j.Range(b[0].ownerDocument);e.setStartAfter(b);e.setEndAfter(a);d=e.extractContents();e.insertNode(b.remove());b.after(d)}});j.Range=p},{requires:["./base","./utils","./walker","./elementPath","./dom"]});
KISSY.add("editor/core/selection",function(h){function j(b){this.document=b;this._={cache:{}};if(n){var a=this.getNative().createRange();if(!a||a.item&&a.item(0).ownerDocument!=b||a.parentElement&&a.parentElement().ownerDocument!=b)this.isInvalid=f}}function l(b){b=new j(b);return!b||b.isInvalid?a:b}var c=h.Editor;c.SELECTION={SELECTION_NONE:1,SELECTION_TEXT:2,SELECTION_ELEMENT:3};var f=!0,a=null,i=h.UA,e=h.DOM,g=h.Node,k=c.SELECTION,p=c.RANGE,n=i.ie,o=c.Walker,d=c.Range,b={img:1,hr:1,li:1,table:1,
tr:1,td:1,th:1,embed:1,object:1,ol:1,ul:1,a:1,input:1,form:1,select:1,textarea:1,button:1,fieldset:1,thead:1,tfoot:1};h.augment(j,{getNative:!n?function(){var b=this._.cache;return b.nativeSel||(b.nativeSel=e._4e_getWin(this.document).getSelection())}:function(){var b=this._.cache;return b.nativeSel||(b.nativeSel=this.document.selection)},getType:!n?function(){var a=this._.cache;if(a.type)return a.type;var d=k.SELECTION_TEXT,g=this.getNative();if(g){if(1==g.rangeCount){var g=g.getRangeAt(0),c=g.startContainer;
c==g.endContainer&&c.nodeType==e.ELEMENT_NODE&&1==Number(g.endOffset-g.startOffset)&&b[c.childNodes[g.startOffset].nodeName.toLowerCase()]&&(d=k.SELECTION_ELEMENT)}}else d=k.SELECTION_NONE;return a.type=d}:function(){var b=this._.cache;if(b.type)return b.type;var a=k.SELECTION_NONE;try{var d=this.getNative(),e=d.type;"Text"==e&&(a=k.SELECTION_TEXT);"Control"==e&&(a=k.SELECTION_ELEMENT);d.createRange().parentElement&&(a=k.SELECTION_TEXT)}catch(g){}return b.type=a},getRanges:n?function(){var b=function(b,
d){b=b.duplicate();b.collapse(d);for(var g=b.parentElement(),c=g.childNodes,f,i=0;i<c.length;i++){var k=c[i];if(k.nodeType==e.ELEMENT_NODE){f=b.duplicate();f.moveToElementText(k);var k=f.compareEndPoints("StartToStart",b),h=f.compareEndPoints("EndToStart",b);f.collapse();if(0<k)break;else{if(!k||1==h&&-1==k)return{container:g,offset:i};if(!h)return{container:g,offset:i+1}}f=a}}f||(f=b.duplicate(),f.moveToElementText(g),f.collapse(!1));f.setEndPoint("StartToStart",b);f=(""+f.text).replace(/\r\n|\r/g,
"\n").length;try{for(;0<f;)f-=c[--i].nodeValue.length}catch(j){f=0}return 0===f?{container:g,offset:i}:{container:c[i],offset:-f}};return function(a){var e=this._.cache;if(e.ranges&&!a)return e.ranges;var c=this.getNative(),a=c&&c.createRange(),i=this.getType();if(!c)return[];if(i==k.SELECTION_TEXT)return c=new d(this.document),i=b(a,f),c.setStart(new g(i.container),i.offset),i=b(a),c.setEnd(new g(i.container),i.offset),e.ranges=[c];if(i==k.SELECTION_ELEMENT){e=e.ranges=[];for(i=0;i<a.length;i++){for(var h=
a.item(i),j=h.parentNode,m=0,c=new d(this.document);m<j.childNodes.length&&j.childNodes[m]!=h;m++);c.setStart(new g(j),m);c.setEnd(new g(j),m+1);e.push(c)}return e}return e.ranges=[]}}():function(b){var a=this._.cache;if(a.ranges&&!b)return a.ranges;var b=[],e=this.getNative();if(!e)return[];for(var c=0;c<e.rangeCount;c++){var f=e.getRangeAt(c),i=new d(this.document);i.setStart(new g(f.startContainer),f.startOffset);i.setEnd(new g(f.endContainer),f.endOffset);b.push(i)}return a.ranges=b},getStartElement:function(){var b=
this._.cache;if(void 0!==b.startElement)return b.startElement;var a,d=this.getNative();switch(this.getType()){case k.SELECTION_ELEMENT:return this.getSelectedElement();case k.SELECTION_TEXT:var c=this.getRanges()[0];if(c&&!c.collapsed){for(c.optimize();f;)if(a=c.startContainer,c.startOffset==(a[0].nodeType===e.ELEMENT_NODE?a[0].childNodes.length:a[0].nodeValue.length)&&!a._4e_isBlockBoundary())c.setStartAfter(a);else break;a=c.startContainer;if(a[0].nodeType!=e.ELEMENT_NODE)return a.parent();a=new g(a[0].childNodes[c.startOffset]);
if(!a[0]||a[0].nodeType!=e.ELEMENT_NODE)return c.startContainer;for(c=a[0].firstChild;c&&c.nodeType==e.ELEMENT_NODE;)a=new g(c),c=c.firstChild;return a}if(n)c=d.createRange(),c.collapse(f),a=new g(c.parentElement());else{if((a=d.anchorNode)&&a.nodeType!=e.ELEMENT_NODE)a=a.parentNode;a&&(a=new g(a))}}return b.startElement=a},getSelectedElement:function(){var a,d=this._.cache;if(void 0!==d.selectedElement)return d.selectedElement;n&&(a=this.getNative().createRange(),a=a.item&&a.item(0));var c;if(a)c=
new g(a);else{a=this.getRanges()[0];for(var f,i=2;i&&(!(c=a.getEnclosedNode())||!(c[0].nodeType==e.ELEMENT_NODE&&b[c.nodeName()]&&(f=c)));i--)a.shrink(p.SHRINK_ELEMENT);c=f}return d.selectedElement=c},reset:function(){this._.cache={}},selectElement:function(b){var a,d=this.document;if(n)try{a=d.body.createControlRange(),a.addElement(b[0]),a.select()}catch(e){a=d.body.createTextRange(),a.moveToElementText(b[0]),a.select()}finally{}else a=d.createRange(),a.selectNode(b[0]),b=this.getNative(),b.removeAllRanges(),
b.addRange(a);this.reset()},selectRanges:function(b){if(n){if(1<b.length){var a=b[b.length-1];b[0].setEnd(a.endContainer,a.endOffset);b.length=1}b[0]&&b[0].select()}else{a=this.getNative();if(!a)return;a.removeAllRanges();for(var d=0;d<b.length;d++){var g=b[d],c=this.document.createRange(),f=g.startContainer;if(g.collapsed&&(i.gecko&&1.09>i.gecko||i.opera||i.webkit)&&f[0].nodeType==e.ELEMENT_NODE&&!f[0].childNodes.length)f[0].appendChild(this.document.createTextNode(i.webkit?"\u200b":"")),g.startOffset++,
g.endOffset++;c.setStart(f[0],g.startOffset);c.setEnd(g.endContainer[0],g.endOffset);a.addRange(c)}}this.reset()},createBookmarks2:function(b){for(var a=[],d=this.getRanges(),e=0;e<d.length;e++)a.push(d[e].createBookmark2(b));return a},createBookmarks:function(b,a){for(var d=[],g=this.document,c,a=a||this.getRanges(),i=a.length,k=0;k<i;k++){d.push(c=a[k].createBookmark(b,f));var j=(b=c.serializable)?h.one("#"+c.startNode,g):c.startNode;c=b?h.one("#"+c.endNode,g):c.endNode;for(var m=k+1;m<i;m++){var n=
a[m],p=n.startContainer,o=n.endContainer;e.equals(p,j.parent())&&n.startOffset++;e.equals(p,c.parent())&&n.startOffset++;e.equals(o,j.parent())&&n.endOffset++;e.equals(o,c.parent())&&n.endOffset++}}return d},selectBookmarks:function(b){for(var a=[],e=0;e<b.length;e++){var c=new d(this.document);c.moveToBookmark(b[e]);a.push(c)}this.selectRanges(a);return this},getCommonAncestor:function(){var b=this.getRanges();return b[0].startContainer._4e_commonAncestor(b[b.length-1].endContainer)},scrollIntoView:function(){var b=
this.getStartElement();b&&b.scrollIntoView(void 0,!1)},removeAllRanges:function(){var b=this.getNative();n?b&&b.clear():b&&b.removeAllRanges()}});var q={table:1,tbody:1,tr:1},m=o.whitespaces(f),w=/\ufeff|\u00a0/;d.prototype.select=d.prototype.select=!n?function(){var b=this.startContainer;this.collapsed&&b[0].nodeType==e.ELEMENT_NODE&&!b[0].childNodes.length&&b[0].appendChild(this.document.createTextNode(""));var a=this.document.createRange();a.setStart(b[0],this.startOffset);try{a.setEnd(this.endContainer[0],
this.endOffset)}catch(d){if(0<=d.toString().indexOf("NS_ERROR_ILLEGAL_VALUE"))this.collapse(f),a.setEnd(this.endContainer[0],this.endOffset);else throw d;}b=l(this.document).getNative();b.removeAllRanges();b.addRange(a)}:function(b){var a=this.collapsed,d,c;if(this.startContainer[0]===this.endContainer[0]&&1==this.endOffset-this.startOffset){var i=this.startContainer[0].childNodes[this.startOffset];if(i.nodeType==e.ELEMENT_NODE){(new j(this.document)).selectElement(new g(i));return}}(this.startContainer[0].nodeType==
e.ELEMENT_NODE&&this.startContainer.nodeName()in q||this.endContainer[0].nodeType==e.ELEMENT_NODE&&this.endContainer.nodeName()in q)&&this.shrink(p.SHRINK_ELEMENT,f);var k=this.createBookmark(),i=k.startNode,h;a||(h=k.endNode);k=this.document.body.createTextRange();k.moveToElementText(i[0]);k.moveStart("character",1);if(h)b=this.document.body.createTextRange(),b.moveToElementText(h[0]),k.setEndPoint("EndToEnd",b),k.moveEnd("character",-1);else{for(d=i[0].nextSibling;d&&!m(d);)d=d.nextSibling;d=!(d&&
d.nodeValue&&d.nodeValue.match(w))&&(b||!i[0].previousSibling||i[0].previousSibling&&"br"==e.nodeName(i[0].previousSibling));c=new g(this.document.createElement("span"));c.html("&#65279;");c.insertBefore(i);d&&e.insertBefore(this.document.createTextNode("\ufeff"),i[0]||i)}this.setStartBefore(i);i._4e_remove();if(a){if(d?(k.moveStart("character",-1),k.select(),this.document.selection.clear()):k.select(),c)this.moveToPosition(c,p.POSITION_BEFORE_START),c._4e_remove()}else this.setEndBefore(h),h._4e_remove(),
k.select()};j.getSelection=l;return c.Selection=j},{requires:["./base","./walker","./range","./dom"]});
KISSY.add("editor/plugin/selection/index",function(h,j){function l(b){function a(b,d){var e=i.body.createTextRange();try{e.moveToPoint(b,d)}catch(c){e=g}return e}function d(){var b=i.selection.createRange();k&&!b.item&&0===b.compareEndPoints("StartToEnd",b)&&k.select();p.remove(i,"mouseup",d);p.remove(i,"mousemove",e);k=c=0}function e(b){if(b.button){if(b=a(b.pageX,b.pageY))0<b.compareEndPoints("StartToStart",k)?b.setEndPoint("StartToStart",k):b.setEndPoint("EndToEnd",k),b.select()}else d()}var c,
f=b.get("iframe")[0].contentWindow,i=b.get("document")[0],k;p.on(i,"mousedown contextmenu",function(b){var g=i.documentElement;if(b.target===g&&(c&&d(),!(g.scrollHeight>g.clientHeight)&&(c=1,k=a(b.pageX,b.pageY))))p.on(i,"mouseup",d),p.on(i,"mousemove",e),f.focus(),k.select()})}function c(b){function a(e){if(n){var g=b.getSelection(),f=g&&g.getType(),k=g&&c.selection;if(e&&k&&f==d.SELECTION_NONE&&!c.queryCommandEnabled("InsertImage"))setTimeout(function(){a(i)},50);else{var j;if(!k||!k.type||!("Control"!=
k.type&&(j=k.createRange())&&(j=j.parentElement())&&(j=j.nodeName)&&j.toLowerCase()in{input:1,textarea:1}))h=k&&g.getRanges()[0],b.checkSelectionChange()}}}var c=b.get("document")[0],f=new o(c.body),k=new o(c.documentElement);if(8>j.Utils.ieEngine)k.on("click",function(a){"html"===(new o(a.target)).nodeName()&&b.getSelection().getNative().createRange().select()});var h,n,p=i;k.on("mousedown",function(){p=e});k.on("mouseup",function(){p=i});f.on("focusin",function(b){if("body"==(new o(b.target)).nodeName()&&
h){try{p&&h.select()}catch(a){}h=g}});f.on("focus",function(){n=i;a()});f.on("beforedeactivate",function(b){b.relatedTarget||(n=e,p=i)});f.on("mousedown",function(){n=e});f.on("mouseup",function(){n=i;setTimeout(function(){a(i)},0)});f.on("keydown",function(){n=e});f.on("keyup",function(){n=i;setTimeout(function(){a()},0)})}function f(b){var a=b.get("document")[0];p.on(a,"mouseup keyup",function(){b.checkSelectionChange()})}function a(b){function a(b){var d=j.XHTML_DTD;return b._4e_isBlockBoundary()&&
d.$empty[b.nodeName()]}function d(b){return f(b)&&h(b)}var c=b.get("document")[0],g=/\s*<(p|div|address|h\d|center)[^>]*>\s*(?:<br[^>]*>|&nbsp;|\u00A0|&#160;|(<\!--[\s\S]*?--\>))?\s*(:?<\/\1>)?(?=\s*$|<\/body>)/gi,f=j.Walker.whitespaces(i),h=j.Walker.bookmark(e,i),p=function(b){return f(b)&&8!=b.nodeType};b.on("selectionChange",function(f){var h=f.path,l=new o(b.get("document")[0].body),f=(f=f.selection)&&f.getRanges()[0],s=h.blockLimit;if(k.gecko){var r=h.block||h.blockLimit,t=r&&r.last(d);r&&r._4e_isBlockBoundary()&&
(!t||!(1==t[0].nodeType&&t._4e_isBlockBoundary()))&&"pre"!=r.nodeName()&&!r._4e_getBogus()&&r._4e_appendBogus()}if(f&&f.collapsed&&!h.block){if("body"==s.nodeName()){if((h=f.fixBlock(i,"p"))&&h[0]!=l[0].lastChild&&h._4e_outerHtml().match(g))if((s=h.next(p))&&s[0].nodeType==n.ELEMENT_NODE&&!a[s])f.moveToElementEditablePosition(s),h._4e_remove();else if((s=h.prev(p))&&s[0].nodeType==n.ELEMENT_NODE&&!a[s])f.moveToElementEditablePosition(s,s._4e_outerHtml().match(g)?e:i),h._4e_remove();f.select();b.notifySelectionChange()}h=
new j.Range(c);h.moveToElementEditablePosition(l,i);"body"!==(new j.ElementPath(h.startContainer)).blockLimit.nodeName()&&(l=(new o(c.createElement("p"))).appendTo(l),k.ie||l._4e_appendBogus())}})}var i=!0,e=!1,g=null,k=h.UA,p=h.Event,n=h.DOM,o=h.Node,d=j.SELECTION;return{init:function(b){b.docReady(function(){k.ie?(l(b),c(b)):f(b)});a(b)}}},{requires:["editor"]});
KISSY.add("editor/core/styles",function(h){function j(b){return!v.attr(b,"_ke_bookmark")}function l(b,a){for(var d in b)b.hasOwnProperty(d)&&(h.isString(b[d])?b[d]=b[d].replace(L,function(b,d){return a[d]}):l(b[d],a))}function c(b,a){a&&(b=h.clone(b),l(b,a));var d=this.element=this.element=(b.element||"*").toLowerCase();this.type=this.type="#"==d||K[d]?s.STYLE_BLOCK:I[d]?s.STYLE_OBJECT:s.STYLE_INLINE;this._={definition:b}}function f(b,a){var d=a?this.removeFromRange:this.applyToRange;b.body.focus();
for(var e=new C(b),c=e.getRanges(),g=0;g<c.length;g++)d.call(this,c[g]);e.selectRanges(c)}function a(b,a,d){var e=b.element;"*"==e&&(e="span");a=new D(a.createElement(e));d&&d._4e_copyAttributes(a);d=b._.definition;b=d.attributes;d=c.getStyleText(d);if(b)for(var g in b)b.hasOwnProperty(g)&&a.attr(g,b[g]);d&&(a[0].style.cssText=d);return a}function i(b){var d=b.createBookmark(x),c=b.createIterator();c.enforceRealBlocks=x;c.enlargeBr=x;for(var f,i=b.document;f=c.getNextParagraph();){var h=a(this,i,
f),j=h,h="pre"==j.nodeName,n="pre"==f.nodeName,m=!h&&n;h&&!n?(n=f,m=n.html(),m=e(m,/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,""),m=m.replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,"$1"),m=m.replace(/([ \t\n\r]+|&nbsp;)/g," "),m=m.replace(/<br\b[^>]*>/gi,"\n"),G.ie?(n=n[0].ownerDocument.createElement("div"),n.appendChild(j[0]),j[0].outerHTML="<pre>"+m+"</pre>",j=new D(n.firstChild),j._4e_remove()):j.html(m)):m?j=k(g(f),j):f._4e_moveChildren(j);f[0].parentNode.replaceChild(j[0],f[0]);if(h&&(f=j,h=void 0,(h=f._4e_previousSourceNode(x,
v.ELEMENT_NODE))&&"pre"==h.nodeName()))j=e(h.html(),/\n$/,"")+"\n\n"+e(f.html(),/^\n/,""),G.ie?f[0].outerHTML="<pre>"+j+"</pre>":f.html(j),h._4e_remove()}b.moveToBookmark(d)}function e(b,a,d){var e="",c="",b=b.replace(/(^<span[^>]+_ke_bookmark.*?\/span>)|(<span[^>]+_ke_bookmark.*?\/span>$)/gi,function(b,a,d){a&&(e=a);d&&(c=d);return""});return e+b.replace(a,d)+c}function g(b){var a=[];e(b._4e_outerHtml(),/(\S\s*)\n(?:\s|(<span[^>]+_ck_bookmark.*?\/span>))*\n(?!$)/gi,function(b,a,d){return a+"</pre>"+
d+"<pre>"}).replace(/<pre\b.*?>([\s\S]*?)<\/pre>/gi,function(b,d){a.push(d)});return a}function k(b,a){for(var d=a[0].ownerDocument.createDocumentFragment(),c=0;c<b.length;c++){var g=b[c],g=g.replace(/(\r\n|\r)/g,"\n"),g=e(g,/^[ \t]*\n/,""),g=e(g,/\n$/,""),g=e(g,/^[ \t]+|[ \t]+$/g,function(b,a){return 1==b.length?"&nbsp;":a?" "+Array(b.length).join("&nbsp;"):Array(b.length).join("&nbsp;")+" "}),g=g.replace(/\n/g,"<br>"),g=g.replace(/[ \t]{2,}/g,function(b){return Array(b.length).join("&nbsp;")+" "}),
f=a.clone();f.html(g);d.appendChild(f[0])}return d}function p(b){var d=b.document;if(b.collapsed)d=a(this,d,void 0),b.insertNode(d),b.moveToPosition(d,B.POSITION_BEFORE_END);else{var e=this.element,c=this._.definition,g,f=E[e];f||(g=x,f=E.span);var i=b.createBookmark();b.enlarge(B.ENLARGE_ELEMENT);b.trim();for(var k=b.createBookmark(),h=k.startNode,k=k.endNode,m=h,n;m&&m[0];){var p=y;if(v.equals(m,k))m=z,p=x;else{var l=m[0].nodeType,o=l==v.ELEMENT_NODE?m.nodeName():z;if(o&&m.attr("_ke_bookmark")){m=
m._4e_nextSourceNode(x);continue}if(!o||f[o]&&(m._4e_position(k)|A.POSITION_PRECEDING|A.POSITION_IDENTICAL|A.POSITION_IS_CONTAINED)==A.POSITION_PRECEDING+A.POSITION_IDENTICAL+A.POSITION_IS_CONTAINED&&(!c.childRule||c.childRule(m))){var s=m.parent();if(s&&"a"==e&&s.nodeName()==e)l=a(this,d,void 0),s._4e_moveChildren(l),s[0].parentNode.replaceChild(l[0],s[0]),l._4e_mergeSiblings();else if(s&&s[0]&&((E[s.nodeName()]||E.span)[e]||g)&&(!c.parentRule||c.parentRule(s))){if(!n&&(!o||!E.$removeEmpty[o]||(m._4e_position(k)|
A.POSITION_PRECEDING|A.POSITION_IDENTICAL|A.POSITION_IS_CONTAINED)==A.POSITION_PRECEDING+A.POSITION_IDENTICAL+A.POSITION_IS_CONTAINED))n=new F(d),n.setStartBefore(m);if(l==v.TEXT_NODE||l==v.ELEMENT_NODE&&!m[0].childNodes.length){s=m;for(l=null;(p=!s.next(j))&&(l=s.parent())&&f[l.nodeName()]&&(l._4e_position(h)|A.POSITION_FOLLOWING|A.POSITION_IDENTICAL|A.POSITION_IS_CONTAINED)==A.POSITION_FOLLOWING+A.POSITION_IDENTICAL+A.POSITION_IS_CONTAINED&&(!c.childRule||c.childRule(l));)s=l;n.setEndAfter(s)}}else p=
x}else p=x;m=m._4e_nextSourceNode()}if(p&&n&&!n.collapsed){for(var p=a(this,d,void 0),s=n.getCommonAncestor(),l={},o={},q,r=null,u;p&&s&&p[0]&&s[0];){if(s.nodeName()==e){for(q in c.attributes)if(c.attributes.hasOwnProperty(q)&&!o[q]&&(u=s.attr(r)))p.attr(q)==u?p.removeAttr(q):o[q]=1;for(r in c.styles)if(c.styles.hasOwnProperty(r)&&!l[r]&&(u=s.style(r)))p.style(r)==u?p.style(r,""):l[r]=1;if(!p._4e_hasAttributes()){p=z;break}}s=s.parent()}p?(p[0].appendChild(n.extractContents()),w(this,p),n.insertNode(p),
p._4e_mergeSiblings(),G.ie||p[0].normalize()):(p=new D(d.createElement("span")),p[0].appendChild(n.extractContents()),n.insertNode(p),w(this,p),p._4e_remove(!0));n=z}}h._4e_remove();k._4e_remove();b.moveToBookmark(i);b.shrink(B.SHRINK_TEXT)}}function n(a){a.enlarge(B.ENLARGE_ELEMENT);var d=a.createBookmark(),e=d.startNode;if(a.collapsed){for(var c=new H(e.parent()),g,f=0,i;f<c.elements.length&&(i=c.elements[f])&&!(i==c.block||i==c.blockLimit);f++)if(this.checkElementRemovable(i)){var k=a.checkBoundaryOfElement(i,
B.END),h=!k&&a.checkBoundaryOfElement(i,B.START);h||k?(g=i,g.match=h?"start":"end"):(i._4e_mergeSiblings(),i.nodeName()!=this.element?(k=b(this),u(i,k[i.nodeName()]||k["*"])):q(this,i))}if(g){i=e;for(f=0;;f++){k=c.elements[f];if(v.equals(k,g))break;else if(k.match)continue;else k=k.clone();k[0].appendChild(i[0]);i=k}i["start"==g.match?"insertBefore":"insertAfter"](g)}}else{var j=d.endNode,m=this,c=function(){for(var b=new H(e.parent()),a=new H(j.parent()),d=z,c=z,g=0;g<b.elements.length;g++){var f=
b.elements[g];if(f==b.block||f==b.blockLimit)break;m.checkElementRemovable(f)&&(d=f)}for(g=0;g<a.elements.length;g++){f=a.elements[g];if(f==a.block||f==a.blockLimit)break;m.checkElementRemovable(f)&&(c=f)}c&&j._4e_breakParent(c);d&&e._4e_breakParent(d)};c();for(g=new D(e[0].nextSibling);g[0]!==j[0];){f=g._4e_nextSourceNode();if(g[0]&&g[0].nodeType==v.ELEMENT_NODE&&this.checkElementRemovable(g)&&(g.nodeName()==this.element?q(this,g):(i=b(this),u(g,i[g.nodeName()]||i["*"])),f[0].nodeType==v.ELEMENT_NODE&&
f.contains(e)))c(),f=new D(e[0].nextSibling);g=f}}a.moveToBookmark(d)}function o(b){var a={};(""+b).replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(b,d,e){a[d]=e});return a}function d(b,a){var d="";a!==y?(d=document.createElement("span"),d.style.cssText=b,d=d.style.cssText||""):d=b;return d.replace(/\s*([;:])\s*/,"$1").replace(/([^\s;])$/,"$1;").replace(/,\s+/g,",").toLowerCase()}function b(b){if(b._.overrides)return b._.overrides;var a=b._.overrides={},d=b._.definition.overrides;
if(d){h.isArray(d)||(d=[d]);for(var e=0;e<d.length;e++){var g=d[e],c,f,i;"string"==typeof g?c=g.toLowerCase():(c=g.element?g.element.toLowerCase():b.element,f=g.attributes,i=g.styles);g=a[c]||(a[c]={});if(f){c=g.attributes=g.attributes||[];for(var k in f)f.hasOwnProperty(k)&&c.push([k.toLowerCase(),f[k]])}if(i){var g=g.styles=g.styles||[],j;for(j in i)i.hasOwnProperty(j)&&g.push([j.toLowerCase(),i[j]])}}}return a}function q(a,d){var e=a._.definition,g=b(a),c=h.merge(e.attributes,(g[d.nodeName()]||
g["*"]||{}).attributes),e=h.merge(e.styles,(g[d.nodeName()]||g["*"]||{}).styles),g=h.isEmptyObject(c)&&h.isEmptyObject(e),f;for(f in c)if(c.hasOwnProperty(f)&&!(("class"==f||a._.definition.fullMatch)&&d.attr(f)!=m(f,c[f])))g=g||!!d.hasAttr(f),d.removeAttr(f);for(var i in e)e.hasOwnProperty(i)&&!(a._.definition.fullMatch&&d.style(i)!=m(i,e[i],x))&&(g=g||!!d.style(i),d.style(i,""));t(d)}function m(b,a,d){var e=new D("<span>");e[d?"style":"attr"](b,a);return e[d?"style":"attr"](b)}function w(a,d){for(var e=
b(a),g=d.all(a.element),c=g.length;0<=--c;)q(a,new D(g[c]));for(var f in e)if(e.hasOwnProperty(f)&&f!=a.element){g=d.all(f);for(c=g.length-1;0<=c;c--){var i=new D(g[c]);u(i,e[f])}}}function u(b,a){var d,e=a&&a.attributes;if(e)for(d=0;d<e.length;d++){var g=e[d][0],c;if(c=b.attr(g)){var f=e[d][1];(f===z||f.test&&f.test(c)||"string"==typeof f&&c==f)&&b[0].removeAttribute(g)}}if(e=a&&a.styles)for(d=0;d<e.length;d++)if(g=e[d][0],f=b.css(g)){var i=e[d][1];(i===z||i.test&&i.test(c)||"string"==typeof i&&
f==i)&&b.css(g,"")}t(b)}function t(b){if(!b._4e_hasAttributes()){var a=b[0].firstChild,d=b[0].lastChild;b._4e_remove(x);a&&(a.nodeType==v.ELEMENT_NODE&&v._4e_mergeSiblings(a),d&&a!=d&&d.nodeType==v.ELEMENT_NODE&&v._4e_mergeSiblings(d))}}var r=h.Editor,x=!0,y=!1,z=null,v=h.DOM,s={STYLE_BLOCK:1,STYLE_INLINE:2,STYLE_OBJECT:3},B=r.RANGE,C=r.Selection,A=r.POSITION,F=r.Range,D=h.Node,G=h.UA,H=r.ElementPath,K={address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1},E=r.XHTML_DTD,I={embed:1,hr:1,img:1,li:1,
object:1,ol:1,table:1,td:1,tr:1,th:1,ul:1,dl:1,dt:1,dd:1,form:1},J=/\s*(?:;\s*|$)/g,L=/#\((.+?)\)/g;r.STYLE=s;c.prototype={apply:function(b){f.call(this,b,y)},remove:function(b){f.call(this,b,x)},applyToRange:function(b){return(this.applyToRange=this.type==s.STYLE_INLINE?p:this.type==s.STYLE_BLOCK?i:z).call(this,b)},removeFromRange:function(b){return(this.removeFromRange=this.type==s.STYLE_INLINE?n:z).call(this,b)},checkElementRemovable:function(a,e){if(!a)return y;var g=this._.definition,f;if(a.nodeName()==
this.element){if(!e&&!a._4e_hasAttributes())return x;var i=g._AC;if(i)g=i;else{var i={},k=0,h=g.attributes;if(h)for(var j in h)h.hasOwnProperty(j)&&(k++,i[j]=h[j]);if(h=c.getStyleText(g))i.style||k++,i.style=h;i._length=k;g=g._AC=i}if(g._length){for(var m in g)if("_length"!=m&&g.hasOwnProperty(m)){k=a.attr(m)||"";if("style"==m)a:{i=g[m];k=d(k,y);"string"==typeof i&&(i=o(i));"string"==typeof k&&(k=o(k));h=void 0;for(h in i)if(i.hasOwnProperty(h)&&!(h in k&&(k[h]==i[h]||"inherit"==i[h]||"inherit"==
k[h]))){i=y;break a}i=x}else i=g[m]==k;if(i){if(!e)return x}else if(e)return y}if(e)return x}else return x}m=b(this);if(m=m[a.nodeName()]||m["*"]){if(!(g=m.attributes)&&!(f=m.styles))return x;if(g)for(i=0;i<g.length;i++)if(m=g[i][0],m=a.attr(m))if(k=g[i][1],k===z||"string"==typeof k&&m==k||k.test&&k.test(m))return x;if(f)for(i=0;i<f.length;i++)if(m=a.css(f[i][0]))if(g=f[i][1],g===z||"string"==typeof g&&m==g||g.test&&g.test(m))return x}return y},checkActive:function(b){switch(this.type){case s.STYLE_BLOCK:return this.checkElementRemovable(b.block||
b.blockLimit,x);case s.STYLE_OBJECT:case s.STYLE_INLINE:for(var a=b.elements,d=0,e;d<a.length;d++)if(e=a[d],!(this.type==s.STYLE_INLINE&&(v.equals(e,b.block)||v.equals(e,b.blockLimit))))if((this.type!=s.STYLE_OBJECT||e.nodeName()in I)&&this.checkElementRemovable(e,x))return x}return y}};c.getStyleText=function(b){var a=b._ST;if(a)return a;var a=b.styles,e=b.attributes&&b.attributes.style||"",g="";e.length&&(e=e.replace(J,";"));for(var c in a)if(a.hasOwnProperty(c)){var f=a[c],i=(c+":"+f).replace(J,
";");"inherit"==f?g+=i:e+=i}e.length&&(e=d(e));return b._ST=e+g};r.Style=c},{requires:["./range","./selection","./domIterator","./elementPath"]});
KISSY.add("editor/core/utils",function(h){var j=h.Node,l=h.DOM,c=h.UA,f={debugUrl:function(a){var c=h.Config;c.debug||(a=a.replace(/\.(js|css)/i,"-min.$1"));-1==a.indexOf("?t")&&(a=-1!=a.indexOf("?")?a+"&":a+"?",a+="t="+encodeURIComponent(c.tag));return c.base+"editor/"+a},lazyRun:function(a,c,e){var g=a[c],f=a[e];a[c]=function(){g.apply(this,arguments);a[c]=a[e];return f.apply(this,arguments)}},getXY:function(a,c,e,g){e=e.defaultView||e.parentWindow;a-=l.scrollLeft(e);c-=l.scrollTop(e);g&&(g=g.defaultView||
g.parentWindow,e!=g&&e.frameElement&&(g=l.offset(e.frameElement,void 0,g),a+=g.left,c+=g.top));return{left:a,top:c}},tryThese:function(a){for(var c,e=0,g=arguments.length;e<g;e++){var f=arguments[e];try{c=f();break}catch(h){}}return c},arrayCompare:function(a,c){if(!a&&!c)return!0;if(!a||!c||a.length!=c.length)return!1;for(var e=0;e<a.length;e++)if(a[e]!==c[e])return!1;return!0},clearAllMarkers:function(a){for(var c in a)a.hasOwnProperty(c)&&a[c]._4e_clearMarkers(a,!0,void 0)},ltrim:function(a){return a.replace(/^\s+/,
"")},rtrim:function(a){return a.replace(/\s+$/,"")},isNumber:function(a){return/^\d+(.\d+)?$/.test(h.trim(a))},verifyInputs:function(a){for(var c=0;c<a.length;c++){var e=new j(a[c]),g=h.trim(f.valInput(e)),k=e.attr("data-verify"),e=e.attr("data-warning");if(k&&!RegExp(k).test(g))return alert(e),!1}return!0},sourceDisable:function(a,c){a.on("sourceMode",c.disable,c);a.on("wysiwygMode",c.enable,c)},resetInput:function(a){var f=a.attr("placeholder");f&&c.ie?(a.addClass("ke-input-tip"),a.val(f)):c.ie||
a.val("")},valInput:function(a,c){if(void 0===c)return a.hasClass("ke-input-tip")?"":a.val();a.removeClass("ke-input-tip");a.val(c)},placeholder:function(a,f){a.attr("placeholder",f);c.ie&&(a.on("blur",function(){h.trim(a.val())||(a.addClass("ke-input-tip"),a.val(f))}),a.on("focus",function(){a.removeClass("ke-input-tip");h.trim(a.val())==f&&a.val("")}))},htmlEncode:function(a){return!a?a:(""+a).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")},normParams:function(a){var a=
h.clone(a),c;for(c in a)if(a.hasOwnProperty(c)){var e=a[c];h.isFunction(e)&&(a[c]=e())}return a},map:function(a,c){for(var e=0;e<a.length;e++)a[e]=c(a[e]);return a},ieEngine:document.documentMode||c.ie,preventFocus:function(a){c.ie?a.unselectable(void 0):a.attr("onmousedown","return false;")},injectDom:function(a){h.mix(l,a);for(var c in a)a.hasOwnProperty(c)&&function(e){j.prototype[e]=function(){var c=[].slice.call(arguments,0);c.unshift(this[0]);return(c=a[e].apply(null,c))&&(c.nodeType||h.isWindow(c))?
new j(c):h.isArray(c)&&(c.__IS_NODELIST||c[0]&&c[0].nodeType)?new j(c):c}}(c)},addRes:function(){var a=this.__res=this.__res||[];a.push.apply(a,h.makeArray(arguments))},destroyRes:function(){for(var a=this.__res||[],c=0;c<a.length;c++){var e=a[c];h.isFunction(e)?e():(e.destroy&&e.destroy(),e.remove&&e.remove())}this.__res=[]},getQueryCmd:function(a){return"query"+("-"+a).replace(/-(\w)/g,function(a,e){return e.toUpperCase()})+"Active"}};return h.Editor.Utils=f},{requires:["./base"]});
KISSY.add("editor/core/walker",function(h,j){function l(b,d){if(this._.end)return e;var c,g=this.range,f,h=this.guard,j=this.type,p=b?"_4e_previousSourceNode":"_4e_nextSourceNode";if(!this._.start&&(this._.start=1,g.trim(),g.collapsed))return this.end(),e;if(!b&&!this._.guardLTR){var l=g.endContainer[0],s=l.childNodes[g.endOffset];this._.guardLTR=function(b,a){return a&&(l==b||"body"==k.nodeName(b))?!1:b!=s}}if(b&&!this._.guardRTL){var o=g.startContainer[0],q=0<g.startOffset&&o.childNodes[g.startOffset-
1]||null;this._.guardRTL=function(b,a){return a&&(o==b||"body"==k.nodeName(b))?!1:b!=q}}var A=b?this._.guardRTL:this._.guardLTR;f=h?function(b,a){return A(b,a)===i?i:h(b,a)}:A;this.current?c=this.current[p](i,j,f):b?(c=g.endContainer,0<g.endOffset?(c=new n(c[0].childNodes[g.endOffset-1]),f(c[0])===i&&(c=e)):c=f(c,a)===i?e:c._4e_previousSourceNode(a,j,f,void 0)):(c=g.startContainer,c=new n(c[0].childNodes[g.startOffset]),c.length?f(c[0])===i&&(c=e):c=f(g.startContainer,a)===i?e:g.startContainer._4e_nextSourceNode(a,
j,f,void 0));for(;c&&!this._.end;){this.current=c;if(!this.evaluator||this.evaluator(c[0])!==i){if(!d)return c}else if(d&&this.evaluator)return i;c=c[p](i,j,f)}this.end();return this.current=e}function c(b){for(var a,d=e;a=l.call(this,b);)d=a;return d}function f(b){this.range=b;this.guard=this.evaluator=e;this._={}}var a=!0,i=!1,e=null,g=h.UA,k=h.DOM,p=j.XHTML_DTD,n=h.Node;h.augment(f,{end:function(){this._.end=1},next:function(){return l.call(this)},previous:function(){return l.call(this,a)},checkForward:function(){return l.call(this,
i,a)!==i},checkBackward:function(){return l.call(this,a,a)!==i},lastForward:function(){return c.call(this)},lastBackward:function(){return c.call(this,a)},reset:function(){delete this.current;this._={}},_iterator:l});h.mix(f,{blockBoundary:function(b){return function(a){return!(a.nodeType==k.ELEMENT_NODE&&k._4e_isBlockBoundary(a,b))}},bookmark:function(b,a){function d(b){return"span"==k.nodeName(b)&&k.attr(b,"_ke_bookmark")}return function(c){var e,g;e=c.nodeType==k.TEXT_NODE&&(g=c.parentNode)&&d(g);
e=b?e:e||d(c);return!!(a^e)}},whitespaces:function(b){return function(a){a=a.nodeType==k.TEXT_NODE&&!h.trim(a.nodeValue);return!!(b^a)}},invisible:function(b){var a=f.whitespaces();return function(d){d=a(d)||d.nodeType==k.ELEMENT_NODE&&!d.offsetHeight;return!!(b^d)}}});var o=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,d=f.whitespaces(),b=f.bookmark(),q=function(a){var c=k.nodeName(a);return b(a)||d(a)||1==a.nodeType&&c in p.$inline&&!(c in p.$empty)};j.Utils.injectDom({_4e_getBogus:function(b){b=new n(b);do b=
b._4e_previousSourceNode();while(b&&q(b[0]));return b&&(!g.ie?"br"==b.nodeName():3==b[0].nodeType&&o.test(b.text()))?b[0]:!1}});return j.Walker=f},{requires:["./base","./utils","./dom"]});KISSY.add("editor/core/zIndexManager",function(h){var j=h.Editor;j.zIndexManager={BUBBLE_VIEW:1100,POPUP_MENU:1200,STORE_FLASH_SHOW:99999,MAXIMIZE:900,OVERLAY:9999,LOADING:11E3,LOADING_CANCEL:12E3,SELECT:1200};j.baseZIndex=function(h){return(j.Config.baseZIndex||1E4)+h}},{requires:["./base"]});
KISSY.add("editor",function(h,j,l,c){function f(b,a){var c=b.body;r(function(){b.designMode="on";setTimeout(function(){b.designMode="off";c.focus();arguments.callee.retry||(arguments.callee.retry=p)},50)},function(){b.designMode="off";w.attr(c,"contentEditable",d);w.attr(c,"contentEditable",p);!a&&f(b,1)})}function a(b){var a=b.get("iframe"),e=b.get("textarea")[0],a=a[0].contentWindow,g=b.get("document")[0];q.webkit&&(t.on(g,"click",function(b){var a=new u(b.target);h.inArray(a.nodeName(),["input",
"select"])&&b.preventDefault()}),t.on(g,"mouseup",function(b){var a=new u(b.target);h.inArray(a.nodeName(),["input","textarea"])&&b.preventDefault()}));if(q.gecko||m||q.opera){var i;i=(new u('<span tabindex="-1" style="position:absolute; left:-10000" role="presentation"></span>')).insertAfter(e);i.on("focus",function(){b.focus()});b.activateGecko=function(){q.gecko&&b.__iframeFocus&&i[0].focus()};b.on("destroy",function(){i.detach();i.remove()})}t.on(a,"focus",function(){q.gecko?f(g,d):q.opera&&g.body.focus();
b.notifySelectionChange()});if(q.gecko)t.on(g,"mousedown",function(){b.__iframeFocus||f(g,d)});if(m&&(t.on(g,"keydown",function(a){if(a.keyCode in{8:1,46:1}){var d=b.getSelection(),c=d.getSelectedElement();if(c){b.fire("save");var e=d.getRanges()[0].createBookmark();c.remove();d.selectBookmarks([e]);b.fire("save");a.preventDefault()}}}),"CSS1Compat"==g.compatMode)){var k={33:1,34:1};t.on(g,"keydown",function(a){a.keyCode in k&&setTimeout(function(){b.getSelection().scrollIntoView()},0)})}if(q.webkit)t.on(g,
"mousedown",function(a){a=new u(a.target);h.inArray(a.nodeName(),["img","hr","input","textarea","select"])&&b.getSelection().selectElement(a)});if(q.gecko)t.on(g,"dragstart",function(b){var a=new u(b.target);a.nodeName()==="img"&&/ke_/.test(a[0].className)&&b.preventDefault()});c.add(b)}function i(a,d,c,e){var g="",f,i=l.debugUrl("theme/editor-iframe.css");if(c)for(f=0;f<c.length;f++)g+=h.substitute('<link href="{href}" rel="stylesheet" />',{href:c[f]});return h.substitute(x,{doctype:8===b.documentMode?
'<meta http-equiv="X-UA-Compatible" content="IE=7" />':"",title:"${title}",href:i,style:d||"",data:e||"&nbsp;",script:a?'<script id="ke_active_script">'+(w.isCustomDomain()?'document.domain="'+b.domain+'";':"")+'parent.KISSY.Editor._initIFrame("'+a+'");<\/script>':""})}function e(b,a){b.__saveTimer&&(clearTimeout(b.__saveTimer),b.__saveTimer=null);b.__saveTimer=setTimeout(function(){b.execCommand("save")},a||0)}function g(b,a){function d(){k=f.document;b.__set("document",new u(k));b.__set("window",
new u(f));c.detach();k.open("text/html","replace");k.write(e);k.close()}var c=b.get("iframe"),e=i(b._UUID,b.get("customStyle"),b.get("customLink"),a),g=c[0],f=g.contentWindow,k;c.__loaded=1;try{k=f.document}catch(h){if(g.src=g.src,7>m){setTimeout(d,10);return}}d()}function k(b,a){var d=new u(z),c=b.get("textarea");c.hasAttr("tabindex")&&d.attr("tabIndex",q.webkit?-1:c.attr("tabIndex"));b.get("iframeWrapEl").prepend(d);b.set("iframe",d);b.__docReady=0;if(q.gecko&&!d.__loaded)d.on("load",function(){g(b,
a)},b);else g(b,a)}var p=!0,n=n,o=h.all,d=!1,b=document,q=h.UA,m=q.ie,w=h.DOM,u=h.Node,t=h.Event,r=l.tryThese,x="<!doctype html><html><head>{doctype}<title>{title}</title><link href='{href}' rel='stylesheet' /><style>{style}</style>{links}</head><body class='ke-editor'>{data}{script}</body></html>",y=w.getEmptyIframeSrc(),z='<iframe style="width:100%;height:100%;border:none;"  frameborder="0"  title="kissy-editor"  allowTransparency="true" '+(y?' src="'+y+'"':"")+"</iframe>";h.mix(j,{SOURCE_MODE:0,
WYSIWYG_MODE:1});var v=j.WYSIWYG_MODE;h.augment(j,{createDom:function(){var b,a=this.get("textarea"),d;a||this.set("textarea",a=o("<textarea></textarea>"));d=this.get("el");d.addClass(this.get("prefixCls")+"editor-wrap",n);d.html('<div class="ke-editor-tools"></div><div class="ke-textarea-wrap"></div><div class=\'ke-editor-status\'></div>');this._UUID=h.guid();this.set({iframeWrapEl:b=d.one(".ke-textarea-wrap"),toolBarEl:d.one(".ke-editor-tools"),statusBarEl:d.one(".ke-editor-status")},{silent:1});
a.css("width","100%");a.css("display","none");b.append(a);c.register(this)},_uiSetHeight:function(b){var a=this.get("toolBarEl"),d=this.get("statusBarEl"),b=parseInt(b,10),b=b-((a&&a.outerHeight()||0)+(d&&d.outerHeight()||0));this.get("iframeWrapEl").css("height",b);this.get("textarea").css("height",b)},_uiSetMode:function(b){var a=this,d,c=a.get("iframe"),e=a.get("textarea");b==v?(a.execCommand("save"),a.on("docReady",d=function(){a.execCommand("save");a.detach("docReady",d)}),a._setData(e.val()),
a.fire("wysiwygMode")):(e.val(a._getData(1,v)),e[0].focus(),e.show(),c.hide(),a.fire("sourceMode"))},_uiSetFocused:function(b){b&&this.__docReady&&this.focus()},bindUI:function(){function b(){a.detach("docReady",b);if(a.get("focused"))a.focus();else{var d=a.getSelection();d&&d.removeAllRanges()}}var a=this,d,c=a.get("textarea");if(a.get("attachForm")&&(d=c[0].form))w.on(d,"submit",a.sync,a),a.on("destroy",function(){w.detach(d,"submit",a.sync,a)});a.on("docReady",b)},destructor:function(){var b=this.get("el"),
a=this.get("textarea"),d=this.get("document")[0],e=this.get("iframe")[0].contentWindow;this.sync();c.remove(this);t.remove([d,d.documentElement,d.body,e]);h.each(this.__dialogs,function(b){b.destroy&&b.destroy()});this.__commands=0;this.__editor_created_new||(a.insertBefore(b,n),a.css({width:this.get("width"),height:this.get("height")}),a.show())},addDialog:function(b,a){this.__dialogs[b]=a},showDialog:function(b,a){var d=this.__dialogs[b];d.show(a);this.fire("dialogShow",{dialog:d.dialog,pluginDialog:d,
dialogName:b})},hasDialog:function(b){return!!this.__dialogs[b]},addCommand:function(b,a){this.__commands[b]=a},hasCommand:function(b){return this.__commands[b]},execCommand:function(b){var a=this.__commands[b],d=h.makeArray(arguments);d.shift();d.unshift(this);if(a)return a.exec.apply(a,d)},_getData:function(b,a){var d=this.htmlDataProcessor,c;a==n&&(a=this.get("mode"));c=a==v?this.get("document")[0].body.innerHTML:d.toDataFormat(this.get("textarea").val());c=b?d.toHtml(c):d.toServer(c);c=h.trim(c);
/^(?:<(p)>)?(?:(?:&nbsp;)|\s)*(?:<\/\1>)?$/.test(c)&&(c="");return c},_setData:function(b){var a,d=b;if(this.get("mode")!=v)this.get("textarea").val(b);else{if(a=this.htmlDataProcessor)d=a.toDataFormat(b,"p");if(this.get("iframe")){b=this.get("iframe");a=b[0].contentWindow;var c=this.get("document")[0];t.remove([c,c.documentElement,c.body,a]);b.remove()}k(this,d)}},sync:function(){this.get("textarea").val(this.get("data"))},getDocHtml:function(){return i(0,this.get("customStyle"),this.get("customLink"),
this.get("formatData"))},getSelection:function(){return j.Selection.getSelection(this.get("document")[0])},focus:function(){var b=this.get("document")[0],a=w._4e_getWin(b);q.ie||a&&a.parent&&a.parent.focus();a&&a.focus();b.body.focus();this.notifySelectionChange()},blur:function(){w._4e_getWin(this.get("document")[0]).blur();this.get("document")[0].body.blur()},addCustomStyle:function(b,a){var d=this.get("customStyle")||"",d=d+("\n"+b);this.set("customStyle",d);w.addStyleSheet(this.get("iframe")[0].contentWindow,
d,a)},removeCustomStyle:function(b){w.remove(w.get("#"+b,this.get("iframe")[0].contentWindow))},addCustomLink:function(b){var a=this.get("customLink")||[],d=this.get("document")[0];a.push(b);this.set("customLink",a);a=d.createElement("link");a.rel="stylesheet";d.getElementsByTagName("head")[0].appendChild(a);a.href=b},removeCustomLink:function(b){for(var a=this.get("document")[0],a=w.query("link",a),d=0;d<a.length;d++)w.attr(a[d],"href")==b&&w.remove(a[d]);a=this.get("customLink")||[];b=h.indexOf(b,
a);-1!=b&&a.splice(b,1)},docReady:function(b){this.on("docReady",b);this.__docReady&&b.call(this)},checkSelectionChange:function(){var b=this;b.__checkSelectionChangeId&&clearTimeout(b.__checkSelectionChangeId);b.__checkSelectionChangeId=setTimeout(function(){var a=b.getSelection();if(a&&!a.isInvalid){var d=a.getStartElement(),c=new j.ElementPath(d);if(!b.__previousPath||!b.__previousPath.compare(c))b.__previousPath=c,b.fire("selectionChange",{selection:a,path:c,element:d})}},100)},notifySelectionChange:function(){this.__previousPath=
null;this.checkSelectionChange()},insertElement:function(b,a,d){var c=this;if(c.get("mode")===v){c.focus();var g,f=b.nodeName(),i=j.XHTML_DTD,k=i.$block[f],h=j.RANGE,m=(f=c.getSelection())&&f.getRanges(),l,o,q;if(!m||0==m.length){var r=arguments,y=r.callee;setTimeout(function(){y.apply(c,r)},30)}else{c.execCommand("save");for(o=m.length-1;0<=o;o--)l=m[o],g=!o&&b||b.clone(p),a&&a(g),l.insertNodeByDtd(g),q||(q=g);q&&(l.moveToPosition(q,h.POSITION_AFTER_END),k&&(k=j.Walker.whitespaces(!0),(k=(q=q.next(k))&&
q[0].nodeType==w.ELEMENT_NODE&&q.nodeName())&&i.$block[k]&&i[k]["#"]&&l.moveToElementEditablePosition(q)),f.selectRanges([l]),c.focus(),g&&g.scrollIntoView(n,!1),e(c),d&&d(g))}}},insertHtml:function(b,a){var c=this,g;if(c.get("mode")===v){if(g=c.htmlDataProcessor)b=g.toDataFormat(b,null,a);c.focus();c.execCommand("save");var f=c.get("document")[0];g=0;if(m){var i=f.selection;"Control"==i.type&&i.clear();try{i.createRange().pasteHTML(b)}catch(k){}}else try{f.execCommand("inserthtml",d,b)}catch(h){setTimeout(function(){if(0==
c.getSelection().getRanges().length){var a=new j.Range(f),e=w.first(f.body,function(b){return 1==b.nodeType&&"br"!=w.nodeName(b)});e||(e=new u(f.createElement("p")),e._4e_appendBogus(n),f.body.appendChild(e[0]));a.setStartAt(e,j.RANGE.POSITION_AFTER_START);a.select()}f.execCommand("inserthtml",d,b)},g=100)}setTimeout(function(){c.getSelection().scrollIntoView()},g);e(c,g)}}});j._initIFrame=function(b){var e=c.getInstance(b),g=e.get("document")[0],b=g.getElementById("ke_active_script");w.remove(b);
a(e);var i=g.body;m?(i.hideFocus=p,i.disabled=p,i.contentEditable=p,i.removeAttribute("disabled")):setTimeout(function(){q.gecko||q.opera?i.contentEditable=p:q.webkit?i.parentNode.contentEditable=p:g.designMode="on"},0);if(q.gecko||q.opera){var k=g.documentElement;t.on(k,"mousedown",function(b){if(b.target==k){q.gecko&&f(g,d);e.activateGecko()}})}setTimeout(function(){m&&setTimeout(function(){if(g){i.runtimeStyle.marginBottom="0px";i.runtimeStyle.marginBottom=""}},1E3)},0);setTimeout(function(){e.__docReady=
1;e.fire("docReady");var b=e.get("disableObjectResizing"),a=e.get("disableInlineTableEditing");if(b||a)try{g.execCommand("enableObjectResizing",d,!b);g.execCommand("enableInlineTableEditing",d,!a)}catch(c){t.on(i,m?"resizestart":"resize",function(d){var c=new u(d.target);(b||c.nodeName()==="table"&&a)&&d.preventDefault()})}},10)};return j},{requires:"editor/core/base,editor/core/utils,editor/core/focusManager,editor/core/styles,editor/core/zIndexManager,editor/core/focusManager,editor/core/meta".split(",")});
KISSY.add("editor/plugin/backColor/cmd",function(h,j){var l={element:"span",styles:{"background-color":"#(color)"},overrides:[{element:"*",styles:{"background-color":null}}],childRule:function(){return!1}};return{init:function(c){c.hasCommand("backColor")||c.addCommand("backColor",{exec:function(c,a){c.execCommand("save");j.applyColor(c,a,l);c.execCommand("save")}})}}},{requires:["../color/cmd"]});
KISSY.add("editor/plugin/backColor/index",function(h,j,l,c){return{init:function(f){c.init(f);f.addButton({cmdType:"backColor",title:"\u80cc\u666f\u989c\u8272",contentCls:"ke-toolbar-back-color"},void 0,l)}}},{requires:["editor","../color/btn","./cmd"]});KISSY.add("editor/plugin/bold/cmd",function(h,j,l){var c=new j.Style({element:"strong",overrides:[{element:"b"},{element:"span",attributes:{style:"font-weight: bold;"}}]});return{init:function(f){l.addButtonCmd(f,"bold",c)}}},{requires:["editor","../font/cmd"]});
KISSY.add("editor/plugin/bold/index",function(h,j,l,c){return{init:function(f){c.init(f);f.addButton({cmdType:"bold",contentCls:"ke-toolbar-bold",title:"\u7c97\u4f53 "},void 0,l.Button)}}},{requires:["editor","../font/ui","./cmd"]});
KISSY.add("editor/plugin/bubbleview/index",function(h,j,l){function c(a){var c=null,e=g[h.stamp(a.editor)];h.each(e,function(e){var d;if(d=e!==a)if(d=e.get("visible")){d=a.get("y");var b=d+a.get("el").outerHeight(),g=e.get("y"),f=g+e.get("el").outerHeight();d=d<=f&&b>=f||d<=g&&b>=g}d&&(c?c.get("y")<e.get("y")&&(c=e):c=e);return c})}var f=h.Event,a={}.a,i=h.DOM,e=j.extend({ATTRS:{zIndex:{value:l.baseZIndex(l.zIndexManager.BUBBLE_VIEW)},elCls:{value:"ke-bubbleview-bubble"},prefixCls:{value:"ke-"},effect:{value:{effect:"fade",
duration:0.3}}}}),g={};e.register=function(k){function j(){m&&(m.hide(),f.remove(t,"scroll",l))}function n(){var b;var d=m.selectedEl,e=m.editor;if(d){var g=e.get("iframe")[0].contentWindow,f=e.get("iframe").offset(),e=f.top,f=f.left,k=f+i.width(g),g=e+i.height(g),h=d.offset(a,window),j=h.top,h=h.left,n=h+d.width(),d=j+d.height(),p;d>g&&j<g?p=g-30:d>e&&d<g&&(p=d);n>f&&h<f?b=f:h>f&&h<k&&(b=h);b=b!==a&&p!==a?[b,p]:a}else b=a;if(b){m.set("xy",b);if(p=c(m))b[1]=p.get("y")+p.get("el").outerHeight(),m.set("xy",
b);m.get("visible")||m.show()}}function l(){m.selectedEl&&(m&&(m.get("el"),m.hide()),r())}function d(){f.on(t,"scroll",l);n()}var b=k.filter,q=k.editor,m=new e({editor:q}),w=h.stamp(q),u=g[w]=g[w]||[];m.init=k.init;if(m.init)m.on("afterRenderUI",function(){m.init()});u.push(m);m.editor=q;q.on("destroy",function(){delete g[w];m.destroy()});q.on("selectionChange",function(a){var a=a.path,c=a.elements;if(a&&c&&(a=a.lastElement))(a=b(a))?(m.selectedEl=a,m.hide(),h.later(d,10)):m&&j()});q.on("sourceMode",
j);var t=q.get("iframe")[0].contentWindow,r=h.buffer(n,350)};return e},{requires:["overlay","editor"]});
KISSY.add("editor/plugin/button/index",function(h,j,l){function c(a){return a&&-1==a.indexOf("<")?a:0}var f=l.define([l.UIBase.Box.Render],{_updateHref:function(){this.get("el").attr("href","javascript:void('"+(c(this.get("text"))||c(this.get("title")))+"')")},bindUI:function(){var a=this,c=a.get("keepFocus"),e=a.get("el");e.on("click",a._action,a);c&&e.unselectable();e.on("mousedown",function(g){"off"==a.get("state")&&e.addClass("ke-triplebutton-active");c&&g.halt()});e.on("mouseup mouseleave",function(){"off"==
a.get("state")&&e.hasClass("ke-triplebutton-active")&&setTimeout(function(){e.removeClass("ke-triplebutton-active")},300)})},_uiSetTitle:function(){this.get("el").attr("title",this.get("title"));this._updateHref()},_uiSetContentCls:function(a){var c=this.get("el");void 0!==a&&(c.html("<span class='ke-toolbar-item "+a+"' />"),this.get("keepFocus")&&c.unselectable(void 0))},_uiSetText:function(a){this.get("el").html(a);this._updateHref()},_uiSetState:function(a,c){this["_"+a](c)},disable:function(){this.set("state",
"disabled")},enable:function(){"disabled"==this.get("state")&&this.set("state",this._savedState)},_action:function(a){this.fire(this.get("state")+"Click",{TripleEvent:a});this.fire("click",{TripleClickType:this.get("state")+"Click"});this.get("keepFocus")||this.get("el")[0].focus()},bon:function(){this.set("state","on")},boff:function(){this.set("state","off")},_on:function(){this.get("el").removeClass("ke-triplebutton-off ke-triplebutton-disabled").addClass("ke-triplebutton-on")},_off:function(){this.get("el").removeClass("ke-triplebutton-on ke-triplebutton-disabled").addClass("ke-triplebutton-off")},
_disabled:function(a){var c=this.get("el");this._savedState=a.prevVal;c.removeClass("ke-triplebutton-off ke-triplebutton-on").addClass("ke-triplebutton-disabled")}},{name:"editor/plugin/button",ATTRS:{state:{value:"off"},elCls:{value:"ke-triplebutton ke-triplebutton-off"},elTagName:{value:"a"},title:{},contentCls:{},text:{},keepFocus:{value:!0}}});f.ON="on";f.OFF="off";f.DISABLED="disabled";f.ON_CLASS="ke-triplebutton-on";f.OFF_CLASS="ke-triplebutton-off";f.DISABLED_CLASS="ke-triplebutton-disabled";
j.TripleButton=f;j.prototype.addButton=function(a,c,e){var e=e||f,g=this,k=new e(h.mix({render:g.get("toolBarEl"),autoRender:!0,editor:g},a));h.mix(k,c);k.init&&k.init();g.on("selectionChange",function(){g.get("mode")!=j.SOURCE_MODE&&k.selectionChange&&k.selectionChange.apply(k,arguments)});k.on("click",function(a){var c=a.TripleClickType;k[c]&&k[c].apply(k,arguments)});k.get("mode")==j.WYSIWYG_MODE&&(g.on("wysiwygMode",k.enable,k),g.on("sourceMode",k.disable,k));g.on("destroy",function(){k.destroy()});
return k};return f},{requires:["editor","component"]});
KISSY.add("editor/plugin/checkboxSourcearea/index",function(h,j){function l(a){this.editor=a;this._init()}var c=h.Node,f=j.SOURCE_MODE,a=j.WYSIWYG_MODE;h.augment(l,{_init:function(){var a=this.editor,e=a.get("statusBarEl");this.holder=(new c("<span style='zoom:1;display:inline-block;height:22px;line-height:22px;'><input style='margin:0 5px;vertical-align:middle;' type='checkbox' /><span style='vertical-align:middle;'>\u7f16\u8f91\u6e90\u4ee3\u7801</span></span>")).appendTo(e);(this.el=this.holder.one("input")).on("click",
this._check,this);a.on("wysiwygMode",this._wysiwygmode,this);a.on("sourceMode",this._sourcemode,this)},_sourcemode:function(){this.el.attr("checked",!0)},_wysiwygmode:function(){this.el.attr("checked",!1)},_check:function(){var c=this.editor;this.el.attr("checked")?c.set("mode",f):c.set("mode",a)},destroy:function(){this.holder.remove()}});return{init:function(a){var c=new l(a);a.on("destroy",function(){c.destroy()})}}},{requires:["editor"]});
KISSY.add("editor/plugin/color/btn",function(h,j,l,c,f){function a(){a.superclass.constructor.apply(this,arguments)}var i=h.Node;h.DOM.addStyleSheet(".ke-color-panel a {display: block;color:black;text-decoration: none;}.ke-color-panel a:hover {color:black;text-decoration: none;}.ke-color-panel a:active {color:black;}.ke-color-palette {    margin: 5px 8px 8px;}.ke-color-palette table {    border: 1px solid #666666;    border-collapse: collapse;}.ke-color-palette td {    border-right: 1px solid #666666;    height: 18px;    width: 18px;}a.ke-color-a {    height: 18px;    width: 18px;}a.ke-color-a:hover {    border: 1px solid #ffffff;    height: 16px;    width: 16px;}a.ke-color-remove {  padding:3px 8px;  margin:2px 0 3px 0;}a.ke-color-remove:hover {    background-color: #D6E9F8;}",
"ke-color-plugin");var e=["000,444,666,999,CCC,EEE,F3F3F3,FFF".split(","),"F00,F90,FF0,0F0,0FF,00F,90F,F0F".split(","),"F4CCCC,FCE5CD,FFF2CC,D9EAD3,D0E0E3,CFE2F3,D9D2E9,EAD1DC,EA9999,F9CB9C,FFE599,B6D7A8,A2C4C9,9FC5E8,B4A7D6,D5A6BD,E06666,F6B26B,FFD966,93C47D,76A5AF,6FA8DC,8E7CC3,C27BAD,CC0000,E69138,F1C232,6AA84F,45818E,3D85C6,674EA7,A64D79,990000,B45F06,BF9000,38761D,134F5C,0B5394,351C75,741B47,660000,783F04,7F6000,274E13,0C343D,073763,20124D,4C1130".split(",")],g;(function(){g="<div class='ke-color-panel'><a class='ke-color-remove' href=\"javascript:void('\u6e05\u9664');\">\u6e05\u9664</a>";
for(var a=0;3>a;a++){g+="<div class='ke-color-palette'><table>";for(var c=e[a],f=c.length/8,i=0;i<f;i++){g+="<tr>";for(var d=0;8>d;d++){var b="#"+c[8*i+d];g+="<td>";g+="<a href='javascript:void(0);' class='ke-color-a' style='background-color:"+b+"'></a>";g+="</td>"}g+="</tr>"}g+="</table></div>"}g+="<div><a class='ke-button ke-color-others'>\u5176\u4ed6\u989c\u8272</a></div></div>"})();h.extend(a,l,{offClick:function(){this._prepare()},onClick:function(){this.colorWin&&this.colorWin.hide()},_prepare:function(){var a=
this,e=a.get("editor"),i;a.colorWin=new c({elAttrs:{tabindex:0},elCls:"ke-popup",content:g,autoRender:!0,width:170,zIndex:j.baseZIndex(j.zIndexManager.POPUP_MENU)});var h=a.colorWin;i=h.get("contentEl");i.on("click",a._selectColor,a);h.get("el").on("blur",function(){h.hide()});h.on("show",a.bon,a);h.on("hide",a.boff,a);i.one(".ke-color-others").on("click",function(d){d.halt();h.hide();f.useDialog(e,"color/colorPicker/dialog",a.get("cmdType"))});a._prepare=a._show;a._show()},_show:function(){var a=
this.get("el"),c=this.colorWin;c.align(a,["bl","tl"],[0,2]);c.show();c.get("el")[0].focus()},_selectColor:function(a){a.halt();a=new i(a.target);a.hasClass("ke-color-a")&&this.get("editor").execCommand(this.get("cmdType"),a.style("background-color"))},destroy:function(){this.colorWin&&this.colorWin.destroy()}},{ATTRS:{mode:{value:j.WYSIWYG_MODE}}});return a},{requires:["editor","../button/","../overlay/","../dialogLoader/"]});
KISSY.add("editor/plugin/color/cmd",function(h,j){return{applyColor:function(h,c,f){var a=h.get("document")[0];h.execCommand("save");c?(new j.Style(f,{color:c})).apply(a):(new j.Style(f,{color:"inherit"})).remove(a);h.execCommand("save")}}},{requires:["editor"]});
KISSY.add("editor/plugin/contextmenu/index",function(h,j,l){function c(){c.superclass.constructor.apply(this,arguments)}var f=h.all,a=h.Event;c.register=function(e){function g(){i.hide()}var i=new c(e),h=e.editor;i.editor=h;h.on("destroy",function(){i.destroy()});h.on("sourceMode",g);h.docReady(function(){var n=h.get("document")[0];a.on(n,"mousedown",g);a.delegate(n,"contextmenu",e.filter,function(a){c.hide(h);var d=f(a.target);a.halt();var b=a.pageX,e=a.pageY;b||(a=d._4e_getOffset(void 0),b=a.left,
e=a.top);setTimeout(function(){i.selectedEl=d;i.show(j.Utils.getXY(b,e,n,document));c.show(i)},30)})});return i};var i={};c.hide=function(a){(a=i[h.stamp(a)])&&a.hide()};c.show=function(a){i[h.stamp(a.editor)]=a};h.extend(c,h.Base,{_init:function(){var a=this,c=a.get("handlers");a.menu=new l({autoRender:!0,width:a.get("width"),elCls:"ke-menu"});var i=a.menu.get("contentEl"),j;for(j in c){var n=f("<a href='#'>"+j+"</a>");i.append(n);c.hasOwnProperty(j)&&function(c,d){c.unselectable(void 0);c.on("click",
function(b){b.halt();c.hasClass("ke-menuitem-disable",void 0)||(a.hide(),h.later(d,30,!1,a))})}(n,c[j])}},destroy:function(){var a;(a=this.menu)&&a.destroy()},hide:function(){var a;(a=this.menu)&&a.hide()},_realShow:function(a){var c=this.menu;j.fire("contextmenu",{contextmenu:this});c.set("xy",[a.left,a.top]);var f=this.get("statusChecker"),i=this.editor;f&&c.get("contentEl").children("a").each(function(a){var c=f[h.trim(a.text())];c&&(c(i)?a.removeClass("ke-menuitem-disable",void 0):a.addClass("ke-menuitem-disable",
void 0))});c.show()},show:function(a){this._init();this.show=this._realShow;this.show(a)}});return c},{requires:["editor","overlay"]});
KISSY.add("editor/plugin/dentUtils/cmd",function(h,j,l){function c(b){return b.nodeType==g.ELEMENT_NODE&&"li"==g.nodeName(b)}function f(b,a,d){for(var c=b.startContainer,e=b.endContainer;c&&!c.parent().equals(a);)c=c.parent();for(;e&&!e.parent().equals(a);)e=e.parent();if(c&&e){for(var f=c,c=[],h=!1;!h;)f.equals(e)&&(h=!0),c.push(f),f=f.next();if(!(1>c.length)){var o=a._4e_parents(!0,void 0);o.each(function(b,a){o[a]=b});for(e=0;e<o.length;e++)if(i[o[e].nodeName()]){a=o[e];break}for(var f="indent"==
d?1:-1,e=c[0],h=c[c.length-1],c={},v=l.listToArray(a,c),s=v[h.data("listarray_index")].indent,e=e.data("listarray_index");e<=h.data("listarray_index");e++){v[e].indent+=f;var B=v[e].parent;v[e].parent=new k(B[0].ownerDocument.createElement(B.nodeName()))}for(e=h.data("listarray_index")+1;e<v.length&&v[e].indent>s;e++)v[e].indent+=f;h=l.arrayToList(v,c,null,"p");f=[];if("outdent"==d){var C;if((C=a.parent())&&"li"==C.nodeName())for(var d=h.listNode.childNodes,A,e=d.length-1;0<=e;e--)(A=new k(d[e]))&&
"li"==A.nodeName()&&f.push(A)}h&&(g.insertBefore(h.listNode[0]||h.listNode,a[0]||a),a.remove());if(f&&f.length)for(e=0;e<f.length;e++){for(A=a=f[e];(A=A.next())&&A.nodeName()in i;)p.ie&&!a.first(function(b){return n(b)&&q(b)})&&a[0].appendChild(b.document.createTextNode("\u00a0")),a[0].appendChild(A[0]);g.insertAfter(a[0],C[0])}j.Utils.clearAllMarkers(c)}}}function a(a,c){var e=parseInt(a.style(o),10);isNaN(e)&&(e=0);e+=("indent"==c?1:-1)*d;if(0>e)return!1;e=Math.max(e,0);e=Math.ceil(e/d)*d;a.css(o,e?
e+b:"");""===a[0].style.cssText&&a.removeAttr("style");return!0}var i={ol:1,ul:1},e=j.Walker,g=h.DOM,k=h.Node,p=h.UA,n=e.whitespaces(!0),o="margin-left",d=40,b="px",q=e.bookmark(!1,!0);return{checkOutdentActive:function(b){var a=b.blockLimit;return b.contains(i)?!0:(b=b.block||a)&&b.style(o)},addCommand:function(b,d){b.hasCommand(d)||b.addCommand(d,{exec:function(b){b.execCommand("save");var h=b.getSelection(),k=h&&h.getRanges()[0];if(k){for(var j=k.startContainer,n=k.endContainer,m=k.getCommonAncestor();m&&
!(m[0].nodeType==g.ELEMENT_NODE&&i[m.nodeName()]);)m=m.parent();m&&j[0].nodeType==g.ELEMENT_NODE&&j.nodeName()in i&&(j=new e(k),j.evaluator=c,k.startContainer=j.next());m&&n[0].nodeType==g.ELEMENT_NODE&&n.nodeName()in i&&(j=new e(k),j.evaluator=c,k.endContainer=j.previous());n=h.createBookmarks(!0);if(m){for(j=m.first();j&&"li"!=j.nodeName();)j=j.next();var p=k.startContainer;(!(j[0]==p[0]||j.contains(p))||!a(m,d))&&f(k,m,d)}else{k=k.createIterator();k.enforceRealBlocks=!0;for(k.enlargeBr=!0;m=k.getNextParagraph();)a(m,
d)}h.selectBookmarks(n)}b.execCommand("save");b.notifySelectionChange()}})}}},{requires:["editor","../listUtils/"]});
KISSY.add("editor/plugin/dialogLoader/index",function(h,j,l){var c,f={loading:function(){c||(c=new j({x:0,width:6==h.UA.ie?h.DOM.docWidth():"100%",y:0,zIndex:l.baseZIndex(l.zIndexManager.LOADING),prefixCls:"ke-",elCls:"ke-global-loading"}));c.set("height",h.DOM.docHeight());c.show();c.loading()},unloading:function(){c.hide()}};return{useDialog:function(a,c,e){a.hasDialog(c)?a.showDialog(c,e):(f.loading(),h.use("editor/plugin/"+c,function(g,h){f.unloading();a.addDialog(c,new h(a));a.showDialog(c,e)}))}}},
{requires:["overlay","editor"]});
KISSY.add("editor/plugin/draft/index",function(h,j,l,c,f){function a(b,a,d){for(b+="";b.length<a;)b=d+b;return b}function i(b){h.isNumber(b)&&(b=new Date(b));return b instanceof Date?[b.getFullYear(),"-",a(b.getMonth()+1,2,"0"),"-",a(b.getDate(),2,"0")," ",a(b.getHours(),2,"0"),":",a(b.getMinutes(),2,"0"),":",a(b.getSeconds(),2,"0")].join(""):b}function e(b){this.editor=b;this._init()}function g(b){var a=new e(b);b.on("destroy",function(){a.destroy()})}var k=h.Node,p=h.Event,n=h.JSON,o=j.Utils.addRes,
d=j.Utils.destroyRes;h.augment(e,{_getSaveKey:function(){var b=this.editor.get("pluginConfig");return b.draft&&b.draft.saveKey||"ke-draft-save20110503"},_getDrafts:function(){if(!this.drafts){var b=l.getItem(this._getSaveKey()),a=[];b&&(a=l==window.localStorage?n.parse(decodeURIComponent(b)):b);this.drafts=a}return this.drafts},_init:function(){var b=this,a=b.editor,d=a.get("statusBarEl"),c=a.get("pluginConfig");c.draft=c.draft||{};b.draftInterval=c.draft.interval=c.draft.interval||5;b.draftLimit=
c.draft.limit=c.draft.limit||5;d=(new k("<div class='ke-draft'><span class='ke-draft-title'>\u5185\u5bb9\u6b63\u6587\u6bcf"+c.draft.interval+"\u5206\u949f\u81ea\u52a8\u4fdd\u5b58\u4e00\u6b21\u3002</span></div>")).appendTo(d);b.timeTip=(new k("<span class='ke-draft-time'/>")).appendTo(d);var e=(new k("<a href='#' onclick='return false;' class='ke-button ke-draft-save-btn' style='vertical-align:middle;padding:1px 9px;'><span class='ke-draft-mansave'></span><span>\u7acb\u5373\u4fdd\u5b58</span></a>")).unselectable().appendTo(d),g=new f({container:d,menuContainer:document.body,doc:a.get("document")[0],
width:"85px",popUpWidth:"225px",align:["r","t"],emptyText:"&nbsp;&nbsp;&nbsp;\u5c1a\u65e0\u7f16\u8f91\u5668\u5386\u53f2\u5b58\u5728",title:"\u6062\u590d\u7f16\u8f91\u5386\u53f2"});b.versions=g;g.on("select",function(){g.detach("select",arguments.callee);b.sync()});e.on("click",function(a){b.save(!1);a.halt()});o.call(b,e);a.get("textarea")[0].form&&function(){function d(){b.save(!0)}var c=a.get("textarea")[0].form;p.on(c,"submit",d);o.call(b,function(){p.remove(c,"submit",d)})}();var i=setInterval(function(){b.save(!0)},6E4*b.draftInterval);o.call(b,function(){clearInterval(i)});
g.on("click",b.recover,b);o.call(b,g);b.holder=d;if(c.draft.helpHtml){var h=(new k('<a tabindex="0" hidefocus="hidefocus" class="ke-draft-help ke-triplebutton-off" title="\u70b9\u51fb\u67e5\u770b\u5e2e\u52a9" href="javascript:void(\'\u70b9\u51fb\u67e5\u770b\u5e2e\u52a9 \')">\u70b9\u51fb\u67e5\u770b\u5e2e\u52a9</a>')).unselectable().appendTo(d);h.on("click",function(){h[0].focus();b.helpPopup&&b.helpPopup.get("visible")?b.helpPopup.hide():b._prepareHelp()});h.on("blur",function(){b.helpPopup&&b.helpPopup.hide()});b.helpBtn=h;o.call(b,h);j.Utils.lazyRun(b,"_prepareHelp","_realHelp")}o.call(b,
d)},_prepareHelp:function(){var b=this.editor.get("pluginConfig").draft,b=new k(b.helpHtml||""),a=new k("<div style='height:0;position:absolute;fontSize:0;width:0;border:8px #000 solid;border-color:#000 transparent transparent transparent;border-style:solid dashed dashed dashed;border-top-color:#CED5E0;'><div style='height:0;position:absolute;fontSize:0;width:0;border:8px #000 solid;border-color:#000 transparent transparent transparent;border-style:solid dashed dashed dashed;left:-8px;top:-10px;border-top-color:white;'></div></div>");
b.append(a);b.css({border:"1px solid #ACB4BE","text-align":"left"});this.helpPopup=new c({content:b,autoRender:!0,width:b.width()+"px",mask:!1});this.helpPopup.get("el").css("border","none");this.helpPopup.arrow=a},_realHelp:function(){var b=this.helpPopup,a=this.helpBtn,d=b.arrow;b.show();a=a.offset();b.get("el").offset({left:a.left-b.get("el").width()+17,top:a.top-b.get("el").height()-7});d.offset({left:a.left-2,top:a.top-8})},disable:function(){this.holder.css("visibility","hidden")},enable:function(){this.holder.css("visibility",
"")},sync:function(){var b=this.draftLimit,a=this.timeTip,d=this.versions,c=this._getDrafts();c.length>b&&c.splice(0,c.length-b);for(var b=[],e,g=0;g<c.length;g++)e=c[g],e=(e.auto?"\u81ea\u52a8":"\u624b\u52a8")+"\u4fdd\u5b58\u4e8e : "+i(e.date),b.push({name:e,value:g});d.set("items",b.reverse());a.html(e);l.setItem(this._getSaveKey(),l==window.localStorage?encodeURIComponent(n.stringify(c)):c)},save:function(b){var a=this._getDrafts(),d=this.editor.get("formatData");d&&(a[a.length-1]&&d==a[a.length-1].content&&(a.length-=1),this.drafts=
a.concat({content:d,date:(new Date).getTime(),auto:b}),this.sync())},recover:function(a){var d=this.editor,c=this.versions,e=this._getDrafts(),g=a.newVal;c.reset("value");confirm("\u786e\u8ba4\u6062\u590d "+i(e[g].date)+" \u7684\u7f16\u8f91\u5386\u53f2\uff1f")&&(d.execCommand("save"),d.set("data",e[g].content),d.execCommand("save"));a.halt()},destroy:function(){d.call(this)}});return{init:function(a){l.ready?l.ready(function(){g(a)}):g(a)}}},{requires:["editor","../localStorage/","overlay","../select/"]});
KISSY.add("editor/plugin/dragUpload/index",function(h,j){var l=h.Node,c=h.Event,f=j.Utils,a=h.DOM;return h.UA.ie?void 0:{init:function(i){function e(b){b=b.originalEvent.target;"img"==a.nodeName(b)&&b.src.match(/^file:\/\//)&&(m[b.src]=b)}function g(a,b){var c=new window.FileReader;c.onload=function(e){var g=a.name,e=e.target.result,f=new XMLHttpRequest;f.open("POST",d,!0);f.onreadystatechange=function(){if(4==f.readyState){if(200==f.status||304==f.status){if(""!=f.responseText){var a=window.JSON.parse(f.responseText);
b[0].src=a.imgUrl}}else alert("\u670d\u52a1\u5668\u7aef\u51fa\u9519\uff01"),b.remove();f.onreadystatechange=null}};g="\r\n------kissy-editor-yiminghe\r\n"+('Content-Disposition: form-data; name="'+p+'"; filename="'+encodeURIComponent(g)+'"\r\n');g+="Content-Type: "+(a.type||"application/octet-stream")+"\r\n\r\n";g+=e+"\r\n";o=j.Utils.normParams(o);for(var i in o)o.hasOwnProperty(i)&&(g+="------kissy-editor-yiminghe\r\n",g+='Content-Disposition: form-data; name="'+i+'"\r\n\r\n',g+=o[i]+"\r\n");g+="------kissy-editor-yiminghe--";f.setRequestHeader("Content-Type",
"multipart/form-data, boundary=----kissy-editor-yiminghe");f.sendAsBinary("Content-Type: multipart/form-data; boundary=----kissy-editor-yiminghe\r\nContent-Length: "+g.length+"\r\n"+g+"\r\n");c.onload=null};c.readAsBinaryString(a)}var k=i.get("pluginConfig").dragUpload||{},p=k.fileInput||"Filedata",n=k.sizeLimit||Number.MAX_VALUE,o=k.serverParams||{},d=k.serverUrl||"",b=RegExp((k.suffix||"png,jpg,jpeg,gif").split(/,/).join("|")+"$","i"),q=i.get("document")[0],m={},w=!1;c.on(q,"dragenter",function(){w||
(c.on(q,"DOMNodeInserted",e),w=!0)});c.on(q,"drop",function(d){c.remove(q,"DOMNodeInserted",e);w=!1;d.halt();var d=d.originalEvent,i,k;h.isEmptyObject(m)?(k=q.elementFromPoint(d.clientX,d.clientY),i=k.lastChild):(h.each(m,function(b){"img"==a.nodeName(b)&&(i=b.nextSibling,k=b.parentNode,a.remove(b))}),m={});d=d.dataTransfer;d.dropEffect="copy";if(d=d.files)for(var j=0;j<d.length;j++){var p=d[j],o=p.size;if(p.name.match(b)&&!(o/1E3>n)){var o=new l("<img src='"+f.debugUrl("theme/tao-loading.gif")+"'/>"),
v=o[0];k.insertBefore(v,i);var s=a.nodeName(v.parentNode);("head"==s||"html"==s)&&a.insertBefore(v,q.body.firstChild);g(p,o)}}});window.XMLHttpRequest&&!XMLHttpRequest.prototype.sendAsBinary&&(XMLHttpRequest.prototype.sendAsBinary=function(a,b){for(var d=new (window.BlobBuilder||window.WebKitBlobBuilder),c=a.length,e=new window.Uint8Array(c),g=0;g<c;g++)e[g]=a.charCodeAt(g);d.append(e.buffer);this.send(d.getBlob(b))})}}},{requires:["editor"]});
KISSY.add("editor/plugin/elementPath/index",function(h,j){function l(c){this.cfg=c;this._cache=[];this._init()}var c=h.Node;h.augment(l,{_init:function(){var f=this.cfg.editor;this.holder=new c("<span>");this.holder.appendTo(f.get("statusBarEl"),void 0);f.on("selectionChange",this._selectionChange,this);j.Utils.sourceDisable(f,this)},disable:function(){this.holder.css("visibility","hidden")},enable:function(){this.holder.css("visibility","")},_selectionChange:function(f){var a=this.cfg.editor,i=this.holder,
f=f.path.elements,e,g;e=this._cache;for(g=0;g<e.length;g++)e[g].remove();this._cache=[];for(g=0;g<f.length;g++){e=f[g];var h=e.attr("_ke_real_element_type")||e.nodeName(),j=new c("<a href='javascript(\""+h+"\")' class='ke-element-path'>"+h+"</a>");this._cache.push(j);(function(c){j.on("click",function(e){e.halt();a.focus();setTimeout(function(){a.getSelection().selectElement(c)},50)})})(e);i.prepend(j)}},destroy:function(){this.holder.remove()}});return{init:function(c){var a=new l({editor:c});c.on("destroy",
function(){a.destroy()})}}},{requires:["editor"]});
KISSY.add("editor/plugin/fakeObjects/index",function(h,j){var l=h.Node,c=h.DOM,f=j.Utils.debugUrl("theme/spacer.gif"),a=h.require("htmlparser");h.augment(j,{createFakeElement:function(a,c,i,j,n,o){var d=a.attr("style")||"";a.attr("width")&&(d="width:"+a.attr("width")+"px;"+d);a.attr("height")&&(d="height:"+a.attr("height")+"px;"+d);var b=h.trim(a.attr("class")),a={"class":c+" "+b,src:f,_ke_realelement:encodeURIComponent(n||a._4e_outerHtml(void 0)),_ke_real_node_type:a[0].nodeType,style:d};o&&delete o.width;
o&&delete o.height;o&&h.mix(a,o,!1);i&&(a._ke_real_element_type=i);j&&(a._ke_resizable=j);return new l("<img/>",a,this.get("document")[0])},restoreRealElement:function(a){if(a.attr("_ke_real_node_type")!=c.ELEMENT_NODE)return null;var a=decodeURIComponent(a.attr("_ke_realelement")),g=new l("<div>",null,this.get("document")[0]);g.html(a);return g.first(function(a){return a.nodeType==c.ELEMENT_NODE}).remove()}});var i={tags:{$:function(c){var g=c.getAttribute("_ke_realelement"),f;g&&(f=(new a.Parser(decodeURIComponent(g))).parse());
if(g=f&&f.childNodes[0]){if(f=c.getAttribute("style")){var i=/(?:^|\s)width\s*:\s*(\d+)/i.exec(f),c=i&&i[1];f=(i=/(?:^|\s)height\s*:\s*(\d+)/i.exec(f))&&i[1];c&&g.setAttribute("width",c);f&&g.setAttribute("height",f)}return g}}}};return{init:function(c){var g=(c=c.htmlDataProcessor)&&c.htmlFilter;c.createFakeParserElement||(g&&g.addRules(i),h.mix(c,{createFakeParserElement:function(c,e,g,i,d){var b;b=new a.BasicWriter;c.writeHtml(b);b=b.getHtml();var j=c.getAttribute("style")||"";c.getAttribute("width")&&
(j="width:"+c.getAttribute("width")+"px;"+j);c.getAttribute("height")&&(j="height:"+c.getAttribute("height")+"px;"+j);var m=h.trim(c.getAttribute("class")),c={"class":e+" "+m,src:f,_ke_realelement:encodeURIComponent(b),_ke_real_node_type:c.nodeType+"",style:j,align:c.getAttribute("align")||""};d&&delete d.width;d&&delete d.height;d&&h.mix(c,d,!1);g&&(c._ke_real_element_type=g);i&&(c._ke_resizable="_ke_resizable");return new a.Tag("img",c)}}))}}},{requires:["editor"]});
KISSY.add("editor/plugin/flashBridge/index",function(h,j,l){function c(a){this._init(a)}function f(c){var e=h.isString(c)?c.match(/(\d)+/g):c;h.isArray(e)&&(c=parseFloat(e[0]+"."+a(e[1],3)+a(e[2],5)));return c||0}function a(a,c){for(var d=(a+"").length;d++<c;)a="0"+a;return a}var i={};h.augment(c,h.EventTarget,{_init:function(a){var c=h.guid("flashbridge-");a.flashVars=a.flashVars||{};a.attrs=a.attrs||{};a.params=a.params||{};var d=a.flashVars,b=a.params;h.mix(a.attrs,{id:c,width:"100%",height:"100%"},
!1);h.mix(b,{allowScriptAccess:"always",allowNetworking:"all",scale:"noScale"},!1);h.mix(d,{shareData:!1,useCompression:!1},!1);b={YUISwfId:c,YUIBridgeCallback:"KISSY.Editor.FlashBridge.EventHandler"};a.ajbridge&&(b={swfID:c,jsEntry:"KISSY.Editor.FlashBridge.EventHandler"});h.mix(d,b);i[c]=this;this.id=c;this.swf=l.createSWFRuntime(a.movie,a);this._expose(a.methods)},_expose:function(a){for(var c=this,d=0;d<a.length;d++)(function(a){c[a]=function(){return c._callSWF(a,h.makeArray(arguments))}})(a[d])},
_callSWF:function(a,c){c=c||[];try{if(this.swf[a])return this.swf[a].apply(this.swf,c)}catch(d){var b="";0!==c.length&&(b="'"+c.join("', '")+"'");return(new Function("self","return self.swf."+a+"("+b+");"))(this)}},_eventHandler:function(a){var c=a.type;"log"!==c&&c&&this.fire(c,a)},ready:function(a){if(this._ready)a.call(this);else this.on("contentReady",a)},destroy:function(){delete i[this.id]}});c.EventHandler=function(a,c){var d=i[a];d&&setTimeout(function(){d._eventHandler.call(d,c)},100)};j.FlashBridge=
c;var e=h.UA,g,k,p=!0;e.fpv=function(a){if(a||p){p=!1;var c;if(navigator.plugins&&navigator.mimeTypes.length)c=(navigator.plugins["Shockwave Flash"]||{}).description;else if(window.ActiveXObject)try{c=(new ActiveXObject("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version")}catch(d){}g=!c?void 0:c.match(/(\d)+/g);k=f(g)}return g};e.fpvGEQ=function(a,c){p&&e.fpv(c);return!!k&&k>=f(a)};return c},{requires:["editor","../flashCommon/utils"]});
KISSY.add("editor/plugin/flashCommon/baseClass",function(h,j,l,c,f,a){function i(){i.superclass.constructor.apply(this,arguments);this._init()}var e=h.Node;i.ATTRS={cls:{},type:{},label:{value:"\u5728\u65b0\u7a97\u53e3\u67e5\u770b"},contextMenuHandlers:{}};h.extend(i,h.Base,{_init:function(){var a=this,e=a.get("cls"),f=a.get("editor"),i=a.get("contextMenuHandlers");l.register({editor:f,filter:"."+e,width:"120px",handlers:i});c.register({filter:function(a){return a.hasClass(e,void 0)&&a},editor:f,init:function(){var c=this,d=c.get("contentEl");
d.html(h.substitute(' <a class="ke-bubbleview-url" target="_blank" href="#">{label}</a>   |    <span class="ke-bubbleview-link ke-bubbleview-change">\u7f16\u8f91</span>   |    <span class="ke-bubbleview-link ke-bubbleview-remove">\u5220\u9664</span>',{label:a.get("label")}));var b=d.one(".ke-bubbleview-url"),e=d.one(".ke-bubbleview-change"),i=d.one(".ke-bubbleview-remove");j.Utils.preventFocus(d);e.on("click",function(b){a.show(c.selectedEl);b.halt()});i.on("click",function(a){if(h.UA.webkit){var b=f.getSelection().getRanges();
if(b=b&&b[0])b.collapse(!0),b.select()}c.selectedEl.remove();c.hide();f.notifySelectionChange();a.halt()});c.on("show",function(){var d=c.selectedEl;d&&a._updateTip(b,d)})}});f.docReady(function(){f.get("document").on("dblclick",a._dbClick,a)})},_getFlashUrl:function(c){return a.getUrl(c)},_updateTip:function(a,c){var e=this.get("editor").restoreRealElement(c);e&&(e=this._getFlashUrl(e),a.attr("href",e))},_dbClick:function(a){var c=new e(a.target);"img"===c.nodeName()&&c.hasClass(this.get("cls"),
void 0)&&(this.show(c),a.halt())},show:function(a){var c=this.get("editor");f.useDialog(c,this.get("type")+"/dialog",a)}});return i},{requires:["editor","../contextmenu/","../bubbleview/","../dialogLoader/","./utils"]});
KISSY.add("editor/plugin/flashCommon/utils",function(h){var j=h.DOM,l=h.Node,c=h.UA,f={insertFlash:function(a,c,e,g,h,j){c=f.createSWF(c,{attrs:e},a.get("document")[0]);e=a.createFakeElement(c.el,g||"ke_flash",h||"flash",!0,c.html,e);a.insertElement(e,null,j)},isFlashEmbed:function(a){return"application/x-shockwave-flash"==a.getAttribute("type")||/\.swf(?:$|\?)/i.test(a.getAttribute("src")||"")},getUrl:function(a){var c="";if("object"==a.nodeName())for(var a=a[0].childNodes,e=0;e<a.length;e++)1==
a[e].nodeType&&("movie"==(j.attr(a[e],"name")||"").toLowerCase()?c=j.attr(a[e],"value"):"embed"==j.nodeName(a[e])?c=j.attr(a[e],"src"):"object"==j.nodeName(a[e])&&(c=j.attr(a[e],"data")));else"embed"==a.nodeName()&&(c=a.attr("src"));return c},createSWF:function(a,c,e){var g=c.attrs||{},f=c.flashVars,j="",n="",c=c.params||{},o="",e=e||document;h.mix(g,{wmode:"transparent"});for(var d in g)g.hasOwnProperty(d)&&(j+=d+"='"+g[d]+"' ");h.mix(c,{quality:"high",movie:a,wmode:"transparent"});for(var b in c)c.hasOwnProperty(b)&&
(n+="<param name='"+b+"' value='"+c[b]+"'/>");if(f){for(var q in f)f.hasOwnProperty(q)&&(o+="&"+q+"="+encodeURIComponent(f[q]));o=o.substring(1)}a="<object "+j+' classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" >'+n+(o?'<param name="flashVars" value="'+o+'"/>':"")+"<embed "+j+" "+(o?'FlashVars="'+o+'"':"")+' pluginspage="http://www.macromedia.com/go/getflashplayer"  quality="high"  src="'+a+'"  type="application/x-shockwave-flash"/></object>';return{el:new l(a,null,e),html:a}},createSWFRuntime2:function(a,
i,e){var e=e||document,g=(new l("<div style='width:0;height:0;overflow:hidden;'>",null,e)).appendTo(e.body),g=f.createSWF.apply(this,arguments).el.appendTo(g);c.ie||(g=g.one("object"));return g[0]},createSWFRuntime:function(a,f,e){var g=f.attrs||{},k=f.flashVars||{},p=f.params||{},n="",o="",d="",e=e||document;g.id=g.id||h.guid("ke-runtimeflash-");for(var b in g)g.hasOwnProperty(b)&&(n+=b+"='"+g[b]+"' ");for(var q in p)p.hasOwnProperty(q)&&(o+="<param name='"+q+"' value='"+p[q]+"'/>");for(var m in k)k.hasOwnProperty(m)&&
(d+="&"+m+"="+encodeURIComponent(k[m]));var d=d.substring(1),a=c.ie?"<object "+n+' classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" >'+o+'<param name="movie" value="'+a+'" />'+(d?'<param name="flashVars" value="'+d+'" />':"")+"</object>":"<object type='application/x-shockwave-flash' data='"+a+"' "+n+">"+o+(d?'<param name="flashVars" value="'+d+'"/>':"")+"</object>",w=f.holder;w||(w=(new l("<div style='"+(f.style?f.style:"width:1px;height:1px;position:absolute;NaN")+"'>",null,e)).appendTo(e.body),
setTimeout(function(){w.offset({left:j.scrollLeft(),top:j.scrollTop()})},100));w.html(a);return e.getElementById(g.id)}};return f});
KISSY.add("editor/plugin/flash/index",function(h,j,l,c){return{init:function(f){var a=f.htmlDataProcessor;a.dataFilter.addRules({tags:{object:function(e){var f;if(!e.getAttribute("classid")){var i=e.childNodes;for(f=0;f<i.length;f++)if("embed"==i[f].nodeName)if(c.isFlashEmbed(i[f][f]))break;else return a.createFakeParserElement(e,"ke_flash","flash",!0);return null}return a.createFakeParserElement(e,"ke_flash","flash",!0)},embed:function(e){return c.isFlashEmbed(e)?a.createFakeParserElement(e,"ke_flash",
"flash",!0):null}}},5);var i=f.get("pluginConfig").flash||{},e=new l({editor:f,cls:"ke_flash",type:"flash",contextMenuHandlers:{"Flash\u5c5e\u6027":function(){var a=this.selectedEl;a&&e.show(a)}}});!1!==i.btn&&f.addButton({contentCls:"ke-toolbar-flash",title:"\u63d2\u5165Flash",mode:j.WYSIWYG_MODE},{offClick:function(){e.show()}})}}},{requires:["editor","../flashCommon/baseClass","../flashCommon/utils"]});
KISSY.add("editor/plugin/fontFamily/cmd",function(h,j,l){var c={element:"span",styles:{"font-family":"#(value)"},overrides:[{element:"font",attributes:{face:null}}]};return{init:function(f){l.addSelectCmd(f,"fontFamily",c)}}},{requires:["editor","../font/cmd"]});
KISSY.add("editor/plugin/fontFamily/index",function(h,j,l,c){return{init:function(f){c.init(f);var a=f.get("pluginConfig").fontFamily,a=a||{};h.mix(a,{items:[{name:"\u5b8b\u4f53",value:"SimSun"},{name:"\u9ed1\u4f53",value:"SimHei"},{name:"\u96b6\u4e66",value:"LiSu"},{name:"\u6977\u4f53",value:"KaiTi_GB2312"},{name:"\u5fae\u8f6f\u96c5\u9ed1",value:"Microsoft YaHei"},{name:"Georgia",value:"Georgia"},{name:"Times New Roman",value:"Times New Roman"},{name:"Impact",value:"Impact"},{name:"Courier New",value:"Courier New"},{name:"Arial",value:"Arial"},{name:"Verdana",
value:"Verdana"},{name:"Tahoma",value:"Tahoma"}],width:"130px"},!1);h.each(a.items,function(a){var c=a.attrs||{},g=a.value;c.style=c.style||"";c.style+=";font-family:"+g;a.attrs=c});f.addSelect({cmdType:"fontFamily",title:"\u5b57\u4f53",width:"110px",mode:j.WYSIWYG_MODE,defaultValue:a.defaultValue,popUpWidth:a.width,items:a.items},void 0,l.Select)}}},{requires:["editor","../font/ui","./cmd"]});
KISSY.add("editor/plugin/fontSize/cmd",function(h,j,l){var c={element:"span",styles:{"font-size":"#(value)"},overrides:[{element:"font",attributes:{size:null}}]};return{init:function(f){l.addSelectCmd(f,"fontSize",c)}}},{requires:["editor","../font/cmd"]});
KISSY.add("editor/plugin/fontSize/index",function(h,j,l,c){return{init:function(f){c.init(f);var a=f.get("pluginConfig").fontSize,a=a||{};h.mix(a,{items:function(a){var c=[];h.each(a,function(a){c.push({name:a,value:a})});return c}("8px,10px,12px,14px,18px,24px,36px,48px,60px,72px,84px,96px".split(",")),width:"55px"},!1);f.addSelect({cmdType:"fontSize",title:"\u5927\u5c0f",width:"30px",mode:j.WYSIWYG_MODE,showValue:!0,defaultValue:a.defaultValue,popUpWidth:a.width,items:a.items},void 0,l.Select)}}},{requires:["editor",
"../font/ui","./cmd"]});
KISSY.add("editor/plugin/font/cmd",function(h,j){var l=j.Utils.getQueryCmd;return{addButtonCmd:function(c,f,a){var i=l(f);c.hasCommand(f)||(c.addCommand(f,{exec:function(c,g){var f=c.get("document")[0];c.execCommand("save");g||void 0===g?a.apply(f):a.remove(f);c.execCommand("save");c.notifySelectionChange()}}),c.addCommand(i,{exec:function(c,g){return a.checkActive(g)}}))},addSelectCmd:function(c,f,a){var i=l(f);c.hasCommand(f)||(c.addCommand(f,{exec:function(c,g,f){var g=new j.Style(a,{value:g}),
i=c.get("document")[0];c.execCommand("save");void 0===f||f?g.apply(i):g.remove(i);c.execCommand("save")}}),c.addCommand(i,{exec:function(c,g,f){return(new j.Style(a,{value:g})).checkElementRemovable(f,!0)}}))}}},{requires:["editor"]});
KISSY.add("editor/plugin/font/ui",function(h,j,l,c){function f(){f.superclass.constructor.apply(this,arguments)}function a(){a.superclass.constructor.apply(this,arguments)}var i=j.Utils.getQueryCmd;h.extend(f,c,{click:function(a){var c=a.newVal,f=this.get("cmdType"),a=a.prevVal,i=this.get("editor");i.focus();c==a?i.execCommand(f,c,!1):i.execCommand(f,c)},selectionChange:function(a){for(var c=a.path,a=i(this.get("cmdType")),f=this.get("items"),h=this.get("editor"),c=c.elements,j=0,l;j<c.length;j++){l=
c[j];for(var d=0;d<f.length;d++){var b=f[d].value;if(h.execCommand(a,b,l)){this.set("value",b);return}}}(a=this.get("defaultValue"))?this.set("value",a):this.reset("value")}});h.extend(a,l,{offClick:function(){var a=this.get("cmdType"),c=this.get("editor");c.execCommand(a);c.focus()},onClick:function(){var a=this.get("cmdType"),c=this.get("editor");c.execCommand(a,!1);c.focus()},selectionChange:function(a){var c=this.get("editor"),f=i(this.get("cmdType"));c.execCommand(f,a.path)?this.set("state",
l.ON):this.set("state",l.OFF)}},{ATTRS:{mode:{value:j.WYSIWYG_MODE}}});return{Button:a,Select:f}},{requires:["editor","../button/","../select/"]});
KISSY.add("editor/plugin/foreColor/cmd",function(h,j){var l={element:"span",styles:{color:"#(color)"},overrides:[{element:"font",attributes:{color:null}}],childRule:function(c){return!("a"==c.nodeName()||c.all("a").length)}};return{init:function(c){c.hasCommand("foreColor")||c.addCommand("foreColor",{exec:function(c,a){c.execCommand("save");j.applyColor(c,a,l);c.execCommand("save")}})}}},{requires:["../color/cmd"]});
KISSY.add("editor/plugin/foreColor/index",function(h,j,l,c){return{init:function(f){c.init(f);f.addButton({cmdType:"foreColor",title:"\u6587\u672c\u989c\u8272",contentCls:"ke-toolbar-fore-color"},void 0,l)}}},{requires:["editor","../color/btn","./cmd"]});
KISSY.add("editor/plugin/heading/cmd",function(h,j){return{init:function(h){if(!h.hasCommand("heading")){h.addCommand("heading",{exec:function(c,a){c.execCommand("save");(new j.Style({element:a})).apply(c.get("document")[0]);c.execCommand("save")}});var c=j.Utils.getQueryCmd("heading");h.addCommand(c,{exec:function(c,a,i){return(new j.Style({element:i})).checkActive(a)}})}}}},{requires:["editor"]});
KISSY.add("editor/plugin/heading/index",function(h,j,l){return{init:function(c){l.init(c);var f=[],a={"\u666e\u901a\u6587\u672c":"p","\u6807\u98981":"h1","\u6807\u98982":"h2","\u6807\u98983":"h3","\u6807\u98984":"h4","\u6807\u98985":"h5","\u6807\u98986":"h6"},i={p:"1em",h1:"2em",h2:"1.5em",h3:"1.17em",h4:"1em",h5:"0.83em",h6:"0.67em"},e;for(e in a)a.hasOwnProperty(e)&&f.push({name:e,value:a[e],attrs:{style:"font-size:"+i[a[e]]}});c.addSelect({items:f,title:"\u6807\u9898",width:"100px",mode:j.WYSIWYG_MODE},{click:function(a){var e=a.newVal;e!=a.prevVal?c.execCommand("heading",e):(c.execCommand("heading",
"p"),this.set("value","p"))},selectionChange:function(a){var a=a.path,e=j.Utils.getQueryCmd("heading"),f;for(f in i)if(i.hasOwnProperty(f)&&c.execCommand(e,a,f)){this.set("value",f);break}}})}}},{requires:["editor","./cmd"]});
KISSY.add("editor/plugin/image/index",function(h,j,l,c,f,a){var i=h.UA,e=h.Node,g=h.all,k=h.Event,p=function(a){a=g(a);return"img"===a.nodeName(a)&&!/(^|\s+)ke_/.test(a[0].className)&&a};return{init:function(h){function l(c){a.useDialog(h,"image/dialog",c)}h.addButton({contentCls:"ke-toolbar-image",title:"\u63d2\u5165\u56fe\u7247",mode:j.WYSIWYG_MODE},{offClick:function(){l(null)}});f.register({editor:h,filter:p,width:"120px",handlers:{"\u56fe\u7247\u5c5e\u6027":function(){var a=p(this.selectedEl);a&&l(g(a))},"\u63d2\u5165\u65b0\u884c":function(){var a=h.get("document")[0],
b=new e(a.createElement("p"));i.ie||b._4e_appendBogus(void 0);a=new j.Range(a);a.setStartAfter(this.selectedEl);a.select();h.insertElement(b);a.moveToElementEditablePosition(b,1);a.select()}}});h.docReady(function(){k.on(h.get("document")[0],"dblclick",function(a){a.halt();a=g(a.target);p(a)&&l(a)})});c.register({editor:h,filter:p,init:function(){var a=this,b=a.get("contentEl");b.html('<a class="ke-bubbleview-url" target="_blank" href="#">\u5728\u65b0\u7a97\u53e3\u67e5\u770b</a>  |  <a class="ke-bubbleview-link ke-bubbleview-change" href="#">\u7f16\u8f91</a>  |  <a class="ke-bubbleview-link ke-bubbleview-remove" href="#">\u5220\u9664</a>');
var c=b.one(".ke-bubbleview-url"),e=b.one(".ke-bubbleview-change"),g=b.one(".ke-bubbleview-remove");j.Utils.preventFocus(b);e.on("click",function(b){l(a.selectedEl);b.halt()});g.on("click",function(b){if(i.webkit){var c=h.getSelection().getRanges();c&&c[0]&&(c[0].collapse(),c[0].select())}a.selectedEl.remove();a.hide();h.notifySelectionChange();b.halt()});a.on("show",function(){var b=a.selectedEl;b&&(b=b.attr("_ke_saved_src")||b.attr("src"),c.attr("href",b))})}})}}},{requires:["editor","../button/",
"../bubbleview/","../contextmenu/","../dialogLoader/"]});KISSY.add("editor/plugin/indent/cmd",function(h,j,l){var c=l.addCommand;return{init:function(f){c(f,"indent")}}},{requires:["editor","../dentUtils/cmd"]});KISSY.add("editor/plugin/indent/index",function(h,j,l){return{init:function(c){l.init(c);c.addButton({title:"\u589e\u52a0\u7f29\u8fdb\u91cf ",mode:j.WYSIWYG_MODE,contentCls:"ke-toolbar-indent"},{offClick:function(){c.execCommand("indent")}})}}},{requires:["editor","./cmd"]});
KISSY.add("editor/plugin/insertOrderedList/cmd",function(h,j,l){var c=l.queryActive,f=new l.ListCommand("ol");return{init:function(a){a.hasCommand("insertOrderedList")||a.addCommand("insertOrderedList",{exec:function(a){f.exec(a)}});var i=j.Utils.getQueryCmd("insertOrderedList");a.hasCommand(i)||a.addCommand(i,{exec:function(a,g){return c("ol",g)}})}}},{requires:["editor","../listUtils/cmd"]});
KISSY.add("editor/plugin/insertOrderedList/index",function(h,j,l,c){return{init:function(f){c.init(f);f.addButton({cmdType:"insertOrderedList",mode:j.WYSIWYG_MODE,contentCls:"ke-toolbar-ol"},void 0,l)}}},{requires:["editor","../listUtils/btn","./cmd"]});
KISSY.add("editor/plugin/insertUnorderedList/cmd",function(h,j,l){var c=l.queryActive,f=new l.ListCommand("ul");return{init:function(a){a.hasCommand("insertUnorderedList")||a.addCommand("insertUnorderedList",{exec:function(a){f.exec(a)}});var i=j.Utils.getQueryCmd("insertUnorderedList");a.hasCommand(i)||a.addCommand(i,{exec:function(a,g){return c("ul",g)}})}}},{requires:["editor","../listUtils/cmd.js"]});
KISSY.add("editor/plugin/insertUnorderedList/index",function(h,j,l,c){return{init:function(f){c.init(f);f.addButton({cmdType:"insertUnorderedList",mode:j.WYSIWYG_MODE,contentCls:"ke-toolbar-ul"},void 0,l)}}},{requires:["editor","../listUtils/btn","./cmd"]});
KISSY.add("editor/plugin/italic/cmd",function(h,j,l){var c=new j.Style({element:"em",overrides:[{element:"i"},{element:"span",attributes:{style:"font-style: italic;"}}]});return{init:function(f){l.addButtonCmd(f,"italic",c)}}},{requires:["editor","../font/cmd"]});KISSY.add("editor/plugin/italic/index",function(h,j,l,c){return{init:function(f){c.init(f);f.addButton({cmdType:"italic",contentCls:"ke-toolbar-italic",title:"\u659c\u4f53 "},void 0,l.Button)}}},{requires:["editor","../font/ui","./cmd"]});
KISSY.add("editor/plugin/justifyCenter/cmd",function(h,j){return{init:function(h){j.addCommand(h,"justifyCenter","center")}}},{requires:["../justifyUtils/cmd"]});
KISSY.add("editor/plugin/justifyCenter/index",function(h,j,l){function c(){this.get("editor").execCommand("justifyCenter")}return{init:function(f){l.init(f);f.addButton({contentCls:"ke-toolbar-justifyCenter",title:"\u5c45\u4e2d\u5bf9\u9f50"},{onClick:c,offClick:c,selectionChange:function(a){var c=j.Utils.getQueryCmd("justifyCenter");f.execCommand(c,a.path)?this.bon():this.boff()}})}}},{requires:["editor","./cmd"]});
KISSY.add("editor/plugin/justifyLeft/cmd",function(h,j){return{init:function(h){j.addCommand(h,"justifyLeft","left")}}},{requires:["../justifyUtils/cmd"]});
KISSY.add("editor/plugin/justifyLeft/index",function(h,j,l){function c(){this.get("editor").execCommand("justifyLeft")}return{init:function(f){l.init(f);f.addButton({contentCls:"ke-toolbar-justifyLeft",title:"\u5de6\u5bf9\u9f50"},{onClick:c,offClick:c,selectionChange:function(a){var c=j.Utils.getQueryCmd("justifyLeft");f.execCommand(c,a.path)?this.bon():this.boff()}})}}},{requires:["editor","./cmd"]});
KISSY.add("editor/plugin/justifyRight/cmd",function(h,j){return{init:function(h){j.addCommand(h,"justifyRight","right")}}},{requires:["../justifyUtils/cmd"]});
KISSY.add("editor/plugin/justifyRight/index",function(h,j,l){function c(){this.get("editor").execCommand("justifyRight")}return{init:function(f){l.init(f);f.addButton({contentCls:"ke-toolbar-justifyRight",title:"\u53f3\u5bf9\u9f50"},{onClick:c,offClick:c,selectionChange:function(a){var c=j.Utils.getQueryCmd("justifyRight");f.execCommand(c,a.path)?this.bon():this.boff()}})}}},{requires:["editor","./cmd"]});
KISSY.add("editor/plugin/justifyUtils/cmd",function(h,j){var l=/(-moz-|-webkit-|start|auto)/gi;return{addCommand:function(c,f,a){c.hasCommand(f)||(c.addCommand(f,{exec:function(c){c.execCommand("save");for(var e=c.getSelection(),g=e.createBookmarks(),f=e.getRanges(),h,j,o=f.length-1;0<=o;o--){h=f[o].createIterator();for(h.enlargeBr=!0;j=h.getNextParagraph();)j.removeAttr("align"),(j.css("text-align").replace(l,"")||"left")==a?j.css("text-align",""):j.css("text-align",a)}e.selectBookmarks(g);c.execCommand("save");
c.notifySelectionChange()}}),c.addCommand(j.Utils.getQueryCmd(f),{exec:function(c,e){var g=e.block||e.blockLimit;return!g||"body"===g.nodeName()?!1:(g.css("text-align").replace(l,"")||"left")==a}}))}}},{requires:["editor"]});
KISSY.add("editor/plugin/link/index",function(h,j,l,c,f){function a(a){a=i(a);return a.closest("a",void 0)}var i=h.all;return{init:function(e){e.addButton({contentCls:"ke-toolbar-link",title:"\u63d2\u5165\u94fe\u63a5",mode:j.WYSIWYG_MODE},{offClick:function(){f.useDialog(e,"link/dialog",void 0)}});l.register({editor:e,filter:a,init:function(){var a=this,h=a.get("contentEl");h.html('<a href=""  target="_blank" class="ke-bubbleview-url">\u5728\u65b0\u7a97\u53e3\u67e5\u770b</a>  \u2013   <span class="ke-bubbleview-link ke-bubbleview-change">\u7f16\u8f91</span>   |    <span class="ke-bubbleview-link ke-bubbleview-remove">\u53bb\u9664</span>');
var i=h.one(".ke-bubbleview-url"),l=h.one(".ke-bubbleview-change"),o=h.one(".ke-bubbleview-remove");j.Utils.preventFocus(h);l.on("click",function(c){f.useDialog(e,"link/dialog",a.selectedEl);c.halt()});o.on("click",function(d){c.removeLink(e,a.selectedEl);d.halt()});a.on("show",function(){var d=a.selectedEl;d&&(d=d.attr(c._ke_saved_href)||d.attr("href"),i.html(d),i.attr("href",d))})}})}}},{requires:["editor","../bubbleview/","./utils","../dialogLoader/"]});
KISSY.add("editor/plugin/link/utils",function(h,j){var l=h.Node,c=j.Style,f={element:"a",attributes:{href:"#(href)",title:"#(title)",_ke_saved_href:"#(_ke_saved_href)",target:"#(target)"}};return{removeLink:function(a,h){a.execCommand("save");var e=a.getSelection(),g=e.getRanges()[0];if(g&&g.collapsed)g=e.createBookmarks(),h._4e_remove(!0),e.selectBookmarks(g);else if(g){for(var e=h[0],g=e.attributes,j={},l=0;l<g.length;l++){var n=g[l];n.specified&&(j[n.name]=n.value)}e.style.cssText&&(j.style=e.style.cssText);
(new c(f,j)).remove(a.get("document")[0])}a.execCommand("save");a.notifySelectionChange()},applyLink:function(a,h,e){h._ke_saved_href=h.href;e?(a.execCommand("save"),e.attr(h)):(e=(e=a.getSelection())&&e.getRanges()[0],!e||e.collapsed?(h=new l("<a>"+h.href+"</a>",h,a.get("document")[0]),a.insertElement(h)):(a.execCommand("save"),(new c(f,h)).apply(a.get("document")[0])));a.execCommand("save");a.notifySelectionChange()},_ke_saved_href:"_ke_saved_href"}},{requires:["editor"]});
KISSY.add("editor/plugin/listUtils/btn",function(h,j,l){function c(){c.superclass.constructor.apply(this,arguments)}function f(){var a=this.get("editor"),c=this.get("cmdType");a.execCommand(c)}h.extend(c,l,{offClick:f,onClick:f,selectionChange:function(a){var c=this.get("editor"),e=j.Utils.getQueryCmd(this.get("cmdType"));c.execCommand(e,a.path)?this.bon():this.boff()}});return c},{requires:["editor","../button/"]});
KISSY.add("editor/plugin/listUtils/cmd",function(h,j,l,c){function f(a){this.type=a}function a(a,c){var d,e,g=c.blockLimit,f=c.elements;if(!g)return!1;if(f)for(var h=0;h<f.length&&(d=f[h])&&d[0]!==g[0];h++)if(i[e=d.nodeName()]&&e==a)return!0;return!1}var i={ol:"insertOrderedList",ul:"insertUnorderedList"},e=j.RANGE,g=j.ElementPath,k=j.Walker,p=h.UA,n=h.Node,o=h.DOM,d=/^h[1-6]$/;f.prototype={changeListType:function(a,d,e,g){for(var f=l.listToArray(d.root,e,c,c,c),h=[],a=0;a<d.contents.length;a++){var i=
d.contents[a];if((i=i.closest("li",c))&&i[0]&&!i.data("list_item_processed"))h.push(i),i._4e_setMarker(e,"list_item_processed",!0,c)}i=new n(d.root[0].ownerDocument.createElement(this.type));for(a=0;a<h.length;a++){var j=h[a].data("listarray_index");f[j].parent=i}for(var e=l.arrayToList(f,e,null,"p"),k,f=e.listNode.childNodes.length,a=0;a<f&&(k=new n(e.listNode.childNodes[a]));a++)k.nodeName()==this.type&&g.push(k);e.listNode.insertBefore(d.root);d.root.remove()},createList:function(a,e,g){var f=
e.contents,a=e.root[0].ownerDocument,h=[];if(1==f.length&&f[0][0]===e.root[0]){var i=new n(a.createElement("div"));f[0][0].nodeType!=o.TEXT_NODE&&f[0]._4e_moveChildren(i,c,c);f[0][0].appendChild(i[0]);f[0]=i}e=e.contents[0].parent();for(i=0;i<f.length;i++)e=e._4e_commonAncestor(f[i].parent(),c);for(i=0;i<f.length;i++)for(var j=f[i],k;k=j.parent();){if(k[0]===e[0]){h.push(j);break}j=k}if(!(1>h.length)){f=new n(h[h.length-1][0].nextSibling);i=new n(a.createElement(this.type));for(g.push(i);h.length;)g=
h.shift(),j=new n(a.createElement("li")),d.test(g.nodeName())?j[0].appendChild(g[0]):(g._4e_copyAttributes(j,c,c),g._4e_moveChildren(j,c,c),g.remove()),i[0].appendChild(j[0]),p.ie||j._4e_appendBogus(c);f[0]?i.insertBefore(f,c):e.append(i)}},removeList:function(a,d,e){function f(e){if((z=new n(p[e?"firstChild":"lastChild"]))&&!(z[0].nodeType==o.ELEMENT_NODE&&z._4e_isBlockBoundary(c,c))&&(v=d.root[e?"prev":"next"](k.whitespaces(!0)))&&!(z[0].nodeType==o.ELEMENT_NODE&&v._4e_isBlockBoundary({br:1},c)))z[e?
"before":"after"](a.get("document")[0].createElement("br"))}for(var g=l.listToArray(d.root,e,c,c,c),h=[],i=0;i<d.contents.length;i++){var j=d.contents[i];if((j=j.closest("li",c))&&!j.data("list_item_processed"))h.push(j),j._4e_setMarker(e,"list_item_processed",!0,c)}j=null;for(i=0;i<h.length;i++)j=h[i].data("listarray_index"),g[j].indent=-1;for(i=j+1;i<g.length;i++)if(g[i].indent>Math.max(g[i-1].indent,0)){h=g[i-1].indent+1-g[i].indent;for(j=g[i].indent;g[i]&&g[i].indent>=j;)g[i].indent+=h,i++;i--}var p=
l.arrayToList(g,e,null,"p").listNode,z,v;f(!0);f(c);d.root.before(p);d.root.remove()},exec:function(b){var d=b.getSelection(),f=d&&d.getRanges();if(f&&!(1>f.length)){for(var h=d.getStartElement(),h=new j.ElementPath(h),l=a(this.type,h),h=d.createBookmarks(!0),p=[],n={};0<f.length;){var x=f.shift(),y=x.getBoundaryNodes(),z=y.startNode,v=y.endNode;z[0].nodeType==o.ELEMENT_NODE&&"td"==z.nodeName()&&x.setStartAt(y.startNode,e.POSITION_AFTER_START);v[0].nodeType==o.ELEMENT_NODE&&"td"==v.nodeName()&&x.setEndAt(y.endNode,
e.POSITION_BEFORE_END);x=x.createIterator();for(x.forceBrBreak=!1;y=x.getNextParagraph();)if(!y.data("list_block")){y._4e_setMarker(n,"list_block",1,c);for(var v=new g(y),s=v.elements,B=null,C=!1,B=v.blockLimit,A,z=s.length-1;0<=z&&(A=s[z]);z--)if(i[A.nodeName()]&&B.contains(A)){B.removeData("list_group_object");(z=A.data("list_group_object"))?z.contents.push(y):(z={root:A,contents:[y]},p.push(z),A._4e_setMarker(n,"list_group_object",z,c));C=!0;break}C||(v=B||v.block,v.data("list_group_object")?v.data("list_group_object").contents.push(y):
(z={root:v,contents:[y]},v._4e_setMarker(n,"list_group_object",z,c),p.push(z)))}}for(f=[];0<p.length;)z=p.shift(),l?i[z.root.nodeName()]&&this.removeList(b,z,n):i[z.root.nodeName()]?this.changeListType(b,z,n,f):(j.Utils.clearAllMarkers(n),this.createList(b,z,f));for(var F=this,z=0;z<f.length;z++)B=f[z],b=function(a,b){var d=b[a?"prev":"next"](k.whitespaces(!0));d&&d[0]&&d.nodeName()==F.type&&(d.remove(),d._4e_moveChildren(b,a?!0:!1,c))},b(c,B),b(!0,B);j.Utils.clearAllMarkers(n);d.selectBookmarks(h)}}};
new f("ul");new f("ol");return{ListCommand:f,queryActive:a}},{requires:["editor","../listUtils/"]});
KISSY.add("editor/plugin/listUtils/index",function(h){var j={ol:1,ul:1},l=h.Node,c=h.DOM,f=h.UA,a={listToArray:function(f,e,g,h,p){if(!j[f.nodeName()])return[];h||(h=0);g||(g=[]);for(var n=0,o=f[0].childNodes.length;n<o;n++){var d=new l(f[0].childNodes[n]);if("li"==d.nodeName()){var b={parent:f,indent:h,element:d,contents:[]};p?b.grandparent=p:(b.grandparent=f.parent(),b.grandparent&&"li"==b.grandparent.nodeName()&&(b.grandparent=b.grandparent.parent()));e&&d._4e_setMarker(e,"listarray_index",g.length,
void 0);g.push(b);for(var q=0,m=d[0].childNodes.length,w;q<m;q++)w=new l(d[0].childNodes[q]),w[0].nodeType==c.ELEMENT_NODE&&j[w.nodeName()]?a.listToArray(w,e,g,h+1,b.grandparent):b.contents.push(w)}}return g},arrayToList:function(h,e,g,k){g||(g=0);if(!h||h.length<g+1)return null;for(var p=h[g].parent[0].ownerDocument,n=p.createDocumentFragment(),o=null,d=g,b=Math.max(h[g].indent,0),q=null;;){var m=h[d];if(m.indent==b){if(!o||h[d].parent.nodeName()!=o.nodeName())o=h[d].parent.clone(!1),n.appendChild(o[0]);
for(var q=o[0].appendChild(m.element.clone(!1)[0]),w=0;w<m.contents.length;w++)q.appendChild(m.contents[w].clone(!0)[0]);d++}else if(m.indent==Math.max(b,0)+1)d=a.arrayToList(h,null,d,k),q.appendChild(d.listNode),d=d.nextIndex;else if(-1==m.indent&&!g&&m.grandparent){j[m.grandparent.nodeName()]?q=m.element.clone(!1)[0]:"td"!=m.grandparent.nodeName()?(q=p.createElement(k),m.element._4e_copyAttributes(new l(q))):q=p.createDocumentFragment();for(w=0;w<m.contents.length;w++)o=m.contents[w].clone(!0),
q.nodeType==c.DOCUMENT_FRAGMENT_NODE&&m.element._4e_copyAttributes(new l(o)),q.appendChild(o[0]);q.nodeType==c.DOCUMENT_FRAGMENT_NODE&&d!=h.length-1&&(q.lastChild&&q.lastChild.nodeType==c.ELEMENT_NODE&&"_moz"==q.lastChild.getAttribute("type")&&c._4e_remove(q.lastChild),c._4e_appendBogus(q));q.nodeType==c.ELEMENT_NODE&&c.nodeName(q)==k&&q.firstChild&&(c._4e_trim(q),o=q.firstChild,o.nodeType==c.ELEMENT_NODE&&c._4e_isBlockBoundary(o)&&(o=p.createDocumentFragment(),c._4e_moveChildren(q,o),q=o));o=c.nodeName(q);
!f.ie&&("div"==o||"p"==o)&&c._4e_appendBogus(q);n.appendChild(q);o=null;d++}else return null;if(h.length<=d||Math.max(h[d].indent,0)<b)break}if(e)for(h=new l(n.firstChild);h&&h[0];)h[0].nodeType==c.ELEMENT_NODE&&h._4e_clearMarkers(e,!0),h=h._4e_nextSourceNode();return{listNode:n,nextIndex:d}}};return a},{requires:["editor"]});
KISSY.add("editor/plugin/localStorage/index",function(h,j,l,c){if(!h.UA.ie&&window.localStorage)return window.localStorage;var f=j.Utils.debugUrl("plugin/localStorage/swfstore.swf?t="+ +new Date),a=new c({movie:f,flashVars:{useCompression:!0},methods:["setItem","removeItem","getItem","setMinDiskSpace","getValueOf"]});a.swf.height=138;var i=new l({width:"0px",elStyle:{overflow:"hidden"},content:"<h1 style='border:1px solid black;border-bottom:none;background:white;text-align:center;'>\u8bf7\u70b9\u51fb\u5141\u8bb8</h1>",zIndex:j.baseZIndex(j.zIndexManager.STORE_FLASH_SHOW)});
i.render();i.get("contentEl").append(a.swf);i.center();i.show();a.on("pending",function(){i.set("width",215);i.center();i.show();setTimeout(function(){a.retrySave()},1E3)});a.on("save",function(){i.set("width",0)});var e=a.setItem;h.mix(a,{_ke:1,getItem:function(a){return this.getValueOf(a)},retrySave:function(){this.setItem(this.lastSave.k,this.lastSave.v)},setItem:function(a,c){this.lastSave={k:a,v:c};e.call(this,a,c)}});a.on("contentReady",function(){a._ready=1});return a},{attach:!1,requires:["editor",
"overlay","../flashBridge/"]});
KISSY.add("editor/plugin/maximize/cmd",function(h,j){function l(a){this.editor=a}var c=h.UA,f=c.ie,a=document,i=h.Node,e=h.Event,g=h.DOM,k;h.augment(l,{restoreWindow:function(){var a=this,c=a.editor;!1!==c.fire("beforeRestoreWindow")&&a._resize&&(e.remove(window,"resize",a._resize),a._resize=0,a._saveEditorStatus(),a._restoreState(),setTimeout(function(){a._restoreEditorStatus();c.notifySelectionChange();c.fire("restoreWindow")},30))},_restoreState:function(){var c=this.editor,e=this._savedParents;
if(e){for(var h=0;h<e.length;h++){var d=e[h];d.el.css("position",d.position)}this._savedParents=null}c.get("iframeWrapEl").css({height:this.iframeHeight});g.css(a.body,{width:"",height:"",overflow:""});a.documentElement.style.overflow="";c=c.get("el")[0].style;c.position="static";c.width=this.editorElWidth;k.css({left:"-99999px",top:"-99999px"});window.scrollTo(this.scrollLeft,this.scrollTop);8>f&&this.editor.get("toolBarEl").removeClass("ke-toolbar-padding",void 0)},_saveSate:function(){var a=this.editor,
c=[],e=a.get("el");this.iframeHeight=a.get("iframeWrapEl").style("height");this.editorElWidth=e.style("width");this.scrollLeft=g.scrollLeft();this.scrollTop=g.scrollTop();window.scrollTo(0,0);for(a=e.parent();a;)e=a.css("position"),"static"!=e&&(c.push({el:a,position:e}),a.css("position","static")),a=a.parent();this._savedParents=c;8>f&&this.editor.get("toolBarEl").addClass("ke-toolbar-padding",void 0)},_saveEditorStatus:function(){var a=this.editor;this.savedRanges=null;c.gecko&&a.__iframeFocus&&
(this.savedRanges=(a=a.getSelection())&&a.getRanges())},_restoreEditorStatus:function(){var a=this.editor,e=a.getSelection(),f=this.savedRanges;c.gecko&&a.activateGecko();f&&e&&e.selectRanges(f);a.__iframeFocus&&e&&(a=e.getStartElement())&&a.scrollIntoView(void 0,!1)},_maximize:function(c){var e=this.editor,h=e.get("el"),d=g.viewportHeight(),b=g.viewportWidth(),i=e.get("statusBarEl")?e.get("statusBarEl")[0].offsetHeight:0,l=e.get("toolBarEl")[0].offsetHeight;f?a.body.style.overflow="hidden":g.css(a.body,
{width:0,height:0,overflow:"hidden"});a.documentElement.style.overflow="hidden";h.css({position:"absolute",zIndex:j.baseZIndex(j.zIndexManager.MAXIMIZE),width:b+"px"});k.css({zIndex:j.baseZIndex(j.zIndexManager.MAXIMIZE-5),height:d+"px",width:b+"px"});h.offset({left:0,top:0});k.css({left:0,top:0});e.get("iframeWrapEl").css({height:d-i-l+"px"});!0!==c&&arguments.callee.call(this,!0)},_real:function(){var a=this,c=a.editor;a._resize||(a._saveEditorStatus(),a._saveSate(),a._maximize(),a._resize||(a._resize=
h.buffer(function(){a._maximize();c.fire("maximizeWindow")},100)),e.on(window,"resize",a._resize),setTimeout(function(){a._restoreEditorStatus();c.notifySelectionChange();c.fire("maximizeWindow")},30))},maximizeWindow:function(){!1!==this.editor.fire("beforeMaximizeWindow")&&(k||(k=(new i("<iframe  class='ke-maximize-shim' style='position:absolute;top:-9999px;left:-9999px;' frameborder='0'>")).prependTo(a.body,void 0)),this._real())},destroy:function(){this._resize&&(e.remove(window,"resize",this._resize),
this._resize=0)}});return{init:function(a){if(!a.hasCommand("maximizeWindow")){var c=new l(a);a.addCommand("maximizeWindow",{exec:function(){c.maximizeWindow()}});a.addCommand("restoreWindow",{exec:function(){c.restoreWindow()}})}}}},{requires:["editor"]});
KISSY.add("editor/plugin/maximize/index",function(h,j,l){return{init:function(c){l.init(c);c.addButton({title:"\u5168\u5c4f",contentCls:"ke-toolbar-maximize"},{onClick:function(){c.execCommand("restoreWindow");this.boff();this.set("title","\u5168\u5c4f");this.set("contentCls","ke-toolbar-maximize")},offClick:function(){c.execCommand("maximizeWindow");this.bon();this.set("title","\u53d6\u6d88\u5168\u5c4f");this.set("contentCls","ke-toolbar-restore")}})}}},{requires:["editor","./cmd"]});
KISSY.add("editor/plugin/multipleUpload/index",function(h,j,l){return{init:function(c){c.addButton({contentCls:"ke-toolbar-mul-image",title:"\u6279\u91cf\u63d2\u56fe",mode:j.WYSIWYG_MODE},{offClick:function(){l.useDialog(c,"multipleUpload/dialog")}})}}},{requires:["editor","../dialogLoader/"]});
KISSY.add("editor/plugin/outdent/cmd",function(h,j,l){var c=l.addCommand,f=l.checkOutdentActive;return{init:function(a){c(a,"outdent");var h=j.Utils.getQueryCmd("outdent");a.hasCommand(h)||a.addCommand(h,{exec:function(a,c){return f(c)}})}}},{requires:["editor","../dentUtils/cmd"]});
KISSY.add("editor/plugin/outdent/index",function(h,j,l){return{init:function(c){l.init(c);var f=j.Utils.getQueryCmd("outdent");c.addButton({title:"\u51cf\u5c11\u7f29\u8fdb\u91cf ",mode:j.WYSIWYG_MODE,contentCls:"ke-toolbar-outdent"},{offClick:function(){c.execCommand("outdent")},selectionChange:function(a){c.execCommand(f,a.path)?this.enable():this.disable()}})}}},{requires:["editor","./cmd"]});
KISSY.add("editor/plugin/overlay/focus",function(h,j){function l(){}var c=h.UA,f=j.focusManager;l.ATTRS={focus4e:{value:!0}};l.prototype={_uiSetFocus4e:function(a){a?(this.on("show",this._show4FocusExt,this),this.on("hide",this._hide4FocusExt,this)):(this.detach("show",this._show4FocusExt,this),this.detach("hide",this._hide4FocusExt,this))},_show4FocusExt:function(){var a=this._focusEditor=f.currentInstance();if(c.ie&&a){window.focus();document.body.focus();var h=a.get("document")[0].selection.createRange();
h&&h.item&&h.item(0).ownerDocument==a.get("document")[0]&&(a=document.body.createTextRange(),a.moveToElementText(this.get("el").first()[0]),a.collapse(!0),a.select())}},_hide4FocusExt:function(){var a=this._focusEditor;a&&a.focus()}};return l},{requires:["editor"]});
KISSY.add("editor/plugin/overlay/index",function(h,j,l,c){var f=l.extend([c],{},{ATTRS:{prefixCls:{value:"ke-"},zIndex:{value:j.baseZIndex(j.zIndexManager.OVERLAY)}}});f.Dialog=l.Dialog.extend([c],{show:function(){this.center();var a=this.get("y");200<a-h.DOM.scrollTop()&&(a=h.DOM.scrollTop()+200,this.set("y",a));f.prototype.show.call(this)}},{ATTRS:{prefixCls:{value:"ke-"},draggable:{value:!0},constrain:{value:!0},aria:{value:!0},zIndex:{value:j.baseZIndex(j.zIndexManager.OVERLAY)}}});return f},
{requires:["editor","overlay","./focus","dd"]});
KISSY.add("editor/plugin/pageBreak/index",function(h,j,l){var c=h.Node;return{init:function(f){l.init(f);var a=f.htmlDataProcessor;(a&&a.dataFilter).addRules({tags:{div:function(c){var e=c.getAttribute("style"),f;if(e)for(var h=c.childNodes,j=0;j<h.length;j++)1==h[j].nodeType&&(f=h[j]);if((f=f&&"span"==f.nodeName&&f.getAttribute("style"))&&/page-break-after\s*:\s*always/i.test(e)&&/display\s*:\s*none/i.test(f))return a.createFakeParserElement(c,"ke_pagebreak","div")}}});f.addButton({title:"\u5206\u9875",mode:j.WYSIWYG_MODE,
contentCls:"ke-toolbar-pagebreak"},{offClick:function(){var a=this.get("editor"),e=new c('<div style="page-break-after: always; "><span style="DISPLAY:none">&nbsp;</span></div>',null,a.get("document")[0]),e=a.createFakeElement(e,"ke_pagebreak","div",!1,'<div style="page-break-after: always; "><span style="DISPLAY:none">&nbsp;</span></div>'),f=a.getSelection();if(f=f&&f.getRanges()[0]){a.execCommand("save");for(var h=f.startContainer,j=h;"body"!==h.nodeName();)j=h,h=h.parent();f.collapse(!0);f.splitElement(j);
e.insertAfter(j);a.execCommand("save")}}})}}},{requires:["editor","../fakeObjects/"]});
KISSY.add("editor/plugin/preview/index",function(){var h=window;return{init:function(j){j.addButton({title:"\u9884\u89c8",contentCls:"ke-toolbar-preview"},{offClick:function(){var j=this.get("editor");try{var c=h.screen,f=Math.round(0.8*c.width),a=Math.round(0.7*c.height),i=Math.round(0.1*c.width)}catch(e){f=640,a=420,i=80}j=j.getDocHtml().replace(/\${title}/,"\u9884\u89c8");f=h.open("","","toolbar=yes,location=no,status=yes,menubar=yes,scrollbars=yes,resizable=yes,width="+f+",height="+a+",left="+i);a=f.document;a.open();
a.write(j);a.close();f.focus()}})}}});
KISSY.add("editor/plugin/progressbar/index",function(h){function j(){j.superclass.constructor.apply(this,arguments);this._init()}var l=h.Node;j.ATTRS={container:{},width:{},height:{},progress:{value:0}};h.extend(j,h.Base,{destroy:function(){this.detach();this.el.remove()},_init:function(){var c=this.get("height"),f=new l("<div class='ke-progressbar'  style='width:"+this.get("width")+";height:"+c+";'></div>"),a=this.get("container"),c=(new l("<div style='overflow:hidden;'><div class='ke-progressbar-inner' style='height:"+(parseInt(c)-
4)+"px'><div class='ke-progressbar-inner-bg'></div></div></div>")).appendTo(f),h=(new l("<span class='ke-progressbar-title'></span>")).appendTo(f);a&&f.appendTo(a);this.el=f;this._title=h;this._p=c;this.on("afterProgressChange",this._progressChange,this);this._progressChange({newVal:this.get("progress")})},_progressChange:function(c){c=c.newVal;this._p.css("width",c+"%");this._title.html(c+"%")}});return j});
KISSY.add("editor/plugin/removeFormat/cmd",function(h,j){function l(a,c){for(var e=0;e<c.length;e++)a.removeAttr(c[e])}var c=j.RANGE,f=j.ElementPath,a=h.DOM,i="class,style,lang,width,height,align,hspace,valign".split(/,/),e=RegExp("^(?:"+"b,big,code,del,dfn,em,font,i,ins,kbd,q,samp,small,span,strike,strong,sub,sup,tt,u,var,s".replace(/,/g,"|")+")$","i");return{init:function(g){g.hasCommand("removeFormat")||g.addCommand("removeFormat",{exec:function(){g.focus();e.lastIndex=0;var h=g.getSelection().getRanges();
g.execCommand("save");for(var j=0,n;n=h[j];j++)if(!n.collapsed){n.enlarge(c.ENLARGE_ELEMENT);var o=n.createBookmark(),d=o.startNode,b=o.endNode,q=function(a){for(var b=new f(a),c=b.elements,d=1,g;(g=c[d])&&!g.equals(b.block)&&!g.equals(b.blockLimit);d++)e.test(g.nodeName())&&a._4e_breakParent(g)};q(d);q(b);for(d=d._4e_nextSourceNode(!0,a.ELEMENT_NODE,void 0,void 0);d&&!d.equals(b);)q=d._4e_nextSourceNode(!1,a.ELEMENT_NODE,void 0,void 0),"img"==d.nodeName()&&d.attr("_ke_realelement")||(e.test(d.nodeName())?
d._4e_remove(!0):l(d,i)),d=q;n.moveToBookmark(o)}g.getSelection().selectRanges(h);g.execCommand("save")}})}}},{requires:["editor"]});KISSY.add("editor/plugin/removeFormat/index",function(h,j,l){return{init:function(c){l.init(c);c.addButton({title:"\u6e05\u9664\u683c\u5f0f",mode:j.WYSIWYG_MODE,contentCls:"ke-toolbar-removeformat"},{offClick:function(){c.execCommand("removeFormat")}})}}},{requires:["editor","./cmd","../button/"]});
KISSY.add("editor/plugin/resize/index",function(h,j,l){var c=h.Node;return{init:function(f){var a=l.Draggable,i=f.get("statusBarEl");f.get("textarea");var e=(f.get("pluginConfig").resize||{}).direction||["x","y"],g="se-resize";1==e.length&&(g="x"==e[0]?"e-resize":"s-resize");var j=(new c("<div class='ke-resizer' style='cursor: "+g+"'></div>")).appendTo(i);f.on("maximizeWindow",function(){j.css("display","none")});f.on("restoreWindow",function(){j.css("display","")});var p=new a({node:j}),n=0,o=0,
d=f.get("el"),b=f.get("el");p.on("dragstart",function(){n=d.height();o=b.width();f.fire("resizeStart")});p.on("drag",function(a){var b=a.left-this.startNodePos.left,a=a.top-this.startNodePos.top;h.inArray("y",e)&&f.set("height",n+a);h.inArray("x",e)&&f.set("width",o+b);f.fire("resize")});f.on("destroy",function(){p.destroy();j.remove()})}}},{requires:["editor","dd"]});
KISSY.add("editor/plugin/select/index",function(h,j,l,c){function f(a){f.superclass.constructor.call(this,a);this._init()}function a(a){return a&&-1==a.indexOf("<")?a:0}var i=h.Node,e=i.all,g=h.Event,k=h.DOM,p=j.XHTML_DTD;f.DISABLED=0;f.ENABLED=1;f.ATTRS={showValue:{},el:{},cls:{},container:{},doc:{},value:{},width:{},popUpWidth:{},title:{},items:{},emptyText:{},align:{value:["l","b"]},menuContainer:{valueFn:function(){for(var a=this.el.parent();a;){var b=a.nodeName();if(p[b]&&p[b].div)return a;a=
a.parent()}return e(document.body)}},state:{value:1}};f.decorate=function(a){var b=a.width(),c=[];a.all("option").each(function(a){c.push({name:a.html(),value:a.val()})});return new f({width:b+"px",title:a.attr("title"),el:a,items:c,cls:"ke-combox",value:a.val()})};var n=j.Utils.addRes,o=j.Utils.destroyRes;h.extend(f,h.Base,{_init:function(){var d=this,b=d.get("container"),f=d.get("el"),g=e("<span class='ke-select-wrap'><a class='ke-select'  hidefocus='hidefocus' tabindex='0'><span class='ke-select-text'><span class='ke-select-text-inner'></span></span><span class='ke-select-drop-wrap'><span class='ke-select-drop'></span></span></a></span>"),
h=g.one("a"),i=d.get("title")||"",k=d.get("cls"),l=g.one(".ke-select-text"),n=g.one(".ke-select-text-inner");g.one(".ke-select-drop");d.get("value")!==c?n.html(d._findNameByV(d.get("value"))):n.html(i);g.unselectable(c);l.css("width",d.get("width"));i&&g.attr("title",i);h.attr("href","javascript:void('"+a(i)+"')");k&&g.addClass(k,c);f?f[0].parentNode.replaceChild(g[0],f[0]):b&&g.appendTo(b,c);g.on("click",d._click,d);g.on("keydown",d._keydown,d);d.el=g;d.title=n;d._focusA=g.one("a.ke-select");d._focusA.on("blur",
function(){d.menu&&d.menu.hide()});j.Utils.lazyRun(this,"_prepare","_real");d.on("afterValueChange",d._valueChange,d);d.on("afterStateChange",d._stateChange,d)},_keydown:function(a){var b;switch(a.keyCode){case g.KeyCodes.DOWN:a.halt();if(!this._isShown()){this._click();this._findCurrent()||e(this.as[0]).addClass("ke-menu-selected",c);break}a=e(this._findCurrent());a.removeClass("ke-menu-selected",c);(b=a.next())?b.addClass("ke-menu-selected",c):e(this.as[0]).addClass("ke-menu-selected",c);break;
case g.KeyCodes.UP:a.halt();if(!this._isShown())break;a=e(this._findCurrent());a.removeClass("ke-menu-selected",c);(b=a.prev(c,c))?b.addClass("ke-menu-selected",c):e(this.as[this.as.length-1]).addClass("ke-menu-selected",c);break;case g.KeyCodes.ENTER:a.halt();if(!this._isShown()){this._click();this._findCurrent()||e(this.as[0]).addClass("ke-menu-selected",c);break}a=e(this._findCurrent());if(!a)break;this._select({target:a});break;case g.KeyCodes.ESC:a.halt();if(!this._isShown())break;this.menu.hide()}},
_findCurrent:function(){var a=c;this.as.each(function(b){if(b.hasClass("ke-menu-selected",c))return a=b,!1});return a},_isShown:function(){return this.menu&&this.menu.get("visible")},_findNameByV:function(a){var b=this.get("title")||"",c=this.get("items");if(this.get("showValue"))return a||b;h.each(c,function(c){if(c.value==a)return b=c.name,!1});return b},_valueChange:function(a){this.title.html(this._findNameByV(a.newVal))},_itemsChange:function(d){var b,d=d.newVal,f=this._selectList;f.html("");
if(d&&d.length)for(b=0;b<d.length;b++){var g=d[b];(new i(h.substitute("<a class='ke-select-menu-item' tabindex='-1' href='javascript:void(\"{tip}\")' data-value='{value}'>{name}</a>",{tip:a(g.name),value:g.value,name:g.name}),g.attrs)).unselectable(c).appendTo(f,c)}else(b=this.get("emptyText"))&&e(h.substitute("<a class='ke-select-menu-item' tabindex='-1' href='javascript:void(\"{tip}\")' data-value='{value}'>{name}</a>",{tip:a(b),value:"",name:b})).appendTo(f,c);this.as=f.all("a")},val:function(a){return a!==
c?(this.set("value",a),this):this.get("value")},_resize:function(){this.menu.get("visible")&&this._real()},_prepare:function(){var a=this,b=a.el,f=a._focusA,h=a.get("popUpWidth"),h=new l({autoRender:!0,render:a.get("menuContainer"),content:"<div>",elCls:"ke-menu",width:h?h:b.width(),zIndex:j.baseZIndex(j.zIndexManager.SELECT)}),i=a.get("items");h.on("hide",function(){f.removeClass("ke-select-active",c)});h.on("show",function(){f.addClass("ke-select-active",c)});n.call(a,h);b=h.get("contentEl").one("div");
a.menu=h;h.get("el").on("mousedown",function(a){a.halt()});g.on(window,"resize",a._resize,a);n.call(a,function(){g.remove(window,"resize",a._resize,a)});a.get("title")&&e("<div class='ke-menu-title ke-select-menu-item' style='margin-top:-6px;' >"+a.get("title")+"</div>").appendTo(b,c);a._selectList=e("<div>").appendTo(b,c);a._itemsChange({newVal:i});b.on("click",a._select,a);a.as=a._selectList.all("a");b.on("mouseenter",function(){a.as.removeClass("ke-menu-selected",c)});n.call(a,b);a.on("afterItemsChange",
a._itemsChange,a);a.menuNode=b},_stateChange:function(a){var b=this.el;1==a.newVal?b.removeClass("ke-select-disabled",c):b.addClass("ke-select-disabled",c)},enable:function(){this.set("state",1)},disable:function(){this.set("state",0)},_select:function(a){a&&a.halt&&a.halt();var b=this.menu,f=this.menuNode;if((a=e(a.target).closest(function(a){return k.contains(f,a)&&"a"==k.nodeName(a)},c))&&a.attr("data-value")){var g=this.get("value"),h=a.attr("data-value");this.set("value",h);this.fire("click",
{newVal:h,prevVal:g,name:a.html()});b.hide()}},_real:function(){var a=this.el,b=a.offset(),c=h.clone(b),e=this.menu.get("el").height(),f=this.menu.get("el").width(),g=k.scrollTop(),i=k.scrollLeft(),j=k.viewportHeight(),l=k.viewportWidth(),l=i+l-60,j=g+j,n=b.top+(a.height()-2),a=b.left+a.width()-2,o=this.get("align"),p=o[0];"b"==o[1]?(b.top=n,b.top+e>j&&c.top-g>j-n&&(b.top=c.top-e)):(b.top=c.top-e,b.top<g&&c.top-g<j-n&&(b.top=n));"l"==p?b.left+f>l&&a-i>l-c.left&&(b.left=a-f):(b.left=a-f,b.left<i&&
a-i<l-c.left&&(b.left=c.left));this.menu.set("xy",[b.left,b.top]);this.menu.show()},_click:function(a){a&&a.halt();var a=this.el,b=this.menu,e=this.get("value");if(b&&b.get("visible"))b.hide();else{this._focusA[0].focus();if(a.hasClass("ke-select-disabled",c))return!1;this.fire("select");this._prepare();e&&b&&this.as.each(function(a){a.attr("data-value")==e?a.addClass("ke-menu-selected",c):a.removeClass("ke-menu-selected",c)})}},destroy:function(){o.call(this);this.el.remove()}});j.prototype.addSelect=
function(a,b,c){var c=c||f,e=this;a.editor=e;var g=new c(h.mix({container:e.get("toolBarEl"),doc:e.get("document")[0]},a));h.mix(g,b);e.on("selectionChange",function(){e.get("mode")!=j.SOURCE_MODE&&g.selectionChange&&g.selectionChange.apply(g,arguments)});e.on("destroy",function(){g.destroy()});g.on("click",function(a){var b=a.type;g[b]&&g[b].apply(g,arguments);a.halt()});a.mode==j.WYSIWYG_MODE&&(e.on("wysiwygMode",g.enable,g),e.on("sourceMode",g.disable,g));g.init&&g.init();return g};return f},{requires:["editor",
"overlay"]});KISSY.add("editor/plugin/separator/index",function(h){return{init:function(j){var l=(new h.Node('<span class="ke-toolbar-separator">&nbsp;</span>')).appendTo(j.get("toolBarEl"));j.on("destroy",function(){l.remove()})}}},{requires:["editor"]});
KISSY.add("editor/plugin/smiley/index",function(h,j,l){for(var c="<div class='ke-smiley-sprite'>",f=0;98>=f;f++)c+="<a href='javascript:void(0)' data-icon='http://a.tbcdn.cn/sys/wangwang/smiley/48x48/"+f+".gif'></a>";c+="</div>";return{init:function(a){a.addButton({contentCls:"ke-toolbar-smiley",title:"\u63d2\u5165\u8868\u60c5",keepFocus:!1,mode:j.WYSIWYG_MODE},{init:function(){var a=this;a.get("el").on("blur",function(){a.smiley&&setTimeout(function(){a.smiley.hide()},100)})},offClick:function(){this.smiley||(this.smiley=
new l({content:c,focus4e:!1,width:"297px",autoRender:!0,elCls:"ke-popup",zIndex:j.baseZIndex(j.zIndexManager.POPUP_MENU),mask:!1}),this.smiley.get("el").on("click",function(c){var c=new h.Node(c.target),e;if("a"==c.nodeName()&&(e=c.attr("data-icon")))e=new h.Node("<img alt='' src='"+e+"'/>",null,a.get("document")[0]),a.insertElement(e)}));this.smiley.set("align",{node:this.get("el"),points:["bl","tl"]});this.smiley.show()},onClick:function(){this.smiley.hide()},destructor:function(){this.smiley&&
this.smiley.destroy()}})}}},{requires:["editor","../overlay/"]});KISSY.add("editor/plugin/sourceArea/index",function(h,j){var l=j.SOURCE_MODE,c=j.WYSIWYG_MODE;return{init:function(f){f.addButton({title:"\u6e90\u7801",contentCls:"ke-toolbar-source"},{init:function(){f.on("wysiwygMode",this.boff,this);f.on("sourceMode",this.bon,this)},offClick:function(){f.set("mode",l)},onClick:function(){f.set("mode",c)}})}}},{requires:["editor","../button/"]});
KISSY.add("editor/plugin/strikeThrough/cmd",function(h,j,l){var c=new j.Style({element:"del",overrides:[{element:"span",attributes:{style:"text-decoration: line-through;"}},{element:"s"},{element:"strike"}]});return{init:function(f){l.addButtonCmd(f,"strikeThrough",c)}}},{requires:["editor","../font/cmd"]});
KISSY.add("editor/plugin/strikeThrough/index",function(h,j,l,c){return{init:function(f){c.init(f);f.addButton({cmdType:"strikeThrough",contentCls:"ke-toolbar-strikeThrough",title:"\u5220\u9664\u7ebf "},void 0,l.Button)}}},{requires:["editor","../font/ui","./cmd"]});
KISSY.add("editor/plugin/table/index",function(h,j,l,c){function f(a){function c(a){!(0<f.length)&&a[0].nodeType==b.ELEMENT_NODE&&w.test(a.nodeName())&&!a.data("selected_cell")&&(a._4e_setMarker(g,"selected_cell",!0,void 0),f.push(a))}for(var d=a.createBookmarks(),e=a.getRanges(),f=[],g={},h=0;h<e.length;h++){var i=e[h];if(i.collapsed)i=i.getCommonAncestor(),(i=i.closest("td",void 0)||i.closest("th",void 0))&&f.push(i);else{var i=new Walker(i),k;for(i.guard=c;k=i.next();)if((k=k.parent())&&w.test(k.nodeName())&&
!k.data("selected_cell"))k._4e_setMarker(g,"selected_cell",!0,void 0),f.push(k)}}j.Utils.clearAllMarkers(g);a.selectBookmarks(d);return f}function a(a,b){var c=a.getStartElement().parent("tr");if(c){var e=c.clone(!0);e.insertBefore(c);c=(b?e[0]:c[0]).cells;for(e=0;e<c.length;e++)c[e].innerHTML="",d.ie||(new q(c[e]))._4e_appendBogus(void 0)}}function i(a){if(a instanceof j.Selection){for(var b=f(a),c=b.length,a=[],d,e,g=0;g<c;g++){var h=b[g].parent(),k=h[0].rowIndex;!g&&(d=k-1);a[k]=h;g==c-1&&(e=k+
1)}g=h.parent("table");d=new q(e<g[0].rows.length&&g[0].rows[e]||0<d&&g[0].rows[d]||g[0].parentNode);for(g=a.length;0<=g;g--)a[g]&&i(a[g]);return d}a instanceof q&&(g=a.parent("table"),1==g[0].rows.length?g.remove():a.remove());return 0}function e(a,b){var c=a.getStartElement();if(c=c.closest("td",void 0)||c.closest("th",void 0))for(var e=c.parent("table"),f=c[0].cellIndex,g=0;g<e[0].rows.length;g++){var h=e[0].rows[g];h.cells.length<f+1||(c=new q(h.cells[f].cloneNode(void 0)),d.ie||c._4e_appendBogus(void 0),
h=new q(h.cells[f]),b?c.insertBefore(h):c.insertAfter(h))}}function g(a){if(a instanceof j.Selection){var b=f(a),c,d=[],a=b[0]&&b[0].parent("table"),e,h,k;e=0;for(h=b.length;e<h;e++)d.push(b[e][0].cellIndex);d.sort();e=1;for(h=d.length;e<h;e++)if(1<d[e]-d[e-1]){k=d[e-1]+1;break}k||(k=0<d[0]?d[0]-1:d[d.length-1]+1);d=a[0].rows;e=0;for(h=d.length;e<h&&!(c=d[e].cells[k]);e++);c=c?new q(c):a.prev();for(k=b.length-1;0<=k;k--)b[k]&&g(b[k]);return c}if(a instanceof q){b=a.parent("table");if(!b)return null;
c=a[0].cellIndex;for(k=b[0].rows.length-1;0<=k;k--)a=new q(b[0].rows[k]),!c&&1==a[0].cells.length?i(a):a[0].cells[c]&&a[0].removeChild(a[0].cells[c])}return null}function k(a,b){var c=new j.Range(a[0].ownerDocument);if(!c.moveToElementEditablePosition(a,b?!0:void 0))c.selectNodeContents(a),c.collapse(b?!1:!0);c.select(!0)}function p(a){var c=(a=a.getSelection())&&a.getStartElement(),d=c&&c.closest("table",void 0);if(d)return a=c.closest(function(a){var c=b.nodeName(a);return d.contains(a)&&("td"==
c||"th"==c)},void 0),c=c.closest(function(a){var c=b.nodeName(a);return d.contains(a)&&"tr"==c},void 0),{table:d,td:a,tr:c}}function n(a){return(a=p(a))&&a.td}function o(a){return(a=p(a))&&a.tr}var d=h.UA,b=h.DOM,q=h.Node,m=["tr","th","td","tbody","table"],w=/^(?:td|th)$/,u={"\u8868\u683c\u5c5e\u6027":p,"\u5220\u9664\u8868\u683c":n,"\u5220\u9664\u5217":n,"\u5220\u9664\u884c":o,"\u5728\u4e0a\u65b9\u63d2\u5165\u884c":o,"\u5728\u4e0b\u65b9\u63d2\u5165\u884c":o,"\u5728\u5de6\u4fa7\u63d2\u5165\u5217":n,"\u5728\u53f3\u4fa7\u63d2\u5165\u5217":n},t=(6===d.ie?["table.%2,","table.%2 td, table.%2 th,","{","border : #d3d3d3 1px dotted","}"]:" table.%2,; table.%2 > tr > td,  table.%2 > tr > th,; table.%2 > tbody > tr > td,  table.%2 > tbody > tr > th,; table.%2 > thead > tr > td,  table.%2 > thead > tr > th,; table.%2 > tfoot > tr > td,  table.%2 > tfoot > tr > th;{;border : #d3d3d3 1px dotted;}".split(";")).join("").replace(/%2/g,
"ke_show_border"),r={elements:{table:function(a){var a=a.attributes,b=a["class"],c=parseInt(a.border,10);if(!c||0>=c)a["class"]=(b||"")+" ke_show_border"}}},x={elements:{table:function(a){var a=a.attributes,b=a["class"];b&&(a["class"]=h.trim(b.replace("ke_show_border","")))}}};return{init:function(d){d.addCustomStyle(t);var f=d.htmlDataProcessor,n=f&&f.htmlFilter;(f&&f.dataFilter).addRules(r);n.addRules(x);c.register({editor:d,filter:function(a){if(h.inArray(b.nodeName(a),m))return!0},statusChecker:u,
width:"120px",handlers:{"\u8868\u683c\u5c5e\u6027":function(){var a=p(d);a&&l.useDialog(d,"table/dialog",{selectedTable:a.table,selectedTd:a.td})},"\u5220\u9664\u8868\u683c":function(){var a=d.getSelection(),b=a&&a.getStartElement();if(b=b&&b.closest("table",void 0)){a.selectElement(b);var c=a.getRanges()[0];c.collapse();a.selectRanges([c]);a=b.parent();1==a[0].childNodes.length&&"body"!=a.nodeName()&&"td"!=a.nodeName()?a.remove():b.remove()}},"\u5220\u9664\u884c ":function(){var a=d.getSelection();k(i(a),void 0)},"\u5220\u9664\u5217 ":function(){var a=d.getSelection();
(a=g(a))&&k(a,!0)},"\u5728\u4e0a\u65b9\u63d2\u5165\u884c":function(){var b=d.getSelection();a(b,!0)},"\u5728\u4e0b\u65b9\u63d2\u5165\u884c":function(){var b=d.getSelection();a(b,void 0)},"\u5728\u5de6\u4fa7\u63d2\u5165\u5217":function(){var a=d.getSelection();e(a,!0)},"\u5728\u53f3\u4fa7\u63d2\u5165\u5217":function(){var a=d.getSelection();e(a,void 0)}}});d.addButton({contentCls:"ke-toolbar-table",mode:j.WYSIWYG_MODE,title:"\u63d2\u5165\u8868\u683c"},{offClick:function(){l.useDialog(d,"table/dialog",{selectedTable:0,selectedTd:0})}})}}},{requires:["editor","../dialogLoader/","../contextmenu/"]});
KISSY.add("editor/plugin/underline/cmd",function(h,j,l){var c=new j.Style({element:"u",overrides:[{element:"span",attributes:{style:"text-decoration: underline;"}}]});return{init:function(f){l.addButtonCmd(f,"underline",c)}}},{requires:["editor","../font/cmd"]});KISSY.add("editor/plugin/underline/index",function(h,j,l,c){return{init:function(f){c.init(f);f.addButton({cmdType:"underline",contentCls:"ke-toolbar-underline",title:"\u4e0b\u5212\u7ebf "},void 0,l.Button)}}},{requires:["editor","../font/ui","./cmd"]});
KISSY.add("editor/plugin/undo/btn",function(h,j,l){function c(){this.get("editor").on("afterSave afterRestore",this._respond,this);this.disable()}function f(){f.superclass.constructor.apply(this,arguments);c.call(this)}function a(){a.superclass.constructor.apply(this,arguments);c.call(this)}h.extend(f,l,{offClick:function(){this.get("editor").execCommand("undo")},_respond:function(a){0<a.index?this.boff():this.disable()}});h.extend(a,l,{offClick:function(){this.get("editor").execCommand("redo")},
_respond:function(a){a.index<a.history.length-1?this.boff():this.disable()}});return{RedoBtn:a,UndoBtn:f}},{requires:["editor","../button/"]});
KISSY.add("editor/plugin/undo/cmd",function(h,j){function l(a){var c=a.get("document")[0].body.innerHTML,e;c&&(e=a.getSelection());this.contents=c;this.bookmarks=e&&e.createBookmarks2(!0)}function c(a){this.history=[];this.index=-1;this.editor=a;this.bufferRunner=h.buffer(this.save,500,this);this._init()}var f=j.Utils.arrayCompare,a=h.UA;h.augment(l,{equals:function(a){if(this.contents!=a.contents)return!1;var c=this.bookmarks,a=a.bookmarks;if(c||a){if(!c||!a||c.length!=a.length)return!1;for(var e=
0;e<c.length;e++){var h=c[e],i=a[e];if(h.startOffset!=i.startOffset||h.endOffset!=i.endOffset||!f(h.start,i.start)||!f(h.end,i.end))return!1}}return!0}});var i={16:1,17:1,18:1},e={37:1,38:1,39:1,40:1,33:1,34:1};h.augment(c,{_keyMonitor:function(){var a=this,c=a.editor;c.get("document").on("keydown",function(f){var h=f.keyCode;h in e||h in i||(90===h&&(f.ctrlKey||f.metaKey)?(!1!==c.fire("restore",{direction:-1})&&a.restore(-1),f.halt()):89===h&&(f.ctrlKey||f.metaKey)?(!1!==c.fire("restore",{direction:1})&&
a.restore(1),f.halt()):!1!==c.fire("save",{buffer:1})&&a.save(1))})},_init:function(){var a=this;a._keyMonitor();setTimeout(function(){a.save()},0)},save:function(a){if(this.editor.get("mode")==j.WYSIWYG_MODE)if(a)this.bufferRunner();else{var a=this.history,c=this.index;a.length>c+1&&a.splice(c+1,a.length-c-1);var e=this.editor,c=a[a.length-1],f=new l(e);if(!c||!c.equals(f))30===a.length&&a.shift(),a.push(f),this.index=c=a.length-1,e.fire("afterSave",{history:a,index:c})}},restore:function(c){if(this.editor.get("mode")==
j.WYSIWYG_MODE){var e=this.history,f=this.editor,h=f.get("document")[0].body,i=e[this.index+c];i&&(h.innerHTML=i.contents,i.bookmarks?f.getSelection().selectBookmarks(i.bookmarks):a.ie&&(h=h.createTextRange(),h.collapse(!0),h.select()),(h=f.getSelection())&&h.scrollIntoView(),this.index+=c,f.fire("afterRestore",{history:e,index:this.index}),f.notifySelectionChange());return i}}});return{init:function(a){if(!a.hasCommand("save")){var e=new c(a);a.addCommand("save",{exec:function(a,c){e.save(c)}});
a.addCommand("undo",{exec:function(){e.restore(-1)}});a.addCommand("redo",{exec:function(){e.restore(1)}})}}}},{requires:["editor"]});KISSY.add("editor/plugin/undo/index",function(h,j,l,c){return{init:function(f){c.init(f);f.addButton({mode:j.WYSIWYG_MODE,title:"\u64a4\u9500",editor:f,contentCls:"ke-toolbar-undo"},void 0,l.UndoBtn);f.addButton({mode:j.WYSIWYG_MODE,title:"\u91cd\u505a",editor:f,contentCls:"ke-toolbar-redo"},void 0,l.RedoBtn)}}},{requires:["editor","./btn","./cmd"]});
KISSY.add("editor/plugin/video/index",function(h,j,l,c){return{init:function(f){function a(a){for(var c=0;c<g.length;c++){var d=g[c];if(d.reg.test(a))return d}}var h=f.htmlDataProcessor,e=h&&h.dataFilter,g=[],k=f.get("pluginConfig");k.video=k.video||{};k=k.video;k.providers&&g.push.apply(g,k.providers);k.getProvider=a;e&&e.addRules({elements:{object:function(c){var e=c.getAttribute("classid"),d=c.childNodes;if(!e){for(e=0;e<d.length;e++)if("embed"==d[e].name){if(!l.isFlashEmbed(d[e]))break;if(a(d[e].getAttribute("src")))return h.createFakeParserElement(c,
"ke_video","video",!0)}return null}for(e=0;e<d.length;e++){var b=d[e];if("param"==b.nodeName&&"movie"==b.getAttribute("name").toLowerCase()&&a(b.getAttribute("value")))return h.createFakeParserElement(c,"ke_video","video",!0)}},embed:function(c){if(!l.isFlashEmbed(c))return null;if(a(c.getAttribute("src")))return h.createFakeParserElement(c,"ke_video","video",!0)}}},4);var p=new c({editor:f,cls:"ke_video",type:"video",contextMenuHandlers:{"\u89c6\u9891\u5c5e\u6027":function(){var a=this.selectedEl;a&&p.show(a)}}});f.addButton({contentCls:"ke-toolbar-video",
title:"\u63d2\u5165\u89c6\u9891",mode:j.WYSIWYG_MODE},{offClick:function(){p.show()}})}}},{requires:["editor","../flashCommon/utils","../flashCommon/baseClass"]});
KISSY.add("editor/plugin/xiamiMusic/index",function(h,j,l,c){function f(){f.superclass.constructor.apply(this,arguments)}h.extend(f,l,{_updateTip:function(a,c){var e=this.get("editor").restoreRealElement(c);e&&(a.html(c.attr("title")),a.attr("href",this._getFlashUrl(e)))}});return{init:function(a){function h(a){return/xiami\.com/i.test(a)}var e=a.htmlDataProcessor,g=e&&e.dataFilter;g&&g.addRules({tags:{object:function(a){var f=a.getAttribute("title"),g,d;g=a.getAttribute("classid");var b=a.childNodes;
if(!g){for(g=0;g<b.length;g++)if(d=b[g],"embed"==d.nodeName){if(!c.isFlashEmbed(d))break;if(h(d.attributes.src))return e.createFakeParserElement(a,"ke_xiami","xiamiMusic",!0,{title:f})}return null}for(g=0;g<b.length;g++)if(d=b[g],"param"==d.nodeName&&"movie"==d.getAttribute("name")&&h(d.getAttribute("value")))return e.createFakeParserElement(a,"ke_xiami","xiamiMusic",!0,{title:f})},embed:function(a){if(c.isFlashEmbed(a)&&h(a.getAttribute("src")))return e.createFakeParserElement(a,"ke_xiami","xiamiMusic",
!0,{title:a.getAttribute("title")})}}},4);var k=new f({editor:a,cls:"ke_xiami",type:"xiamiMusic",contextMenuHandlers:{"\u867e\u7c73\u5c5e\u6027":function(){var a=this.selectedEl;a&&k.show(a)}}});a.addButton({contentCls:"ke-toolbar-music",title:"\u63d2\u5165\u867e\u7c73\u97f3\u4e50",mode:j.WYSIWYG_MODE},{offClick:function(){k.show()}})}}},{requires:["editor","../flashCommon/baseClass","../flashCommon/utils"]});KISSY.add("editor/full",function(h,j){return j},{requires:["editor"]});
