/*
Copyright 2012, KISSY UI Library v1.40dev
MIT Licensed
build time: Dec 6 01:12
*/
KISSY.add("xtemplate/runtime/base",function(e){function c(a,g){"string"==typeof a&&(a=a.replace(/\{\{@/g,"{{#"));this.tpl=a;g=e.merge(b,g);g.subTpls=e.merge(g.subTpls,c.subTpls);g.commands=e.merge(g.commands,c.commands);this.option=g}var f=0,d={},b={cache:!0,utils:{getProperty:function(a,b){if(!b)return!1;var a=a.split("."),d=a.length,f,e=b;for(f=0;f<d;f++){if(!(a[f]in e))return!1;e=e[a[f]]}return[e]}}};c.prototype={constructor:c,removeSubTpl:function(a){delete this.option.subTpls[a]},removeCommand:function(a){delete this.option.commands[a]},
addSubTpl:function(a,b){this.option.subTpls[a]=b},addCommand:function(a,b){this.option.commands[a]=b},__compile:function(){var a=this.option,b=e.require("xtemplate/compiler");if(!b)return null;b=b.compile(this.tpl);return Function.apply(null,[].concat(b.params).concat(b.source.join("\n")+"//@ sourceURL="+(a.name?a.name:"xtemplate"+f++)+".js"))},compile:function(){var a=this.tpl,b=this.option;this.compiled||(e.isFunction(a)||(this.tpl=b.cache?d[a]||(d[a]=this.__compile()):this.__compile()),this.compiled=
!!this.tpl);return this.tpl},render:function(a){this.compile();e.isArray(a)||(a=[a]);return this.tpl(a,this.option)}};return c});
KISSY.add("xtemplate/runtime/commands",function(e,c){return{each:function(f,d){var b=d.params;if(!b||1!=b.length)throw Error("each must has one param");var b=b[0],a="",g,c;if(e.isArray(b)){var j=[0].concat(f);g=b.length;for(var i=0;i<g;i++){var h={};c=b[i];h["this"]=c;h.xcount=g;h.xindex=i;e.isObject(c)&&e.mix(h,c);j[0]=h;a+=d.fn(j)}}else throw Error("each can only apply to array");return a},"with":function(f,d){var b=d.params;if(!b||1!=b.length)throw Error("with must has one param");var b=b[0],a=
[0].concat(f),c="";if(e.isObject(b))a[0]=b,c=d.fn(a);else throw Error("with can only apply to object");return c},"if":function(c,d){var b=d.params;if(!b||1!=b.length)throw Error("if must has one param");var a="";b[0]?a=d.fn(c):d.inverse&&(a=d.inverse(c));return a},set:function(c,d){e.mix(c[0],d.hash);return""},include:function(e,d){var b=d.params;if(!b||1!=b.length)throw Error("include must has one param");var b=b[0],a;if(!(a=d.subTpls[b]))throw Error('does not include sub template "'+b+'"');return(new c(a,
{cache:d.cache,commands:d.commands,subTpls:d.subTpls})).render(e)}}},{requires:["./base"]});KISSY.add("xtemplate/runtime",function(e,c,f){c.addCommand=function(b,a){f[b]=a};c.commands=f;var d={};c.subTpls=d;c.addSubTpl=function(b,a){d[b]=a};return c},{requires:["./runtime/base","./runtime/commands"]});
