/*
Copyright 2012, KISSY UI Library v1.40dev
MIT Licensed
build time: Aug 21 20:57
*/
KISSY.add("kison/Grammar",function(c,l,g,e,f,k,j){function m(b){var d=0,a;for(a in b)b.hasOwnProperty(a)&&d++;return d}function p(b,d){for(var a=0;a<d.length;a++)if(b.equals(d[a]))return a;return-1}function n(){n.superclass.constructor.apply(this,arguments);this.buildTerminals();this.buildNonTerminals();this.buildNullAble();this.buildFirsts();this.buildItemSet();this.buildLalrItemSets();this.buildTable()}var q=c.mix;c.extend(n,l,{buildTerminals:function(){var b=this.get("lexer"),b=b&&b.get("rules"),
d=this.get("terminals");d.$EOF=1;c.each(b,function(b){b.token&&(d[b.token]=1)})},buildNonTerminals:function(){var b=this.get("terminals"),d=this.get("nonTerminals"),a=this.get("productions");c.each(a,function(a){var i=a.get("symbol"),h=d[i];h||(h=d[i]=new f({symbol:i}));h.get("productions").push(a);c.each(a.get("handles"),function(a){!b[a]&&!d[a]&&(d[a]=new f({symbol:a}))})})},buildNullAble:function(){for(var b=this,d,a,o,i,h,r,e,f=b.get("nonTerminals"),k=!0;k;)for(i in k=!1,c.each(b.get("productions"),
function(i){if(!i.get("nullAble")){a=i.get("rhs");for(o=d=0;h=a[d];++d)b.isNullAble(h)&&o++;o===d&&i.set("nullAble",k=!0)}}),f)if(f.hasOwnProperty(i)&&!f[i].get("nullAble")){e=f[i].get("productions");for(d=0;r=e[d];d++)r.get("nullAble")&&f[i].set("nullAble",k=!0)}},isNullAble:function(b){var d=this.get("nonTerminals");if(b instanceof Array){for(var d=0,a;a=b[d];++d)if(!this.isNullAble(a))return!1;return!0}return d[b]?d[b].get("nullAble"):!1},findFirst:function(b){var d={},a,c,i=this.get("nonTerminals");
if(b instanceof Array){for(c=0;(a=b[c])&&!(i[a]?q(d,i[a].get("firsts")):d[a]=1,!this.isNullAble(a));++c);return d}return i[b]?i[b].get("firsts"):[b]},buildFirsts:function(){var b=this,d;b.get("productions");for(var a=b.get("nonTerminals"),e=!0,i,h;e;)for(i in e=!1,c.each(b.get("productions"),function(a){var d=b.findFirst(a.get("rhs"));m(d)!==m(a.get("firsts"))&&(a.set("firsts",d),e=!0)}),a)a.hasOwnProperty(i)&&(d=a[i],h={},c.each(d.get("productions"),function(a){q(h,a.get("firsts"))}),m(h)!==m(d.get("firsts"))&&
(d.set("firsts",h),e=!0))},closure:function(b){for(var d=this,a=b.get("items"),e=d.get("productions"),i=1;i;)i=!1,c.each(a,function(a){var f=a.get("dotPosition"),k=a.get("production").get("rhs"),s=k[f],a=a.get("lookAhead"),j={};c.each(a,function(a,b){var i=k.slice(f+1);i.push(b);c.mix(j,d.findFirst(i))});c.each(e,function(a){if(a.get("symbol")==s){var a=new g({production:a}),d=b.findItemIndex(a,!0);-1!=d?(a=b.getItemAt(d),i=i||!!a.addLookAhead(j)):(a.addLookAhead(j),b.addItem(a),i=!0)}})});return b},
gotos:function(b,d){var a=new e,f=b.get("items");c.each(f,function(b){var h=b.get("production"),c=b.get("dotPosition");h.get("rhs")[c]==d&&(h=new g({production:h,dotPosition:c+1}),c=a.findItemIndex(h,!0),-1!=c?(h=a.getItemAt(c),h.addLookAhead(b.get("lookAhead"))):(h.addLookAhead(b.get("lookAhead")),a.addItem(h)))});return this.closure(a)},findItemSetIndex:function(b){for(var d=this.get("itemSets"),a=0;a<d.length;a++)if(d[a].equals(b))return a;return-1},buildItemSet:function(){var b=this,d=b.get("itemSets"),
a={},f=b.get("productions");a.$EOF=1;a=b.closure(new e({items:[new g({production:f[0],lookAhead:a})]}));d.push(a);var i=!0,h=c.merge(b.get("terminals"),b.get("nonTerminals"));for(delete h.$EOF;i;)i=!1,a=d.concat(),c.each(a,function(a){c.each(h,function(c,h){a.__cache||(a.__cache={});if(!a.__cache[h]){var e=b.gotos(a,h);a.__cache[h]=1;if(0!=e.size()){var f=b.findItemSetIndex(e);-1<f?e=d[f]:(d.push(e),i=!0);a.get("gotos")[h]=e;e.addReverseGoto(h,a)}}})})},buildLalrItemSets:function(){for(var b=this.get("itemSets"),
d=0;d<b.length;d++)for(var a=b[d],e=d+1;e<b.length;e++){var i=b[e];if(a.equals(i,!0)){for(var h=0;h<a.get("items").length;h++)a.get("items")[h].addLookAhead(i.get("items")[h].get("lookAhead"));var f=a.get("gotos");c.each(i.get("gotos"),function(b,d){f[d]=b;b.addReverseGoto(d,a)});c.each(i.get("reverseGotos"),function(b,d){c.each(b,function(b){b.get("gotos")[d]=a;a.addReverseGoto(d,b)})});b.splice(e--,1)}}},buildTable:function(){var b=this.get("table"),d=this.get("itemSets"),a={},e={};b.gotos=a;b.action=
e;for(var i=this.get("nonTerminals"),h=0;h<d.length;h++)b=d[h],c.each(b.get("gotos"),function(b,c){i[c]?(a[h]=a[h]||{},a[h][c]=p(b,d)):(e[h]=e[h]||{},e[h][c]={type:1,to:p(b,d)})}),c.each(b.get("items"),function(a){var b=a.get("production");a.get("dotPosition")==b.get("rhs").length&&("$START"==b.get("symbol")?a.get("lookAhead").$EOF&&(e[h]=e[h]||{},e[h].$EOF={type:0}):(e[h]=e[h]||{},c.each(a.get("lookAhead"),function(a,d){e[h][d]={type:2,symbol:b.get("symbol"),rhs:b.get("rhs"),action:b.get("action")}})))})},
visualizeTable:function(){var b=this.get("table"),d=b.gotos,b=b.action,a=[];c.each(this.get("itemSets"),function(b,d){a.push(Array(70).join("*")+" itemSet : "+d);a.push(b.toString());a.push("")});a.push("");a.push(Array(70).join("*")+" table : ");c.each(b,function(b,d){c.each(b,function(b,e){var c,f=b.type;0==f?c="acc":2==f?c="r, "+b.symbol+"="+b.rhs.join(""):1==f&&(c="s, "+b.to);a.push("action["+d+"]["+e+"] = "+c)})});a.push("");c.each(d,function(b,d){c.each(b,function(b,e){a.push("goto["+d+"]["+
e+"] = "+b)})});return a},parse:function(b){var d=this.get("lexer"),a,e;this.get("nonTerminals");var c,f=this.get("table"),k=f.gotos,f=f.action,g=[null],j=[0];for(d.set("input",b);;){b=j[j.length-1];a||(e=d.lex(),a=e.token);if(!a)return!1;c=f[b]&&f[b][a];if(!c)return!1;switch(c.type){case 1:j.push(a);g.push(e.text);j.push(c.to);a=null;break;case 2:var b=c.symbol,l=c.action;c=c.rhs.length;var m=g[g.length-c],n=g.slice(-c),l=l.apply(null,n);void 0!==l&&(m=l);c&&(j=j.slice(0,-2*c),g=g.slice(0,-1*c));
j.push(b);g.push(m);j.push(k[j[j.length-2]][j[j.length-1]]);break;case 0:return m}}}},{ATTRS:{table:{value:{}},itemSets:{value:[]},productions:{value:[],setter:function(b){b.unshift({symbol:"$START",rhs:[b[0].symbol]});c.each(b,function(c,a){b[a]=new j(c)})}},nonTerminals:{value:{}},lexer:{setter:function(b){return new k(b)}},terminals:{value:{}}}});return n},{requires:"base,./Item,./ItemSet,./NonTerminal,./Lexer,./Production".split(",")});
KISSY.add("kison/Item",function(c,l){function g(){g.superclass.constructor.apply(this,arguments)}c.extend(g,l,{equals:function(e,f){return!e.get("production").equals(this.get("production"))||e.get("dotPosition")!=this.get("dotPosition")||!f&&!c.equals(this.get("lookAhead"),e.get("lookAhead"))?!1:!0},toString:function(e){return this.get("production").toString(this.get("dotPosition"))+(e?"":","+c.keys(this.get("lookAhead")).join("/"))},addLookAhead:function(e){var f=this.get("lookAhead");c.each(e,function(c,
e){f[e]||(f[e]=1)})}},{ATTRS:{production:{},dotPosition:{value:0},lookAhead:{value:{}}}});return g},{requires:["base"]});
KISSY.add("kison/ItemSet",function(c,l){function g(){g.superclass.constructor.apply(this,arguments)}c.extend(g,l,{addItem:function(c){for(var f=this.get("items"),k=0;k<f.length&&!(f[k].get("production").toString()>c.get("production").toString());k++);f.splice(k,0,c)},size:function(){return this.get("items").length},findItemIndex:function(c,f){for(var k=this.get("items"),j=0;j<k.length;j++)if(k[j].equals(c,f))return j;return-1},getItemAt:function(c){return this.get("items")[c]},equals:function(c,f){var k=
this.get("items"),j,g=c.get("items");if(k.length!=g.length)return!1;for(j=0;j<k.length;j++)if(!k[j].equals(g[j],f))return!1;return!0},toString:function(){var e=[];c.each(this.get("items"),function(c){e.push(c.toString())});return e.join("\n")},addReverseGoto:function(c,f){var g=this.get("reverseGotos");g[c]=g[c]||[];g[c].push(f)}},{ATTRS:{items:{value:[]},gotos:{value:{}},reverseGotos:{value:{}}}});return g},{requires:["base"]});
KISSY.add("kison/Lexer",function(c,l){function g(){g.superclass.constructor.apply(this,arguments)}g.ATTRS={input:{value:""},rules:{value:[]}};c.extend(g,l,{lex:function(){var e=this.get("input"),f,g,j,l=this.get("rules");if(!c.trim(e))return{token:"$EOF"};for(f=0;f<l.length;f++)if(g=l[f],j=e.match(g.regexp))return f=g.action&&g.action(j),void 0==f&&(f={token:g.token,text:j[0]}),e=e.slice(j[0].length),this.set("input",e),f.token?f:this.lex()}});return g},{requires:["base"]});
KISSY.add("kison/NonTerminal",function(c,l){function g(){g.superclass.constructor.apply(this,arguments)}c.extend(g,l,{},{ATTRS:{productions:{value:[]},firsts:{value:{}},symbol:{},nullAble:{value:!1}}});return g},{requires:["base"]});
KISSY.add("kison/Production",function(c,l){function g(){g.superclass.constructor.apply(this,arguments)}c.extend(g,l,{equals:function(e){return!c.equals(e.get("rhs"),this.get("rhs"))?!1:e.get("symbol")==this.get("symbol")},toString:function(e){var f="",g=this.get("rhs");c.each(g,function(c,g){g==e&&(f+=".");f+=c});e==g.length&&(f+=".");return this.get("symbol")+"=>"+f}},{ATTRS:{firsts:{value:{}},follows:{value:[]},symbol:{},rhs:{value:[]},nullAble:{value:!1},action:{value:c.noop}}});return g},{requires:["base"]});
KISSY.add("kison",function(c,l,g,e){c={};c.Grammar=l;c.Production=g;c.Lexer=e;return c},{requires:["kison/Grammar","kison/Production","kison/Lexer"]});
