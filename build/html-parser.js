/*
Copyright 2014, KISSY v5.0.0
MIT Licensed
build time: Jul 18 14:03
*/
KISSY.add("html-parser","html-parser/dtd,html-parser/lexer/lexer,html-parser/parser,html-parser/writer/basic,html-parser/writer/beautify,html-parser/writer/minify,html-parser/writer/filter,html-parser/nodes/cdata,html-parser/nodes/comment,html-parser/nodes/tag,html-parser/nodes/text,html-parser/nodes/node".split(","),function(m,b,p,o){var m=b("html-parser/dtd"),p=b("html-parser/lexer/lexer"),a=b("html-parser/parser"),h=b("html-parser/writer/basic"),k=b("html-parser/writer/beautify"),i=b("html-parser/writer/minify"),
e=b("html-parser/writer/filter"),l=b("html-parser/nodes/cdata"),n=b("html-parser/nodes/comment"),c=b("html-parser/nodes/tag"),d=b("html-parser/nodes/text");o.exports={CData:l,Comment:n,Node:b("html-parser/nodes/node"),Tag:c,Text:d,Lexer:p,Parser:a,BasicWriter:h,BeautifyWriter:k,MinifyWriter:i,Filter:e,DTD:m,serialize:function(c,j){var g=new h;c.writeHtml(g,j);return g.getHtml()},parse:function(c){return(new a(c)).parse()}}});
KISSY.add("html-parser/dtd",["util"],function(m,b,p,o){var m=b("util").merge,b={isindex:1,fieldset:1},a={input:1,button:1,select:1,textarea:1,label:1},p=m({a:1},a),h=m({iframe:1},p),k={hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1},i={ins:1,del:1,script:1,style:1},e=m({b:1,acronym:1,bdo:1,"var":1,"#text":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1},i),l=
m({sub:1,img:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1},e),n=m({p:1},l),a=m({iframe:1},l,a),l={img:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#text":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,
a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1},c=m({a:1},a),d={tr:1},s={"#text":1},j=m({param:1},l),g=m({form:1},b,h,k,n),f={li:1},u={base:1,link:1,meta:1,title:1},w=m(u,{style:1,script:1}),v={head:1,body:1},q={address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1},o=o.exports={$nonBodyContent:m({html:1},v,u),$block:q,$blockLimit:{body:1,div:1,td:1,th:1,caption:1,form:1},
$inline:c,$body:m({script:1,style:1},q),$cdata:{script:1,style:1},$empty:{area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1},$listItem:{dd:1,dt:1,li:1},$list:{ul:1,ol:1,dl:1},$nonEditable:{applet:1,button:1,embed:1,iframe:1,map:1,object:1,option:1,script:1,textarea:1,param:1},$removeEmpty:{abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},$tabIndex:{a:1,
area:1,button:1,input:1,object:1,select:1,textarea:1},$tableContent:{caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1},html:v,head:w,style:s,body:g,base:{},link:{},meta:{},title:s,col:{},tr:{td:1,th:1},img:{},colgroup:{col:1},noscript:g,td:g,br:{},th:g,center:g,kbd:c,button:m(n,k),basefont:{},h5:c,h4:c,samp:c,h6:c,ol:f,h1:c,h3:c,option:s,h2:c,form:m(b,h,k,n),select:{optgroup:1,option:1},font:c,ins:c,menu:f,abbr:c,label:c,table:{thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1},
code:c,script:s,tfoot:d,cite:c,li:g,input:{},iframe:g,strong:c,textarea:s,noframes:g,big:c,small:c,span:c,hr:{},dt:c,sub:c,optgroup:{option:1},param:{},bdo:c,"var":c,div:g,object:j,sup:c,dd:g,strike:c,area:{},dir:f,map:m({area:1,form:1,p:1},b,i,k),applet:j,dl:{dt:1,dd:1},del:c,isindex:{},fieldset:m({legend:1},l),thead:d,ul:f,acronym:c,b:c,a:a,blockquote:g,caption:c,i:c,u:c,tbody:d,s:c,address:m(h,n),tt:c,legend:c,q:c,pre:m(e,p),p:c,em:c,dfn:c},b="article,figure,nav,aside,section,footer".split(","),
t;for(t in o)for(var r in o[t])if("div"===r)for(m=0;m<b.length;m++)o[t][b[m]]=o[t][r];for(m=0;m<b.length;m++)o[b[m]]=o.div});
KISSY.add("html-parser/lexer/lexer","./cursor,./page,../nodes/text,../nodes/cdata,../utils,../nodes/attribute,../nodes/tag,../nodes/comment".split(","),function(m,b,p,o){function a(c,j){this.page=new k(c);this.cursor=new h;this.nodeFactory=this;this.cfg=j||{}}var h=b("./cursor"),k=b("./page"),i=b("../nodes/text"),e=b("../nodes/cdata"),l=b("../utils"),n=b("../nodes/attribute"),c=b("../nodes/tag"),d=b("../nodes/comment");a.prototype={constructor:a,setPosition:function(c){this.cursor.position=c},getPosition:function(){return this.cursor.position},
nextNode:function(c){var j,g,f=this.cursor,d=this.page;j=f.position;g=d.getChar(f);switch(g){case -1:c=null;break;case "<":g=d.getChar(f);if(g===-1)c=this.makeString(j,f.position);else if(g==="/"||l.isLetter(g)){d.ungetChar(f);c=this.parseTag(j)}else if("!"===g||"?"===g){g=d.getChar(f);if(g===-1)c=this.makeString(j,f.position);else if(">"===g)c=this.makeComment(j,f.position);else{d.ungetChar(f);if("-"===g)c=this.parseComment(j,c);else{d.ungetChar(f);c=this.parseTag(j)}}}else{d.ungetChar(f);c=this.parseString(j,
c)}break;default:d.ungetChar(f);c=this.parseString(j,c)}return c},makeComment:function(c,j){var g;g=j-c;if(0!==g){if(2>g)return this.makeString(c,j);g=this.nodeFactory.createCommentNode(this.page,c,j)}else g=null;return g},makeString:function(c,j){var g=null;j-c>0&&(g=this.nodeFactory.createStringNode(this.page,c,j));return g},makeCData:function(c,j){var g=null;j-c>0&&(g=this.nodeFactory.createCDataNode(this.page,c,j));return g},makeTag:function(c,j,g){var f;f=j-c;if(0!==f){if(2>f)return this.makeString(c,
j);c=this.nodeFactory.createTagNode(this.page,c,j,g)}else c=null;return c},createTagNode:function(d,j,g,f){return new c(d,j,g,f)},createStringNode:function(c,j,g){return new i(c,j,g)},createCDataNode:function(c,j,g){return new e(c,j,g)},createCommentNode:function(c,j,g){return new d(c,j,g)},parseTag:function(c){var j,g=[],f=[],d,e=this.cfg.strict,k=this.page,a=0,b=this.cursor;for(g[0]=b.position;!j;){g[a+1]=b.position;d=k.getChar(b);switch(a){case 0:if(d===-1||">"===d||"<"===d){if("<"===d){k.ungetChar(b);
g[a+1]=b.position}j=true}else if(d==="/"||l.isValidAttributeNameStartChar(d))a=1;break;case 1:if(-1===d||">"===d||"<"===d){if("<"===d){k.ungetChar(b);g[a+1]=b.getPosition}this.standalone(f,g);j=true}else if(l.isWhitespace(d)){g[6]=g[2];a=6}else"="===d&&(a=2);break;case 2:if(-1===d||">"===d){this.standalone(f,g);j=true}else if("'"===d){a=4;g[4]=g[3]}else if('"'===d){a=5;g[5]=g[3]}else l.isWhitespace(d)||(a=3);break;case 3:if(-1===d||">"===d){this.naked(f,g);j=true}else if(l.isWhitespace(d)){this.naked(f,
g);g[0]=g[4];a=0}break;case 4:if(-1===d){this.singleQuote(f,g);j=true}else if("'"===d){this.singleQuote(f,g);g[0]=g[5]+1;a=0}break;case 5:if(-1===d){this.doubleQuote(f,g);j=true}else if('"'===d){this.doubleQuote(f,g);g[0]=g[6]+1;a=0}break;case 6:if(-1===d){this.standalone(f,g);g[0]=g[6];k.ungetChar(b);a=0}else if("="===d){g[2]=g[6];g[3]=g[7];a=2}else if(!l.isWhitespace(d)){this.standalone(f,g);g[0]=g[6];k.ungetChar(b);a=0}break;default:throw Error("how ** did we get in state "+a);}if(e&&d===-1&&f.length)throw Error(f[0].name+
" syntax error at row "+(k.row(b)+1)+" , col "+(k.col(b)+1));}return this.makeTag(c,b.position,f)},parseComment:function(c,d){var g,f,k=this.page,e=this.cursor,a;g=false;for(a=0;!g;){f=k.getChar(e);if(-1===f)g=true;else switch(a){case 0:if(">"===f)g=true;else if("-"===f)a=1;else return this.parseString(c,d);break;case 1:if("-"===f){f=k.getChar(e);if(-1===f)g=true;else if(">"===f)g=true;else{k.ungetChar(e);a=2}}else return this.parseString(c,d);break;case 2:if("-"===f)a=3;else if(-1===f)return this.parseString(c,
d);break;case 3:a="-"===f?4:2;break;case 4:">"===f?g=true:l.isWhitespace(f)||(a=2);break;default:throw Error("how ** did we get in state "+a);}}return this.makeComment(c,e.position)},parseString:function(c,d){for(var g=0,f,a=this.page,k=this.cursor,e=0;!g;){f=a.getChar(k);if(-1===f)g=1;else if(d&&0===e&&('"'===f||"'"===f))e=f;else if(d&&0!==e&&"\\"===f){f=a.getChar(k);-1!==f&&"\\"!==f&&f!==e&&a.ungetChar(k)}else if(d&&f===e)e=0;else if(d&&0===e&&f==="/"){f=a.getChar(k);if(-1===f)g=1;else if("/"===
f){do f=a.getChar(k);while(-1!==f&&"\n"!==f)}else if("*"===f){do{do f=a.getChar(k);while(-1!==f&&"*"!==f);f=a.getChar(k);f==="*"&&a.ungetChar(k)}while(-1!==f&&"/"!==f)}else a.ungetChar(k)}else if(0===e&&"<"===f){f=a.getChar(k);if(-1===f)g=1;else{if("/"===f||l.isLetter(f)||"!"===f||"?"===f){g=1;a.ungetChar(k)}a.ungetChar(k)}}}return this.makeString(c,k.position)},parseCDATA:function(c,d){var k,f,a,e,b,i,h=this.cursor,n=this.page;k=h.position;f=0;a=false;e="";for(i=false;!a;){b=n.getChar(h);switch(f){case 0:switch(b){case -1:a=
true;break;case "'":c&&!i&&(""===e?e="'":"'"===e&&(e=""));break;case '"':c&&!i&&(""===e?e='"':'"'===e&&(e=""));break;case "\\":if(c&&""!==e){b=n.getChar(h);-1===b?a=true:b!=="\\"&&b!==e&&n.ungetChar(h)}break;case "/":if(c&&""===e){b=n.getChar(h);if(-1===b)a=true;else if("/"===b)i=true;else if("*"===b){do{do b=n.getChar(h);while(-1!==b&&"*"!==b);b=n.getChar(h);b==="*"&&n.ungetChar(h)}while(-1!==b&&"/"!==b)}else n.ungetChar(h)}break;case "\n":i=false;break;case "<":c?""===e&&(f=1):f=1}break;case 1:switch(b){case -1:a=
true;break;case "/":f=!d||n.getText(h.position,h.position+d.length)===d&&!n.getText(h.position+d.length,h.position+d.length+1).match(/\w/)?2:0;break;case "!":b=n.getChar(h);if(-1===b)a=true;else if("-"===b){b=n.getChar(h);-1===b?a=true:f="-"===b?3:0}else f=0;break;default:f=0}break;case 2:i=false;if(-1===b)a=true;else if(l.isLetter(b)){a=true;n.ungetChar(h);n.ungetChar(h);n.ungetChar(h)}else f=0;break;case 3:i=false;if(-1===b)a=true;else if("-"===b){b=n.getChar(h);if(-1===b)a=true;else if("-"===b){b=
n.getChar(h);if(-1===b)a=true;else if(">"===b)f=0;else{n.ungetChar(h);n.ungetChar(h)}}else n.ungetChar(h)}break;default:throw Error("unexpected "+f);}}return this.makeCData(k,h.position)},singleQuote:function(c,d){var a=this.page;c.push(new n(a.getText(d[1],d[2]),"=",a.getText(d[4]+1,d[5]),"'"))},doubleQuote:function(c,d){var a=this.page;c.push(new n(a.getText(d[1],d[2]),"=",a.getText(d[5]+1,d[6]),'"'))},standalone:function(c,d){c.push(new n(this.page.getText(d[1],d[2])))},naked:function(c,d){var a=
this.page;c.push(new n(a.getText(d[1],d[2]),"=",a.getText(d[3],d[4])))}};o.exports=a});KISSY.add("html-parser/lexer/cursor",[],function(m,b,p,o){function a(a){this.position=a||0}a.prototype={constructor:a,advance:function(){this.position++},clone:function(){var b=new a;b.position=this.position;return b},retreat:function(){this.position=Math.max(--this.position,0)}};o.exports=a});
KISSY.add("html-parser/lexer/page",["./index"],function(m,b,p,o){function a(a){this.source=a;this.lineIndex=new h}var h=b("./index");a.prototype={constructor:a,getChar:function(a){var b=this.source,e=a.position;if(e>=b.length)return-1;var l=b.charAt(e);a.advance();"\r"===l&&(l="\n",e=a.position,"\n"===b.charAt(e)&&a.advance());"\n"===l&&this.lineIndex.add(a);return l},ungetChar:function(a){var b=this.source;a.retreat();var e=a.position,l=b.charAt(e);"\n"===l&&0!==e&&(l=b.charAt(e-1),"\r"===l&&a.retreat())},
getText:function(a,b){return this.source.slice(a,b)},row:function(a){return this.lineIndex.row(a)},col:function(a){return this.lineIndex.col(a)}};o.exports=a});
KISSY.add("html-parser/lexer/index",[],function(m,b,p,o){function a(){this.lineCursors=[]}a.prototype={constructor:a,add:function(a){var b;a:{b=this.lineCursors;for(var i=a.position,e=0;e<b.length;e++){var l=b[e].position;if(l===i){b=-1;break a}if(l>i)break}b=e}-1!==b&&this.lineCursors.splice(b,0,a.clone())},remove:function(a){var b=this.lineCursors,i;a:{i=this.lineCursors;for(var a=a.position,e=0;e<i.length;e++){var l=i[e].position;if(l===a){i=e;break a}if(l<a)break}i=-1}-1!==i&&b.splice(i,1)},row:function(a){for(var b=
this.lineCursors,i=0;i<b.length;i++)if(b[i].position>a.position)return i-1;return i},col:function(a){var b=0,i=this.lineCursors[this.row(a)-1];i&&(b=i.position);return a.position-b}};o.exports=a});
KISSY.add("html-parser/nodes/text",["./node","util"],function(m,b,p,o){function a(b){"string"===typeof b?(this.nodeValue=b,a.superclass.constructor.apply(this,[null,-1,-1])):(a.superclass.constructor.apply(this,arguments),this.nodeValue=this.toHtml());this.nodeType=3;this.nodeName="#text"}m=b("./node");b("util").extend(a,m,{writeHtml:function(a,b){var i;if(!b||!1!==(i=b.onText(this)))i&&this!==i?i.writeHtml(a,b):a.text(this.toHtml())},toHtml:function(){return this.nodeValue?this.nodeValue:a.superclass.toHtml.apply(this,
arguments)}});o.exports=a});
KISSY.add("html-parser/nodes/node",[],function(m,b,p,o){function a(a){var b=0;a.replace(/\n/g,function(){b++});return b}function h(a,b,e){this.parentNode=null;this.page=a;this.startPosition=b;this.endPosition=e;this.nextSibling=this.previousSibling=this.nodeName=null}h.prototype={constructor:h,getStartLine:function(){if(this.page){if("startLine"in this)return this.startLine;this.startLine=a(this.page.getText(0,this.startPosition))}return-1},getEndLine:function(){if(this.page){if("endLine"in this)return this.endLine;
this.endLine=a(this.page.getText(0,this.endPosition))}return-1},toHtml:function(){return this.page&&this.page.getText?this.page.getText(this.startPosition,this.endPosition):""},toDebugString:function(){var a=[];a.push(this.nodeName+"  [ "+this.startPosition+"|"+this.getStartLine()+" : "+this.endPosition+"|"+this.getEndLine()+" ]\n");a.push(this.toHtml());return a.join("")}};o.exports=h});
KISSY.add("html-parser/nodes/cdata",["./text","util"],function(m,b,p,o){function a(){a.superclass.constructor.apply(this,arguments);this.nodeType=4;this.nodeName="#cdata"}m=b("./text");b("util").extend(a,m,{writeHtml:function(a,b){var i;if(!b||!1!==(i=b.onCData(this)))i&&this!==i?i.writeHtml(a,b):a.cdata(this.toHtml())}});o.exports=a});
KISSY.add("html-parser/utils",[],function(m,b,p,o){o.exports={isBooleanAttribute:function(a){return/^(?:checked|disabled|selected|readonly|defer|multiple|nohref|noshape|nowrap|noresize|compact|ismap)$/i.test(a)},collapseWhitespace:function(a){return a.replace(/[\s\xa0]+/g," ")},isLetter:function(a){return"a"<=a&&"z">=a||"A"<=a&&"Z">=a},isValidAttributeNameStartChar:function(a){return!this.isWhitespace(a)&&'"'!==a&&"'"!==a&&">"!==a&&a!==""<""&&"/"!==a&&"="!==a},isWhitespace:function(a){return/^[\s\xa0]$/.test(a)}}});
KISSY.add("html-parser/nodes/attribute",["util"],function(m,b,p,o){function a(a,b,e,l){this.nodeType=2;this.name=a;this.assignment=b;this.value=e;this.quote=l}var h=b("util");a.prototype={clone:function(){var b=new a;h.mix(b,this);return b},equals:function(a){return this.name===a.name&&this.value===a.value&&this.nodeType===a.nodeType}};a.prototype.clone=function(){var b=new a;h.mix(b,this);return b};o.exports=a});
KISSY.add("html-parser/nodes/tag",["./node","./attribute","../dtd","util"],function(m,b,p,o){function a(c,a,b){c.nodeName=c.tagName=a.toLowerCase();c._updateSelfClosed();n.each(b,function(a,d){c.setAttribute(d,a)})}function h(c,d,b,e){this.childNodes=[];this.lastChild=this.firstChild=null;this.attributes=e||[];this.nodeType=1;if("string"===typeof c)a.apply(null,[this].concat(n.makeArray(arguments)));else{h.superclass.constructor.apply(this,arguments);e=this.attributes;e[0]&&(this.nodeName=e[0].name.toLowerCase(),
this.tagName=this.nodeName.replace(/\//,""),this._updateSelfClosed(),e.splice(0,1));var g=e[e.length-1];if(g=!(!g||!/\/$/.test(g.name)))e.length-=1;this.closed=this.isSelfClosed=this.isSelfClosed||g}this.closedEndPosition=this.closedStartPosition=-1}function k(c){var a=c.childNodes;c.firstChild=a[0];c.lastChild=a[a.length-1];1<=a.length&&(a[0].nextSibling=a[0].nextSibling=null,a[0].parentNode=c);if(1<a.length){for(var b=0;b<a.length-1;b++)a[b].nextSibling=a[b+1],a[b+1].previousSibling=a[b],a[b+1].parentNode=
c;a[a.length-1].nextSibling=null}}function i(c,a){if(c&&c.length)for(var b=0;b<c.length;b++)if(c[b].name===a)return c[b];return null}var m=b("./node"),e=b("./attribute"),l=b("../dtd"),n=b("util");n.extend(h,m,{_updateSelfClosed:function(){this.isSelfClosed=!!l.$empty[this.nodeName];this.isSelfClosed||(this.isSelfClosed=/\/$/.test(this.nodeName));this.closed=this.isSelfClosed},clone:function(){var c=new h,a=[];n.each(this.attributes,function(c){a.push(c.clone())});n.mix(c,{childNodes:[],firstChild:null,
lastChild:null,attributes:a,nodeType:this.nodeType,nodeName:this.nodeName,tagName:this.tagName,isSelfClosed:this.isSelfClosed,closed:this.closed,closedStartPosition:this.closedStartPosition,closedEndPosition:this.closedEndPosition});return c},setTagName:function(c){(this.nodeName=this.tagName=c)&&this._updateSelfClosed()},equals:function(c){if(!c||this.nodeName!==c.nodeName||this.nodeType!==c.nodeType||this.attributes.length!==c.attributes.length)return 0;for(var a=0;a<this.attributes.length;a++)if(!this.attributes[a].equals(c.attributes[a]))return 0;
return 1},isEndTag:function(){return/^\//.test(this.nodeName)},appendChild:function(c){this.childNodes.push(c);k(this)},replace:function(c){var a=c.parentNode.childNodes,b=n.indexOf(c,a);a[b]=this;k(c.parentNode)},replaceChild:function(c,a){var b=this.childNodes,e=n.indexOf(a,b);b[e]=c;k(this)},prepend:function(a){this.childNodes.unshift(a);k(this)},insertBefore:function(a){var b=a.parentNode.childNodes,e=n.indexOf(a,b);b.splice(e,0,this);k(a.parentNode)},insertAfter:function(a){var b=a.parentNode.childNodes,
e=n.indexOf(a,b);e===b.length-1?a.parentNode.appendChild(this):this.insertBefore(a.parentNode.childNodes[[e+1]])},empty:function(){this.childNodes=[];k(this)},removeChild:function(a){var b=a.parentNode.childNodes,e=n.indexOf(a,b);b.splice(e,1);k(a.parentNode)},getAttribute:function(a){return(a=i(this.attributes,a))&&a.value},setAttribute:function(a,b){var l=i(this.attributes,a);l?l.value=b:this.attributes.push(new e(a,"=",b,'"'))},removeAttribute:function(a){(a=i(this.attributes,a))&&this.attributes.splice(n.indexOf(a,
this.attributes),1)},filterChildren:function(){var a=this;if(!a.isChildrenFiltered){var b=new (o.require("html-parser/writer/basic"));a._writeChildrenHTML(b);b=(new (o.require("html-parser/parser"))(b.getHtml())).parse().childNodes;a.empty();n.each(b,function(b){a.appendChild(b)});a.isChildrenFiltered=1}},writeHtml:function(a,b){var e=this,l;l=e.tagName;if("!doctype"===l)a.append(this.toHtml()+"\n");else{e.__filter=b;e.isChildrenFiltered=0;if(b){if(!(l=b.onTagName(l)))return;e.tagName=l;l=b.onTag(e);
if(!1===l)return;l&&(e=l);if(1!==e.nodeType){e.writeHtml(a,b);return}if(!e.tagName){e._writeChildrenHTML(a);return}}a.openTag(e);for(var g=e.attributes,f=0;f<g.length;f++){var k=g[f];l=k.name;if(b){if(!(l=b.onAttributeName(l,e)))continue;k.name=l;if(!1===b.onAttribute(k,e))continue}a.attribute(k,e)}a.openTagClose(e);e.isSelfClosed||(e._writeChildrenHTML(a),a.closeTag(e))}},_writeChildrenHTML:function(a){var b=this.isChildrenFiltered?0:this.__filter;n.each(this.childNodes,function(e){e.writeHtml(a,
b)})},outerHtml:function(){var a=new (o.require("html-parser/writer/basic"));this.writeHtml(a);return a.getHtml()}});o.exports=h});
KISSY.add("html-parser/nodes/comment",["./text","util"],function(m,b,p,o){function a(){a.superclass.constructor.apply(this,arguments);this.nodeType=8;this.nodeName="#comment"}var h=b("./text");b("util").extend(a,h,{writeHtml:function(a,b){var e;if(!b||!1!==(e=b.onComment(this)))e&&this!==e?e.writeHtml(a,b):a.comment(this.toHtml())},toHtml:function(){if(this.nodeValue)return this.nodeValue;var a=h.superclass.toHtml.apply(this,arguments);return a.substring(4,a.length-3)}});o.exports=a});
KISSY.add("html-parser/parser","util,./dtd,./nodes/tag,./nodes/fragment,./lexer/lexer,./nodes/document,./scanner".split(","),function(m,b,p,o){function a(a,b){this.originalHTML=a=l.trim(a);a=/^(<!doctype|<html|<body)/i.test(a)?"<document>"+a+"</document>":"<body>"+a+"</body>";this.lexer=new s(a);this.opts=b||{}}function h(a){var b=i(a,"body",3);if(b){var a=b.parentNode,c=a.childNodes,e=l.indexOf(b,c);if(e!==c.length-1){c=c.slice(e+1,c.length);for(e=0;e<c.length;e++){a.removeChild(c[e]);c[e].tagName===
"body"?l.each(c[e].childNodes,function(a){b.appendChild(a)}):b.appendChild(c[e])}}}return b}function k(a){var b=a.childNodes,e,d,g=n.p,l=0;for(d=0;d<b.length;d++){e=b[d];if(e.nodeType===3||e.nodeType===1&&g[e.nodeName]){l=1;break}}if(l){var l=[],k=new c;k.nodeName=k.tagName="p";for(d=0;d<b.length;d++){e=b[d];if(e.nodeType===3||e.nodeType===1&&g[e.nodeName])k.appendChild(e);else{if(k.childNodes.length){l.push(k);k=k.clone()}l.push(e)}}k.childNodes.length&&l.push(k);a.empty();for(d=0;d<l.length;d++)a.appendChild(l[d])}}
function i(a,b,c){if(c===0)return 0;typeof c==="number"&&c--;var e=a.childNodes;if(e)for(var d=0;d<e.length;d++){if(e[d].tagName===b)return e[d];if(a=i(e[d],b,c))return a}return 0}function e(a){for(var b=[].concat(a.childNodes),c=0;c<b.length;c++)if(b[c].nodeName==="html"){for(var e=b[c],d=0;d<c;d++)b[d].nodeType===3&&!l.trim(b[d].toHtml())&&a.removeChild(b[d]);for(;e.firstChild&&e.firstChild.nodeType===3&&!l.trim(e.firstChild.toHtml());)e.removeChild(e.firstChild);break}}var l=b("util"),n=b("./dtd"),
c=b("./nodes/tag"),d=b("./nodes/fragment"),s=b("./lexer/lexer"),j=b("./nodes/document"),g=b("./scanner");a.prototype={constructor:a,elements:function(){var a,b,c=this.lexer,n=this.opts;b=a=c.nextNode();if(a.tagName!=="document"){b=new j;b.appendChild(a)}b.nodeType=9;g.getScanner("div").scan(a,c,n);(a=h(b))&&n.autoParagraph&&k(a);e(b);var n=this.originalHTML,i=new d;b=/^(<!doctype|<html|<body)/i.test(n)?b.childNodes:a.childNodes;l.each(b,function(a){i.appendChild(a)});return i},parse:function(){return this.elements()}};
o.exports=a});KISSY.add("html-parser/nodes/fragment",["./tag","util"],function(m,b,p,o){function a(){this.childNodes=[];this.nodeType=9;this.nodeName="#fragment"}m=b("./tag");b("util").extend(a,m,{writeHtml:function(a,b){this.__filter=b;this.isChildrenFiltered=0;if(b)b.onFragment(this);this._writeChildrenHTML(a)}});o.exports=a});
KISSY.add("html-parser/nodes/document",["./tag","util"],function(m,b,p,o){function a(){this.childNodes=[];this.nodeType=9;this.nodeName="#document"}m=b("./tag");b("util").extend(a,m,{writeHtml:function(a,b){this.__filter=b;this._writeChildrenHTML(a)}});o.exports=a});
KISSY.add("html-parser/scanner",["./scanners/tag-scanner","./scanners/special-scanners","./scanners/quote-cdata-scanner","./scanners/textarea-scanner"],function(m,b,p){var o=b("./scanners/tag-scanner"),a=b("./scanners/special-scanners");b("./scanners/quote-cdata-scanner");b("./scanners/textarea-scanner");p.getScanner=function(b){return a[b]||o}});
KISSY.add("html-parser/scanners/tag-scanner",["../dtd","../nodes/tag","./special-scanners","util"],function(m,b,p){function o(b,d){function n(){f.childNodes.length&&(f.insertAfter(i),i=f,f=b.clone())}b.closed=1;if(!d.fixByDtd)return 0;var j=1,g=[].concat(b.childNodes);e.each(g,function(e){if(!a(b,e))return j=0,!1});if(j)return 0;for(var f=b.clone(),i=b,m=[],p=0;p<g.length;p++){var q=g[p];if(a(f,q))f.appendChild(q);else if(1===q.nodeType){var t=q.tagName;if(h.$listItem[t]){n();var q=l[q.tagName],r=
new k;for(r.nodeName=r.tagName=q;p<g.length;){if(g[p].tagName===t)r.appendChild(g[p]);else if(3===g[p].nodeType&&e.trim(g[p].toHtml()))break;p++}r.insertAfter(i);i=r;p--}else n(),q.equals(f)?(q.insertAfter(i),i=q):a(q,f)?(f=b.clone(),e.each(q.childNodes,function(a){f.appendChild(a)}),q.empty(),q.insertAfter(i),i=q,q.appendChild(f),m.push(f),f=b.clone()):(q.insertAfter(i),i=q)}}f.childNodes.length&&f.insertAfter(i);b.parentNode.removeChild(b);e.each(m,function(a){o(a,d)});return 1}function a(a,b){if(9===
a.nodeType)return 1;if(!h[a.tagName])throw Error("dtd["+a.tagName+"] === undefined!");return 8===b.nodeType?1:!!h[a.tagName][b.tagName||b.nodeName]}var h=b("../dtd"),k=b("../nodes/tag"),i=b("./special-scanners"),e=b("util"),l={li:"ul",dt:"dl",dd:"dl"},n={dd:{dl:1},dt:{dl:1},li:{ul:1,ol:1},option:{select:1},optgroup:{select:1}};p.scan=function(a,b,e){function l(b,d){for(k=b;k>d;k--){var f=h[k];h[k-1].appendChild(f);o(f,e)}a=h[d];h.length=d}function g(a){var b=0,e;if(e=n[a.tagName]){for(var c=h.length-
1,d=h[c];d&&!(d.tagName in e);){if(d.tagName===a.tagName){b=1;break}c--;d=h[c]}b&&l(h.length-1,c-1)}return b}var f,k,h;h=e.stack=e.stack||[];do{if(f=b.nextNode())if(1===f.nodeType)if(f.isEndTag()&&f.tagName===a.tagName)f=null;else if(f.isEndTag()){if(f.isEndTag()){var m=-1;for(k=h.length-1;0<=k;k--)if(h[k].tagName===f.tagName){m=k;break}-1!==m&&(h[h.length-1].appendChild(a),o(a,e),l(h.length-1,m),f=null)}}else i[f.tagName]?(i[f.tagName].scan(f,b,e),a.appendChild(f)):f.isSelfClosed?a.appendChild(f):
(h.push(a),g(f)&&h.push(a),a=f);else a.appendChild(f);null===f&&0<h.length&&(f=h[h.length-1],i[f.tagName]?f=null:(h.length-=1,f.appendChild(a),o(a,e),a=f))}while(f);o(a,e)}});KISSY.add("html-parser/scanners/special-scanners",[],function(m,b,p,o){o.exports={}});
KISSY.add("html-parser/scanners/quote-cdata-scanner",["./cdata-scanner","../dtd","./special-scanners"],function(m,b,p){var o=b("./cdata-scanner"),m=b("../dtd"),b=b("./special-scanners");p.scan=function(a,b,i){i=i||{};i.quoteSmart=1;o.scan(a,b,i);i.quoteSmart=0};for(var a in m.$cdata)b[a]=p});
KISSY.add("html-parser/scanners/cdata-scanner",[],function(m,b,p){p.scan=function(b,a,h){var h=a.parseCDATA(h.quoteSmart,b.nodeName),k=a.getPosition(),i=a.nextNode();i&&(1!==i.nodeType||!(i.isEndTag()&&i.tagName===b.tagName))&&a.setPosition(k);b.closed=!0;h&&b.appendChild(h)}});
KISSY.add("html-parser/scanners/textarea-scanner",["./cdata-scanner","./special-scanners"],function(m,b,p,o){var a=b("./cdata-scanner"),m=b("./special-scanners");o.exports=m.textarea={scan:function(b,k,i){i=i||{};a.scan(b,k,i)}}});
KISSY.add("html-parser/writer/basic",["../utils"],function(m,b,p,o){function a(){this.output=[]}var h=b("../utils").isBooleanAttribute;a.prototype={constructor:a,append:function(){for(var a=this.output,b=arguments,e,l=0;l<b.length;l++)if(e=b[l],1<e.length)for(var n=0;n<e.length;n++)a.push(e.charAt(n));else a.push(e);return this},openTag:function(a){this.append("<",a.tagName)},openTagClose:function(a){a.isSelfClosed&&this.append(" ","/");this.append(">")},closeTag:function(a){this.append("</",a.tagName,
">")},attribute:function(a){var b=a.value||"",a=a.name;h(a)&&!b&&(b=a);this.append(" ",a,'="',(""+b).replace(/'/g,"&quot;"),'"')},text:function(a){this.append(a)},cdata:function(a){this.append(a)},comment:function(a){this.append("<\!--"+a+"--\>")},getHtml:function(){return this.output.join("")}};o.exports=a});
KISSY.add("html-parser/writer/beautify",["./basic","../dtd","../utils","util"],function(m,b,p,o){function a(){var b=this;a.superclass.constructor.apply(b,arguments);b.inPre=0;b.indentChar="\t";b.indentLevel=0;b.allowIndent=0;b.rules={};var l=i.merge(h.$nonBodyContent,h.$block,h.$listItem,h.$tableContent,{select:1,script:1,style:1}),n;for(n in l)b.setRules(n,{allowIndent:1,breakBeforeOpen:1,breakAfterOpen:1,breakBeforeClose:1,breakAfterClose:1});i.each("p,h1,h2,h3,h4,h5,h6".split(","),function(a){b.setRules(a,
{allowIndent:0,breakAfterOpen:0,breakBeforeClose:0})});b.setRules("option",{breakBeforeOpen:1});b.setRules("optiongroup",{breakBeforeOpen:1});b.setRules("br",{breakAfterOpen:1});b.setRules("title",{allowIndent:0,breakBeforeClose:0,breakAfterOpen:0});b.setRules("pre",{breakAfterOpen:1,allowIndent:0})}var m=b("./basic"),h=b("../dtd"),k=b("../utils"),i=b("util");i.extend(a,m,{indentation:function(){this.inPre||this.append(Array(this.indentLevel+1).join(this.indentChar));this.allowIndent=0},lineBreak:function(){var a=
this.output;if(!this.inPre&&a.length){for(var b=a.length-1;0<=b&&/[\r\n\t ]/.test(a[b]);b--);a.length=b+1;this.append("\n")}this.allowIndent=1},setRules:function(a,b){this.rules[a]||(this.rules[a]={});i.mix(this.rules[a],b)},openTag:function(b){var l=this.rules[b.tagName]||{};this.allowIndent?this.indentation():l.breakBeforeOpen&&(this.lineBreak(),this.indentation());a.superclass.openTag.apply(this,arguments)},openTagClose:function(a){var b=a.tagName,n=this.rules[b]||{};a.isSelfClosed?this.append(" />"):
(this.append(">"),n.allowIndent&&this.indentLevel++);n.breakAfterOpen&&this.lineBreak();"pre"===b&&(this.inPre=1)},closeTag:function(b){var l=b.tagName,n=this.rules[l]||{};n.allowIndent&&this.indentLevel--;this.allowIndent?this.indentation():n.breakBeforeClose&&(this.lineBreak(),this.indentation());a.superclass.closeTag.apply(this,arguments);"pre"===l&&(this.inPre=0);n.breakAfterClose&&this.lineBreak()},text:function(a){this.allowIndent&&this.indentation();this.inPre||(a=k.collapseWhitespace(a));
this.append(a)},comment:function(a){this.allowIndent&&this.indentation();this.append("<\!--"+a+"--\>")},cdata:function(a){this.allowIndent&&this.indentation();this.append(i.trim(a))}});o.exports=a});
KISSY.add("html-parser/writer/minify",["./basic","../utils","util"],function(m,b,p,o){function a(){a.superclass.constructor.apply(this,arguments);this.inPre=0}var m=b("./basic"),p=b("../utils"),b=b("util"),h=b.trim,k=p.isBooleanAttribute,i=p.collapseWhitespace,e=RegExp("^(?:class|id|style|title|lang|dir|on(?:focus|blur|change|click|dblclick|mouse(?:down|up|over|move|out)|key(?:press|down|up)))$");b.extend(a,m,{comment:function(b){/\[if[^\]]+\]/.test(b)&&(b=b.replace(/^(\[[^\]]+\]>)[\s\xa0]*/,"$1").replace(/[\s\xa0]*(<!\[endif\])$/,
"$1"),a.superclass.comment.call(this,b))},openTag:function(b){"pre"===b.tagName&&(this.inPre=1);a.superclass.openTag.apply(this,arguments)},closeTag:function(b){"pre"===b.tagName&&(this.inPre=0);a.superclass.closeTag.apply(this,arguments)},cdata:function(b){b=h(b).replace(/^(?:[\s\xa0]*\/\*[\s\xa0]*<!\[CDATA\[[\s\xa0]*\*\/|[\s\xa0]*\/\/[\s\xa0]*<!\[CDATA\[.*)/,"").replace(/(?:\/\*[\s\xa0]*\]\]>[\s\xa0]*\*\/|\/\/[\s\xa0]*\]\]>)[\s\xa0]*$/,"");a.superclass.cdata.call(this,b)},attribute:function(a,b){var c=
a.name,d,m=a.value||"";d=a.name;if(!(d=!h(a.value||"")?"input"===b&&"value"===d||e.test(d):0)){d=b.nodeName;var j=a.name,g=a.value||"",g=h(g.toLowerCase());d="script"===d&&"language"===j&&"javascript"===g||"form"===d&&"method"===j&&"get"===g||"input"===d&&"type"===j&&"text"===g||"script"===d&&"type"===j&&"text/javascript"===g||"style"===d&&"type"===j&&"text/css"===g||"area"===d&&"shape"===j&&"rect"===g}if(!d)if(k(c))this.append(" ",c);else{d=b.nodeName;j=a.name;g=a.value||"";/^on[a-z]+/.test(j)?g=
h(g).replace(/^javascript:[\s\xa0]*/i,"").replace(/[\s\xa0]*;$/,""):"class"===j?g=i(h(g)):/^(?:a|area|link|base)$/.test(d)&&"href"===j||"img"===d&&/^(?:src|longdesc|usemap)$/.test(j)||"object"===d&&/^(?:classid|codebase|data|usemap)$/.test(j)||"q"===d&&"cite"===j||"blockquote"===d&&"cite"===j||("ins"===d||"del"===d)&&"cite"===j||"form"===d&&"action"===j||"input"===d&&("src"===j||"usemap"===j)||"head"===d&&"profile"===j||"script"===d&&("src"===j||"for"===j)||/^(?:a|area|object|button)$/.test(d)&&"tabindex"===
j||"input"===d&&("maxlength"===j||"tabindex"===j)||"select"===d&&("size"===j||"tabindex"===j)||"textarea"===d&&/^(?:rows|cols|tabindex)$/.test(j)||"colgroup"===d&&"span"===j||"col"===d&&"span"===j||("th"===d||"td"===d)&&("rowspan"===j||"colspan"===j)?g=h(g):"style"===j&&(g=h(g).replace(/[\s\xa0]*;[\s\xa0]*$/,""));d=(""+g).replace(/"/g,"&quot;");if(!m||/[ "'=<>`]/.test(m))d='"'+d+'"';this.append(" ",c,"=",d)}},text:function(a){this.inPre||(a=i(a));this.append(a)}});o.exports=a});
KISSY.add("html-parser/writer/filter",["util"],function(m,b,p,o){function a(){this.tagNames=[];this.attributeNames=[];this.tags=[];this.comment=[];this.text=[];this.cdata=[];this.attributes=[];this.root=[]}function h(a,b){for(var h=0;a&&h<a.length;h++)i.each(a[h].value,function(a){b=b.replace(a[0],a[1])});return b}function k(a,b,h){var c,d;for(d=0;a&&d<a.length;d++){c=a[d].value;if(!1===(c=c.apply(null,b)))return!1;if(h&&c&&c!==h){if("string"===typeof c){if(h.toHtml()===c)break;h.nodeValue=c;c=h}return this.onNode(c)}}return h}
var i=b("util");a.prototype={constructor:a,addRules:function(a,b){var b=b||10,h;for(h in a){var c=this[h];if(c){var d;a:{for(d=0;c&&d<c.length;d++)if(c[d].priority>b)break a;d=c.length}c.splice(d,0,{value:a[h],priority:b})}}},onTagName:function(a){return h(this.tagNames,a)},onAttributeName:function(a){return h(this.attributeNames,a)},onText:function(a){return k.call(this,this.text,[a.toHtml(),a],a)},onCData:function(a){return k.call(this,this.cdata,[a.toHtml(),a],a)},onAttribute:function(a,b){var h;
a:{h=this.attributes;for(var c=0;h&&c<h.length;c++){var d=h[c].value,i,j=a.name;if(d[j]&&!1===(i=d[j].call(null,a.value,b))){h=i;break a}"string"===typeof i&&(a.value=i)}h=a}return h},onComment:function(a){return k.call(this,this.comment,[a.toHtml(),a],a)},onNode:function(a){var b=a.nodeType;if(1===b)return this.onTag(a);if(3===b)return this.onText(a);if(8===b)return this.onComment(a)},onFragment:function(a){return k.call(this,this.root,[a],a)},onTag:function(a){for(var b=["^",a.tagName,"$"],h=this.tags,
c,d=0;d<b.length;d++)for(var i=b[d],j=0;j<h.length;j++)if(c=h[j].value,c[i]){if(!1===(c=c[i](a)))return!1;if(c&&c!==a)return this.onNode(c);if(!a.tagName)return a}return a}};o.exports=a});
