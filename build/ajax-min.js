/*
Copyright 2012, KISSY UI Library v1.40dev
MIT Licensed
build time: Aug 21 20:53
*/
KISSY.add("ajax",function(b,f,j){function k(c,e,g,a,l){b.isFunction(e)&&(a=g,g=e,e=i);return j({type:l||"get",url:c,data:e,success:g,dataType:a})}var i=void 0;b.mix(j,{serialize:f.serialize,get:k,post:function(c,e,g,a){b.isFunction(e)&&(a=g,g=e,e=i);return k(c,e,g,a,"post")},jsonp:function(c,e,g){b.isFunction(e)&&(g=e,e=i);return k(c,e,g,"jsonp")},getScript:b.getScript,getJSON:function(c,e,g){b.isFunction(e)&&(g=e,e=i);return k(c,e,g,"json")},upload:function(c,e,g,a,l){b.isFunction(g)&&(l=a,a=g,g=
i);return j({url:c,type:"post",dataType:l,form:e,data:g,success:a})}});b.mix(b,{Ajax:j,IO:j,ajax:j,io:j,jsonp:j.jsonp});return j},{requires:"ajax/form-serializer,ajax/base,ajax/xhr-transport,ajax/script-transport,ajax/jsonp,ajax/form,ajax/iframe-transport,ajax/methods".split(",")});
KISSY.add("ajax/base",function(b,f,j,k){function i(a){var d=a.context,c=a.ifModified;delete a.context;a=b.mix(b.clone(n),a,{deep:!0});a.context=d||a;var l,e=a.type,i=a.dataType,o;o=a.query=new b.Uri.Query;d=a.uri=q.resolve(a.url);"crossDomain"in a||(a.crossDomain=!a.uri.hasSameDomainAs(q));if(a.processData&&(l=a.data))b.isObject(l)?o.add(l):o.reset(l);e=a.type=e.toUpperCase();a.hasContent=!h.test(e);i=a.dataType=b.trim(i||"*").split(g);!("cache"in a)&&b.inArray(i[0],["script","jsonp"])&&(a.cache=
!1);var f;a.hasContent||(o.count()&&d.query.add(o),c&&(f=d.clone()),!1===a.cache&&d.query.set("_ksTS",b.now()+"_"+b.guid()));c&&(a.ifModifiedKeyUri=f||d.clone());return a}function c(a,h){e.fire(a,{ajaxConfig:h.config,xhr:h,io:h})}function e(a){function h(l){return function(h){if(f=d.timeoutTimer)clearTimeout(f),d.timeoutTimer=0;var g=a[l];g&&g.apply(t,h);c(l,d)}}var d=this;if(!a.url)return k;if(!(d instanceof e))return new e(a);l.call(d);a=i(a);b.mix(d,{responseData:null,config:a||{},timeoutTimer:null,
responseText:null,responseXML:null,responseHeadersString:"",responseHeaders:null,requestHeaders:{},readyState:0,state:0,statusText:null,status:0,transport:null,_defer:new b.Defer(this)});var g;c("start",d);g=new (r[a.dataType[0]]||r["*"])(d);d.transport=g;a.contentType&&d.setRequestHeader("Content-Type",a.contentType);var o=a.dataType[0],f,m,j=a.timeout,t=a.context,q=a.headers,n=a.accepts;d.setRequestHeader("Accept",o&&n[o]?n[o]+("*"===o?"":", */*; q=0.01"):n["*"]);for(m in q)q.hasOwnProperty(m)&&
d.setRequestHeader(m,q[m]);if(a.beforeSend&&!1===a.beforeSend.call(t,d,a))return k;d.then(h("success"),h("error"));d.fin(h("complete"));d.readyState=1;c("send",d);a.async&&0<j&&(d.timeoutTimer=setTimeout(function(){d.abort("timeout")},1E3*j));try{d.state=1,g.send()}catch(p){2>d.state&&d._ioReady(-1,p)}return k}var g=/\s+/,a=function(a){return a},l=b.Promise,h=/^(?:GET|HEAD)$/,d,o=b.Uri,t=b.Env.host,m=t.document,t=t.location,q;try{d=t.href}catch(p){d=m.createElement("a"),d.href="",d=d.href}q=new o(d);
d=/^(?:about|app|app\-storage|.+\-extension|file|widget)$/.test(q.getScheme());var r={},n={type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",async:!0,serializeArray:!0,processData:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":"*/*"},converters:{text:{json:f.parse,html:a,text:a,xml:b.parseXML}},contents:{xml:/xml/,html:/html/,json:/json/}};n.converters.html=n.converters.text;b.mix(e,j.Target);b.mix(e,
{isLocal:d,setupConfig:function(a){b.mix(n,a,{deep:!0})},setupTransport:function(a,d){r[a]=d},getTransport:function(a){return r[a]},getConfig:function(){return n}});return e},{requires:["json","event"]});
KISSY.add("ajax/form-serializer",function(b,f){function j(c){return c.replace(i,"\r\n")}var k=/^(?:select|textarea)/i,i=/\r?\n/g,c,e=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i;return c={serialize:function(g,a){return b.param(c.getFormData(g),void 0,void 0,a||!1)},getFormData:function(c){var a=[],l={};b.each(f.query(c),function(h){h=h.elements?b.makeArray(h.elements):[h];a.push.apply(a,h)});a=b.filter(a,function(a){return a.name&&!a.disabled&&
(a.checked||k.test(a.nodeName)||e.test(a.type))});b.each(a,function(a){var d=f.val(a),c,d=b.isArray(d)?b.map(d,j):j(d);(c=l[a.name])?(c&&!b.isArray(c)&&(c=l[a.name]=[c]),c.push.apply(c,b.makeArray(d))):l[a.name]=d});return l}}},{requires:["dom"]});
KISSY.add("ajax/form",function(b,f,j,k){f.on("start",function(b){var c,e,b=b.io.config;if(c=b.form)c=j.get(c),e=c.encoding||c.enctype,"multipart/form-data"!=e.toLowerCase()?(c=k.getFormData(c),b.hasContent?b.query.add(c):(b.uri.query.add(c),b.ifModifiedKeyUri&&b.ifModifiedKeyUri.query.add(c))):(c=b.dataType,b=c[0],"*"==b&&(b="text"),c.length=2,c[0]="iframe",c[1]=b)});return f},{requires:["./base","dom","./form-serializer"]});
KISSY.add("ajax/iframe-transport",function(b,f,j,k){function i(a){var c=b.guid("ajax-iframe"),h=f.getEmptyIframeSrc(),a=a.iframe=f.create("<iframe "+(h?' src="'+h+'" ':"")+' id="'+c+'" name="'+c+'" style="position:absolute;left:-9999px;top:-9999px;"/>');f.prepend(a,g.body||g.documentElement);return a}function c(a,c,h){var d=[],e,i,m,j,k=a.keys();b.each(k,function(k){var n=a.get(k);e=b.isArray(n);i=b.makeArray(n);for(m=0;m<i.length;m++)j=g.createElement("input"),j.type="hidden",j.name=k+(e&&h?"[]":
""),j.value=i[m],f.append(j,c),d.push(j)});return d}function e(a){this.io=a}var g=b.Env.host.document;k.setupConfig({converters:{iframe:k.getConfig().converters.text,text:{iframe:function(a){return a}},xml:{iframe:function(a){return a}}}});b.augment(e,{send:function(){var a=this,b=a.io,h=b.config,d,e,g=h.query,m=f.get(h.form);a.attrs={target:f.attr(m,"target")||"",action:f.attr(m,"action")||"",method:f.attr(m,"method")};a.form=m;e=i(b);f.attr(m,{target:e.id,action:h.uri.toString(h.serializeArray),
method:"post"});g.count()&&(d=c(g,m,h.serializeArray));a.fields=d;setTimeout(function(){j.on(e,"load error",a._callback,a);m.submit()},10)},_callback:function(a){var c=this.io,a=a.type,h=c.iframe;if(h)if(f.attr(this.form,this.attrs),f.remove(this.fields),j.detach(h),setTimeout(function(){f.remove(h)},30),c.iframe=null,"load"==a){if((a=h.contentWindow.document)&&a.body)c.responseText=b.trim(f.text(a.body)),b.startsWith(c.responseText,"<?xml")&&(c.responseText=void 0);c.responseXML=a&&a.XMLDocument?
a.XMLDocument:a;c._ioReady(200,"success")}else"error"==a&&c._ioReady(500,"error")},abort:function(){this._callback({})}});k.setupTransport("iframe",e);return k},{requires:["dom","event","./base"]});
KISSY.add("ajax/jsonp",function(b,f){var j=b.Env.host;f.setupConfig({jsonp:"callback",jsonpCallback:function(){return b.guid("jsonp")}});f.on("start",function(f){var i=f.io,c=i.config,f=c.dataType;if("jsonp"==f[0]){var e,g=c.jsonpCallback,a=b.isFunction(g)?g():g,l=j[a];c.uri.query.set(c.jsonp,a);j[a]=function(a){1<arguments.length&&(a=b.makeArray(arguments));e=[a]};i.fin(function(){j[a]=l;if(void 0===l)try{delete j[a]}catch(h){}else e&&l(e[0])});i=i.converters=i.converters||{};i.script=i.script||
{};i.script.json=function(){return e[0]};f.length=2;f[0]="script";f[1]="json"}});return f},{requires:["./base"]});
KISSY.add("ajax/methods",function(b,f,j){function k(c){var e=c.responseText,g=c.responseXML,a=c.config,l=a.converters,h=c.converters||{},d,f,i=a.contents,m=a.dataType;if(e||g){for(a=c.mimeType||c.getResponseHeader("Content-Type");"*"==m[0];)m.shift();if(!m.length)for(d in i)if(i.hasOwnProperty(d)&&i[d].test(a)){m[0]!=d&&m.unshift(d);break}m[0]=m[0]||"text";if("text"==m[0]&&e!==j)f=e;else if("xml"==m[0]&&g!==j)f=g;else{var k={text:e,xml:g};b.each(["text","xml"],function(a){var d=m[0];if((h[a]&&h[a][d]||
l[a]&&l[a][d])&&k[a])return m.unshift(a),f="text"==a?e:g,!1})}}i=m[0];for(a=1;a<m.length;a++){d=m[a];var p=h[i]&&h[i][d]||l[i]&&l[i][d];if(!p)throw"no covert for "+i+" => "+d;f=p(f);i=d}c.responseData=f}var i=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg;b.extend(f,b.Promise,{setRequestHeader:function(c,b){this.requestHeaders[c]=b;return this},getAllResponseHeaders:function(){return 2===this.state?this.responseHeadersString:null},getResponseHeader:function(c){var b,g;if(2===this.state){if(!(g=this.responseHeaders))for(g=
this.responseHeaders={};b=i.exec(this.responseHeadersString);)g[b[1]]=b[2];b=g[c]}return b===j?null:b},overrideMimeType:function(c){this.state||(this.mimeType=c);return this},abort:function(c){c=c||"abort";this.transport&&this.transport.abort(c);this._ioReady(0,c);return this},getNativeXhr:function(){var c;if(c=this.transport)return c.nativeXhr},_ioReady:function(c,b){if(2!=this.state){this.state=2;this.readyState=4;var g;if(200<=c&&300>c||304==c)if(304==c)b="not modified",g=!0;else try{k(this),b=
"success",g=!0}catch(a){b="parser error"}else 0>c&&(c=0);this.status=c;this.statusText=b;this._defer[g?"resolve":"reject"]([this.responseData,b,this])}}})},{requires:["./base"]});
KISSY.add("ajax/script-transport",function(b,f,j,k){function i(c){if(!c.config.crossDomain)return new (f.getTransport("*"))(c);this.io=c;return 0}var c=b.Env.host,e=c.document;f.setupConfig({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{text:{script:function(c){b.globalEval(c);return c}}}});b.augment(i,{send:function(){var b=this,a,l=b.io.config,h=e.head||e.getElementsByTagName("head")[0]||
e.documentElement;b.head=h;a=e.createElement("script");b.script=a;a.async="async";l.scriptCharset&&(a.charset=l.scriptCharset);a.src=l.uri.toString(l.serializeArray);a.onerror=a.onload=a.onreadystatechange=function(a){a=a||c.event;b._callback((a.type||"error").toLowerCase())};h.insertBefore(a,h.firstChild)},_callback:function(c,a){var b=this.script,h=this.io,d=this.head;if(b&&(a||!b.readyState||/loaded|complete/.test(b.readyState)||"error"==c))b.onerror=b.onload=b.onreadystatechange=null,d&&b.parentNode&&
d.removeChild(b),this.head=this.script=k,!a&&"error"!=c?h._ioReady(200,"success"):"error"==c&&h._ioReady(500,"script error")},abort:function(){this._callback(0,1)}});f.setupTransport("script",i);return f},{requires:["./base","./xhr-transport"]});
KISSY.add("ajax/sub-domain-transport",function(b,f,j,k){function i(a){var c=a.config;this.io=a;c.crossDomain=!1}function c(){var a=this.io.config.uri.getHostname(),a=g[a];a.ready=1;j.detach(a.iframe,"load",c,this);this.send()}var e=b.Env.host.document,g={};b.augment(i,f.proto,{send:function(){var a=this.io.config,l=a.uri,h=l.getHostname(),d;d=g[h];var i="/sub_domain_proxy.html";a.xdr&&a.xdr.subDomain&&a.xdr.subDomain.proxy&&(i=a.xdr.subDomain.proxy);d&&d.ready?(this.nativeXhr=f.nativeXhr(0,d.iframe.contentWindow))&&
this.sendInternal():(d?a=d.iframe:(d=g[h]={},a=d.iframe=e.createElement("iframe"),k.css(a,{position:"absolute",left:"-9999px",top:"-9999px"}),k.prepend(a,e.body||e.documentElement),d=new b.Uri,d.setScheme(l.getScheme()),d.setHostname(h),d.setPath(i),a.src=d.toString()),j.on(a,"load",c,this))}});return i},{requires:["./xhr-transport-base","event","dom"]});
KISSY.add("ajax/xdr-flash-transport",function(b,f,j){function k(c,d,b){l||(l=!0,c='<object id="'+e+'" type="application/x-shockwave-flash" data="'+c+'" width="0" height="0"><param name="movie" value="'+c+'" /><param name="FlashVars" value="yid='+d+"&uid="+b+'&host=KISSY.require(\'ajax\')" /><param name="allowScriptAccess" value="always" /></object>',d=a.createElement("div"),j.prepend(d,a.body||a.documentElement),d.innerHTML=c)}function i(a){this.io=a}var c={},e="io_swf",g,a=b.Env.host.document,l=
!1;b.augment(i,{send:function(){var a=this,d=a.io.config;k((d.xdr||{}).src||b.Config.base+"ajax/io.swf",1,1);g?(a._uid=b.guid(),c[a._uid]=a,g.send(d.uri.toString(d.serializeArray),{id:a._uid,uid:a._uid,method:d.type,data:d.hasContent&&d.query.toString(d.serializeArray)||{}})):setTimeout(function(){a.send()},200)},abort:function(){g.abort(this._uid)},_xdrResponse:function(a,d){var b,e=d.id,g=this.io;g.responseText=decodeURI(d.c.responseText);switch(a){case "success":b={status:200,statusText:"success"};
delete c[e];break;case "abort":delete c[e];break;case "timeout":case "transport error":case "failure":delete c[e],b={status:500,statusText:a}}b&&g._ioReady(b.status,b.statusText)}});f.applyTo=function(a,d,c){var a=d.split(".").slice(1),e=f;b.each(a,function(a){e=e[a]});e.apply(null,c)};f.xdrReady=function(){g=a.getElementById(e)};f.xdrResponse=function(a,d){var b=c[d.uid];b&&b._xdrResponse(a,d)};return i},{requires:["./base","dom"]});
KISSY.add("ajax/xhr-transport-base",function(b,f){function j(a,b){try{return new (b||k).XMLHttpRequest}catch(c){}}var k=b.Env.host,i=k.XDomainRequest,c={proto:{}},e={},g={};f.__lastModifiedCached=e;f.__eTagCached=g;c.nativeXhr=k.ActiveXObject?function(a,b){var c;if(a&&i)c=new i;else if(!(c=!f.isLocal&&j(a,b)))a:{try{c=new (b||k).ActiveXObject("Microsoft.XMLHTTP");break a}catch(d){}c=void 0}return c}:j;b.mix(c.proto,{sendInternal:function(){var a=this,c=a.io,b=c.config,d=a.nativeXhr,f=b.type,j=b.async,
m,k=b.crossDomain,p=c.mimeType,c=c.requestHeaders||{},r=b.serializeArray,n=b.uri.toString(r),v,u,s;if(v=b.ifModifiedKeyUri&&b.ifModifiedKeyUri.toString()){if(u=e[v])c["If-Modified-Since"]=u;if(u=g[v])c["If-None-Match"]=u}(m=b.username)?d.open(f,n,j,m,b.password):d.open(f,n,j);if(f=b.xhrFields)for(s in f)f.hasOwnProperty(s)&&(d[s]=f[s]);p&&d.overrideMimeType&&d.overrideMimeType(p);!k&&!c["X-Requested-With"]&&(c["X-Requested-With"]="XMLHttpRequest");try{if(!k)for(s in c)c.hasOwnProperty(s)&&d.setRequestHeader(s,
c[s])}catch(w){}d.send(b.hasContent&&b.query.toString(r)||null);!j||4==d.readyState?a._callback():i&&d instanceof i?(d.onload=function(){d.readyState=4;d.status=200;a._callback()},d.onerror=function(){d.readyState=4;d.status=500;a._callback()}):d.onreadystatechange=function(){a._callback()}},abort:function(){this._callback(0,1)},_callback:function(a,c){try{var h=this.nativeXhr,d=this.io,f=d.config;if(c||4==h.readyState)if(i&&h instanceof i?(h.onerror=b.noop,h.onload=b.noop):h.onreadystatechange=b.noop,
c)4!==h.readyState&&h.abort();else{var j=f.ifModifiedKeyUri&&f.ifModifiedKeyUri.toString(),k=h.status;i&&h instanceof i||(d.responseHeadersString=h.getAllResponseHeaders());if(j){var q=h.getResponseHeader("Last-Modified"),p=h.getResponseHeader("ETag");q&&(e[j]=q);p&&(g[p]=p)}var r=h.responseXML;r&&r.documentElement&&(d.responseXML=r);d.responseText=h.responseText;try{var n=h.statusText}catch(v){n=""}!k&&d.isLocal&&!f.crossDomain?k=d.responseText?200:404:1223===k&&(k=204);d._ioReady(k,n)}}catch(u){h.onreadystatechange=
b.noop,c||d._ioReady(-1,u)}}});return c},{requires:["./base"]});
KISSY.add("ajax/xhr-transport",function(b,f,j,k,i,c){var e=b.Env.host.XDomainRequest,g=j.nativeXhr();if(g){var a=function(a){var a=a.split("."),c=a.length,b=3<c?3:2;return c<b?a.join("."):a.reverse().slice(0,b).reverse().join(".")},l=function(b){var d=b.config,f=d.crossDomain,l=d.xdr||{};if(f){if(a(location.hostname)==a(d.uri.getHostname()))return new k(b);if(!("withCredentials"in g)&&("flash"===""+l.use||!e))return new i(b)}this.io=b;this.nativeXhr=j.nativeXhr(f);return c};b.augment(l,j.proto,{send:function(){this.sendInternal()}});
f.setupTransport("*",l)}return f},{requires:["./base","./xhr-transport-base","./sub-domain-transport","./xdr-flash-transport"]});
