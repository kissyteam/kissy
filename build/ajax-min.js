/*
Copyright 2012, KISSY UI Library v1.40dev
MIT Licensed
build time: Nov 14 21:49
*/
KISSY.add("ajax",function(c,g,j){function k(f,e,d,b,l){c.isFunction(e)&&(b=d,d=e,e=i);return j({type:l||"get",url:f,data:e,success:d,dataType:b})}var i=void 0;c.mix(j,{serialize:g.serialize,get:k,post:function(f,e,d,b){c.isFunction(e)&&(b=d,d=e,e=i);return k(f,e,d,b,"post")},jsonp:function(f,e,d){c.isFunction(e)&&(d=e,e=i);return k(f,e,d,"jsonp")},getScript:c.getScript,getJSON:function(f,e,d){c.isFunction(e)&&(d=e,e=i);return k(f,e,d,"json")},upload:function(f,e,d,b,l){c.isFunction(d)&&(l=b,b=d,d=
i);return j({url:f,type:"post",dataType:l,form:e,data:d,success:b})}});c.mix(c,{Ajax:j,IO:j,ajax:j,io:j,jsonp:j.jsonp});return j},{requires:"ajax/form-serializer,ajax/base,ajax/xhr-transport,ajax/script-transport,ajax/jsonp,ajax/form,ajax/iframe-transport,ajax/methods".split(",")});
KISSY.add("ajax/base",function(c,g,j,k){function i(a){var f=a.context,l=a.ifModified;delete a.context;a=c.mix(c.clone(p),a,{deep:!0});a.context=f||a;var d,e=a.type,o=a.dataType,i;i=a.query=new c.Uri.Query;f=a.uri=n.resolve(a.url);"crossDomain"in a||(a.crossDomain=!a.uri.hasSameDomainAs(n));if(a.processData&&(d=a.data))c.isObject(d)?i.add(d):i.reset(d);e=a.type=e.toUpperCase();a.hasContent=!h.test(e);o=a.dataType=c.trim(o||"*").split(b);!("cache"in a)&&c.inArray(o[0],["script","jsonp"])&&(a.cache=
!1);var g;a.hasContent||(i.count()&&f.query.add(i),l&&(g=f.clone()),!1===a.cache&&f.query.set("_ksTS",c.now()+"_"+c.guid()));l&&(a.ifModifiedKeyUri=g||f.clone());return a}function f(a,b){e.fire(a,{ajaxConfig:b.config,xhr:b,io:b})}function e(b){function h(a){return function(h){if(g=d.timeoutTimer)clearTimeout(g),d.timeoutTimer=0;var l=b[a];l&&l.apply(u,h);f(a,d)}}var d=this;if(!b.url)return k;if(!(d instanceof e))return new e(b);a.call(d);b=i(b);c.mix(d,{responseData:null,config:b||{},timeoutTimer:null,
responseText:null,responseXML:null,responseHeadersString:"",responseHeaders:null,requestHeaders:{},readyState:0,state:0,statusText:null,status:0,transport:null,_defer:new c.Defer(this)});var l;f("start",d);l=new (q[b.dataType[0]]||q["*"])(d);d.transport=l;b.contentType&&d.setRequestHeader("Content-Type",b.contentType);var o=b.dataType[0],g,m,j=b.timeout,u=b.context,r=b.headers,n=b.accepts;d.setRequestHeader("Accept",o&&n[o]?n[o]+("*"===o?"":", */*; q=0.01"):n["*"]);for(m in r)d.setRequestHeader(m,
r[m]);if(b.beforeSend&&!1===b.beforeSend.call(u,d,b))return k;d.then(h("success"),h("error"));d.fin(h("complete"));d.readyState=1;f("send",d);b.async&&0<j&&(d.timeoutTimer=setTimeout(function(){d.abort("timeout")},1E3*j));try{d.state=1,l.send()}catch(v){2>d.state&&d._ioReady(-1,v)}return k}var d=/^(?:about|app|app\-storage|.+\-extension|file|widget)$/,b=/\s+/,l=function(a){return a},a=c.Promise,h=/^(?:GET|HEAD)$/,o,u=c.Uri,m=c.Env.host,v=m.document,m=m.location,n;if(m){try{o=m.href}catch(r){o=v.createElement("a"),
o.href="",o=o.href}n=new u(o)}var d=n&&d.test(n.getScheme()),q={},p={type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",async:!0,serializeArray:!0,processData:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":"*/*"},converters:{text:{json:g.parse,html:l,text:l,xml:c.parseXML}},contents:{xml:/xml/,html:/html/,json:/json/}};p.converters.html=p.converters.text;c.mix(e,j.Target);c.mix(e,{isLocal:d,setupConfig:function(a){c.mix(p,
a,{deep:!0})},setupTransport:function(a,b){q[a]=b},getTransport:function(a){return q[a]},getConfig:function(){return p}});return e},{requires:["json","event"]});
KISSY.add("ajax/form-serializer",function(c,g){function j(d){return d.replace(i,"\r\n")}var k=/^(?:select|textarea)/i,i=/\r?\n/g,f,e=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i;return f={serialize:function(d,b){return c.param(f.getFormData(d),void 0,void 0,b||!1)},getFormData:function(d){var b=[],l={};c.each(g.query(d),function(a){a=a.elements?c.makeArray(a.elements):[a];b.push.apply(b,a)});b=c.filter(b,function(a){return a.name&&!a.disabled&&
(a.checked||k.test(a.nodeName)||e.test(a.type))});c.each(b,function(a){var b=g.val(a),d,b=c.isArray(b)?c.map(b,j):j(b);(d=l[a.name])?(d&&!c.isArray(d)&&(d=l[a.name]=[d]),d.push.apply(d,c.makeArray(b))):l[a.name]=b});return l}}},{requires:["dom"]});
KISSY.add("ajax/form",function(c,g,j,k){g.on("start",function(c){var f,e,c=c.io.config;if(f=c.form)f=j.get(f),e=f.encoding||f.enctype,"multipart/form-data"!=e.toLowerCase()?(f=k.getFormData(f),c.hasContent?c.query.add(f):(c.uri.query.add(f),c.ifModifiedKeyUri&&c.ifModifiedKeyUri.query.add(f))):(f=c.dataType,c=f[0],"*"==c&&(c="text"),f.length=2,f[0]="iframe",f[1]=c)});return g},{requires:["./base","dom","./form-serializer"]});
KISSY.add("ajax/iframe-transport",function(c,g,j,k){function i(b){var l=c.guid("ajax-iframe"),a=g.getEmptyIframeSrc(),b=b.iframe=g.create("<iframe "+(a?' src="'+a+'" ':"")+' id="'+l+'" name="'+l+'" style="position:absolute;left:-9999px;top:-9999px;"/>');g.prepend(b,d.body||d.documentElement);return b}function f(b,l,a){var h=[],f,e,m,i,j=b.keys();c.each(j,function(j){var k=b.get(j);f=c.isArray(k);e=c.makeArray(k);for(m=0;m<e.length;m++)i=d.createElement("input"),i.type="hidden",i.name=j+(f&&a?"[]":
""),i.value=e[m],g.append(i,l),h.push(i)});return h}function e(b){this.io=b}var d=c.Env.host.document;k.setupConfig({converters:{iframe:k.getConfig().converters.text,text:{iframe:function(b){return b}},xml:{iframe:function(b){return b}}}});c.augment(e,{send:function(){var b=this,d=b.io,a=d.config,h,c,e=a.query,m=g.get(a.form);b.attrs={target:g.attr(m,"target")||"",action:g.attr(m,"action")||"",method:g.attr(m,"method")};b.form=m;c=i(d);g.attr(m,{target:c.id,action:a.uri.toString(a.serializeArray),
method:"post"});e.count()&&(h=f(e,m,a.serializeArray));b.fields=h;setTimeout(function(){j.on(c,"load error",b._callback,b);m.submit()},10)},_callback:function(b){var d=this.io,b=b.type,a,h=d.iframe;if(h)if(g.attr(this.form,this.attrs),g.remove(this.fields),j.detach(h),setTimeout(function(){g.remove(h)},30),d.iframe=null,"load"==b)try{if((a=h.contentWindow.document)&&a.body)d.responseText=c.trim(g.text(a.body)),c.startsWith(d.responseText,"<?xml")&&(d.responseText=void 0);d.responseXML=a&&a.XMLDocument?
a.XMLDocument:a;a?d._ioReady(200,"success"):d._ioReady(500,"parser error")}catch(f){d._ioReady(500,"parser error")}else"error"==b&&d._ioReady(500,"error")},abort:function(){this._callback({})}});k.setupTransport("iframe",e);return k},{requires:["dom","event","./base"]});
KISSY.add("ajax/jsonp",function(c,g){var j=c.Env.host;g.setupConfig({jsonp:"callback",jsonpCallback:function(){return c.guid("jsonp")}});g.on("start",function(g){var i=g.io,f=i.config,g=f.dataType;if("jsonp"==g[0]){var e,d=f.jsonpCallback,b=c.isFunction(d)?d():d,l=j[b];f.uri.query.set(f.jsonp,b);j[b]=function(a){1<arguments.length&&(a=c.makeArray(arguments));e=[a]};i.fin(function(){j[b]=l;if(void 0===l)try{delete j[b]}catch(a){}else e&&l(e[0])});i=i.converters=i.converters||{};i.script=i.script||
{};i.script.json=function(){return e[0]};g.length=2;g[0]="script";g[1]="json"}});return g},{requires:["./base"]});
KISSY.add("ajax/methods",function(c,g,j){function k(f){var e=f.responseText,d=f.responseXML,b=f.config,l=b.converters,a=f.converters||{},h,g,i=b.contents,m=b.dataType;if(e||d){for(b=f.mimeType||f.getResponseHeader("Content-Type");"*"==m[0];)m.shift();if(!m.length)for(h in i)if(i[h].test(b)){m[0]!=h&&m.unshift(h);break}m[0]=m[0]||"text";if("text"==m[0]&&e!==j)g=e;else if("xml"==m[0]&&d!==j)g=d;else{var k={text:e,xml:d};c.each(["text","xml"],function(b){var h=m[0];if((a[b]&&a[b][h]||l[b]&&l[b][h])&&
k[b])return m.unshift(b),g="text"==b?e:d,!1})}}i=m[0];for(b=1;b<m.length;b++){h=m[b];var n=a[i]&&a[i][h]||l[i]&&l[i][h];if(!n)throw"no covert for "+i+" => "+h;g=n(g);i=h}f.responseData=g}var i=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg;c.extend(g,c.Promise,{setRequestHeader:function(c,e){this.requestHeaders[c]=e;return this},getAllResponseHeaders:function(){return 2===this.state?this.responseHeadersString:null},getResponseHeader:function(c){var e,d;if(2===this.state){if(!(d=this.responseHeaders))for(d=this.responseHeaders=
{};e=i.exec(this.responseHeadersString);)d[e[1]]=e[2];e=d[c]}return e===j?null:e},overrideMimeType:function(c){this.state||(this.mimeType=c);return this},abort:function(c){c=c||"abort";this.transport&&this.transport.abort(c);this._ioReady(0,c);return this},getNativeXhr:function(){var c;if(c=this.transport)return c.nativeXhr},_ioReady:function(c,e){if(2!=this.state){this.state=2;this.readyState=4;var d;if(200<=c&&300>c||304==c)if(304==c)e="not modified",d=!0;else try{k(this),e="success",d=!0}catch(b){e=
"parser error"}else 0>c&&(c=0);this.status=c;this.statusText=e;this._defer[d?"resolve":"reject"]([this.responseData,e,this])}}})},{requires:["./base"]});
KISSY.add("ajax/script-transport",function(c,g,j,k){function i(d){if(!d.config.crossDomain)return new (g.getTransport("*"))(d);this.io=d;return 0}var f=c.Env.host,e=f.document;g.setupConfig({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{text:{script:function(d){c.globalEval(d);return d}}}});c.augment(i,{send:function(){var d=this,b,c=d.io.config,a=e.head||e.getElementsByTagName("head")[0]||
e.documentElement;d.head=a;b=e.createElement("script");d.script=b;b.async="async";c.scriptCharset&&(b.charset=c.scriptCharset);b.src=c.uri.toString(c.serializeArray);b.onerror=b.onload=b.onreadystatechange=function(a){a=a||f.event;d._callback((a.type||"error").toLowerCase())};a.insertBefore(b,a.firstChild)},_callback:function(d,b){var c=this.script,a=this.io,h=this.head;if(c&&(b||!c.readyState||/loaded|complete/.test(c.readyState)||"error"==d))c.onerror=c.onload=c.onreadystatechange=null,h&&c.parentNode&&
h.removeChild(c),this.head=this.script=k,!b&&"error"!=d?a._ioReady(200,"success"):"error"==d&&a._ioReady(500,"script error")},abort:function(){this._callback(0,1)}});g.setupTransport("script",i);return g},{requires:["./base","./xhr-transport"]});
KISSY.add("ajax/sub-domain-transport",function(c,g,j,k){function i(b){var c=b.config;this.io=b;c.crossDomain=!1}function f(){var b=this.io.config.uri.getHostname(),b=d[b];b.ready=1;j.detach(b.iframe,"load",f,this);this.send()}var e=c.Env.host.document,d={};c.augment(i,g.proto,{send:function(){var b=this.io.config,i=b.uri,a=i.getHostname(),h;h=d[a];var o="/sub_domain_proxy.html";b.xdr&&b.xdr.subDomain&&b.xdr.subDomain.proxy&&(o=b.xdr.subDomain.proxy);h&&h.ready?(this.nativeXhr=g.nativeXhr(0,h.iframe.contentWindow))&&
this.sendInternal():(h?b=h.iframe:(h=d[a]={},b=h.iframe=e.createElement("iframe"),k.css(b,{position:"absolute",left:"-9999px",top:"-9999px"}),k.prepend(b,e.body||e.documentElement),h=new c.Uri,h.setScheme(i.getScheme()),h.setHostname(a),h.setPath(o),b.src=h.toString()),j.on(b,"load",f,this))}});return i},{requires:["./xhr-transport-base","event","dom"]});
KISSY.add("ajax/xdr-flash-transport",function(c,g,j){function k(a,c,d){l||(l=!0,a='<object id="'+e+'" type="application/x-shockwave-flash" data="'+a+'" width="0" height="0"><param name="movie" value="'+a+'" /><param name="FlashVars" value="yid='+c+"&uid="+d+'&host=KISSY.require(\'ajax\')" /><param name="allowScriptAccess" value="always" /></object>',c=b.createElement("div"),j.prepend(c,b.body||b.documentElement),c.innerHTML=a)}function i(a){this.io=a}var f={},e="io_swf",d,b=c.Env.host.document,l=
!1;c.augment(i,{send:function(){var a=this,b=a.io.config;k((b.xdr||{}).src||c.Config.base+"ajax/io.swf",1,1);d?(a._uid=c.guid(),f[a._uid]=a,d.send(b.uri.toString(b.serializeArray),{id:a._uid,uid:a._uid,method:b.type,data:b.hasContent&&b.query.toString(b.serializeArray)||{}})):setTimeout(function(){a.send()},200)},abort:function(){d.abort(this._uid)},_xdrResponse:function(a,b){var c,d=b.id,e=this.io;e.responseText=decodeURI(b.c.responseText);switch(a){case "success":c={status:200,statusText:"success"};
delete f[d];break;case "abort":delete f[d];break;case "timeout":case "transport error":case "failure":delete f[d],c={status:500,statusText:a}}c&&e._ioReady(c.status,c.statusText)}});g.applyTo=function(a,b,d){var a=b.split(".").slice(1),e=g;c.each(a,function(a){e=e[a]});e.apply(null,d)};g.xdrReady=function(){d=b.getElementById(e)};g.xdrResponse=function(a,b){var c=f[b.uid];c&&c._xdrResponse(a,b)};return i},{requires:["./base","dom"]});
KISSY.add("ajax/xhr-transport-base",function(c,g){function j(b,c){try{return new (c||k).XMLHttpRequest}catch(a){}}var k=c.Env.host,i=k.XDomainRequest,f={proto:{}},e={},d={};g.__lastModifiedCached=e;g.__eTagCached=d;f.nativeXhr=k.ActiveXObject?function(b,c){var a;if(b&&i)a=new i;else if(!(a=!g.isLocal&&j(b,c)))a:{try{a=new (c||k).ActiveXObject("Microsoft.XMLHTTP");break a}catch(d){}a=void 0}return a}:j;c.mix(f.proto,{sendInternal:function(){var b=this,c=b.io,a=c.config,h=b.nativeXhr,f=a.type,g=a.async,
j,k=a.crossDomain,n=c.mimeType,c=c.requestHeaders||{},r=a.serializeArray,q=a.uri.toString(r),p,s,t;if(p=a.ifModifiedKeyUri&&a.ifModifiedKeyUri.toString()){if(s=e[p])c["If-Modified-Since"]=s;if(s=d[p])c["If-None-Match"]=s}(j=a.username)?h.open(f,q,g,j,a.password):h.open(f,q,g);if(f=a.xhrFields)for(t in f)h[t]=f[t];n&&h.overrideMimeType&&h.overrideMimeType(n);!k&&!c["X-Requested-With"]&&(c["X-Requested-With"]="XMLHttpRequest");try{if(!k)for(t in c)h.setRequestHeader(t,c[t])}catch(w){}h.send(a.hasContent&&
a.query.toString(r)||null);!g||4==h.readyState?b._callback():i&&h instanceof i?(h.onload=function(){h.readyState=4;h.status=200;b._callback()},h.onerror=function(){h.readyState=4;h.status=500;b._callback()}):h.onreadystatechange=function(){b._callback()}},abort:function(){this._callback(0,1)},_callback:function(b,f){try{var a=this.nativeXhr,h=this.io,g=h.config;if(f||4==a.readyState)if(i&&a instanceof i?(a.onerror=c.noop,a.onload=c.noop):a.onreadystatechange=c.noop,f)4!==a.readyState&&a.abort();else{var j=
g.ifModifiedKeyUri&&g.ifModifiedKeyUri.toString(),m=a.status;i&&a instanceof i||(h.responseHeadersString=a.getAllResponseHeaders());if(j){var k=a.getResponseHeader("Last-Modified"),n=a.getResponseHeader("ETag");k&&(e[j]=k);n&&(d[n]=n)}var r=a.responseXML;r&&r.documentElement&&(h.responseXML=r);h.responseText=a.responseText;try{var q=a.statusText}catch(p){q=""}!m&&h.isLocal&&!g.crossDomain?m=h.responseText?200:404:1223===m&&(m=204);h._ioReady(m,q)}}catch(s){a.onreadystatechange=c.noop,f||h._ioReady(-1,
s)}}});return f},{requires:["./base"]});
KISSY.add("ajax/xhr-transport",function(c,g,j,k,i,f){var e=c.Env.host.XDomainRequest,d=j.nativeXhr();if(d){var b=function(a){var a=a.split("."),b=a.length,c=3<b?3:2;return b<c?a.join("."):a.reverse().slice(0,c).reverse().join(".")},l=function(a){var c=a.config,g=c.crossDomain,l=c.xdr||{};if(g){if(b(location.hostname)==b(c.uri.getHostname()))return new k(a);if(!("withCredentials"in d)&&("flash"===""+l.use||!e))return new i(a)}this.io=a;this.nativeXhr=j.nativeXhr(g);return f};c.augment(l,j.proto,{send:function(){this.sendInternal()}});
g.setupTransport("*",l)}return g},{requires:["./base","./xhr-transport-base","./sub-domain-transport","./xdr-flash-transport"]});
