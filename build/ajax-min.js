/*
Copyright 2011, KISSY UI Library v1.30dev
MIT Licensed
build time: Dec 31 15:15
*/
KISSY.add("ajax",function(i,k,l,m){i.mix(l,{XhrObject:m,serialize:k.serialize,get:function(e,b,c,d,a){if(i.isFunction(b)){d=c;c=b;b=undefined}return l({type:a||"get",url:e,data:b,success:c,dataType:d})},post:function(e,b,c,d){if(i.isFunction(b)){d=c;c=b;b=undefined}return l.get(e,b,c,d,"post")},jsonp:function(e,b,c){if(i.isFunction(b)){c=b;b=undefined}return l.get(e,b,c,"jsonp")},getScript:i.getScript,getJSON:function(e,b,c){if(i.isFunction(b)){c=b;b=undefined}return l.get(e,b,c,"json")},upload:function(e,
b,c,d,a){if(i.isFunction(c)){a=d;d=c;c=undefined}return l({url:e,type:"post",dataType:a,form:b,data:c,success:d})}});return l},{requires:["ajax/form-serializer","ajax/base","ajax/xhrobject","ajax/xhr","ajax/script","ajax/jsonp","ajax/form","ajax/iframe-upload"]});
KISSY.add("ajax/base",function(i,k,l,m){function e(j){j=i.mix(i.clone(u),j||{},undefined,undefined,true);if(!i.isBoolean(j.crossDomain)){var o=f.exec(j.url.toLowerCase());j.crossDomain=!!(o&&(o[1]!=r[1]||o[2]!=r[2]||(o[3]||(o[1]==="http:"?g:n))!=(r[3]||(r[1]==="http:"?g:n))))}if(j.processData&&j.data&&!i.isString(j.data))j.data=i.param(j.data,undefined,undefined,j.serializeArray);j.type=j.type.toUpperCase();j.hasContent=!q.test(j.type);if(!j.hasContent){if(j.data)j.url+=(/\?/.test(j.url)?"&":"?")+
j.data;if(j.cache===false)j.url+=(/\?/.test(j.url)?"&":"?")+"_ksTS="+(i.now()+"_"+i.guid())}j.dataType=i.trim(j.dataType||"*").split(a);j.context=j.context||j;return j}function b(j,o){d.fire(j,{ajaxConfig:o.config,xhr:o})}function c(j){var o=this.config;j=j.type;this.timeoutTimer&&clearTimeout(this.timeoutTimer);o[j]&&o[j].call(o.context,this.responseData,this.statusText,this);b(j,this)}function d(j){if(j.url){j=e(j);var o=new m(j);b("start",o);var x=new (s[j.dataType[0]]||s["*"])(o);o.transport=
x;j.contentType&&o.setRequestHeader("Content-Type",j.contentType);var v=j.dataType[0],w=j.accepts;o.setRequestHeader("Accept",v&&w[v]?w[v]+(v==="*"?"":", */*; q=0.01"):w["*"]);for(var y in j.headers)o.setRequestHeader(y,j.headers[y]);o.on("complete success error",c);o.readyState=1;b("send",o);if(j.async&&j.timeout>0)o.timeoutTimer=setTimeout(function(){o.abort("timeout")},j.timeout*1E3);try{o.state=1;x.send()}catch(z){o.status<2&&o.callback(-1,z)}return o}}var a=/\s+/,f=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,
h=function(j){return j},g=80,n=443,q=/^(?:GET|HEAD)$/,p,r;try{p=location.href}catch(t){p=document.createElement("a");p.href="";p=p.href}r=f.exec(p);p=/^(?:about|app|app\-storage|.+\-extension|file|widget):$/.test(r[1]);var s={},u={type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",async:true,serializeArray:true,processData:true,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":"*/*"},converters:{text:{json:k.parse,
html:h,text:h,xml:i.parseXML}},contents:{xml:/xml/,html:/html/,json:/json/}};u.converters.html=u.converters.text;i.mix(d,l.Target);i.mix(d,{isLocal:p,setupConfig:function(j){i.mix(u,j,undefined,undefined,true)},setupTransport:function(j,o){s[j]=o},getTransport:function(j){return s[j]},getConfig:function(){return u}});return d},{requires:["json","event","./xhrobject"]});
KISSY.add("ajax/form-serializer",function(i,k){var l=/^(?:select|textarea)/i,m=/\r?\n/g,e=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i;return{serialize:function(b){var c=[],d={};k.query(b).each(function(a){a=a.elements?i.makeArray(a.elements):[a];c.push.apply(c,a)});c=i.filter(c,function(a){return a.name&&!a.disabled&&(a.checked||l.test(a.nodeName)||e.test(a.type))});i.each(c,function(a){var f=k.val(a);f=i.map(i.makeArray(f),function(h){return h.replace(m,
"\r\n")});a=d[a.name]=d[a.name]||[];a.push.apply(a,f)});return i.param(d,undefined,undefined,false)}}},{requires:["dom"]});
KISSY.add("ajax/form",function(i,k,l,m){k.on("start",function(e){e=e.xhr.config;if(e.form){var b=l.get(e.form);if((b.encoding||b.enctype).toLowerCase()!="multipart/form-data"){if(b=m.serialize(b))if(e.hasContent){e.data=e.data||"";if(e.data)e.data+="&";e.data+=b}else e.url+=(/\?/.test(e.url)?"&":"?")+b}else{b=e.dataType[0];if(b=="*")b="text";e.dataType.length=2;e.dataType[0]="iframe";e.dataType[1]=b}}});return k},{requires:["./base","dom","./form-serializer"]});
KISSY.add("ajax/iframe-upload",function(i,k,l,m){function e(c){this.xhr=c}var b=document;m.setupConfig({converters:{iframe:m.getConfig().converters.text,text:{iframe:function(c){return c}}}});i.augment(e,{send:function(){var c=this.xhr,d=c.config,a,f=k.get(d.form);this.attrs={target:k.attr(f,"target")||"",action:k.attr(f,"action")||""};this.form=f;var h=i.guid("ajax-iframe");c.iframe=k.create("<iframe  id='"+h+"' name='"+h+"' style='position:absolute;left:-9999px;top:-9999px;'/>");c.iframeId=h;k.prepend(c.iframe,
b.body||b.documentElement);k.attr(f,{target:c.iframeId,action:d.url});if(d.data){a=d.data;d=d.serializeArray;a=i.unparam(a);h=[];for(var g in a)for(var n=i.isArray(a[g]),q=i.makeArray(a[g]),p=0;p<q.length;p++){var r=b.createElement("input");r.type="hidden";r.name=g+(n&&d?"[]":"");r.value=q[p];k.append(r,f);h.push(r)}a=h}this.fields=a;l.on(c.iframe,"load error",this._callback,this);f.submit()},_callback:function(c){var d=this.xhr;c=c.type;var a=d.iframe;if(a){k.attr(this.form,this.attrs);if(c=="load"){c=
a.contentWindow.document;d.responseXML=c;d.responseText=k.text(c.body);d.callback(200,"success")}else c=="error"&&d.callback(500,"error");k.remove(this.fields);l.detach(a);setTimeout(function(){k.remove(a)},30);d.iframe=null}},abort:function(){this._callback(0,1)}});m.setupTransport("iframe",e);return m},{requires:["dom","event","./base"]});
KISSY.add("ajax/jsonp",function(i,k){k.setupConfig({jsonp:"callback",jsonpCallback:function(){return i.guid("jsonp")}});k.on("start",function(l){l=l.xhr;var m=l.config;if(m.dataType[0]=="jsonp"){var e,b=m.jsonpCallback,c=i.isFunction(b)?b():b,d=window[c];m.url+=(/\?/.test(m.url)?"&":"?")+m.jsonp+"="+c;window[c]=function(a){if(arguments.length>1)a=i.makeArray(arguments);e=[a]};l.on("complete",function(){window[c]=d;if(d===undefined)try{delete window[c]}catch(a){}else e&&d(e[0])});l.converters=l.converters||
{};l.converters.script=l.converters.script||{};l.converters.script.json=function(){return e[0]};m.dataType.length=2;m.dataType[0]="script";m.dataType[1]="json"}});return k},{requires:["./base"]});
KISSY.add("ajax/script",function(i,k){function l(e){if(!e.config.crossDomain&&!e.config.forceScript)return new (k.getTransport("*"))(e);this.xhrObj=e;return 0}var m=document;k.setupConfig({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{text:{script:function(e){i.globalEval(e);return e}}}});i.augment(l,{send:function(){var e=this,b,c=this.xhrObj.config,d=m.head||m.getElementsByTagName("head")[0]||
m.documentElement;e.head=d;b=m.createElement("script");e.script=b;b.async="async";if(c.scriptCharset)b.charset=c.scriptCharset;b.src=c.url;b.onerror=b.onload=b.onreadystatechange=function(a){a=a||window.event;e._callback((a.type||"error").toLowerCase())};d.insertBefore(b,d.firstChild)},_callback:function(e,b){var c=this.script,d=this.xhrObj,a=this.head;if(c)if(b||!c.readyState||/loaded|complete/.test(c.readyState)||e=="error"){c.onerror=c.onload=c.onreadystatechange=null;a&&c.parentNode&&a.removeChild(c);
this.head=this.script=undefined;if(!b&&e!="error")d.callback(200,"success");else e=="error"&&d.callback(500,"scripterror")}},abort:function(){this._callback(0,1)}});k.setupTransport("script",l);return k},{requires:["./base","./xhr"]});
KISSY.add("ajax/subdomain",function(i,k,l,m){function e(f){var h=f.config;this.xhrObj=f;f=h.url.match(c);this.__hostname=f[2];this.__protocol=f[1];h.crossDomain=false}function b(){var f=a[this.__hostname];f.ready=1;l.detach(f.iframe,"load",b,this);this.send()}var c=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,d=document,a={};i.augment(e,k.proto,{send:function(){var f=this.xhrObj.config,h=this.__hostname,g=a[h],n="/sub_domain_proxy.html";if(f.xdr&&f.xdr.subDomain&&f.xdr.subDomain.proxy)n=f.xdr.subDomain.proxy;
if(g&&g.ready)(this.xhr=k.xhr(0,g.iframe.contentWindow))&&this.sendInternal();else{if(g)f=g.iframe;else{g=a[h]={};f=g.iframe=document.createElement("iframe");m.css(f,{position:"absolute",left:"-9999px",top:"-9999px"});m.prepend(f,d.body||d.documentElement);f.src=this.__protocol+"//"+h+n}l.on(f,"load",b,this)}}});return e},{requires:["./xhrbase","event","dom"]});
KISSY.add("ajax/xdr",function(i,k,l){function m(h,g,n){if(!f){f=true;h='<object id="'+c+'" type="application/x-shockwave-flash" data="'+h+'" width="0" height="0"><param name="movie" value="'+h+'" /><param name="FlashVars" value="yid='+g+"&uid="+n+'&host=KISSY.io" /><param name="allowScriptAccess" value="always" /></object>';g=a.createElement("div");l.prepend(g,a.body||a.documentElement);g.innerHTML=h}}function e(h){this.xhrObj=h}var b={},c="io_swf",d,a=document,f=false;i.augment(e,{send:function(){var h=
this,g=h.xhrObj.config;m((g.xdr||{}).src||i.Config.base+"ajax/io.swf",1,1);if(d){h._uid=i.guid();b[h._uid]=h;d.send(g.url,{id:h._uid,uid:h._uid,method:g.type,data:g.hasContent&&g.data||{}})}else setTimeout(function(){h.send()},200)},abort:function(){d.abort(this._uid)},_xdrResponse:function(h,g){var n,q=this.xhrObj;q.responseText=decodeURI(g.c.responseText);switch(h){case "success":n={status:200,statusText:"success"};delete b[g.id];break;case "abort":delete b[g.id];break;case "timeout":case "transport error":case "failure":delete b[g.id];
n={status:500,statusText:h}}n&&q.callback(n.status,n.statusText)}});k.applyTo=function(h,g,n){h=g.split(".");var q=i;i.each(h,function(p){q=q[p]});q.apply(null,n)};k.xdrReady=function(){d=a.getElementById(c)};k.xdrResponse=function(h,g,n){var q=b[g.uid];q&&q._xdrResponse(h,g,n)};i.io=k;return e},{requires:["./base","dom"]});
KISSY.add("ajax/xhr",function(i,k,l,m,e){var b=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,c=window.XDomainRequest,d=l.xhr();if(d){var a=function(h){h=h.split(".");return h.length<2?h.join("."):h.reverse().slice(0,2).reverse().join(".")},f=function(h){var g=h.config,n=g.xdr||{};if(g.crossDomain){g=g.url.match(b);if(a(location.hostname)==a(g[2]))return new m(h);if(!("withCredentials"in d)&&(String(n.use)==="flash"||!c))return new e(h)}this.xhrObj=h};i.augment(f,l.proto,{send:function(){this.xhr=
l.xhr(this.xhrObj.config.crossDomain);this.sendInternal()}});k.setupTransport("*",f)}return k},{requires:["./base","./xhrbase","./subdomain","./xdr"]});
KISSY.add("ajax/xhrbase",function(i,k){function l(c,d){try{return new (d||m).XMLHttpRequest}catch(a){}}var m=window,e=m.XDomainRequest,b={proto:{}};b.xhr=m.ActiveXObject?function(c,d){if(c&&e)return new e;var a;if(!(a=!k.isLocal&&l(c,d)))a:{try{a=new (d||m).ActiveXObject("Microsoft.XMLHTTP");break a}catch(f){}a=void 0}return a}:l;i.mix(b.proto,{sendInternal:function(){var c=this,d=c.xhrObj,a=d.config,f=c.xhr,h,g;a.username?f.open(a.type,a.url,a.async,a.username,a.password):f.open(a.type,a.url,a.async);
if(h=a.xhrFields)for(g in h)if(h.hasOwnProperty(g))f[g]=h[g];d.mimeType&&f.overrideMimeType&&f.overrideMimeType(d.mimeType);if(!a.crossDomain&&!d.requestHeaders["X-Requested-With"])d.requestHeaders["X-Requested-With"]="XMLHttpRequest";try{if(!a.crossDomain)for(g in d.requestHeaders)f.setRequestHeader(g,d.requestHeaders[g])}catch(n){}f.send(a.hasContent&&a.data||null);if(!a.async||f.readyState==4)c._callback();else if(e&&f instanceof e){f.onload=function(){f.readyState=4;f.status=200;c._callback()};
f.onerror=function(){f.readyState=4;f.status=500;c._callback()}}else f.onreadystatechange=function(){c._callback()}},abort:function(){this._callback(0,1)},_callback:function(c,d){try{var a=this.xhr,f=this.xhrObj,h=f.config;if(d||a.readyState==4){if(e&&a instanceof e){a.onerror=i.noop;a.onload=i.noop}else a.onreadystatechange=i.noop;if(d)a.readyState!==4&&a.abort();else{var g=a.status;if(!(e&&a instanceof e))f.responseHeadersString=a.getAllResponseHeaders();var n=a.responseXML;if(n&&n.documentElement)f.responseXML=
n;f.responseText=a.responseText;try{var q=a.statusText}catch(p){q=""}if(!g&&k.isLocal&&!h.crossDomain)g=f.responseText?200:404;else if(g===1223)g=204;f.callback(g,q)}}}catch(r){a.onreadystatechange=i.noop;d||f.callback(-1,r)}}});return b},{requires:["./base"]});
KISSY.add("ajax/xhrobject",function(i,k){function l(b){var c=b.responseText,d=b.responseXML,a=b.config,f=a.converters,h=b.converters||{},g,n,q=a.contents,p=a.dataType;if(c||d){for(a=b.mimeType||b.getResponseHeader("Content-Type");p[0]=="*";)p.shift();if(!p.length)for(g in q)if(q[g].test(a)){p[0]!=g&&p.unshift(g);break}p[0]=p[0]||"text";if(p[0]=="text"&&c!==undefined)n=c;else if(p[0]=="xml"&&d!==undefined)n=d;else i.each(["text","xml"],function(t){var s=p[0];if(h[t]&&h[t][s]||f[t]&&f[t][s]){p.unshift(t);
n=t=="text"?c:d;return false}})}q=p[0];for(a=1;a<p.length;a++){g=p[a];var r=h[q]&&h[q][g]||f[q]&&f[q][g];if(!r)throw"no covert for "+q+" => "+g;n=r(n);q=g}b.responseData=n}function m(b){i.mix(this,{responseData:null,config:b||{},timeoutTimer:null,responseText:null,responseXML:null,responseHeadersString:"",responseHeaders:null,requestHeaders:{},readyState:0,state:0,statusText:null,status:0,transport:null})}var e=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg;i.augment(m,k.Target,{setRequestHeader:function(b,c){this.requestHeaders[b]=
c;return this},getAllResponseHeaders:function(){return this.state===2?this.responseHeadersString:null},getResponseHeader:function(b){var c;if(this.state===2){if(!this.responseHeaders)for(this.responseHeaders={};c=e.exec(this.responseHeadersString);)this.responseHeaders[c[1]]=c[2];c=this.responseHeaders[b]}return c===undefined?null:c},overrideMimeType:function(b){if(!this.state)this.mimeType=b;return this},abort:function(b){b=b||"abort";this.transport&&this.transport.abort(b);this.callback(0,b);return this},
callback:function(b,c){if(this.state!=2){this.state=2;this.readyState=4;var d;if(b>=200&&b<300||b==304)if(b==304){c="notmodified";d=true}else try{l(this);c="success";d=true}catch(a){c="parsererror : "+a}else if(b<0)b=0;this.status=b;this.statusText=c;d?this.fire("success"):this.fire("error");this.fire("complete");this.transport=undefined}}});return m},{requires:["event"]});
