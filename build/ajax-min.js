/*
Copyright 2012, KISSY UI Library v1.40dev
MIT Licensed
build time: Dec 5 02:22
*/
KISSY.add("ajax",function(b,g,j){function k(e,h,c,f,m){b.isFunction(h)&&(f=c,c=h,h=i);return j({type:m||"get",url:e,data:h,success:c,dataType:f})}var i=void 0;b.mix(j,{serialize:g.serialize,get:k,post:function(e,h,c,f){b.isFunction(h)&&(f=c,c=h,h=i);return k(e,h,c,f,"post")},jsonp:function(e,h,c){b.isFunction(h)&&(c=h,h=i);return k(e,h,c,"jsonp")},getScript:b.getScript,getJSON:function(e,h,c){b.isFunction(h)&&(c=h,h=i);return k(e,h,c,"json")},upload:function(e,h,c,f,m){b.isFunction(c)&&(m=f,f=c,c=
i);return j({url:e,type:"post",dataType:m,form:h,data:c,success:f})}});b.mix(b,{Ajax:j,IO:j,ajax:j,io:j,jsonp:j.jsonp});return j},{requires:"ajax/form-serializer,ajax/base,ajax/xhr-transport,ajax/script-transport,ajax/jsonp,ajax/form,ajax/iframe-transport,ajax/methods".split(",")});
KISSY.add("ajax/base",function(b,g,j,k){function i(a){var e=a.context,m=a.ifModified;delete a.context;a=b.mix(b.clone(r),a,{deep:!0});a.context=e||a;var c,h=a.type,p=a.dataType,i;i=a.query=new b.Uri.Query;e=a.uri=n.resolve(a.url);"crossDomain"in a||(a.crossDomain=!a.uri.hasSameDomainAs(n));if(a.processData&&(c=a.data))b.isObject(c)?i.add(c):i.reset(c);h=a.type=h.toUpperCase();a.hasContent=!d.test(h);p=a.dataType=b.trim(p||"*").split(f);!("cache"in a)&&b.inArray(p[0],["script","jsonp"])&&(a.cache=
!1);var g;a.hasContent||(i.count()&&e.query.add(i),m&&(g=e.clone()),!1===a.cache&&e.query.set("_ksTS",b.now()+"_"+b.guid()));m&&(a.ifModifiedKeyUri=g||e.clone());return a}function e(a,d){h.fire(a,{ajaxConfig:d.config,io:d})}function h(d){function f(a){return function(f){if(g=c.timeoutTimer)clearTimeout(g),c.timeoutTimer=0;var m=d[a];m&&m.apply(j,f);e(a,c)}}var c=this;if(!d.url)return k;if(!(c instanceof h))return new h(d);a.call(c);d=i(d);b.mix(c,{responseData:null,config:d||{},timeoutTimer:null,
responseText:null,responseXML:null,responseHeadersString:"",responseHeaders:null,requestHeaders:{},readyState:0,state:0,statusText:null,status:0,transport:null,_defer:new b.Defer(this)});var m;e("start",c);m=new (q[d.dataType[0]]||q["*"])(c);c.transport=m;d.contentType&&c.setRequestHeader("Content-Type",d.contentType);var p=d.dataType[0],g,v,l=d.timeout,j=d.context,o=d.headers,n=d.accepts;c.setRequestHeader("Accept",p&&n[p]?n[p]+("*"===p?"":", */*; q=0.01"):n["*"]);for(v in o)c.setRequestHeader(v,
o[v]);if(d.beforeSend&&!1===d.beforeSend.call(j,c,d))return k;c.then(f("success"),f("error"));c.fin(f("complete"));c.readyState=1;e("send",c);d.async&&0<l&&(c.timeoutTimer=setTimeout(function(){c.abort("timeout")},1E3*l));try{c.state=1,m.send()}catch(s){2>c.state&&c._ioReady(-1,s)}return k}var c=/^(?:about|app|app\-storage|.+\-extension|file|widget)$/,f=/\s+/,m=function(a){return a},a=b.Promise,d=/^(?:GET|HEAD)$/,p,v=b.Uri,l=b.Env.host,o=l.document,l=l.location,n;if(l){try{p=l.href}catch(s){p=o.createElement("a"),
p.href="",p=p.href}n=new v(p)}var c=n&&c.test(n.getScheme()),q={},r={type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",async:!0,serializeArray:!0,processData:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":"*/*"},converters:{text:{json:g.parse,html:m,text:m,xml:b.parseXML}},contents:{xml:/xml/,html:/html/,json:/json/}};r.converters.html=r.converters.text;b.mix(h,j.Target);b.mix(h,{isLocal:c,setupConfig:function(a){b.mix(r,
a,{deep:!0})},setupTransport:function(a,d){q[a]=d},getTransport:function(a){return q[a]},getConfig:function(){return r}});return h},{requires:["json","event"]});
KISSY.add("ajax/form-serializer",function(b,g){function j(c){return c.replace(i,"\r\n")}var k=/^(?:select|textarea)/i,i=/\r?\n/g,e,h=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i;return e={serialize:function(c,f){return b.param(e.getFormData(c),void 0,void 0,f||!1)},getFormData:function(c){var f=[],e={};b.each(g.query(c),function(a){a=a.elements?b.makeArray(a.elements):[a];f.push.apply(f,a)});f=b.filter(f,function(a){return a.name&&!a.disabled&&
(a.checked||k.test(a.nodeName)||h.test(a.type))});b.each(f,function(a){var d=g.val(a),f,d=b.isArray(d)?b.map(d,j):j(d);(f=e[a.name])?(f&&!b.isArray(f)&&(f=e[a.name]=[f]),f.push.apply(f,b.makeArray(d))):e[a.name]=d});return e}}},{requires:["dom"]});
KISSY.add("ajax/form",function(b,g,j,k){g.on("start",function(b){var e,h,b=b.io.config;if(e=b.form)e=j.get(e),h=e.encoding||e.enctype,"multipart/form-data"!=h.toLowerCase()?(e=k.getFormData(e),b.hasContent?b.query.add(e):(b.uri.query.add(e),b.ifModifiedKeyUri&&b.ifModifiedKeyUri.query.add(e))):(e=b.dataType,b=e[0],"*"==b&&(b="text"),e.length=2,e[0]="iframe",e[1]=b)});return g},{requires:["./base","dom","./form-serializer"]});
KISSY.add("ajax/iframe-transport",function(b,g,j,k){function i(f){var e=b.guid("ajax-iframe"),a=g.getEmptyIframeSrc(),f=f.iframe=g.create("<iframe "+(a?' src="'+a+'" ':"")+' id="'+e+'" name="'+e+'" style="position:absolute;left:-9999px;top:-9999px;"/>');g.prepend(f,c.body||c.documentElement);return f}function e(f,e,a){var d=[],h,i,l,j,k=f.keys();b.each(k,function(k){var n=f.get(k);h=b.isArray(n);i=b.makeArray(n);for(l=0;l<i.length;l++)j=c.createElement("input"),j.type="hidden",j.name=k+(h&&a?"[]":
""),j.value=i[l],g.append(j,e),d.push(j)});return d}function h(f){this.io=f}var c=b.Env.host.document;k.setupConfig({converters:{iframe:k.getConfig().converters.text,text:{iframe:function(f){return f}},xml:{iframe:function(f){return f}}}});b.augment(h,{send:function(){function f(){j.on(k,"load error",c._callback,c);o.submit()}var c=this,a=c.io,d=a.config,h,k,l=d.query,o=g.get(d.form);c.attrs={target:g.attr(o,"target")||"",action:g.attr(o,"action")||"",method:g.attr(o,"method")};c.form=o;k=i(a);g.attr(o,
{target:k.id,action:d.uri.toString(d.serializeArray),method:"post"});l.count()&&(h=e(l,o,d.serializeArray));c.fields=h;6==b.UA.ie?setTimeout(f,0):f()},_callback:function(f){var c=this,a=c.form,d=c.io,f=f.type,e,h=d.iframe;if(h)if("abort"==f&&6==b.UA.ie?setTimeout(function(){g.attr(a,c.attrs)},0):g.attr(a,c.attrs),g.remove(this.fields),j.detach(h),setTimeout(function(){g.remove(h)},30),d.iframe=null,"load"==f)try{if((e=h.contentWindow.document)&&e.body)d.responseText=b.trim(g.text(e.body)),b.startsWith(d.responseText,
"<?xml")&&(d.responseText=void 0);d.responseXML=e&&e.XMLDocument?e.XMLDocument:e;e?d._ioReady(200,"success"):d._ioReady(500,"parser error")}catch(i){d._ioReady(500,"parser error")}else"error"==f&&d._ioReady(500,"error")},abort:function(){this._callback({type:"abort"})}});k.setupTransport("iframe",h);return k},{requires:["dom","event","./base"]});
KISSY.add("ajax/jsonp",function(b,g){var j=b.Env.host;g.setupConfig({jsonp:"callback",jsonpCallback:function(){return b.guid("jsonp")}});g.on("start",function(g){var i=g.io,e=i.config,g=e.dataType;if("jsonp"==g[0]){var h,c=e.jsonpCallback,f=b.isFunction(c)?c():c,m=j[f];e.uri.query.set(e.jsonp,f);j[f]=function(a){1<arguments.length&&(a=b.makeArray(arguments));h=[a]};i.fin(function(){j[f]=m;if(void 0===m)try{delete j[f]}catch(a){}else h&&m(h[0])});i=i.converters=i.converters||{};i.script=i.script||
{};i.script.json=function(){return h[0]};g.length=2;g[0]="script";g[1]="json"}});return g},{requires:["./base"]});
KISSY.add("ajax/methods",function(b,g,j){function k(e){var h=e.responseText,c=e.responseXML,f=e.config,m=f.converters,a=e.converters||{},d,g,i=f.contents,l=f.dataType;if(h||c){for(f=e.mimeType||e.getResponseHeader("Content-Type");"*"==l[0];)l.shift();if(!l.length)for(d in i)if(i[d].test(f)){l[0]!=d&&l.unshift(d);break}l[0]=l[0]||"text";if("text"==l[0]&&h!==j)g=h;else if("xml"==l[0]&&c!==j)g=c;else{var k={text:h,xml:c};b.each(["text","xml"],function(d){var f=l[0];if((a[d]&&a[d][f]||m[d]&&m[d][f])&&
k[d])return l.unshift(d),g="text"==d?h:c,!1})}}i=l[0];for(f=1;f<l.length;f++){d=l[f];var n=a[i]&&a[i][d]||m[i]&&m[i][d];if(!n)throw"no covert for "+i+" => "+d;g=n(g);i=d}e.responseData=g}var i=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg;b.extend(g,b.Promise,{setRequestHeader:function(e,b){this.requestHeaders[e]=b;return this},getAllResponseHeaders:function(){return 2===this.state?this.responseHeadersString:null},getResponseHeader:function(e){var b,c;if(2===this.state){if(!(c=this.responseHeaders))for(c=this.responseHeaders=
{};b=i.exec(this.responseHeadersString);)c[b[1]]=b[2];b=c[e]}return b===j?null:b},overrideMimeType:function(e){this.state||(this.mimeType=e);return this},abort:function(e){e=e||"abort";this.transport&&this.transport.abort(e);this._ioReady(0,e);return this},getNativeXhr:function(){var e;if(e=this.transport)return e.nativeXhr},_ioReady:function(e,b){if(2!=this.state){this.state=2;this.readyState=4;var c;if(200<=e&&300>e||304==e)if(304==e)b="not modified",c=!0;else try{k(this),b="success",c=!0}catch(f){b=
"parser error"}else 0>e&&(e=0);this.status=e;this.statusText=b;this._defer[c?"resolve":"reject"]([this.responseData,b,this])}}})},{requires:["./base"]});
KISSY.add("ajax/script-transport",function(b,g,j,k){function i(c){if(!c.config.crossDomain)return new (g.getTransport("*"))(c);this.io=c;return 0}var e=b.Env.host,h=e.document;g.setupConfig({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{text:{script:function(c){b.globalEval(c);return c}}}});b.augment(i,{send:function(){var c=this,f,b=c.io.config,a=h.head||h.getElementsByTagName("head")[0]||
h.documentElement;c.head=a;f=h.createElement("script");c.script=f;f.async=!0;b.scriptCharset&&(f.charset=b.scriptCharset);f.src=b.uri.toString(b.serializeArray);f.onerror=f.onload=f.onreadystatechange=function(a){a=a||e.event;c._callback((a.type||"error").toLowerCase())};a.insertBefore(f,a.firstChild)},_callback:function(c,f){var b=this.script,a=this.io,d=this.head;if(b&&(f||!b.readyState||/loaded|complete/.test(b.readyState)||"error"==c))b.onerror=b.onload=b.onreadystatechange=null,d&&b.parentNode&&
d.removeChild(b),this.head=this.script=k,!f&&"error"!=c?a._ioReady(200,"success"):"error"==c&&a._ioReady(500,"script error")},abort:function(){this._callback(0,1)}});g.setupTransport("script",i);return g},{requires:["./base","./xhr-transport"]});
KISSY.add("ajax/sub-domain-transport",function(b,g,j,k){function i(f){var b=f.config;this.io=f;b.crossDomain=!1}function e(){var f=this.io.config.uri.getHostname(),f=c[f];f.ready=1;j.detach(f.iframe,"load",e,this);this.send()}var h=b.Env.host.document,c={};b.augment(i,g.proto,{send:function(){var f=this.io.config,i=f.uri,a=i.getHostname(),d;d=c[a];var p="/sub_domain_proxy.html";f.xdr&&f.xdr.subDomain&&f.xdr.subDomain.proxy&&(p=f.xdr.subDomain.proxy);d&&d.ready?(this.nativeXhr=g.nativeXhr(0,d.iframe.contentWindow))&&
this.sendInternal():(d?f=d.iframe:(d=c[a]={},f=d.iframe=h.createElement("iframe"),k.css(f,{position:"absolute",left:"-9999px",top:"-9999px"}),k.prepend(f,h.body||h.documentElement),d=new b.Uri,d.setScheme(i.getScheme()),d.setPort(i.getPort()),d.setHostname(a),d.setPath(p),f.src=d.toString()),j.on(f,"load",e,this))}});return i},{requires:["./xhr-transport-base","event","dom"]});
KISSY.add("ajax/xdr-flash-transport",function(b,g,j){function k(a,d,b){m||(m=!0,a='<object id="'+h+'" type="application/x-shockwave-flash" data="'+a+'" width="0" height="0"><param name="movie" value="'+a+'" /><param name="FlashVars" value="yid='+d+"&uid="+b+'&host=KISSY.require(\'ajax\')" /><param name="allowScriptAccess" value="always" /></object>',d=f.createElement("div"),j.prepend(d,f.body||f.documentElement),d.innerHTML=a)}function i(a){this.io=a}var e={},h="io_swf",c,f=b.Env.host.document,m=
!1;b.augment(i,{send:function(){var a=this,d=a.io.config;k((d.xdr||{}).src||b.Config.base+"ajax/io.swf",1,1);c?(a._uid=b.guid(),e[a._uid]=a,c.send(d.uri.toString(d.serializeArray),{id:a._uid,uid:a._uid,method:d.type,data:d.hasContent&&d.query.toString(d.serializeArray)||{}})):setTimeout(function(){a.send()},200)},abort:function(){c.abort(this._uid)},_xdrResponse:function(a,d){var b,f=d.id,c,h=d.c,g=this.io;if(h&&(c=h.responseText))g.responseText=decodeURI(c);switch(a){case "success":b={status:200,
statusText:"success"};delete e[f];break;case "abort":delete e[f];break;case "timeout":case "transport error":case "failure":delete e[f],b={status:"status"in h?h.status:500,statusText:h.statusText||a}}b&&g._ioReady(b.status,b.statusText)}});g.applyTo=function(a,d,f){var a=d.split(".").slice(1),c=g;b.each(a,function(a){c=c[a]});c.apply(null,f)};g.xdrReady=function(){c=f.getElementById(h)};g.xdrResponse=function(a,d){var b=e[d.uid];b&&b._xdrResponse(a,d)};return i},{requires:["./base","dom"]});
KISSY.add("ajax/xhr-transport-base",function(b,g){function j(b,c){try{return new (c||k).XMLHttpRequest}catch(a){}}var k=b.Env.host,i=7<b.UA.ie&&k.XDomainRequest,e={proto:{}},h={},c={};g.__lastModifiedCached=h;g.__eTagCached=c;e.nativeXhr=k.ActiveXObject?function(b,c){var a;if(b&&i)a=new i;else if(!(a=!g.isLocal&&j(b,c)))a:{try{a=new (c||k).ActiveXObject("Microsoft.XMLHTTP");break a}catch(d){}a=void 0}return a}:j;e._XDomainRequest=i;b.mix(e.proto,{sendInternal:function(){var b=this,e=b.io,a=e.config,
d=b.nativeXhr,g=a.type,j=a.async,k,o=a.crossDomain,n=e.mimeType,e=e.requestHeaders||{},s=a.serializeArray,q=a.uri.toString(s),r,t,u;if(r=a.ifModifiedKeyUri&&a.ifModifiedKeyUri.toString()){if(t=h[r])e["If-Modified-Since"]=t;if(t=c[r])e["If-None-Match"]=t}(k=a.username)?d.open(g,q,j,k,a.password):d.open(g,q,j);if(g=a.xhrFields)for(u in g)d[u]=g[u];n&&d.overrideMimeType&&d.overrideMimeType(n);!o&&!e["X-Requested-With"]&&(e["X-Requested-With"]="XMLHttpRequest");try{if(!o)for(u in e)d.setRequestHeader(u,
e[u])}catch(w){}d.send(a.hasContent&&a.query.toString(s)||null);!j||4==d.readyState?b._callback():i&&d instanceof i?(d.onload=function(){d.readyState=4;d.status=200;b._callback()},d.onerror=function(){d.readyState=4;d.status=500;b._callback()}):d.onreadystatechange=function(){b._callback()}},abort:function(){this._callback(0,1)},_callback:function(e,g){var a=this.nativeXhr,d=this.io,j,k,l,o,n,s=d.config;try{if(g||4==a.readyState)if(i&&a instanceof i?(a.onerror=b.noop,a.onload=b.noop):a.onreadystatechange=
b.noop,g)4!==a.readyState&&a.abort();else{j=s.ifModifiedKeyUri&&s.ifModifiedKeyUri.toString();var q=a.status;i&&a instanceof i||(d.responseHeadersString=a.getAllResponseHeaders());j&&(k=a.getResponseHeader("Last-Modified"),l=a.getResponseHeader("ETag"),k&&(h[j]=k),l&&(c[l]=l));if((n=a.responseXML)&&n.documentElement)d.responseXML=n;d.responseText=a.responseText;try{o=a.statusText}catch(r){o=""}!q&&d.isLocal&&!s.crossDomain?q=d.responseText?200:404:1223===q&&(q=204);d._ioReady(q,o)}}catch(t){a.onreadystatechange=
b.noop,g||d._ioReady(-1,t)}}});return e},{requires:["./base"]});
KISSY.add("ajax/xhr-transport",function(b,g,j,k,i,e){var h=j._XDomainRequest,c=j.nativeXhr();if(c){var f=function(a){var a=a.split("."),b=a.length,c=3<b?3:2;return b<c?a.join("."):a.reverse().slice(0,c).reverse().join(".")},m=function(a){var b=a.config,g=b.crossDomain,m=b.xdr||{},l=m.subDomain=m.subDomain||{};this.io=a;if(g){if(f(location.hostname)==f(b.uri.getHostname())&&!1!==l.proxy)return new k(a);if(!("withCredentials"in c)&&("flash"===""+m.use||!h))return new i(a)}this.nativeXhr=j.nativeXhr(g);
return e};b.augment(m,j.proto,{send:function(){this.sendInternal()}});g.setupTransport("*",m)}return g},{requires:["./base","./xhr-transport-base","./sub-domain-transport","./xdr-flash-transport"]});
