/*
Copyright 2010, KISSY UI Library v1.1.6
MIT Licensed
build time: Nov 24 11:33
*/
KISSY.add("ajax",function(e,H){function f(a){a=e.merge(I,a);if(a.data&&!e.isString(a.data))a.data=e.param(a.data);var c,d=l,g,i=a.type.toUpperCase();if(a.dataType===x){if(i===v){if(!m.test(a.url))a.url=a.url+(a.url.indexOf("?")===-1?"?":"&")+(a.jsonp+"=?")}else if(!a.data||!m.test(a.data))a.data=(a.data?a.data+"&":r)+a.jsonp+"=?";a.dataType=s}if(a.dataType===s&&(a.data&&m.test(a.data)||m.test(a.url))){c=a.jsonpCallback||x+e.now();if(a.data)a.data=(a.data+r).replace(m,"="+c+"$1");a.url=a.url.replace(m,
"="+c+"$1");a.dataType=y;var n=t[c];t[c]=function(j){if(e.isFunction(n))n(j);else{t[c]=H;try{delete t[c]}catch(h){}}k([l,u],j,d,b,a)}}if(a.data&&i===v)a.url=a.url+(a.url.indexOf("?")===-1?"?":"&")+a.data;if(a.dataType===y){f.fire(C);e.getScript(a.url,c?function(){k([l,u],r,d,b,a)}:null);f.fire(D)}else{var o=false,b=a.xhr();f.fire(C,{xhr:b});b.open(i,a.url,a.async);try{if(a.data||a.contentType)b.setRequestHeader("Content-Type",a.contentType);b.setRequestHeader("Accept",a.dataType&&a.accepts[a.dataType]?
a.accepts[a.dataType]+", */*":a.accepts._default)}catch(K){}b.onreadystatechange=function(j){if(!b||b.readyState===0||j==="abort"){o||k(u,null,z,b,a);o=true;if(b)b.onreadystatechange=E}else if(!o&&b&&(b.readyState===4||j===w)){o=true;b.onreadystatechange=E;var h;if(j===w)h=w;else{a:{try{h=b.status>=200&&b.status<300||b.status===304||b.status===0||b.status===1223;break a}catch(L){}h=false}h=!h?z:l}d=h;try{h=b;var p=a.dataType,A=h.getResponseHeader("content-type")||r,F=p==="xml"||!p&&A.indexOf("xml")>=
0,q=F?h.responseXML:h.responseText;F&&q.documentElement.nodeName===B&&e.error(B);if(e.isString(q))if(p===s||!p&&A.indexOf(x)>=0)q=e.JSON.parse(q);else if(p===y||!p&&A.indexOf("javascript")>=0)e.globalEval(q);g=q}catch(M){d=B}if(d===l)c||k(l,g,d,b,a);else k(z,g,d,b,a);k(u,g,d,b,a);if(j===w){b.abort();f.fire(J,{xhr:b})}if(a.async)b=null}};f.fire(D,{xhr:b});b.send(i===G?a.data:null);a.async||f.fire(u,{xhr:b});return b}}function k(a,c,d,g,i){if(e.isArray(a))e.each(a,function(n){k(n,c,d,g,i)});else{d===
a&&i[a](c,d,g);f.fire(a,{xhr:g})}}var t=window,E=function(){},v="GET",G="POST",s="json",x=s+"p",y="script",r="",l="success",u="complete",z="error",w="timeout",B="parsererror",C="start",D="send",J="stop",m=/=\?(&|$)/,I={type:v,url:r,contentType:"application/x-www-form-urlencoded",async:true,data:null,xhr:t.XMLHttpRequest?function(){return new window.XMLHttpRequest}:function(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(a){}},accepts:{xml:"application/xml, text/xml",html:"text/html",
script:"text/javascript, application/javascript",json:"application/json, text/javascript",text:"text/plain",_default:"*/*"},complete:function(){},success:function(){},error:function(){},jsonp:"callback"};e.mix(f,e.EventTarget);e.mix(f,{get:function(a,c,d,g,i){if(e.isFunction(c)){g=d;d=c}f({type:i||v,url:a,data:c,success:function(n,o,b){e.isFunction(d)&&d(n,o,b)},dataType:g});return this},post:function(a,c,d,g){if(e.isFunction(c)){g=d;d=c;c=null}return f.get(a,c,d,g,G)},getJSON:function(a,c,d){if(e.isFunction(c))d=
c;return f.get(a,c,d,s)}});f.getScript=e.getScript;e.ajax=e.io=f;e.getJSON=f.getJSON});
