/*
Copyright 2011, KISSY UI Library v1.20dev
MIT Licensed
build time: Dec 2 17:26
*/
KISSY.add("htmlparser/Parser",function(i,p,o,m,g,f,q){function j(b,e){b=i.trim(b);b=/^(<!doctype|<html|<body)/i.test(b)?"<document>"+b+"</document>":"<body>"+b+"</body>";this.lexer=new g(b);this.opts=e||{}}function h(b){var e=l(b,"body",3);if(e){b=e.parentNode;var c=b.childNodes,a=i.indexOf(e,c);if(a!=c.length-1){c=c.slice(a+1,c.length);for(a=0;a<c.length;a++){b.removeChild(c[a]);c[a].tagName=="body"?i.each(c[a].childNodes,function(d){e.appendChild(d)}):e.appendChild(c[a])}}}return e}function l(b,
e,c){if(c===0)return 0;i.isNumber(c)&&c--;for(var a=b.childNodes,d=0;d<a.length;d++){if(a[d].tagName===e)return a[d];if(b=l(a[d],e,c))return b}return 0}j.prototype={elements:function(){var b,e,c=this.lexer,a=this.opts;e=b=c.nextNode();if(b.tagName!="document"){e=new f;e.appendChild(b)}e.nodeType=9;q.getScanner("div").scan(b,c,a);if((b=h(e))&&a.autoParagraph){a=b.childNodes;var d,n=p.p,k=0;for(d=0;d<a.length;d++){c=a[d];if(c.nodeType==3||c.nodeType==1&&n[c.nodeName]){k=1;break}}if(k){k=[];var r=new o;
r.nodeName=r.tagName="p";for(d=0;d<a.length;d++){c=a[d];if(c.nodeType==3||c.nodeType==1&&n[c.nodeName])r.appendChild(c);else{if(r.childNodes.length){k.push(r);r=r.clone()}k.push(c)}}r.childNodes.length&&k.push(r);b.empty();for(d=0;d<k.length;d++)b.appendChild(k[d])}}b=e;a=[].concat(b.childNodes);for(c=0;c<a.length;c++)if(a[c].nodeName=="html"){d=a[c];for(n=0;n<c;n++)a[n].nodeType==3&&!i.trim(a[n].toHtml())&&b.removeChild(a[n]);for(;d.firstChild&&d.firstChild.nodeType==3&&!i.trim(d.firstChild.toHtml());)d.removeChild(d.firstChild);
break}return e.childNodes},parse:function(){return this.elements()}};return j},{requires:["./dtd","./nodes/Tag","./lexer/Cursor","./lexer/Lexer","./nodes/Document","./Scanner"]});KISSY.add("htmlparser/Scanner",function(i,p,o){return{getScanner:function(m){return o[m]||p}}},{requires:["./scanners/TagScanner","./scanners/SpecialScanners","./scanners/QuoteCdataScanner","./scanners/TextareaScanner"]});
KISSY.add("htmlparser/Utils",function(){return{collapseWhitespace:function(i){return i.replace(/[\s\xa0]+/g," ")},isLetter:function(i){return"a"<=i&&"z">=i||"A"<=i&&"Z">=i},isValidAttributeNameStartChar:function(i){return!this.isWhitespace(i)&&i!='"'&&i!="'"&&i!=">"&&i!="<"&&i!="/"&&i!="="},isWhitespace:function(i){return/^[\s\xa0]$/.test(i)}}});
KISSY.add("htmlparser/dtd",function(i){i=i.merge;var p={isindex:1,fieldset:1},o={input:1,button:1,select:1,textarea:1,label:1},m=i({a:1},o),g=i({iframe:1},m),f={hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1},q={ins:1,del:1,script:1,style:1},j=i({b:1,acronym:1,bdo:1,"var":1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1},q),h=i({sub:1,img:1,object:1,sup:1,
basefont:1,map:1,applet:1,font:1,big:1,small:1},j),l=i({p:1},h);o=i({iframe:1},h,o);h={img:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,
address:1,q:1,pre:1,p:1,em:1,dfn:1};var b=i({a:1},o),e={tr:1},c={"#":1},a=i({param:1},h),d=i({form:1},p,g,f,l),n={li:1},k={base:1,link:1,meta:1,title:1},r=i(k,{style:1,script:1}),s={head:1,body:1},t={address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1},u={$nonBodyContent:i({html:1},s,k),$block:t,$blockLimit:{body:1,div:1,td:1,th:1,caption:1,form:1},$inline:b,$body:i({script:1,style:1},t),$cdata:{script:1,
style:1},$empty:{area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1},$listItem:{dd:1,dt:1,li:1},$list:{ul:1,ol:1,dl:1},$nonEditable:{applet:1,button:1,embed:1,iframe:1,map:1,object:1,option:1,script:1,textarea:1,param:1},$removeEmpty:{abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},$tabIndex:{a:1,area:1,button:1,input:1,object:1,select:1,textarea:1},
$tableContent:{caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1},html:s,head:r,style:c,body:d,base:{},link:{},meta:{},title:c,col:{},tr:{td:1,th:1},img:{},colgroup:{col:1},noscript:d,td:d,br:{},th:d,center:d,kbd:b,button:i(l,f),basefont:{},h5:b,h4:b,samp:b,h6:b,ol:n,h1:b,h3:b,option:c,h2:b,form:i(p,g,f,l),select:{optgroup:1,option:1},font:b,ins:b,menu:n,abbr:b,label:b,table:{thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1},code:b,script:c,tfoot:e,cite:b,li:d,input:{},iframe:d,
strong:b,textarea:c,noframes:d,big:b,small:b,span:b,hr:{},dt:b,sub:b,optgroup:{option:1},param:{},bdo:b,"var":b,div:d,object:a,sup:b,dd:d,strike:b,area:{},dir:n,map:i({area:1,form:1,p:1},p,q,f),applet:a,dl:{dt:1,dd:1},del:b,isindex:{},fieldset:i({legend:1},h),thead:e,ul:n,acronym:b,b:b,a:o,blockquote:d,caption:b,i:b,u:b,tbody:e,s:b,address:i(g,l),tt:b,legend:b,q:b,pre:i(j,m),p:b,em:b,dfn:b};(function(){var v,w=["article","figure","nav","aside","section","footer"],x;for(x in u)for(var y in u[x])if(y==
"div")for(v=0;v<w.length;v++)u[x][w[v]]=u[x][y];for(v=0;v<w.length;v++)u[w[v]]=u.div;u.$empty["!doctype"]=1})();return u});KISSY.add("htmlparser/lexer/Cursor",function(){function i(p){this.position=p||0}i.prototype={advance:function(){this.position++},retreat:function(){this.position=Math.max(--this.position,0)}};return i});
KISSY.add("htmlparser/lexer/Index",function(){function i(){this.lineCursors=[]}function p(m,g){for(var f=0;f<m.length;f++)if(m[f].position===g.position)return f;return-1}function o(m,g){for(var f=0;f<m.length;f++)if(m[f].position>g.position)break;return f}i.prototype={add:function(m){p(this.lineCursors,m)==-1&&this.lineCursors.splice(o(this.lineCursors,m),0,m)},remove:function(m){var g=this.lineCursors;m=p(this.lineCursors,m);m!=-1&&g.splice(m,1)},row:function(m){return o(this.lineCursors,m)-1},col:function(m){var g=
o(this.lineCursors,m)-1;return m.position-this.lineCursors[g]}};return i});
KISSY.add("htmlparser/lexer/Lexer",function(i,p,o,m,g,f,q,j,h){function l(b){this.page=new o(b);this.cursor=new p;this.nodeFactory=this}l.prototype={setPosition:function(b){this.cursor.position=b},getPosition:function(){return this.cursor.position},nextNode:function(b){var e,c,a=this.cursor,d=this.page;e=a.position;c=d.getChar(a);switch(c){case -1:b=null;break;case "<":c=d.getChar(a);if(c==-1)b=this.makeString(e,a.position);else if(c=="/"||f.isLetter(c)){d.ungetChar(a);b=this.parseTag(e)}else if("!"==
c){c=d.getChar(a);if(c==-1)b=this.makeString(e,a.position);else if(">"==c)b=this.makeComment(e,a.position);else{d.ungetChar(a);if("-"==c)b=this.parseComment(e,b);else{d.ungetChar(a);b=this.parseTag(e)}}}else{d.ungetChar(a);b=this.parseString(e,b)}break;default:d.ungetChar(a);b=this.parseString(e,b)}return b},makeComment:function(b,e){var c;c=e-b;if(0!=c){if(2>c)return this.makeString(b,e);c=this.nodeFactory.createCommentNode(this.page,b,e)}else c=null;return c},makeString:function(b,e){var c=null;
if(e-b>0)c=this.nodeFactory.createStringNode(this.page,b,e);return c},makeCData:function(b,e){var c=null;if(e-b>0)c=this.nodeFactory.createCDataNode(this.page,b,e);return c},makeTag:function(b,e,c){var a;a=e-b;if(0!=a){if(2>a)return this.makeString(b,e);b=this.nodeFactory.createTagNode(this.page,b,e,c)}else b=null;return b},createTagNode:function(b,e,c,a){return new j(b,e,c,a)},createStringNode:function(b,e,c){return new m(b,e,c)},createCDataNode:function(b,e,c){return new g(b,e,c)},createCommentNode:function(b,
e,c){return new h(b,e,c)},parseTag:function(b){var e,c=[],a=[],d,n=this.page,k=0,r=this.cursor;for(c[0]=r.position;!e;){c[k+1]=r.position;d=n.getChar(r);switch(k){case 0:if(d==-1||">"==d||"<"==d){if("<"==d){n.ungetChar(r);c[k+1]=r.position}e=true}else if(a.length){if(f.isValidAttributeNameStartChar(d))k=1}else if(d=="/"||f.isValidAttributeNameStartChar(d))k=1;break;case 1:if(-1==d||">"==d||"<"==d){if("<"==d){n.ungetChar(r);c[k+1]=r.getPosition}this.standalone(a,c);e=true}else if(f.isWhitespace(d)){c[6]=
c[2];k=6}else if("="==d)k=2;break;case 2:if(-1==d||">"==d){this.standalone(a,c);e=true}else if("'"==d){k=4;c[4]=c[3]}else if('"'==d){k=5;c[5]=c[3]}else f.isWhitespace(d)||(k=3);break;case 3:if(-1==d||">"==d){this.naked(a,c);e=true}else if(f.isWhitespace(d)){this.naked(a,c);c[0]=c[4];k=0}break;case 4:if(-1==d){this.single_quote(a,c);e=true}else if("'"==d){this.single_quote(a,c);c[0]=c[5]+1;k=0}break;case 5:if(-1==d){this.double_quote(a,c);e=true}else if('"'==d){this.double_quote(a,c);c[0]=c[6]+1;k=
0}break;case 6:if(-1==d){this.standalone(a,c);c[0]=c[6];n.ungetChar(r);k=0}else if(!f.isWhitespace(d))if("="==d){c[2]=c[6];c[3]=c[7];k=2}else{this.standalone(a,c);c[0]=c[6];n.ungetChar(r);k=0}break;default:throw Error("how ** did we get in state "+k);}}return this.makeTag(b,r.position,a)},parseComment:function(b,e){var c,a,d=this.page,n=this.cursor,k;c=false;for(k=0;!c;){a=d.getChar(n);if(-1==a)c=true;else switch(k){case 0:if(">"==a)c=true;if("-"==a)k=1;else return this.parseString(b,e);break;case 1:if("-"==
a){a=d.getChar(n);if(-1==a)c=true;else if(">"==a)c=true;else{d.ungetChar(n);k=2}}else return this.parseString(b,e);break;case 2:if("-"==a)k=3;else if(-1==a)return this.parseString(b,e);break;case 3:k="-"==a?4:2;break;case 4:if(">"==a)c=true;else f.isWhitespace(a)||(k=2);break;default:throw Error("how ** did we get in state "+k);}}return this.makeComment(b,n.position)},parseString:function(b,e){for(var c=0,a,d=this.page,n=this.cursor,k=0;!c;){a=d.getChar(n);if(-1==a)c=1;else if(e&&0==k&&("'"==a||'"'==
a))k=a;else if(e&&0!=k&&"\\"==a){a=d.getChar(n);-1!=a&&"\\"!=a&&a!=k&&d.ungetChar(n)}else if(e&&a==k)k=0;else if(e&&0==k&&a=="/"){a=d.getChar(n);if(-1==a)c=1;else if("/"==a){do a=d.getChar(n);while(-1!=a&&"\n"!=a)}else if("*"==a){do{do a=d.getChar(n);while(-1!=a&&"*"!=a);a=d.getChar(n);a=="*"&&d.ungetChar(n)}while(-1!=a&&"/"!=a)}else d.ungetChar(n)}else if(0==k&&"<"==a){a=d.getChar(n);if(-1==a)c=1;else{if("/"==a||f.isLetter(a)||"!"==a){c=1;d.ungetChar(n)}d.ungetChar(n)}}}return this.makeString(b,
n.position)},parseCDATA:function(b,e){var c,a,d,n,k,r,s=this.cursor,t=this.page;c=s.position;a=0;d=false;n="";for(r=false;!d;){k=t.getChar(s);switch(a){case 0:switch(k){case -1:d=true;break;case "'":if(b&&!r)if(""==n)n="'";else if("'"==n)n="";break;case '"':if(b&&!r)if(""==n)n='"';else if('"'==n)n="";break;case "\\":if(b)if(""!=n){k=t.getChar(s);if(-1==k)d=true;else k!="\\"&&k!=n&&t.ungetChar(s)}break;case "/":if(b)if(""==n){k=t.getChar(s);if(-1==k)d=true;else if("/"==k)r=true;else if("*"==k){do{do k=
t.getChar(s);while(-1!=k&&"*"!=k);k=t.getChar(s);k=="*"&&t.ungetChar(s)}while(-1!=k&&"/"!=k)}else t.ungetChar(s)}break;case "\n":r=false;break;case "<":if(b){if(""==n)a=1}else a=1}break;case 1:switch(k){case -1:d=true;break;case "/":a=!e||t.getText(s.position,s.position+e.length)===e&&!t.getText(s.position+e.length,s.position+e.length+1).match(/\w/)?2:0;break;case "!":k=t.getChar(s);if(-1==k)d=true;else if("-"==k){k=t.getChar(s);if(-1==k)d=true;else a="-"==k?3:0}else a=0;break;default:a=0}break;case 2:r=
false;if(-1==k)d=true;else if(f.isLetter(k)){d=true;t.ungetChar(s);t.ungetChar(s);t.ungetChar(s)}else a=0;break;case 3:r=false;if(-1==k)d=true;else if("-"==k){k=t.getChar(s);if(-1==k)d=true;else if("-"==k){k=t.getChar(s);if(-1==k)d=true;else if(">"==k)a=0;else{t.ungetChar(s);t.ungetChar(s)}}else t.ungetChar(s)}break;default:throw Error("unexpected "+a);}}return this.makeCData(c,s.position)},single_quote:function(b,e){var c=this.page;b.push(new q(c.getText(e[1],e[2]),"=",c.getText(e[4]+1,e[5]),"'"))},
double_quote:function(b,e){var c=this.page;b.push(new q(c.getText(e[1],e[2]),"=",c.getText(e[5]+1,e[6]),'"'))},standalone:function(b,e){b.push(new q(this.page.getText(e[1],e[2])))},naked:function(b,e){var c=this.page;b.push(new q(c.getText(e[1],e[2]),"=",c.getText(e[3],e[4])))}};return l},{requires:["./Cursor","./Page","../nodes/Text","../nodes/CData","../Utils","../nodes/Attribute","../nodes/Tag","../nodes/Comment"]});
KISSY.add("htmlparser/lexer/Page",function(i,p){function o(m){this.source=m;this.lineIndex=new p}o.prototype={getChar:function(m){var g=this.source,f=m.position;if(f>=g.length)return-1;var q=g.charAt(f);m.advance();if("\r"===q){q="\n";f=m.position;g.charAt(f)==="\n"&&m.advance()}"\n"===q&&this.lineIndex.add(m);return q},ungetChar:function(m){var g=this.source;m.retreat();var f=m.position,q=g.charAt(f);if(q==="\n"&&0!=f){q=g.charAt(f-1);"\r"===q&&m.retreat()}},getText:function(m,g){return this.source.slice(m,
g)},row:function(m){return this.lineIndex.row(m)},col:function(m){return this.lineIndex.col(m)}};return o},{requires:["./Index"]});KISSY.add("htmlparser/nodes/Attribute",function(i){function p(o,m,g,f){this.nodeType=2;this.name=o;this.assignMent=m;this.value=g;this.quote=f}i.augment(p,{clone:function(){var o=new p;i.mix(o,this);return o},equals:function(o){return this.name==o.name&&this.value==o.value&&this.nodeType==o.nodeType}});p.prototype.clone=function(){var o=new p;i.mix(o,this);return o};return p});
KISSY.add("htmlparser/nodes/CData",function(i,p){function o(){o.superclass.constructor.apply(this,arguments);this.nodeType=4;this.nodeName="#cdata"}i.extend(o,p,{writeHtml:function(m,g){var f=this.toHtml();if(!g||g.onCData(this)!==false)m.cdata(f)}});return o},{requires:["./Text"]});
KISSY.add("htmlparser/nodes/Comment",function(i,p){function o(){o.superclass.constructor.apply(this,arguments);this.nodeType=8;this.nodeName="#comment"}i.extend(o,p,{writeHtml:function(m,g){var f=this.toHtml();if(!g||g.onComment(this)!==false)m.comment(f)}});return o},{requires:["./Tag"]});KISSY.add("htmlparser/nodes/Document",function(i,p){function o(){this.childNodes=[];this.nodeType=9;this.nodeName="#document"}i.extend(o,p,{writeHtml:function(m,g){this._writeChildrenHtml(m,g)}});return o},{requires:["./Tag"]});
KISSY.add("htmlparser/nodes/Node",function(i){function p(o,m,g){this.parentNode=null;this.page=o;this.startPosition=m;this.endPosition=g;this.nextSibling=this.previousSibling=this.nodeName=null;if(i.Config.debug)this.toHtmlContent=this.toHtml()}p.prototype={toHtml:function(){if(this.page&&this.page.getText)return this.page.getText(this.startPosition,this.endPosition)},toString:function(){var o=[];o.push(this.nodeName+"  ["+this.startPosition+":"+this.endPosition+"]\n");o.push(this.toHtml());return o.join("")}};
return p});
KISSY.add("htmlparser/nodes/Tag",function(i,p,o,m){function g(j,h,l,b){g.superclass.constructor.apply(this,arguments);this.childNodes=[];this.lastChild=this.firstChild=null;this.attributes=b||[];this.nodeType=1;b=this.attributes;if(b[0]){this.nodeName=b[0].name.toLowerCase();this.tagName=this.nodeName.replace(/\//,"");this.isSelfClosed=!!m.$empty[this.nodeName];if(!this.isSelfClosed)this.isSelfClosed=/\/$/.test(this.nodeName);b.splice(0,1)}var e=b[b.length-1];if(e=!!(e&&/\/$/.test(e.name)))b.length-=1;
this.closed=this.isSelfClosed=this.isSelfClosed||e;this.closedEndPosition=this.closedStartPosition=-1}function f(j){var h=j.childNodes;j.firstChild=h[0];j.lastChild=h[h.length-1];if(h.length>=1){h[0].nextSibling=h[0].nextSibling=null;h[0].parentNode=j}if(h.length>1){for(var l=0;l<h.length-1;l++){h[l].nextSibling=h[l+1];h[l+1].previousSibling=h[l];h[l+1].parentNode=j}h[h.length-1].nextSibling=null}}function q(j,h){for(var l=0;l<j.length;l++)if(j[l].name==h)return j[l];return null}i.extend(g,p,{clone:function(){var j=
new g,h=[];i.each(this.attributes,function(l){h.push(l.clone())});i.mix(j,{childNodes:[],firstChild:null,lastChild:null,attributes:h,nodeType:this.nodeType,nodeName:this.nodeName,tagName:this.tagName,isSelfClosed:this.isSelfClosed,closed:this.closed,closedStartPosition:this.closedStartPosition,closedEndPosition:this.closedEndPosition});return j},equals:function(j){if(!j||this.nodeName!=j.nodeName)return 0;if(this.nodeType!=j.nodeType)return 0;if(this.attributes.length!=j.attributes.length)return 0;
for(var h=0;h<this.attributes.length;h++)if(!this.attributes[h].equals(j.attributes[h]))return 0;return 1},isEndTag:function(){return/^\//.test(this.nodeName)},appendChild:function(j){this.childNodes.push(j);f(this)},replace:function(j){var h=j.parentNode.childNodes,l=i.indexOf(j,h);h[l]=this;f(j.parentNode)},prepend:function(j){this.childNodes.unshift(j);f(this)},insertBefore:function(j){var h=j.parentNode.childNodes,l=i.indexOf(j,h);h.splice(l,0,this);f(j.parentNode)},insertAfter:function(j){var h=
j.parentNode.childNodes,l=i.indexOf(j,h);l==h.length-1?j.parentNode.appendChild(this):this.insertBefore(j.parentNode.childNodes[[l+1]])},empty:function(){this.childNodes=[];f(this)},removeChild:function(j){var h=j.parentNode.childNodes,l=i.indexOf(j,h);h.splice(l,1);f(j.parentNode)},getAttribute:function(j){return(j=q(this.attributes,j))&&j.value},setAttribute:function(j,h){var l=q(this.attributes,j);if(l)l.value=h;else this.attributes.push(new o(j,"=",h,'"'))},removeAttribute:function(j){(j=q(this.attributes,
j))&&this.attributes.splice(i.indexOf(j,this.attributes),1)},writeHtml:function(j,h){var l=this,b;b=l.tagName;if(b=="!doctype")j.append(this.toHtml()+"\n");else{if(h){if(!(b=h.onTagName(b)))return;l.tagName=b;b=h.onTag(l);if(b===false)return;if(b)l=b;if(l.nodeType!==1){l.writeHtml(j,h);return}if(!l.tagName){i.each(l.childNodes,function(d){d.writeHtml(j,h)});return}}j.openTag(l);for(var e=l.attributes,c=0;c<e.length;c++){var a=e[c];b=a.name;if(h){if(!(b=h.onAttributeName(b)))continue;if(h.onAttribute(a)===
false)continue}j.attribute(a,l)}j.openTagClose(l);if(!l.isSelfClosed){this._writeChildrenHtml(j,h);j.closeTag(l)}}},_writeChildrenHtml:function(j,h){i.each(this.childNodes,function(l){l.writeHtml(j,h)})}});return g},{requires:["./Node","./Attribute","../dtd"]});
KISSY.add("htmlparser/nodes/Text",function(i,p){function o(){o.superclass.constructor.apply(this,arguments);this.nodeType=3;this.nodeName="#text"}i.extend(o,p,{writeHtml:function(m,g){var f=this.toHtml();if(!g||g.onText(this)!==false)m.text(f)}});return o},{requires:["./Node"]});
KISSY.add("htmlparser/scanners/CdataScanner",function(){return{scan:function(i,p,o){o=p.parseCDATA(o.quoteSmart,i.nodeName);var m=p.getPosition(),g=p.nextNode();if(g)if(g.nodeType!=1||!(g.isEndTag()&&g.tagName==i.tagName))p.setPosition(m);i.closed=true;o&&i.appendChild(o)}}});KISSY.add("htmlparser/scanners/QuoteCdataScanner",function(i,p,o,m){i={scan:function(f,q,j){j=j||{};j.quoteSmart=1;p.scan(f,q,j);j.quoteSmart=0}};for(var g in o.$cdata)m[g]=i;return i},{requires:["./CdataScanner","../dtd","./SpecialScanners"]});
KISSY.add("htmlparser/scanners/SpecialScanners",function(){return{}});
KISSY.add("htmlparser/scanners/TagScanner",function(i,p,o,m){function g(h,l){function b(){if(a.childNodes.length){a.insertAfter(d);d=a;a=h.clone()}}h.closed=1;if(!l.fixByDtd)return 0;var e=1,c=[].concat(h.childNodes);i.each(c,function(u){if(!f(h,u)){e=0;return false}});if(e)return 0;for(var a=h.clone(),d=h,n=[],k=0;k<c.length;k++){var r=c[k];if(f(a,r))a.appendChild(r);else if(r.nodeType==1){var s=r.tagName;if(p.$listItem[s]){b();r=q[r.tagName];var t=new o;for(t.nodeName=t.tagName=r;k<c.length;){if(c[k].tagName==
s)t.appendChild(c[k]);else if(!(c[k].nodeType==3&&!i.trim(c[k].toHtml())))if(c[k].nodeType==3)break;k++}t.insertAfter(d);d=t;k--}else if(p.$inline[h.tagName]){b();if(r.equals(a)){r.insertAfter(d);d=r}else if(f(r,a)){a=h.clone();i.each(r.childNodes,function(u){a.appendChild(u)});r.empty();r.insertAfter(d);d=r;r.appendChild(a);n.push(a);a=h.clone()}else{r.insertAfter(d);d=r}}}}a.childNodes.length&&a.insertAfter(d);h.parentNode.removeChild(h);i.each(n,function(u){g(u,l)});return 1}function f(h,l){if(h.nodeType==
9)return 1;if(l.nodeType==8)return 1;var b=l.tagName||l.nodeName;if(l.nodeType==3)b="#";return!!p[h.tagName][b]}var q={li:"ul",dt:"dl",dd:"dl"},j={dd:"dl",dt:"dl",li:"ul",option:"select",optgroup:"select"};return{scan:function(h,l,b){function e(r,s){for(d=r;d>s;d--){var t=n[d];n[d-1].appendChild(t);g(t,b)}h=n[s];n.length=s}function c(r){var s=0,t;if(t=j[r.tagName]){for(var u=n.length-1,v=n[u];v&&v.tagName!=t;){if(v.tagName==r.tagName){s=1;break}u--;v=n[u]}s&&e(n.length-1,u-1)}return s}var a,d,n;n=
b.stack=b.stack||[];do{if(a=l.nextNode())if(a.nodeType===1)if(a.isEndTag()&&a.tagName==h.tagName)a=null;else if(a.isEndTag()){if(a.isEndTag()){var k=-1;for(d=n.length-1;d>=0;d--)if(n[d].tagName===a.tagName){k=d;break}if(k!=-1){n[n.length-1].appendChild(h);g(h,b);e(n.length-1,k);a=null}}}else if(m[a.tagName]){m[a.tagName].scan(a,l,b);h.appendChild(a)}else if(a.isSelfClosed)h.appendChild(a);else{n.push(h);c(a)&&n.push(h);h=a}else h.appendChild(a);if(a==null)if(n.length>0){a=n[n.length-1];if(m[a.tagName])a=
null;else{n.length-=1;a.appendChild(h);g(h,b);h=a}}}while(a);g(h,b)}}},{requires:["../dtd","../nodes/Tag","./SpecialScanners"]});KISSY.add("htmlparser/scanners/TextareaScanner",function(i,p,o){return o.textarea={scan:function(m,g,f){f=f||{};p.scan(m,g,f)}}},{requires:["./CdataScanner","./SpecialScanners"]});
KISSY.add("htmlparser/writer/basic",function(){function i(){this.output=[]}i.prototype={append:function(){for(var p=this.output,o=arguments,m,g=0;g<o.length;g++){m=o[g];if(m.length>1)for(var f=0;f<m.length;f++)p.push(m.charAt(f));else p.push(m)}return this},openTag:function(p){this.append("<",p.tagName)},openTagClose:function(p){p.isSelfClosed&&this.append(" ","/");this.append(">")},closeTag:function(p){this.append("</",p.tagName,">")},attribute:function(p){this.append(" ",p.name,'="',(p.value||p.name).replace(/"/g,
"&quote;"),'"')},text:function(p){this.append(p)},cdata:function(p){this.append(p)},comment:function(p){this.append(p)},getHtml:function(){return this.output.join("")}};return i});
KISSY.add("htmlparser/writer/beautify",function(i,p,o,m){function g(){g.superclass.constructor.apply(this,arguments);this.inPre=0;this.indentChar="\t";this.allowIndent=this.indentLevel=0;this.rules={};for(var f in i.merge(o.$nonBodyContent,o.$block,o.$listItem,o.$tableContent,{select:1,script:1,style:1}))this.setRules(f,{allowIndent:1,breakBeforeOpen:1,breakAfterOpen:1,breakBeforeClose:1,breakAfterClose:1});this.setRules("option",{breakBeforeOpen:1});this.setRules("optiongroup",{breakBeforeOpen:1});
this.setRules("br",{breakAfterOpen:1});this.setRules("title",{allowIndent:0,breakBeforeClose:0,breakAfterOpen:0});this.setRules("pre",{allowIndent:0})}i.extend(g,p,{indentation:function(){this.inPre||this.append(Array(this.indentLevel+1).join(this.indentChar));this.allowIndent=0},lineBreak:function(){var f=this.output;if(!this.inPre&&f.length){for(var q=f.length-1;q>=0;q--)if(!/[\r\n\t ]/.test(f[q]))break;f.length=q+1;this.append("\n")}this.allowIndent=1},setRules:function(f,q){this.rules[f]||(this.rules[f]=
{});i.mix(this.rules[f],q)},openTag:function(f){var q=this.rules[f.tagName]||{};if(this.allowIndent)this.indentation();else if(q.breakBeforeOpen){this.lineBreak();this.indentation()}g.superclass.openTag.apply(this,arguments)},openTagClose:function(f){var q=f.tagName,j=this.rules[q]||{};if(f.isSelfClosed)this.append(" />");else{this.append(">");j.allowIndent&&this.indentLevel++}j.breakAfterOpen&&this.lineBreak();if(q==="pre")this.inPre=1},closeTag:function(f){var q=f.tagName,j=this.rules[q]||{};j.allowIndent&&
this.indentLevel--;if(this.allowIndent)this.indentation();else if(j.breakBeforeClose){this.lineBreak();this.indentation()}g.superclass.closeTag.apply(this,arguments);if(q==="pre")this.inPre=0;j.breakAfterClose&&this.lineBreak()},text:function(f){this.allowIndent&&this.indentation();this.inPre||(f=m.collapseWhitespace(f));this.append(f)},comment:function(f){this.allowIndent&&this.indentation();this.append(f)},cdata:function(f){this.allowIndent&&this.indentation();this.append(f)}});return g},{requires:["./basic",
"../dtd","../Utils"]});
KISSY.add("htmlparser/writer/filter",function(i){function p(){this.tagNames=[];this.attributeNames=[];this.tags=[];this.comments=[];this.texts=[];this.cdatas=[];this.attributes=[]}function o(g,f){for(var q=0;q<g.length;q++)i.each(g[q].value,function(j){f=f.replace(j[0],j[1])});return f}function m(g,f,q){for(var j=0;j<g.length;j++)if(g[j].value.apply(null,f)===false)return false;return q}p.prototype={addRules:function(g,f){f=f||10;for(var q in g){var j=this[q],h;a:{for(h=0;h<j.length;h++)if(j[h].priority>
f){h=h;break a}h=j.length}j.splice(h,0,{value:g[q],priority:f})}},onTagName:function(g){return o(this.tagNames,g)},onAttributeName:function(g){return o(this.attributeNames,g)},onText:function(g){return m(this.texts,[g.toHtml(),g],g)},onCData:function(g){return m(this.cdatas,[g.toHtml(),g],g)},onAttribute:function(g,f){return m(this.attributes,[f,g],f)},onComment:function(g){return m(this.comments,[g.toHtml(),g],g)},onNode:function(g){var f=g.nodeType;if(f===1)return this.onTag(g);else if(f===3)return this.onText(g.toHtml(),
g);else if(f===8)return this.onComment(g.toHtml(),g)},onTag:function(g){for(var f=["^",g.tagName,"$"],q=this.tags,j,h=0;h<f.length;h++)for(var l=f[h],b=0;b<q.length;b++){var e=q[b].value;if(e[l]){if((j=e[l](g))===false)return false;if(j&&j!=e)return this.onNode(j);if(!g.name)return g}}return g}};return p});
KISSY.add("htmlparser/writer/minify",function(i,p,o){function m(l){return l.replace(/"/g,"&quote;")}function g(l,b){var e=l.nodeName,c=b.name,a=b.value||"";if(/^on[a-z]+/.test(c))a=q(a).replace(/^javascript:[\s\xa0]*/i,"").replace(/[\s\xa0]*;$/,"");else if(c==="class")a=j(q(a));else if(/^(?:a|area|link|base)$/.test(e)&&c==="href"||e==="img"&&/^(?:src|longdesc|usemap)$/.test(c)||e==="object"&&/^(?:classid|codebase|data|usemap)$/.test(c)||e==="q"&&c==="cite"||e==="blockquote"&&c==="cite"||(e==="ins"||
e==="del")&&c==="cite"||e==="form"&&c==="action"||e==="input"&&(c==="src"||c==="usemap")||e==="head"&&c==="profile"||e==="script"&&(c==="src"||c==="for")||/^(?:a|area|object|button)$/.test(e)&&c==="tabindex"||e==="input"&&(c==="maxlength"||c==="tabindex")||e==="select"&&(c==="size"||c==="tabindex")||e==="textarea"&&/^(?:rows|cols|tabindex)$/.test(c)||e==="colgroup"&&c==="span"||e==="col"&&c==="span"||(e==="th"||e=="td")&&(c==="rowspan"||c==="colspan"))a=q(a);else if(c==="style")a=q(a).replace(/[\s\xa0]*;[\s\xa0]*$/,
"");return a}function f(){f.superclass.constructor.apply(this,arguments);this.inPre=0}var q=i.trim,j=o.collapseWhitespace,h=RegExp("^(?:class|id|style|title|lang|dir|on(?:focus|blur|change|click|dblclick|mouse(?:down|up|over|move|out)|key(?:press|down|up)))$");i.extend(f,p,{comment:function(l){if(/\[if[^\]]+\]/.test(l)){l=l.replace(/^(\[[^\]]+\]>)[\s\xa0]*/,"$1").replace(/[\s\xa0]*(<!\[endif\])$/,"$1");f.superclass.comment.call(this,l)}},openTag:function(l){if(l.tagName=="pre")this.inPre=1;f.superclass.openTag.apply(this,
arguments)},closeTag:function(l){if(l.tagName=="pre")this.inPre=0;f.superclass.closeTag.apply(this,arguments)},cdata:function(l){l=q(l).replace(/^(?:[\s\xa0]*\/\*[\s\xa0]*<!\[CDATA\[[\s\xa0]*\*\/|[\s\xa0]*\/\/[\s\xa0]*<!\[CDATA\[.*)/,"").replace(/(?:\/\*[\s\xa0]*\]\]>[\s\xa0]*\*\/|\/\/[\s\xa0]*\]\]>)[\s\xa0]*$/,"");f.superclass.cdata.call(this,l)},attribute:function(l,b){var e=l.name,c=l.value||"",a;a=l.name;a=q(l.value||"")?0:b==="input"&&a==="value"||h.test(a);if(!(a=a)){a=b.nodeName;var d=l.name,
n=l.value||"";n=q(n.toLowerCase());a=a==="script"&&d==="language"&&n==="javascript"||a==="form"&&d==="method"&&n==="get"||a==="input"&&d==="type"&&n==="text"||a==="script"&&d==="type"&&n==="text/javascript"||a==="style"&&d==="type"&&n==="text/css"||a==="area"&&d==="shape"&&n==="rect"}if(!a)if(/^(?:checked|disabled|selected|readonly|defer|multiple|nohref|noshape|nowrap|noresize|compact|ismap)$/i.test(e))this.append(" ",e);else!/[ "'=<>`]/.test(c)?this.append(" ",e,"=",m(g(b,l))):this.append(" ",e,
'="',m(g(b,l)),'"')},text:function(l){this.inPre||this.append(j(l))}});return f},{requires:["./basic","../Utils"]});KISSY.add("htmlparser",function(i,p,o,m,g,f,q){return{Lexer:p,Parser:o,BasicWriter:m,BeautifyWriter:g,MinifyWriter:f,Filter:q}},{requires:["htmlparser/lexer/Lexer","htmlparser/Parser","htmlparser/writer/basic","htmlparser/writer/beautify","htmlparser/writer/minify","htmlparser/writer/filter"]});
