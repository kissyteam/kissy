/*
Copyright 2011, KISSY UI Library v1.20dev
MIT Licensed
build time: Dec 13 15:59
*/
KISSY.add("htmlparser/Parser",function(k,p,o,n,h,f,q,l){function i(a,d){this.originalHtml=a=k.trim(a);a=/^(<!doctype|<html|<body)/i.test(a)?"<document>"+a+"</document>":"<body>"+a+"</body>";this.lexer=new f(a);this.opts=d||{}}function m(a){var d=g(a,"body",3);if(d){a=d.parentNode;var j=a.childNodes,e=k.indexOf(d,j);if(e!=j.length-1){j=j.slice(e+1,j.length);for(e=0;e<j.length;e++){a.removeChild(j[e]);j[e].tagName=="body"?k.each(j[e].childNodes,function(r){d.appendChild(r)}):d.appendChild(j[e])}}}return d}
function b(a){var d=a.childNodes,j,e,r=p.p,s=0;for(e=0;e<d.length;e++){j=d[e];if(j.nodeType==3||j.nodeType==1&&r[j.nodeName]){s=1;break}}if(s){s=[];var t=new o;t.nodeName=t.tagName="p";for(e=0;e<d.length;e++){j=d[e];if(j.nodeType==3||j.nodeType==1&&r[j.nodeName])t.appendChild(j);else{if(t.childNodes.length){s.push(t);t=t.clone()}s.push(j)}}t.childNodes.length&&s.push(t);a.empty();for(e=0;e<s.length;e++)a.appendChild(s[e])}}function g(a,d,j){if(j===0)return 0;k.isNumber(j)&&j--;var e=a.childNodes;
if(e)for(var r=0;r<e.length;r++){if(e[r].tagName===d)return e[r];if(a=g(e[r],d,j))return a}return 0}function c(a){for(var d=[].concat(a.childNodes),j=0;j<d.length;j++)if(d[j].nodeName=="html"){for(var e=d[j],r=0;r<j;r++)d[r].nodeType==3&&!k.trim(d[r].toHtml())&&a.removeChild(d[r]);for(;e.firstChild&&e.firstChild.nodeType==3&&!k.trim(e.firstChild.toHtml());)e.removeChild(e.firstChild);break}}i.prototype={elements:function(){var a,d,j=this.lexer,e=this.opts;d=a=j.nextNode();if(a.tagName!="document"){d=
new q;d.appendChild(a)}d.nodeType=9;l.getScanner("div").scan(a,j,e);(a=m(d))&&e.autoParagraph&&b(a);c(d);e=this.originalHtml;var r=new n;d=/^(<!doctype|<html|<body)/i.test(e)?d.childNodes:a.childNodes;k.each(d,function(s){r.appendChild(s)});return r},parse:function(){return this.elements()}};return i},{requires:["./dtd","./nodes/Tag","./nodes/Fragment","./lexer/Cursor","./lexer/Lexer","./nodes/Document","./Scanner"]});
KISSY.add("htmlparser/Scanner",function(k,p,o){return{getScanner:function(n){return o[n]||p}}},{requires:["./scanners/TagScanner","./scanners/SpecialScanners","./scanners/QuoteCdataScanner","./scanners/TextareaScanner"]});
KISSY.add("htmlparser/Utils",function(){return{collapseWhitespace:function(k){return k.replace(/[\s\xa0]+/g," ")},isLetter:function(k){return"a"<=k&&"z">=k||"A"<=k&&"Z">=k},isValidAttributeNameStartChar:function(k){return!this.isWhitespace(k)&&k!='"'&&k!="'"&&k!=">"&&k!="<"&&k!="/"&&k!="="},isWhitespace:function(k){return/^[\s\xa0]$/.test(k)}}});
KISSY.add("htmlparser/dtd",function(k){k=k.merge;var p={isindex:1,fieldset:1},o={input:1,button:1,select:1,textarea:1,label:1},n=k({a:1},o),h=k({iframe:1},n),f={hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1},q={ins:1,del:1,script:1,style:1},l=k({b:1,acronym:1,bdo:1,"var":1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1},q),i=k({sub:1,img:1,object:1,sup:1,
basefont:1,map:1,applet:1,font:1,big:1,small:1},l),m=k({p:1},i);o=k({iframe:1},i,o);i={img:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,
address:1,q:1,pre:1,p:1,em:1,dfn:1};var b=k({a:1},o),g={tr:1},c={"#":1},a=k({param:1},i),d=k({form:1},p,h,f,m),j={li:1},e={base:1,link:1,meta:1,title:1},r=k(e,{style:1,script:1}),s={head:1,body:1},t={address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1},u={$nonBodyContent:k({html:1},s,e),$block:t,$blockLimit:{body:1,div:1,td:1,th:1,caption:1,form:1},$inline:b,$body:k({script:1,style:1},t),$cdata:{script:1,
style:1},$empty:{area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1},$listItem:{dd:1,dt:1,li:1},$list:{ul:1,ol:1,dl:1},$nonEditable:{applet:1,button:1,embed:1,iframe:1,map:1,object:1,option:1,script:1,textarea:1,param:1},$removeEmpty:{abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},$tabIndex:{a:1,area:1,button:1,input:1,object:1,select:1,textarea:1},
$tableContent:{caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1},html:s,head:r,style:c,body:d,base:{},link:{},meta:{},title:c,col:{},tr:{td:1,th:1},img:{},colgroup:{col:1},noscript:d,td:d,br:{},th:d,center:d,kbd:b,button:k(m,f),basefont:{},h5:b,h4:b,samp:b,h6:b,ol:j,h1:b,h3:b,option:c,h2:b,form:k(p,h,f,m),select:{optgroup:1,option:1},font:b,ins:b,menu:j,abbr:b,label:b,table:{thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1},code:b,script:c,tfoot:g,cite:b,li:d,input:{},iframe:d,
strong:b,textarea:c,noframes:d,big:b,small:b,span:b,hr:{},dt:b,sub:b,optgroup:{option:1},param:{},bdo:b,"var":b,div:d,object:a,sup:b,dd:d,strike:b,area:{},dir:j,map:k({area:1,form:1,p:1},p,q,f),applet:a,dl:{dt:1,dd:1},del:b,isindex:{},fieldset:k({legend:1},i),thead:g,ul:j,acronym:b,b:b,a:o,blockquote:d,caption:b,i:b,u:b,tbody:g,s:b,address:k(h,m),tt:b,legend:b,q:b,pre:k(l,n),p:b,em:b,dfn:b};(function(){var v,w=["article","figure","nav","aside","section","footer"],x;for(x in u)for(var y in u[x])if(y==
"div")for(v=0;v<w.length;v++)u[x][w[v]]=u[x][y];for(v=0;v<w.length;v++)u[w[v]]=u.div;u.$empty["!doctype"]=1})();return u});KISSY.add("htmlparser/lexer/Cursor",function(){function k(p){this.position=p||0}k.prototype={advance:function(){this.position++},retreat:function(){this.position=Math.max(--this.position,0)}};return k});
KISSY.add("htmlparser/lexer/Index",function(){function k(){this.lineCursors=[]}function p(n,h){for(var f=0;f<n.length;f++)if(n[f].position===h.position)return f;return-1}function o(n,h){for(var f=0;f<n.length;f++)if(n[f].position>h.position)break;return f}k.prototype={add:function(n){p(this.lineCursors,n)==-1&&this.lineCursors.splice(o(this.lineCursors,n),0,n)},remove:function(n){var h=this.lineCursors;n=p(this.lineCursors,n);n!=-1&&h.splice(n,1)},row:function(n){return o(this.lineCursors,n)-1},col:function(n){var h=
o(this.lineCursors,n)-1;return n.position-this.lineCursors[h]}};return k});
KISSY.add("htmlparser/lexer/Lexer",function(k,p,o,n,h,f,q,l,i){function m(b){this.page=new o(b);this.cursor=new p;this.nodeFactory=this}m.prototype={setPosition:function(b){this.cursor.position=b},getPosition:function(){return this.cursor.position},nextNode:function(b){var g,c,a=this.cursor,d=this.page;g=a.position;c=d.getChar(a);switch(c){case -1:b=null;break;case "<":c=d.getChar(a);if(c==-1)b=this.makeString(g,a.position);else if(c=="/"||f.isLetter(c)){d.ungetChar(a);b=this.parseTag(g)}else if("!"==
c){c=d.getChar(a);if(c==-1)b=this.makeString(g,a.position);else if(">"==c)b=this.makeComment(g,a.position);else{d.ungetChar(a);if("-"==c)b=this.parseComment(g,b);else{d.ungetChar(a);b=this.parseTag(g)}}}else{d.ungetChar(a);b=this.parseString(g,b)}break;default:d.ungetChar(a);b=this.parseString(g,b)}return b},makeComment:function(b,g){var c;c=g-b;if(0!=c){if(2>c)return this.makeString(b,g);c=this.nodeFactory.createCommentNode(this.page,b,g)}else c=null;return c},makeString:function(b,g){var c=null;
if(g-b>0)c=this.nodeFactory.createStringNode(this.page,b,g);return c},makeCData:function(b,g){var c=null;if(g-b>0)c=this.nodeFactory.createCDataNode(this.page,b,g);return c},makeTag:function(b,g,c){var a;a=g-b;if(0!=a){if(2>a)return this.makeString(b,g);b=this.nodeFactory.createTagNode(this.page,b,g,c)}else b=null;return b},createTagNode:function(b,g,c,a){return new l(b,g,c,a)},createStringNode:function(b,g,c){return new n(b,g,c)},createCDataNode:function(b,g,c){return new h(b,g,c)},createCommentNode:function(b,
g,c){return new i(b,g,c)},parseTag:function(b){var g,c=[],a=[],d,j=this.page,e=0,r=this.cursor;for(c[0]=r.position;!g;){c[e+1]=r.position;d=j.getChar(r);switch(e){case 0:if(d==-1||">"==d||"<"==d){if("<"==d){j.ungetChar(r);c[e+1]=r.position}g=true}else if(a.length){if(f.isValidAttributeNameStartChar(d))e=1}else if(d=="/"||f.isValidAttributeNameStartChar(d))e=1;break;case 1:if(-1==d||">"==d||"<"==d){if("<"==d){j.ungetChar(r);c[e+1]=r.getPosition}this.standalone(a,c);g=true}else if(f.isWhitespace(d)){c[6]=
c[2];e=6}else if("="==d)e=2;break;case 2:if(-1==d||">"==d){this.standalone(a,c);g=true}else if("'"==d){e=4;c[4]=c[3]}else if('"'==d){e=5;c[5]=c[3]}else f.isWhitespace(d)||(e=3);break;case 3:if(-1==d||">"==d){this.naked(a,c);g=true}else if(f.isWhitespace(d)){this.naked(a,c);c[0]=c[4];e=0}break;case 4:if(-1==d){this.single_quote(a,c);g=true}else if("'"==d){this.single_quote(a,c);c[0]=c[5]+1;e=0}break;case 5:if(-1==d){this.double_quote(a,c);g=true}else if('"'==d){this.double_quote(a,c);c[0]=c[6]+1;e=
0}break;case 6:if(-1==d){this.standalone(a,c);c[0]=c[6];j.ungetChar(r);e=0}else if(!f.isWhitespace(d))if("="==d){c[2]=c[6];c[3]=c[7];e=2}else{this.standalone(a,c);c[0]=c[6];j.ungetChar(r);e=0}break;default:throw Error("how ** did we get in state "+e);}}return this.makeTag(b,r.position,a)},parseComment:function(b,g){var c,a,d=this.page,j=this.cursor,e;c=false;for(e=0;!c;){a=d.getChar(j);if(-1==a)c=true;else switch(e){case 0:if(">"==a)c=true;if("-"==a)e=1;else return this.parseString(b,g);break;case 1:if("-"==
a){a=d.getChar(j);if(-1==a)c=true;else if(">"==a)c=true;else{d.ungetChar(j);e=2}}else return this.parseString(b,g);break;case 2:if("-"==a)e=3;else if(-1==a)return this.parseString(b,g);break;case 3:e="-"==a?4:2;break;case 4:if(">"==a)c=true;else f.isWhitespace(a)||(e=2);break;default:throw Error("how ** did we get in state "+e);}}return this.makeComment(b,j.position)},parseString:function(b,g){for(var c=0,a,d=this.page,j=this.cursor,e=0;!c;){a=d.getChar(j);if(-1==a)c=1;else if(g&&0==e&&("'"==a||'"'==
a))e=a;else if(g&&0!=e&&"\\"==a){a=d.getChar(j);-1!=a&&"\\"!=a&&a!=e&&d.ungetChar(j)}else if(g&&a==e)e=0;else if(g&&0==e&&a=="/"){a=d.getChar(j);if(-1==a)c=1;else if("/"==a){do a=d.getChar(j);while(-1!=a&&"\n"!=a)}else if("*"==a){do{do a=d.getChar(j);while(-1!=a&&"*"!=a);a=d.getChar(j);a=="*"&&d.ungetChar(j)}while(-1!=a&&"/"!=a)}else d.ungetChar(j)}else if(0==e&&"<"==a){a=d.getChar(j);if(-1==a)c=1;else{if("/"==a||f.isLetter(a)||"!"==a){c=1;d.ungetChar(j)}d.ungetChar(j)}}}return this.makeString(b,
j.position)},parseCDATA:function(b,g){var c,a,d,j,e,r,s=this.cursor,t=this.page;c=s.position;a=0;d=false;j="";for(r=false;!d;){e=t.getChar(s);switch(a){case 0:switch(e){case -1:d=true;break;case "'":if(b&&!r)if(""==j)j="'";else if("'"==j)j="";break;case '"':if(b&&!r)if(""==j)j='"';else if('"'==j)j="";break;case "\\":if(b)if(""!=j){e=t.getChar(s);if(-1==e)d=true;else e!="\\"&&e!=j&&t.ungetChar(s)}break;case "/":if(b)if(""==j){e=t.getChar(s);if(-1==e)d=true;else if("/"==e)r=true;else if("*"==e){do{do e=
t.getChar(s);while(-1!=e&&"*"!=e);e=t.getChar(s);e=="*"&&t.ungetChar(s)}while(-1!=e&&"/"!=e)}else t.ungetChar(s)}break;case "\n":r=false;break;case "<":if(b){if(""==j)a=1}else a=1}break;case 1:switch(e){case -1:d=true;break;case "/":a=!g||t.getText(s.position,s.position+g.length)===g&&!t.getText(s.position+g.length,s.position+g.length+1).match(/\w/)?2:0;break;case "!":e=t.getChar(s);if(-1==e)d=true;else if("-"==e){e=t.getChar(s);if(-1==e)d=true;else a="-"==e?3:0}else a=0;break;default:a=0}break;case 2:r=
false;if(-1==e)d=true;else if(f.isLetter(e)){d=true;t.ungetChar(s);t.ungetChar(s);t.ungetChar(s)}else a=0;break;case 3:r=false;if(-1==e)d=true;else if("-"==e){e=t.getChar(s);if(-1==e)d=true;else if("-"==e){e=t.getChar(s);if(-1==e)d=true;else if(">"==e)a=0;else{t.ungetChar(s);t.ungetChar(s)}}else t.ungetChar(s)}break;default:throw Error("unexpected "+a);}}return this.makeCData(c,s.position)},single_quote:function(b,g){var c=this.page;b.push(new q(c.getText(g[1],g[2]),"=",c.getText(g[4]+1,g[5]),"'"))},
double_quote:function(b,g){var c=this.page;b.push(new q(c.getText(g[1],g[2]),"=",c.getText(g[5]+1,g[6]),'"'))},standalone:function(b,g){b.push(new q(this.page.getText(g[1],g[2])))},naked:function(b,g){var c=this.page;b.push(new q(c.getText(g[1],g[2]),"=",c.getText(g[3],g[4])))}};return m},{requires:["./Cursor","./Page","../nodes/Text","../nodes/CData","../Utils","../nodes/Attribute","../nodes/Tag","../nodes/Comment"]});
KISSY.add("htmlparser/lexer/Page",function(k,p){function o(n){this.source=n;this.lineIndex=new p}o.prototype={getChar:function(n){var h=this.source,f=n.position;if(f>=h.length)return-1;var q=h.charAt(f);n.advance();if("\r"===q){q="\n";f=n.position;h.charAt(f)==="\n"&&n.advance()}"\n"===q&&this.lineIndex.add(n);return q},ungetChar:function(n){var h=this.source;n.retreat();var f=n.position,q=h.charAt(f);if(q==="\n"&&0!=f){q=h.charAt(f-1);"\r"===q&&n.retreat()}},getText:function(n,h){return this.source.slice(n,
h)},row:function(n){return this.lineIndex.row(n)},col:function(n){return this.lineIndex.col(n)}};return o},{requires:["./Index"]});KISSY.add("htmlparser/nodes/Attribute",function(k){function p(o,n,h,f){this.nodeType=2;this.name=o;this.assignMent=n;this.value=h;this.quote=f}k.augment(p,{clone:function(){var o=new p;k.mix(o,this);return o},equals:function(o){return this.name==o.name&&this.value==o.value&&this.nodeType==o.nodeType}});p.prototype.clone=function(){var o=new p;k.mix(o,this);return o};return p});
KISSY.add("htmlparser/nodes/CData",function(k,p){function o(){o.superclass.constructor.apply(this,arguments);this.nodeType=4;this.nodeName="#cdata"}k.extend(o,p,{writeHtml:function(n,h){var f=this.toHtml();if(!h||h.onCData(this)!==false)n.cdata(f)}});return o},{requires:["./Text"]});
KISSY.add("htmlparser/nodes/Comment",function(k,p){function o(){o.superclass.constructor.apply(this,arguments);this.nodeType=8;this.nodeName="#comment"}k.extend(o,p,{writeHtml:function(n,h){var f=this.toHtml();if(!h||h.onComment(this)!==false)n.comment(f)}});return o},{requires:["./Tag"]});
KISSY.add("htmlparser/nodes/Document",function(k,p){function o(){this.childNodes=[];this.nodeType=9;this.nodeName="#document"}k.extend(o,p,{writeHtml:function(n,h){this.__filter=h;this._writeChildrenHtml(n)}});return o},{requires:["./Tag"]});
KISSY.add("htmlparser/nodes/Fragment",function(k,p){function o(){this.childNodes=[];this.nodeType=9;this.nodeName="#fragment"}k.extend(o,p,{writeHtml:function(n,h){this.__filter=h;this.isChildrenFiltered=0;h&&h.onFragment(this);this._writeChildrenHtml(n)}});return o},{requires:["./Tag"]});
KISSY.add("htmlparser/nodes/Node",function(k){function p(o,n,h){this.parentNode=null;this.page=o;this.startPosition=n;this.endPosition=h;this.nextSibling=this.previousSibling=this.nodeName=null;if(k.Config.debug)this.toHtmlContent=this.toHtml()}p.prototype={toHtml:function(){if(this.page&&this.page.getText)return this.page.getText(this.startPosition,this.endPosition)},toString:function(){var o=[];o.push(this.nodeName+"  ["+this.startPosition+":"+this.endPosition+"]\n");o.push(this.toHtml());return o.join("")}};
return p});
KISSY.add("htmlparser/nodes/Tag",function(k,p,o,n){function h(l,i,m,b){h.superclass.constructor.apply(this,arguments);this.childNodes=[];this.lastChild=this.firstChild=null;this.attributes=b||[];this.nodeType=1;b=this.attributes;if(b[0]){this.nodeName=b[0].name.toLowerCase();this.tagName=this.nodeName.replace(/\//,"");this.isSelfClosed=!!n.$empty[this.nodeName];if(!this.isSelfClosed)this.isSelfClosed=/\/$/.test(this.nodeName);b.splice(0,1)}var g=b[b.length-1];if(g=!!(g&&/\/$/.test(g.name)))b.length-=1;
this.closed=this.isSelfClosed=this.isSelfClosed||g;this.closedEndPosition=this.closedStartPosition=-1}function f(l){var i=l.childNodes;l.firstChild=i[0];l.lastChild=i[i.length-1];if(i.length>=1){i[0].nextSibling=i[0].nextSibling=null;i[0].parentNode=l}if(i.length>1){for(var m=0;m<i.length-1;m++){i[m].nextSibling=i[m+1];i[m+1].previousSibling=i[m];i[m+1].parentNode=l}i[i.length-1].nextSibling=null}}function q(l,i){for(var m=0;m<l.length;m++)if(l[m].name==i)return l[m];return null}k.extend(h,p,{clone:function(){var l=
new h,i=[];k.each(this.attributes,function(m){i.push(m.clone())});k.mix(l,{childNodes:[],firstChild:null,lastChild:null,attributes:i,nodeType:this.nodeType,nodeName:this.nodeName,tagName:this.tagName,isSelfClosed:this.isSelfClosed,closed:this.closed,closedStartPosition:this.closedStartPosition,closedEndPosition:this.closedEndPosition});return l},equals:function(l){if(!l||this.nodeName!=l.nodeName)return 0;if(this.nodeType!=l.nodeType)return 0;if(this.attributes.length!=l.attributes.length)return 0;
for(var i=0;i<this.attributes.length;i++)if(!this.attributes[i].equals(l.attributes[i]))return 0;return 1},isEndTag:function(){return/^\//.test(this.nodeName)},appendChild:function(l){this.childNodes.push(l);f(this)},replace:function(l){var i=l.parentNode.childNodes,m=k.indexOf(l,i);i[m]=this;f(l.parentNode)},prepend:function(l){this.childNodes.unshift(l);f(this)},insertBefore:function(l){var i=l.parentNode.childNodes,m=k.indexOf(l,i);i.splice(m,0,this);f(l.parentNode)},insertAfter:function(l){var i=
l.parentNode.childNodes,m=k.indexOf(l,i);m==i.length-1?l.parentNode.appendChild(this):this.insertBefore(l.parentNode.childNodes[[m+1]])},empty:function(){this.childNodes=[];f(this)},removeChild:function(l){var i=l.parentNode.childNodes,m=k.indexOf(l,i);i.splice(m,1);f(l.parentNode)},getAttribute:function(l){return(l=q(this.attributes,l))&&l.value},setAttribute:function(l,i){var m=q(this.attributes,l);if(m)m.value=i;else this.attributes.push(new o(l,"=",i,'"'))},removeAttribute:function(l){(l=q(this.attributes,
l))&&this.attributes.splice(k.indexOf(l,this.attributes),1)},filterChildren:function(){var l=this;if(!l.isChildrenFiltered){var i=new (k.require("htmlparser/writer/basic"));l._writeChildrenHtml(i);i=(new (k.require("htmlparser/Parser"))(i.getHtml())).parse().childNodes;l.empty();k.each(i,function(m){l.appendChild(m)});l.isChildrenFiltered=1}},writeHtml:function(l,i){var m=this,b;b=m.tagName;if(b=="!doctype")l.append(this.toHtml()+"\n");else{m.__filter=i;m.isChildrenFiltered=0;if(i){if(!(b=i.onTagName(b)))return;
m.tagName=b;b=i.onTag(m);if(b===false)return;if(b)m=b;if(m.nodeType!==1){m.writeHtml(l,i);return}if(!m.tagName){m._writeChildrenHtml(l);return}}l.openTag(m);for(var g=m.attributes,c=0;c<g.length;c++){var a=g[c];b=a.name;if(i){if(!i.onAttributeName(b))continue;if(i.onAttribute(a)===false)continue}l.attribute(a,m)}l.openTagClose(m);if(!m.isSelfClosed){m._writeChildrenHtml(l);l.closeTag(m)}}},_writeChildrenHtml:function(l){var i=this.isChildrenFiltered?0:this.__filter;k.each(this.childNodes,function(m){m.writeHtml(l,
i)})}});return h},{requires:["./Node","./Attribute","../dtd"]});KISSY.add("htmlparser/nodes/Text",function(k,p){function o(){o.superclass.constructor.apply(this,arguments);this.nodeType=3;this.nodeName="#text"}k.extend(o,p,{writeHtml:function(n,h){var f=this.toHtml();if(!h||h.onText(this)!==false)n.text(f)}});return o},{requires:["./Node"]});
KISSY.add("htmlparser/scanners/CdataScanner",function(){return{scan:function(k,p,o){o=p.parseCDATA(o.quoteSmart,k.nodeName);var n=p.getPosition(),h=p.nextNode();if(h)if(h.nodeType!=1||!(h.isEndTag()&&h.tagName==k.tagName))p.setPosition(n);k.closed=true;o&&k.appendChild(o)}}});KISSY.add("htmlparser/scanners/QuoteCdataScanner",function(k,p,o,n){k={scan:function(f,q,l){l=l||{};l.quoteSmart=1;p.scan(f,q,l);l.quoteSmart=0}};for(var h in o.$cdata)n[h]=k;return k},{requires:["./CdataScanner","../dtd","./SpecialScanners"]});
KISSY.add("htmlparser/scanners/SpecialScanners",function(){return{}});
KISSY.add("htmlparser/scanners/TagScanner",function(k,p,o,n){function h(i,m){function b(){if(a.childNodes.length){a.insertAfter(d);d=a;a=i.clone()}}i.closed=1;if(!m.fixByDtd)return 0;var g=1,c=[].concat(i.childNodes);k.each(c,function(u){if(!f(i,u)){g=0;return false}});if(g)return 0;for(var a=i.clone(),d=i,j=[],e=0;e<c.length;e++){var r=c[e];if(f(a,r))a.appendChild(r);else if(r.nodeType==1){var s=r.tagName;if(p.$listItem[s]){b();r=q[r.tagName];var t=new o;for(t.nodeName=t.tagName=r;e<c.length;){if(c[e].tagName==
s)t.appendChild(c[e]);else if(!(c[e].nodeType==3&&!k.trim(c[e].toHtml())))if(c[e].nodeType==3)break;e++}t.insertAfter(d);d=t;e--}else if(p.$inline[i.tagName]){b();if(r.equals(a)){r.insertAfter(d);d=r}else if(f(r,a)){a=i.clone();k.each(r.childNodes,function(u){a.appendChild(u)});r.empty();r.insertAfter(d);d=r;r.appendChild(a);j.push(a);a=i.clone()}else{r.insertAfter(d);d=r}}}}a.childNodes.length&&a.insertAfter(d);i.parentNode.removeChild(i);k.each(j,function(u){h(u,m)});return 1}function f(i,m){if(i.nodeType==
9)return 1;if(m.nodeType==8)return 1;var b=m.tagName||m.nodeName;if(m.nodeType==3)b="#";return!!p[i.tagName][b]}var q={li:"ul",dt:"dl",dd:"dl"},l={dd:"dl",dt:"dl",li:"ul",option:"select",optgroup:"select"};return{scan:function(i,m,b){function g(r,s){for(d=r;d>s;d--){var t=j[d];j[d-1].appendChild(t);h(t,b)}i=j[s];j.length=s}function c(r){var s=0,t;if(t=l[r.tagName]){for(var u=j.length-1,v=j[u];v&&v.tagName!=t;){if(v.tagName==r.tagName){s=1;break}u--;v=j[u]}s&&g(j.length-1,u-1)}return s}var a,d,j;j=
b.stack=b.stack||[];do{if(a=m.nextNode())if(a.nodeType===1)if(a.isEndTag()&&a.tagName==i.tagName)a=null;else if(a.isEndTag()){if(a.isEndTag()){var e=-1;for(d=j.length-1;d>=0;d--)if(j[d].tagName===a.tagName){e=d;break}if(e!=-1){j[j.length-1].appendChild(i);h(i,b);g(j.length-1,e);a=null}}}else if(n[a.tagName]){n[a.tagName].scan(a,m,b);i.appendChild(a)}else if(a.isSelfClosed)i.appendChild(a);else{j.push(i);c(a)&&j.push(i);i=a}else i.appendChild(a);if(a==null)if(j.length>0){a=j[j.length-1];if(n[a.tagName])a=
null;else{j.length-=1;a.appendChild(i);h(i,b);i=a}}}while(a);h(i,b)}}},{requires:["../dtd","../nodes/Tag","./SpecialScanners"]});KISSY.add("htmlparser/scanners/TextareaScanner",function(k,p,o){return o.textarea={scan:function(n,h,f){f=f||{};p.scan(n,h,f)}}},{requires:["./CdataScanner","./SpecialScanners"]});
KISSY.add("htmlparser/writer/basic",function(){function k(){this.output=[]}k.prototype={append:function(){for(var p=this.output,o=arguments,n,h=0;h<o.length;h++){n=o[h];if(n.length>1)for(var f=0;f<n.length;f++)p.push(n.charAt(f));else p.push(n)}return this},openTag:function(p){this.append("<",p.tagName)},openTagClose:function(p){p.isSelfClosed&&this.append(" ","/");this.append(">")},closeTag:function(p){this.append("</",p.tagName,">")},attribute:function(p){this.append(" ",p.name,'="',(p.value||p.name).replace(/"/g,
"&quote;"),'"')},text:function(p){this.append(p)},cdata:function(p){this.append(p)},comment:function(p){this.append(p)},getHtml:function(){return this.output.join("")}};return k});
KISSY.add("htmlparser/writer/beautify",function(k,p,o,n){function h(){h.superclass.constructor.apply(this,arguments);this.inPre=0;this.indentChar="\t";this.allowIndent=this.indentLevel=0;this.rules={};for(var f in k.merge(o.$nonBodyContent,o.$block,o.$listItem,o.$tableContent,{select:1,script:1,style:1}))this.setRules(f,{allowIndent:1,breakBeforeOpen:1,breakAfterOpen:1,breakBeforeClose:1,breakAfterClose:1});this.setRules("option",{breakBeforeOpen:1});this.setRules("optiongroup",{breakBeforeOpen:1});
this.setRules("br",{breakAfterOpen:1});this.setRules("title",{allowIndent:0,breakBeforeClose:0,breakAfterOpen:0});this.setRules("pre",{allowIndent:0})}k.extend(h,p,{indentation:function(){this.inPre||this.append(Array(this.indentLevel+1).join(this.indentChar));this.allowIndent=0},lineBreak:function(){var f=this.output;if(!this.inPre&&f.length){for(var q=f.length-1;q>=0;q--)if(!/[\r\n\t ]/.test(f[q]))break;f.length=q+1;this.append("\n")}this.allowIndent=1},setRules:function(f,q){this.rules[f]||(this.rules[f]=
{});k.mix(this.rules[f],q)},openTag:function(f){var q=this.rules[f.tagName]||{};if(this.allowIndent)this.indentation();else if(q.breakBeforeOpen){this.lineBreak();this.indentation()}h.superclass.openTag.apply(this,arguments)},openTagClose:function(f){var q=f.tagName,l=this.rules[q]||{};if(f.isSelfClosed)this.append(" />");else{this.append(">");l.allowIndent&&this.indentLevel++}l.breakAfterOpen&&this.lineBreak();if(q==="pre")this.inPre=1},closeTag:function(f){var q=f.tagName,l=this.rules[q]||{};l.allowIndent&&
this.indentLevel--;if(this.allowIndent)this.indentation();else if(l.breakBeforeClose){this.lineBreak();this.indentation()}h.superclass.closeTag.apply(this,arguments);if(q==="pre")this.inPre=0;l.breakAfterClose&&this.lineBreak()},text:function(f){this.allowIndent&&this.indentation();this.inPre||(f=n.collapseWhitespace(f));this.append(f)},comment:function(f){this.allowIndent&&this.indentation();this.append(f)},cdata:function(f){this.allowIndent&&this.indentation();this.append(f)}});return h},{requires:["./basic",
"../dtd","../Utils"]});
KISSY.add("htmlparser/writer/filter",function(k){function p(){this.tagNames=[];this.attributeNames=[];this.tags=[];this.comments=[];this.texts=[];this.cdatas=[];this.attributes=[];this.root=[]}function o(h,f){for(var q=0;q<h.length;q++)k.each(h[q].value,function(l){f=f.replace(l[0],l[1])});return f}function n(h,f,q){for(var l=0;l<h.length;l++)if(h[l].value.apply(null,f)===false)return false;return q}p.prototype={addRules:function(h,f){f=f||10;for(var q in h)if(h.hasOwnProperty(q)){var l=this[q],i;
a:{for(i=0;i<l.length;i++)if(l[i].priority>f){i=i;break a}i=l.length}l.splice(i,0,{value:h[q],priority:f})}},onTagName:function(h){return o(this.tagNames,h)},onAttributeName:function(h){return o(this.attributeNames,h)},onText:function(h){return n(this.texts,[h.toHtml(),h],h)},onCData:function(h){return n(this.cdatas,[h.toHtml(),h],h)},onAttribute:function(h,f){return n(this.attributes,[f,h],f)},onComment:function(h){return n(this.comments,[h.toHtml(),h],h)},onNode:function(h){var f=h.nodeType;if(f===
1)return this.onTag(h);else if(f===3)return this.onText(h.toHtml(),h);else if(f===8)return this.onComment(h.toHtml(),h)},onFragment:function(h){return n(this.root,[h],h)},onTag:function(h){for(var f=["^",h.tagName,"$"],q=this.tags,l,i=0;i<f.length;i++)for(var m=f[i],b=0;b<q.length;b++){var g=q[b].value;if(g[m]){if((l=g[m](h))===false)return false;if(l&&l!=g)return this.onNode(l);if(!h.name)return h}}return h}};return p});
KISSY.add("htmlparser/writer/minify",function(k,p,o){function n(m){return m.replace(/"/g,"&quote;")}function h(m,b){var g=m.nodeName,c=b.name,a=b.value||"";if(/^on[a-z]+/.test(c))a=q(a).replace(/^javascript:[\s\xa0]*/i,"").replace(/[\s\xa0]*;$/,"");else if(c==="class")a=l(q(a));else if(/^(?:a|area|link|base)$/.test(g)&&c==="href"||g==="img"&&/^(?:src|longdesc|usemap)$/.test(c)||g==="object"&&/^(?:classid|codebase|data|usemap)$/.test(c)||g==="q"&&c==="cite"||g==="blockquote"&&c==="cite"||(g==="ins"||
g==="del")&&c==="cite"||g==="form"&&c==="action"||g==="input"&&(c==="src"||c==="usemap")||g==="head"&&c==="profile"||g==="script"&&(c==="src"||c==="for")||/^(?:a|area|object|button)$/.test(g)&&c==="tabindex"||g==="input"&&(c==="maxlength"||c==="tabindex")||g==="select"&&(c==="size"||c==="tabindex")||g==="textarea"&&/^(?:rows|cols|tabindex)$/.test(c)||g==="colgroup"&&c==="span"||g==="col"&&c==="span"||(g==="th"||g=="td")&&(c==="rowspan"||c==="colspan"))a=q(a);else if(c==="style")a=q(a).replace(/[\s\xa0]*;[\s\xa0]*$/,
"");return a}function f(){f.superclass.constructor.apply(this,arguments);this.inPre=0}var q=k.trim,l=o.collapseWhitespace,i=RegExp("^(?:class|id|style|title|lang|dir|on(?:focus|blur|change|click|dblclick|mouse(?:down|up|over|move|out)|key(?:press|down|up)))$");k.extend(f,p,{comment:function(m){if(/\[if[^\]]+\]/.test(m)){m=m.replace(/^(\[[^\]]+\]>)[\s\xa0]*/,"$1").replace(/[\s\xa0]*(<!\[endif\])$/,"$1");f.superclass.comment.call(this,m)}},openTag:function(m){if(m.tagName=="pre")this.inPre=1;f.superclass.openTag.apply(this,
arguments)},closeTag:function(m){if(m.tagName=="pre")this.inPre=0;f.superclass.closeTag.apply(this,arguments)},cdata:function(m){m=q(m).replace(/^(?:[\s\xa0]*\/\*[\s\xa0]*<!\[CDATA\[[\s\xa0]*\*\/|[\s\xa0]*\/\/[\s\xa0]*<!\[CDATA\[.*)/,"").replace(/(?:\/\*[\s\xa0]*\]\]>[\s\xa0]*\*\/|\/\/[\s\xa0]*\]\]>)[\s\xa0]*$/,"");f.superclass.cdata.call(this,m)},attribute:function(m,b){var g=m.name,c=m.value||"",a;a=m.name;a=q(m.value||"")?0:b==="input"&&a==="value"||i.test(a);if(!(a=a)){a=b.nodeName;var d=m.name,
j=m.value||"";j=q(j.toLowerCase());a=a==="script"&&d==="language"&&j==="javascript"||a==="form"&&d==="method"&&j==="get"||a==="input"&&d==="type"&&j==="text"||a==="script"&&d==="type"&&j==="text/javascript"||a==="style"&&d==="type"&&j==="text/css"||a==="area"&&d==="shape"&&j==="rect"}if(!a)if(/^(?:checked|disabled|selected|readonly|defer|multiple|nohref|noshape|nowrap|noresize|compact|ismap)$/i.test(g))this.append(" ",g);else!/[ "'=<>`]/.test(c)?this.append(" ",g,"=",n(h(b,m))):this.append(" ",g,
'="',n(h(b,m)),'"')},text:function(m){this.inPre||this.append(l(m))}});return f},{requires:["./basic","../Utils"]});KISSY.add("htmlparser",function(k,p,o,n,h,f,q){return{Lexer:p,Parser:o,BasicWriter:n,BeautifyWriter:h,MinifyWriter:f,Filter:q}},{requires:["htmlparser/lexer/Lexer","htmlparser/Parser","htmlparser/writer/basic","htmlparser/writer/beautify","htmlparser/writer/minify","htmlparser/writer/filter"]});
