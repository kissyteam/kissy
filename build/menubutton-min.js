/*
Copyright 2012, KISSY UI Library v1.40dev
MIT Licensed
build time: Oct 16 20:37
*/
KISSY.add("menubutton/base",function(d,e,g,k,i,l,j){function f(c,o){var a=c.get("menu");if(a&&a.xclass)if(o)a=l.create(a,c),c.setInternal("menu",a);else return null;return a}function p(){var c,o,b=f(this);b&&b.get("visible")&&(c=b.get("align"),o=c.node,delete c.node,c=d.clone(c),c.node=o||this.get("el"),d.mix(c,a,!1),b.set("align",c))}var q=d.Env.host,m=d.buffer(p,50),n=e.all,h=e.KeyCodes,a={points:["bl","tl"],overflow:{adjustX:1,adjustY:1}},b=g.extend([l.DecorateChild],{_uiSetCollapsed:function(c){if(c)(c=
f(this))&&c.hide();else{var c=this.get("el"),a=f(this,1);a&&!a.get("visible")&&(a.render(),this.bindMenu(),this.get("matchElWidth")&&a.set("width",n(a.get("align").node||c).innerWidth()),a.show(),p.call(this),c.attr("aria-haspopup",a.get("el").attr("id")))}},bindMenu:function(){var c=this,a=c.get("menu");a.on("afterActiveItemChange",function(a){c.set("activeItem",a.newVal)});n(q).on("resize",m,c);if(c.get("collapseOnClick"))a.on("click",function(){c.set("collapsed",!0)});c.bindMenu=d.noop},handleKeyEventInternal:function(c){var a=
f(this);if(c.keyCode==h.SPACE){if(c.preventDefault(),"keyup"!=c.type)return j}else if("keydown"!=c.type)return j;return a&&a.get("visible")?(a=a.handleKeydown(c),c.keyCode==h.ESC?(this.set("collapsed",!0),!0):a):c.keyCode==h.SPACE||c.keyCode==h.DOWN||c.keyCode==h.UP?(this.set("collapsed",!1),!0):j},performActionInternal:function(){this.set("collapsed",!this.get("collapsed"))},handleBlur:function(a){b.superclass.handleBlur.call(this,a);this.set("collapsed",!0)},addItem:function(a,b){f(this,1).addChild(a,
b)},removeItem:function(a,b){var d=f(this);d&&d.removeChild(a,b)},removeItems:function(a){var b=this.get("menu");b&&(b.removeChildren?b.removeChildren(a):b.children&&(b.children=[]))},getItemAt:function(a){var b=f(this);return b&&b.getChildAt(a)},_uiSetDisabled:function(a){!a&&this.set("collapsed",!0)},decorateChildrenInternal:function(a,b){var g=this.get("menu");d.one(b[0].ownerDocument.body).prepend(b);this.setInternal("menu",new a(d.mix({srcNode:b,prefixCls:this.get("prefixCls")},g)))},destructor:function(){n(q).detach("resize",
m,this);var a=this.get("menu");a.destroy&&a.destroy()}},{ATTRS:{activeItem:{view:1},matchElWidth:{value:!0},collapseOnClick:{value:!1},decorateChildCls:{valueFn:function(){return this.get("prefixCls")+"popupmenu"}},menu:{value:{xclass:"popupmenu"},setter:function(a){a instanceof i&&a.setInternal("parent",this)}},collapsed:{view:1},xrender:{value:k}}},{xclass:"menu-button",priority:20});return b},{requires:["node","button","./baseRender","menu","component"]});
KISSY.add("menubutton/baseRender",function(d,e){return e.Render.extend({createDom:function(){this.get("el").append(d.substitute('<div class="{prefixCls}menu-button-dropdown"><div class="{prefixCls}menu-button-dropdown-inner"></div></div>',{prefixCls:this.get("prefixCls")})).attr("aria-haspopup",!0)},_uiSetCollapsed:function(d){var e=this.get("el"),i=this.getCssClassWithPrefix("menu-button-open");e[d?"removeClass":"addClass"](i).attr("aria-expanded",!d)},_uiSetActiveItem:function(d){this.get("el").attr("aria-activedescendant",
d&&d.get("el").attr("id")||"")}},{ATTRS:{contentEl:{valueFn:function(){return d.all(d.substitute('<div class="{prefixCls}menu-button-caption"></div>',{prefixCls:this.get("prefixCls")}))}},activeItem:{},collapsed:{value:!0}},HTML_PARSER:{contentEl:function(d){return d.children("."+this.get("prefixCls")+"menu-button-caption")}}})},{requires:["button"]});
KISSY.add("menubutton",function(d,e,g,k,i){e.Render=g;e.Select=k;e.Option=i;return e},{requires:["menubutton/base","menubutton/baseRender","menubutton/select","menubutton/option"]});KISSY.add("menubutton/option",function(d,e){var g=e.Item.extend({handleBlur:function(){return g.superclass.handleBlur.apply(this,arguments)}},{ATTRS:{selectable:{value:!0},textContent:{}}},{xclass:"option",priority:10});return g},{requires:["menu"]});
KISSY.add("menubutton/select",function(d,e,g,k,i,l){function j(a){var b=a.get("menu"),b=b.children||b.get&&b.get("children")||[],a=a.get("value"),c,d;for(d=0;d<b.length;d++)if(c=b[d],f(c)==a)return c;return null}function f(a){var b;if(a)if(a.get){if((b=a.get("value"))===l)b=a.get("textContent")||a.get("content")}else if((b=a.value)===l)b=a.textContent||a.content;return b}function p(a){var b=a.get("menu"),c=a.get("value"),a=b&&b.get&&b.get("children");d.each(a,function(a){a&&a.set&&a.set("selected",
f(a)==c)})}function q(){var a=j(this),b=this.get("menu");b.set("highlightedItem",a||b.getChildAt(0));a&&a.set("selected",!0)}function m(a){var b=j(a),c=b&&(b.textContent||b.get&&b.get("textContent")),b=b&&(b.content||b.get&&b.get("content"));a.set("content",c||b||a.get("defaultCaption"))}function n(a){a=a.target;if(a instanceof k.Item){var b=f(a),c=this.get("value");this.set("value",f(a));b!=c&&this.fire("change",{prevVal:c,newVal:b})}}var h=g.extend({bindUI:function(){this.on("click",n,this)},bindMenu:function(){h.superclass.bindMenu.call(this);
this.get("menu").on("show",q,this)},removeItems:function(){h.superclass.removeItems.apply(this,arguments);this.set("value",null)},removeItem:function(a){h.superclass.removeItem.apply(this,arguments);a.get("value")==this.get("value")&&this.set("value",null)},_uiSetValue:function(){p(this);m(this)},_uiSetDefaultCaption:function(){m(this)}},{ATTRS:{value:{},defaultCaption:{value:""},collapseOnClick:{value:!0}},decorate:function(a,b){a=d.one(a);b=b||{};b.elBefore=a;var c,f=[],g,i=null,j=a.val();a.all("option").each(function(a){var b=
{content:a.text(),elCls:a.attr("class"),value:a.val(),xclass:"option"};j==a.val()&&(i={content:b.content,value:b.value});f.push(b)});d.mix(b,{menu:d.mix({xclass:"popupmenu",children:f},b.menuCfg)});delete b.menuCfg;g=(new h(d.mix(b,i))).render();if(c=a.attr("name")){var k=(new e("<input type='hidden' name='"+c+"' value='"+j+"'>")).insertBefore(a,l);g.on("afterValueChange",function(a){k.val(a.newVal||"")})}a.remove();return g}},{xclass:"select",priority:30});return h},{requires:["node","./base","menu",
"./option"]});
