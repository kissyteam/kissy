/*
Copyright 2012, KISSY UI Library v1.30dev
MIT Licensed
build time: Jun 15 17:22
*/
KISSY.add("menubutton/base",function(b,f,h,m,j,n,i){function g(c,d){var a=c.get("menu");if(a&&a.xclass)if(d)a=n.create(a,c),c.__set("menu",a);else return null;return a}function a(){var c=g(this);if(c&&c.get("visible")){var a=b.clone(c.get("align"));a.node=this.get("el");b.mix(a,q,!1);c.set("align",a)}}var e=b.Env.host,o=b.buffer(a,50),p=f.all,k=f.KeyCodes,q={points:["bl","tl"],overflow:{adjustX:1,adjustY:1}},l=h.extend([n.DecorateChild],{getMenu:function(c){return g(this,c)},_uiSetCollapsed:function(c){if(c)(c=
g(this))&&c.hide();else{var c=this.get("el"),d=g(this,1);this.bindMenu();d&&!d.get("visible")&&(this.get("matchElWidth")&&d.set("width",c.innerWidth()),d.show(),a.call(this),c.attr("aria-haspopup",d.get("el").attr("id")))}},bindMenu:function(){var c=this,a=c.get("menu");a&&(a.on("afterActiveItemChange",function(a){c.set("activeItem",a.newVal)}),a.on("click",c.handleMenuClick,c),p(e).on("resize",o,c),c.bindMenu=b.noop)},handleMenuClick:function(a){this.fire("click",{target:a.target})},handleKeyEventInternal:function(a){var d=
g(this);if(a.keyCode==k.SPACE){if(a.preventDefault(),"keyup"!=a.type)return i}else if("keydown"!=a.type)return i;return d&&d.get("visible")?(d=d.handleKeydown(a),a.keyCode==k.ESC?(this.set("collapsed",!0),!0):d):a.keyCode==k.SPACE||a.keyCode==k.DOWN||a.keyCode==k.UP?(this.set("collapsed",!1),!0):i},performActionInternal:function(){this.set("collapsed",!this.get("collapsed"))},handleBlur:function(a){l.superclass.handleBlur.call(this,a);this.set("collapsed",!0)},addItem:function(a,d){g(this,1).addChild(a,
d)},removeItem:function(a,d){var e=g(this);e&&e.removeChild(a,d)},removeItems:function(a){var d=g(this);d&&d.removeChildren(a)},getItemAt:function(a){var d=g(this);return d&&d.getChildAt(a)},_uiSetDisabled:function(a){!a&&this.set("collapsed",!0)},decorateChildrenInternal:function(a,d){b.one(d[0].ownerDocument.body).prepend(d);this.__set("menu",new a(b.mix({srcNode:d,prefixCls:this.get("prefixCls")})))},destructor:function(){p(e).detach("resize",o,this)}},{ATTRS:{activeItem:{view:1},matchElWidth:{value:!0},
decorateChildCls:{valueFn:function(){return this.get("prefixCls")+"popupmenu"}},menu:{value:{xclass:"popupmenu"},setter:function(a){a instanceof j&&a.__set("parent",this)}},collapsed:{view:1},xrender:{value:m}}},{xclass:"menu-button",priority:20});return l},{requires:["node","button","./baseRender","menu","component"]});
KISSY.add("menubutton/baseRender",function(b,f){return f.Render.extend({createDom:function(){this.get("el").append('<div class="ks-inline-block ks-menu-button-dropdown"><div class="ks-menu-button-dropdown-inner"></div></div>').attr("aria-haspopup",!0)},_uiSetCollapsed:function(b){var f=this.get("el"),j=this.getCssClassWithPrefix("menu-button-open");f[b?"removeClass":"addClass"](j).attr("aria-expanded",!b)},_uiSetActiveItem:function(b){this.get("el").attr("aria-activedescendant",b&&b.get("el").attr("id")||
"")}},{ATTRS:{contentEl:{valueFn:function(){return b.all('<div class="ks-inline-block ks-menu-button-caption"></div>')}},contentElCls:{value:"ks-menu-button-caption"},activeItem:{},collapsed:{value:!0}}})},{requires:["button"]});KISSY.add("menubutton",function(b,f,h,m,j){f.Render=h;f.Select=m;f.Option=j;return f},{requires:["menubutton/base","menubutton/baseRender","menubutton/select","menubutton/option"]});
KISSY.add("menubutton/option",function(b,f){var h=f.Item.extend({handleBlur:function(){return h.superclass.handleBlur.apply(this,arguments)}},{ATTRS:{selectable:{value:!0}}},{xclass:"option",priority:10});return h},{requires:["menu"]});
KISSY.add("menubutton/select",function(b,f,h,m,j,n){function i(a){return(a=a.getMenu(1).render().hide())&&a.get("children")||[]}var g=h.extend({bindMenu:function(){var a=this.getMenu();g.superclass.bindMenu.call(this);if(a)a.on("show",this._handleMenuShow,this)},_handleMenuShow:function(){var a=this.get("menu");a.set("highlightedItem",this.get("selectedItem")||a.getChildAt(0))},_updateCaption:function(){var a=this.get("selectedItem");this.set("content",a?a.get("content"):this.get("defaultCaption"))},
handleMenuClick:function(a){var a=a.target,e=this.get("selectedItem");this.set("selectedItem",a);this.set("collapsed",!0);this.fire("click",{target:a,prevTarget:e})},removeItems:function(){g.superclass.removeItems.apply(this,arguments);this.set("selectedItem",null)},removeItem:function(a){g.superclass.removeItem.apply(this,arguments);a==this.get("selectedItem")&&this.set("selectedItem",null)},_uiSetSelectedItem:function(a,e){e&&e.prevVal&&e.prevVal.set("selected",!1);this._updateCaption()},_uiSetDefaultCaption:function(){this._updateCaption()}},
{ATTRS:{value:{getter:function(){var a=this.get("selectedItem");return a&&a.get("value")},setter:function(a){if(null!=a)for(var e=i(this),b=0;b<e.length;b++){var f=e[b];if(f.get&&f.get("value")==a){this.set("selectedItem",f);return}}this.set("selectedItem",null);return null}},selectedItem:{},selectedIndex:{setter:function(a){var b=i(this);if(0>a||a>=b.length)return-1;this.set("selectedItem",b[a])},getter:function(){return b.indexOf(this.get("selectedItem"),i(this))}},defaultCaption:{value:""}},decorate:function(a,
e){a=b.one(a);e=e||{};e.elBefore=a;var h,i=[],k=null,j=a.val();a.all("option").each(function(a){var b={content:a.text(),elCls:a.attr("class"),value:a.val(),xclass:"option"};j==a.val()&&(k={content:b.content,value:b.value});i.push(b)});b.mix(e,{menu:b.mix({xclass:"popupmenu",children:i},e.menuCfg)});delete e.menuCfg;var l=new g(b.mix(e,k));l.render();if(h=a.attr("name")){var c=(new f("<input type='hidden' name='"+h+"' value='"+j+"'>")).insertBefore(a,n);l.on("afterSelectedItemChange",function(a){a.newVal?
c.val(a.newVal.get("value")):c.val("")})}a.remove();return l}},{xclass:"select",priority:30});return g},{requires:["node","./base","menu","./option"]});
