/*
Copyright 2013, KISSY v1.40dev
MIT Licensed
build time: Sep 17 23:09
*/
KISSY.add("menubutton/menubutton-xtpl",function(){return function(e,c,g){var i=this.config.utils.getPropertyOrRunCommand,c="",a={},f=[];f.push("component/extension/content-render/content-xtpl");a.params=f;a=i(this,e,a,"include",0,1,!1,g);c=c+a+'\r\n<div class="';a={};f=[];f.push("dropdown");a.params=f;a=i(this,e,a,"getBaseCssClasses",0,2,!0,g);c=c+a+'">\r\n    <div class="';a={};f=[];f.push("dropdown-inner");a.params=f;e=i(this,e,a,"getBaseCssClasses",0,3,!0,g);return c+e+'">\r\n    </div>\r\n</div>'}});
KISSY.add("menubutton/render",function(e,c,g,i){return c.getDefaultRender().extend([i],{decorateDom:function(a){var f=this.control,c=f.get("prefixCls"),a=a.one("."+c+"popupmenu"),e=a[0].ownerDocument.body;e.insertBefore(a[0],e.firstChild);e=this.getComponentConstructorByNode(c,a);f.setInternal("menu",new e({srcNode:a,prefixCls:c}))},beforeCreateDom:function(a){e.mix(a.elAttrs,{"aria-expanded":!1,"aria-haspopup":!0})},_onSetCollapsed:function(a){var e=this.$el,c=this.getBaseCssClass("open");e[a?"removeClass":
"addClass"](c).attr("aria-expanded",!a)}},{ATTRS:{contentTpl:{value:g}}})},{requires:["button","./menubutton-xtpl","component/extension/content-render"]});
KISSY.add("menubutton/control",function(e,c,g,i,a,f){function l(d){d.target.isMenuItem&&this.get("collapseOnClick")&&this.set("collapsed",!0)}function k(d){d.target.isMenu&&(d=d.newVal,this.el.setAttribute("aria-activedescendant",d&&d.el.id||""))}var j=c.KeyCode;return g.extend({isMenuButton:1,_onSetCollapsed:function(d){var h=this.get("menu");if(d)h.hide();else if(d=this.$el,!h.get("visible")){var a={node:d,points:["bl","tl"],overflow:{adjustX:1,adjustY:1}};e.mix(h.get("align"),a,!1);this.get("matchElWidth")&&
(h.render(),a=h.get("el"),a=(parseInt(a.css("borderLeftWidth"))||0)+(parseInt(a.css("borderRightWidth"))||0),h.set("width",h.get("align").node[0].offsetWidth-a));h.show();d.attr("aria-haspopup",h.get("el").attr("id"))}},bindUI:function(){this.on("afterHighlightedItemChange",k,this);this.on("click",l,this)},handleKeyDownInternal:function(d){var a=d.keyCode,e=""+d.type,c=this.get("menu");if(a==j.SPACE){if(d.preventDefault(),"keyup"!=e)return f}else if("keydown"!=e)return f;return c.get("rendered")&&
c.get("visible")?(d=c.handleKeyDownInternal(d),a==j.ESC?(this.set("collapsed",!0),!0):d):a==j.SPACE||a==j.DOWN||a==j.UP?(this.set("collapsed",!1),!0):f},handleClickInternal:function(){this.set("collapsed",!this.get("collapsed"))},handleBlurInternal:function(d){this.callSuper(d);this.set("collapsed",!0)},addItem:function(d,a){this.get("menu").addChild(d,a)},removeItem:function(d,a){this.get("menu").removeChild(d,a)},removeItems:function(d){var a=this.get("menu");a&&(a.removeChildren?a.removeChildren(d):
a.children&&(a.children=[]))},getItemAt:function(a){var c=self.get("menu");return c.get("rendered")&&c.getChildAt(a)},_onSetDisabled:function(a){!a&&this.set("collapsed",!0)},destructor:function(){this.get("menu").destroy()}},{ATTRS:{matchElWidth:{value:!0},collapseOnClick:{value:!1},menu:{value:{},getter:function(a){a.isControl||(a.xclass=a.xclass||"popupmenu",a=this.createComponent(a),this.setInternal("menu",a));return a},setter:function(a){a.isControl&&a.setInternal("parent",this)}},collapsed:{value:!1,
view:1},xrender:{value:i}},xclass:"menu-button"})},{requires:["node","button","./render","menu"]});KISSY.add("menubutton/option",function(e,c){return c.Item.extend({},{ATTRS:{selectable:{value:!0},textContent:{}},xclass:"option"})},{requires:["menu"]});
KISSY.add("menubutton/select",function(e,c,g,i,a,f){function l(a){var b=a.get("menu"),b=b.children||b.get&&b.get("children")||[],a=a.get("value"),c,d;for(d=0;d<b.length;d++)if(c=b[d],k(c)==a)return c;return null}function k(a){var b;if(a)if(a.get){if((b=a.get("value"))===f)b=a.get("textContent")||a.get("content")}else if((b=a.value)===f)b=a.textContent||a.content;return b}function j(a){var b=a.get("menu"),c=a.get("value"),a=b&&b.get&&b.get("children");e.each(a,function(a){a&&a.set&&a.set("selected",
k(a)==c)})}function d(a){var b=l(this),c=this.get("menu");a.target===c&&((a=b||c.getChildAt(0))&&a.set("highlighted",!0),b&&b.set("selected",!0))}function h(a){var b=l(a),c=b&&(b.textContent||b.get&&b.get("textContent")),b=b&&(b.content||b.get&&b.get("content"));a.set("content",c||b||a.get("defaultCaption"))}function n(a){a=a.target;if(a.isMenuItem){var a=k(a),b=this.get("value");this.set("value",a);a!=b&&this.fire("change",{prevVal:b,newVal:a})}}var m=g.extend({bindUI:function(){this.on("click",
n,this);this.on("show",d,this)},removeItems:function(){this.callSuper.apply(this,arguments);this.set("value",null)},removeItem:function(a,b){this.callSuper(a,b);a.get("value")==this.get("value")&&this.set("value",null)},_onSetValue:function(){j(this);h(this)},_onSetDefaultCaption:function(){h(this)}},{ATTRS:{value:{},defaultCaption:{value:""},collapseOnClick:{value:!0}},decorate:function(a,b){a=e.one(a);b=b||{};b.elBefore=a;var d,h=[],g,i=null,j=a.val();a.all("option").each(function(a){var b={xclass:"option",
content:a.text(),elCls:a.attr("class"),value:a.val()};j==a.val()&&(i={content:b.content,value:b.value});h.push(b)});e.mix(b,{menu:e.mix({children:h},b.menuCfg)});delete b.menuCfg;g=(new m(e.mix(b,i))).render();if(d=a.attr("name")){var k=(new c("<input type='hidden' name='"+d+"' value='"+j+"'>")).insertBefore(a,f);g.on("afterValueChange",function(a){k.val(a.newVal||"")})}a.remove();return g},xclass:"select"});return m},{requires:["node","./control","menu","./option"]});
KISSY.add("menubutton",function(e,c,g,i){c.Select=g;c.Option=i;return c},{requires:["menubutton/control","menubutton/select","menubutton/option"]});
