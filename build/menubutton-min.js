/*
Copyright 2012, KISSY UI Library v1.30dev
MIT Licensed
build time: Apr 28 16:38
*/
KISSY.add("menubutton/base",function(c,e,h,d,f,o,l,m){function g(b,a){var i=b.get("menu");if(c.isFunction(i))if(a)i=i.call(b),b.__set("menu",i);else return null;i&&i.get("parent")!==b&&(i.__set("parent",b),b.bindMenu());return i}function j(b){var a=new o.PopupMenu(c.mix({prefixCls:b.get("prefixCls")},b.get("menuCfg")));b.__set("menu",a);b.bindMenu();return a}function a(){var b=g(this);b&&b.get("visible")&&b.set("align",c.merge({node:this.get("el")},q,this.get("menuAlign")))}var r=c.Env.host,s=h.all,
n=h.KeyCodes,q={points:["bl","tl"],overflow:{adjustX:1,adjustY:1}},k=e.create(d,[l.DecorateChild],{getMenu:function(b){return g(this,b)},initializer:function(){this._reposition=c.buffer(a,50,this)},_uiSetCollapsed:function(b){if(b)(b=g(this))&&b.hide();else{var b=this.get("el"),a=g(this,1);a&&!a.get("visible")&&(a.set("align",c.merge({node:b},q,this.get("menuAlign"))),a.show(),b.attr("aria-haspopup",a.get("el").attr("id")))}},bindMenu:function(){var b=this,a=g(b);a&&(a.on("afterActiveItemChange",
function(a){b.set("activeItem",a.newVal)}),a.on("click",b.handleMenuClick,b),s(r).on("resize",b._reposition,b),b.bindMenu=c.noop)},handleMenuClick:function(b){this.fire("click",{target:b.target})},bindUI:function(){this.bindMenu()},handleKeyEventInternal:function(b){var a=g(this);if(b.keyCode==n.SPACE){if(b.preventDefault(),"keyup"!=b.type)return m}else if("keydown"!=b.type)return m;return a&&a.get("visible")?(a=a.handleKeydown(b),b.keyCode==n.ESC?(this.set("collapsed",!0),!0):a):b.keyCode==n.SPACE||
b.keyCode==n.DOWN||b.keyCode==n.UP?(this.set("collapsed",!1),!0):m},performActionInternal:function(){this.set("collapsed",!this.get("collapsed"))},handleBlur:function(b){k.superclass.handleBlur.call(this,b);this.set("collapsed",!0)},addItem:function(b,a){(g(this,1)||j(this)).addChild(b,a)},removeItem:function(b,a){var i=g(this);i&&i.removeChild(b,a)},removeItems:function(b){var a=g(this);a&&a.removeChildren(b)},getItemAt:function(a){var c=g(this);return c&&c.getChildAt(a)},_uiSetDisabled:function(a){!a&&
this.set("collapsed",!0)},decorateChildrenInternal:function(a,d){d.css("visibility","hidden");c.one(d[0].ownerDocument.body).prepend(d);this.__set("menu",new a(c.mix({srcNode:d,prefixCls:this.get("prefixCls")},this.get("menuCfg"))))},destructor:function(){var a=this.get("menu");s(r).detach("resize",this._reposition,this);a&&a.destroy&&a.destroy()}},{ATTRS:{activeItem:{view:!0},menuAlign:{value:{}},menuCfg:{},decorateChildCls:{value:"popupmenu"},menu:{},collapsed:{value:!0,view:!0}},DefaultRender:f},
"MenuButton");l.UIStore.setUIConstructorByCssClass("menu-button",{priority:l.UIStore.PRIORITY.LEVEL2,ui:k});return k},{requires:"uibase,node,button,./menubuttonRender,menu,component".split(",")});KISSY.add("menubutton",function(c,e,h,d,f){e.Render=h;e.Select=d;e.Option=f;return e},{requires:["menubutton/base","menubutton/menubuttonRender","menubutton/select","menubutton/option"]});
KISSY.add("menubutton/menubuttonRender",function(c,e,h){return e.create(h.Render,{createDom:function(){var d=this.get("el"),f=c.substitute('<div class="ks-inline-block {prefixCls}menu-button-caption">{content}</div><div class="ks-inline-block {prefixCls}menu-button-dropdown"></div>',{content:this.get("content"),prefixCls:this.get("prefixCls")});d.html(f).attr("aria-haspopup",!0)},_uiSetContent:function(d){var c=this.get("el").one("."+this.getCssClassWithPrefix("menu-button-caption"));c.html("");d&&
c.append(d)},_uiSetCollapsed:function(c){var f=this.get("el"),e=this.getCssClassWithPrefix("menu-button-open");f[c?"removeClass":"addClass"](e).attr("aria-expanded",!c)},_uiSetActiveItem:function(c){this.get("el").attr("aria-activedescendant",c&&c.get("el").attr("id")||"")}},{ATTRS:{activeItem:{},collapsed:{}}},"MenuButton_Render")},{requires:["uibase","button"]});
KISSY.add("menubutton/option",function(c,e,h,d){var f=e.create(d.Item,{handleBlur:function(){return f.superclass.handleBlur.apply(this,arguments)}},{ATTRS:{selectable:{value:!0}}},"Menu_Option");h.UIStore.setUIConstructorByCssClass("option",{priority:10,ui:f});return f},{requires:["uibase","component","menu"]});
KISSY.add("menubutton/select",function(c,e,h,d,f,o,l,m){function g(a){return(a=a.getMenu(1))&&a.get("children")||[]}var j=h.create(f,{bindMenu:function(){var a=this.getMenu();j.superclass.bindMenu.call(this);if(a)a.on("show",this._handleMenuShow,this)},_handleMenuShow:function(){var a=this.get("menu");a.set("highlightedItem",this.get("selectedItem")||a.getChildAt(0))},_updateCaption:function(){var a=this.get("selectedItem");this.set("content",a?a.get("content"):this.get("defaultCaption"))},handleMenuClick:function(a){this.set("selectedItem",
a.target);this.set("collapsed",!0);j.superclass.handleMenuClick.call(this,a)},removeItems:function(){j.superclass.removeItems.apply(this,arguments);this.set("selectedItem",null)},removeItem:function(a){j.superclass.removeItem.apply(this,arguments);a==this.get("selectedItem")&&this.set("selectedItem",null)},_uiSetSelectedItem:function(a,c){c&&c.prevVal&&c.prevVal.set("selected",!1);this._updateCaption()},_uiSetDefaultCaption:function(){this._updateCaption()}},{ATTRS:{value:{getter:function(){var a=
this.get("selectedItem");return a&&a.get("value")},setter:function(a){for(var c=g(this),d=0;d<c.length;d++){var e=c[d];if(e.get("value")==a){this.set("selectedItem",e);return}}this.set("selectedItem",null);return null}},selectedItem:{},selectedIndex:{setter:function(a){var c=g(this);if(0>a||a>=c.length)return-1;this.set("selectedItem",c[a])},getter:function(){return c.indexOf(this.get("selectedItem"),g(this))}},defaultCaption:{value:""}},decorate:function(a,d){a=c.one(a);d=d||{};d.elBefore=a;var g,
f=[],h=null,k=a.val();a.all("option").each(function(a){var b={content:a.text(),prefixCls:d.prefixCls,elCls:a.attr("class"),value:a.val()};k==a.val()&&(h={content:b.content,value:b.value});f.push(b)});c.mix(d,{menu:function(){for(var a=new o.PopupMenu(c.mix({prefixCls:this.get("prefixCls")},this.get("menuCfg"))),b=0;b<f.length;b++)a.addChild(new l(f[b]));return a}});var b=new j(c.mix(d,h));b.render();if(g=a.attr("name")){var p=(new e("<input type='hidden' name='"+g+"' value='"+k+"'>")).insertBefore(a,
m);b.on("afterSelectedItemChange",function(a){a.newVal?p.val(a.newVal.get("value")):p.val("")})}a.remove();return b}},"Menu_Select");d.UIStore.setUIConstructorByCssClass("select",{priority:d.UIStore.PRIORITY.LEVEL3,ui:j});return j},{requires:"node,uibase,component,./base,menu,./option".split(",")});
