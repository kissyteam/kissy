/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: Jul 3 16:19
*/
KISSY.add("menubutton/menubutton-tpl","{{{include 'component/extension/content-render/content-tpl'}}} <div class=\"{{getBaseCssClasses 'dropdown'}}\"> <div class=\"{{getBaseCssClasses 'dropdown-inner'}}\"> </div> </div>");
KISSY.add("menubutton/render",function(c,b,e,i){return b.ATTRS.xrender.value.extend([i],{decorateDom:function(f){var h=this.control,c=h.get("prefixCls"),f=f.one("."+c+"popupmenu"),b=f[0].ownerDocument.body;b.insertBefore(f[0],b.firstChild);b=this.getComponentConstructorByNode(c,f);h.setInternal("menu",new b({srcNode:f,prefixCls:c}))},beforeCreateDom:function(b){c.mix(b.elAttrs,{"aria-expanded":!1,"aria-haspopup":!0})},_onSetCollapsed:function(b){var c=this.$el,e=this.getBaseCssClass("open");c[b?"removeClass":
"addClass"](e).attr("aria-expanded",!b)}},{ATTRS:{contentTpl:{value:e}}})},{requires:["button","./menubutton-tpl","component/extension/content-render"]});
KISSY.add("menubutton/control",function(c,b,e,i,f,h){function l(a){a.target.isMenuItem&&this.get("collapseOnClick")&&this.set("collapsed",!0)}function j(a){a.target.isMenu&&(a=a.newVal,this.el.setAttribute("aria-activedescendant",a&&a.el.id||""))}var g=b.KeyCode,n=e.extend({isMenuButton:1,_onSetCollapsed:function(a){var d=this.get("menu");if(a)d.hide();else if(a=this.$el,!d.get("visible")){var b={node:a,points:["bl","tl"],overflow:{adjustX:1,adjustY:1}};c.mix(d.get("align"),b,!1);this.get("matchElWidth")&&
(d.render(),b=d.get("el"),b=(parseInt(b.css("borderLeftWidth"))||0)+(parseInt(b.css("borderRightWidth"))||0),d.set("width",d.get("align").node[0].offsetWidth-b));d.show();a.attr("aria-haspopup",d.get("el").attr("id"))}},bindUI:function(){this.on("afterHighlightedItemChange",j,this);this.on("click",l,this)},handleKeyDownInternal:function(a){var d=a.keyCode,b=""+a.type,k=this.get("menu");if(d==g.SPACE){if(a.preventDefault(),"keyup"!=b)return h}else if("keydown"!=b)return h;return k.get("rendered")&&
k.get("visible")?(a=k.handleKeyDownInternal(a),d==g.ESC?(this.set("collapsed",!0),!0):a):d==g.SPACE||d==g.DOWN||d==g.UP?(this.set("collapsed",!1),!0):h},handleClickInternal:function(){this.set("collapsed",!this.get("collapsed"))},handleBlurInternal:function(a){n.superclass.handleBlurInternal.call(this,a);this.set("collapsed",!0)},addItem:function(a,b){this.get("menu").addChild(a,b)},removeItem:function(a,b){this.get("menu").removeChild(a,b)},removeItems:function(a){var b=this.get("menu");b&&(b.removeChildren?
b.removeChildren(a):b.children&&(b.children=[]))},getItemAt:function(a){var b=self.get("menu");return b.get("rendered")&&b.getChildAt(a)},_onSetDisabled:function(a){!a&&this.set("collapsed",!0)},destructor:function(){this.get("menu").destroy()}},{ATTRS:{matchElWidth:{value:!0},collapseOnClick:{value:!1},menu:{value:{},getter:function(a){a.isControl||(a.xclass=a.xclass||"popupmenu",a=this.createComponent(a),this.setInternal("menu",a));return a},setter:function(a){a.isControl&&a.setInternal("parent",
this)}},collapsed:{value:!1,view:1},xrender:{value:i}},xclass:"menu-button"});return n},{requires:["node","button","./render","menu"]});KISSY.add("menubutton/option",function(c,b){return b.Item.extend({},{ATTRS:{selectable:{value:!0},textContent:{}},xclass:"option"})},{requires:["menu"]});
KISSY.add("menubutton/select",function(c,b,e,i,f,h){function l(k){var a=k.get("menu"),a=a.children||a.get&&a.get("children")||[],k=k.get("value"),b,c;for(c=0;c<a.length;c++)if(b=a[c],j(b)==k)return b;return null}function j(a){var b;if(a)if(a.get){if((b=a.get("value"))===h)b=a.get("textContent")||a.get("content")}else if((b=a.value)===h)b=a.textContent||a.content;return b}function g(a){var b=a.get("menu"),d=a.get("value"),a=b&&b.get&&b.get("children");c.each(a,function(a){a&&a.set&&a.set("selected",
j(a)==d)})}function n(a){var b=l(this),c=this.get("menu");a.target===c&&((a=b||c.getChildAt(0))&&a.set("highlighted",!0),b&&b.set("selected",!0))}function a(a){var b=l(a),c=b&&(b.textContent||b.get&&b.get("textContent")),b=b&&(b.content||b.get&&b.get("content"));a.set("content",c||b||a.get("defaultCaption"))}function d(a){a=a.target;if(a.isMenuItem){var a=j(a),b=this.get("value");this.set("value",a);a!=b&&this.fire("change",{prevVal:b,newVal:a})}}var m=e.extend({bindUI:function(){this.on("click",
d,this);this.on("show",n,this)},removeItems:function(){m.superclass.removeItems.apply(this,arguments);this.set("value",null)},removeItem:function(a,b){m.superclass.removeItem.apply(this,arguments);a.get("value")==this.get("value")&&this.set("value",null)},_onSetValue:function(){g(this);a(this)},_onSetDefaultCaption:function(){a(this)}},{ATTRS:{value:{},defaultCaption:{value:""},collapseOnClick:{value:!0}},decorate:function(a,d){a=c.one(a);d=d||{};d.elBefore=a;var e,f=[],g,i=null,j=a.val();a.all("option").each(function(a){var b=
{xclass:"option",content:a.text(),elCls:a.attr("class"),value:a.val()};j==a.val()&&(i={content:b.content,value:b.value});f.push(b)});c.mix(d,{menu:c.mix({children:f},d.menuCfg)});delete d.menuCfg;g=(new m(c.mix(d,i))).render();if(e=a.attr("name")){var l=(new b("<input type='hidden' name='"+e+"' value='"+j+"'>")).insertBefore(a,h);g.on("afterValueChange",function(a){l.val(a.newVal||"")})}a.remove();return g},xclass:"select"});return m},{requires:["node","./control","menu","./option"]});
KISSY.add("menubutton",function(c,b,e,i){b.Select=e;b.Option=i;return b},{requires:["menubutton/control","menubutton/select","menubutton/option"]});
