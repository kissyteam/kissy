/*
Copyright 2011, KISSY UI Library v1.20dev
MIT Licensed
build time: Aug 12 19:58
*/
KISSY.add("menubutton/menubutton",function(f,h,i,d,g,m,n){var j=i.all,c=i.KeyCodes,e=h.create(d,[n.DecorateChild],{_hideMenu:function(){var a=this.get("menu");a&&a.hide()},_showMenu:function(){var a=this.get("el"),b=this.get("menu");if(!b.get("visible")){b.set("align",f.mix({node:a},this.get("menuAlign")));b.show();a.attr("aria-haspopup",b.get("el").attr("id"))}},_uiSetCollapsed:function(a){a?this._hideMenu():this._showMenu()},_reposition:function(){var a=this.get("menu"),b=this.get("el");a&&a.get("visible")&&
a.set("align",f.mix({node:b},this.get("menuAlign")))},__bindMenu:function(){var a=this,b=this.get("menu");if(b){b.on("afterActiveItemChange",function(k){a.set("activeItem",k.newVal)});b.on("click",function(k){a.fire("click",{target:k.target})});j(window).on("resize",a._reposition,a);a.__bindMenu=f.noop}},bindUI:function(){this.__bindMenu()},_handleKeyEventInternal:function(a){var b=this.get("menu");if(a.keyCode==c.SPACE){a.preventDefault();if(a.type!="keyup")return}else if(a.type!="keydown")return;
if(b&&b.get("visible")){b=b._handleKeydown(a);if(a.keyCode==c.ESC){this.set("collapsed",true);return true}return b}if(a.keyCode==c.SPACE||a.keyCode==c.DOWN||a.keyCode==c.UP){this.set("collapsed",false);return true}},_performInternal:function(){this.get("menu").get("visible")?this.set("collapsed",true):this.set("collapsed",false)},_handleBlur:function(a){e.superclass._handleBlur.call(this,a);this.set("collapsed",true)},getMenu:function(){var a=this.get("menu");if(!a){a=new m.PopupMenu(f.mix({prefixCls:this.get("prefixCls")},
this.get("menuCfg")));this.set("menu",a);this.__bindMenu()}return a},addItem:function(a,b){this.getMenu().addChild(a,b)},removeItem:function(a,b){this.get("menu")&&this.get("menu").removeChild(a,b)},removeItems:function(a){this.get("menu")&&this.get("menu").removeChildren(a)},getItemAt:function(a){return this.get("menu")&&this.get("menu").getChildAt(a)},_uiSetDisabled:function(a){var b=e.superclass._uiSetDisabled;b&&b.apply(this,f.makeArray(arguments));!a&&this.set("collapsed",true)},decorateChildrenInternal:function(a,
b,k){b.hide();f.one(b[0].ownerDocument.body).prepend(b);this.set("menu",new a(f.mix({srcNode:b,prefixCls:k},this.get("menuCfg"))))},destructor:function(){var a=this.get("menu");j(window).detach("resize",this._reposition,this);a&&a.destroy()}},{ATTRS:{activeItem:{view:true},menuAlign:{value:{points:["bl","tl"],overflow:{failX:1,failY:1,adjustX:1,adjustY:1}}},menuCfg:{},decorateChildCls:{value:"popupmenu"},menu:{setter:function(a){a.set("parent",this)}},collapsed:{value:true,view:true}},DefaultRender:g});
n.UIStore.setUIByClass("menu-button",{priority:n.UIStore.PRIORITY.LEVEL2,ui:e});return e},{requires:["uibase","node","button","./menubuttonrender","menu","component"]});
KISSY.add("menubutton/menubuttonrender",function(f,h,i){return h.create(i.Render,{renderUI:function(){this.get("el").addClass(this.getCls("menu-button"))},createDom:function(){var d=this.get("innerEl"),g=f.substitute('<div class="{prefixCls}inline-block {prefixCls}menu-button-caption">{content}</div><div class="{prefixCls}inline-block {prefixCls}menu-button-dropdown">&nbsp;</div>',{content:this.get("content")||"",prefixCls:this.get("prefixCls")});d.html(g).attr("aria-haspopup",true)},_uiSetContent:function(d){var g=
this.get("el").one("."+this.getCls("menu-button-caption"));g.html("");d&&g.append(d)},_uiSetCollapsed:function(d){var g=this.get("el"),m=this.getCls("menu-button-open");if(d){g.removeClass(m);g.attr("aria-expanded",false)}else{g.addClass(m);g.attr("aria-expanded",true)}},_uiSetActiveItem:function(d){this.get("el").attr("aria-activedescendant",d&&d.get("el").attr("id")||"")}},{ATTRS:{activeItem:{},collapsed:{}}})},{requires:["uibase","button"]});
KISSY.add("menubutton/option",function(f,h,i,d){f=h.create(d.Item,{renderUI:function(){this.get("el").addClass(this.getCls("option"))}},{ATTRS:{selectable:{value:true}}});i.UIStore.setUIByClass("option",{priority:10,ui:f});return f},{requires:["uibase","component","menu"]});
KISSY.add("menubutton/select",function(f,h,i,d,g,m,n){var j=i.create(g,{bindUI:function(){this.on("click",this._handleMenuClick,this);this.get("menu").on("show",this._handleMenuShow,this)},_handleMenuShow:function(){this.get("menu").set("highlightedItem",this.get("selectedItem")||this.get("menu").getChildAt(0))},_updateCaption:function(){var c=this.get("selectedItem");this.set("content",c?c.get("content"):this.get("defaultCaption"))},_handleMenuClick:function(c){this.set("selectedItem",c.target);
this.set("collapsed",true)},removeItems:function(){j.superclass.removeItems.apply(this,arguments);this.set("selectedItem",null)},removeItem:function(c){j.superclass.removeItem.apply(this,arguments);c==this.get("selectedItem")&&this.set("selectedItem",null)},_uiSetSelectedItem:function(c,e){e&&e.prevVal&&e.prevVal.set("selected",false);this._updateCaption()},_uiSetDefaultCaption:function(){this._updateCaption()}},{ATTRS:{value:{getter:function(){var c=this.get("selectedItem");return c&&c.get("value")},
setter:function(c){for(var e=this.get("menu").get("children"),a=0;a<e.length;a++){var b=e[a];if(b.get("value")==c){this.set("selectedItem",b);return}}this.set("selectedItem",null);return null}},selectedItem:{},selectedIndex:{setter:function(c){var e=this.get("menu").get("children");if(c<0||c>=e.length)return-1;this.set("selectedItem",e[c])},getter:function(){return f.indexOf(this.get("selectedItem"),this.get("menu").get("children"))}},defaultCaption:{value:""}}});j.decorate=function(c,e){c=f.one(c);
e.elBefore=c;var a=new j(e),b,k,o=c.val();c.all("option").each(function(l){var p=new n({content:l.text(),prefixCls:e.prefixCls,value:l.val()});if(o==l.val())k=p;a.addItem(p)});a.set("selectedItem",k);a.render();if(b=c.attr("name")){var q=(new h("<input type='hidden' name='"+b+"' value='"+o+"'>")).insertBefore(c);a.on("afterSelectedItemChange",function(l){l.newVal?q.val(l.newVal.get("value")):q.val("")})}c.remove();return a};d.UIStore.setUIByClass("select",{priority:d.UIStore.PRIORITY.LEVEL3,ui:j});
return j},{requires:["node","uibase","component","./menubutton","menu","./option"]});KISSY.add("menubutton",function(f,h,i,d,g){h.Render=i;h.Select=d;h.Option=g;return h},{requires:["menubutton/menubutton","menubutton/menubuttonrender","menubutton/select","menubutton/option"]});
