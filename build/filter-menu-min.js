/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: Jul 23 22:55
*/
KISSY.add("filter-menu/render-tpl",'<div id="ks-filter-menu-input-wrap-{{id}}" class="{{getBaseCssClasses "input-wrap"}}"> <div id="ks-filter-menu-placeholder-{{id}}" class="{{getBaseCssClasses "placeholder"}}"> {{placeholder}} </div> <input id="ks-filter-menu-input-{{id}}" class="{{getBaseCssClasses "input"}}" autocomplete="off"/> </div> {{{include \'component/extension/content-render/content-tpl\'}}}');
KISSY.add("filter-menu/render",function(h,i,g,e,a){return g.getDefaultRender().extend([a],{beforeCreateDom:function(a,b){h.mix(b,{placeholderEl:"#ks-filter-menu-placeholder-{id}",filterInputWrap:"#ks-filter-menu-input-wrap-{id}",filterInput:"#ks-filter-menu-input-{id}"})},getKeyEventTarget:function(){return this.control.get("filterInput")},_onSetPlaceholder:function(a){this.control.get("placeholderEl").html(a)}},{ATTRS:{contentTpl:{value:e}},HTML_PARSER:{placeholderEl:function(a){return a.one("."+
this.getBaseCssClass("placeholder"))},filterInputWrap:function(a){return a.one("."+this.getBaseCssClass("input-wrap"))},filterInput:function(a){return a.one("."+this.getBaseCssClass("input"))}}})},{requires:["node","menu","./render-tpl","component/extension/content-render"]});
KISSY.add("filter-menu",function(h,i,g){var e=i.extend({bindUI:function(){this.get("filterInput").on("valuechange",this.handleFilterEvent,this)},handleMouseEnterInternal:function(){e.superclass.handleMouseEnterInternal.apply(this,arguments);this.view.getKeyEventTarget()[0].select()},handleFilterEvent:function(){var a;a=this.get("filterInput");var f=this.get("highlightedItem");this.set("filterStr",a.val());a=a.val();this.get("allowMultiple")&&(a=a.replace(/^.+,/,""));if(!a&&f)f.set("highlighted",!1);
else if(a&&(!f||!f.get("visible")))(f=this._getNextEnabledHighlighted(0,1))&&f.set("highlighted",!0)},_onSetFilterStr:function(a){this.filterItems(a)},filterItems:function(a){var f=this.get("prefixCls"),b=this.get("placeholderEl"),e=this.get("filterInput");b[a?"hide":"show"]();if(this.get("allowMultiple")){var b=[],d;d=a.match(/(.+)[,\uff0c]\s*([^\uff0c,]*)/);var c=[];d&&(c=d[1].split(/[,\uff0c]/));/[,\uff0c]$/.test(a)?(b=[],d&&(b=c,d=c[c.length-1],(c=(c=this.get("highlightedItem"))&&c.get("content"))&&
-1<c.indexOf(d)&&d&&(b[b.length-1]=c),e.val(b.join(",")+",")),a=""):(d&&(a=d[2]||""),b=c);this.get("enteredItems").length!=b.length&&this.set("enteredItems",b)}var e=this.get("children"),g=a&&RegExp(h.escapeRegExp(a),"ig");h.each(e,function(b){var c=b.get("content");a?-1<c.indexOf(a)?(b.set("visible",!0),b.get("el").html(c.replace(g,function(a){return"<span class='"+f+"menuitem-hit'>"+a+"</span>"}))):b.set("visible",!1):(b.get("el").html(c),b.set("visible",!0))})},reset:function(){this.set("filterStr",
"");this.set("enteredItems",[]);this.get("filterInput").val("")}},{ATTRS:{allowTextSelection:{value:!0},placeholder:{view:1},filterStr:{},enteredItems:{value:[]},allowMultiple:{value:!1},xrender:{value:g}},xclass:"filter-menu"});return e},{requires:["menu","filter-menu/render"]});
