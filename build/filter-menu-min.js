/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: Aug 14 18:44
*/
KISSY.add("filter-menu/render-tpl",'<div id="ks-filter-menu-input-wrap-{{id}}"\n     class="{{getBaseCssClasses "input-wrap"}}">\n    <div id="ks-filter-menu-placeholder-{{id}}"\n         class="{{getBaseCssClasses "placeholder"}}">\n        {{placeholder}}\n    </div>\n    <input id="ks-filter-menu-input-{{id}}"\n           class="{{getBaseCssClasses "input"}}"\n            autocomplete="off"/>\n</div>\n{{{include \'component/extension/content-render/content-tpl\'}}}');
KISSY.add("filter-menu/render",function(g,h,f,a,d){return f.getDefaultRender().extend([d],{beforeCreateDom:function(a,d){g.mix(d,{placeholderEl:"#ks-filter-menu-placeholder-{id}",filterInputWrap:"#ks-filter-menu-input-wrap-{id}",filterInput:"#ks-filter-menu-input-{id}"})},getKeyEventTarget:function(){return this.control.get("filterInput")},_onSetPlaceholder:function(a){this.control.get("placeholderEl").html(a)}},{ATTRS:{contentTpl:{value:a}},HTML_PARSER:{placeholderEl:function(a){return a.one("."+
this.getBaseCssClass("placeholder"))},filterInputWrap:function(a){return a.one("."+this.getBaseCssClass("input-wrap"))},filterInput:function(a){return a.one("."+this.getBaseCssClass("input"))}}})},{requires:["node","menu","./render-tpl","component/extension/content-render"]});
KISSY.add("filter-menu",function(g,h,f){return h.extend({bindUI:function(){this.get("filterInput").on("valuechange",this.handleFilterEvent,this)},handleMouseEnterInternal:function(a){this.callSuper(a);this.view.getKeyEventTarget()[0].select()},handleFilterEvent:function(){var a;a=this.get("filterInput");var d=this.get("highlightedItem");this.set("filterStr",a.val());a=a.val();this.get("allowMultiple")&&(a=a.replace(/^.+,/,""));if(!a&&d)d.set("highlighted",!1);else if(a&&(!d||!d.get("visible")))(d=
this._getNextEnabledHighlighted(0,1))&&d.set("highlighted",!0)},_onSetFilterStr:function(a){this.filterItems(a)},filterItems:function(a){var d=this.get("prefixCls"),b=this.get("placeholderEl"),f=this.get("filterInput");b[a?"hide":"show"]();if(this.get("allowMultiple")){var b=[],e;e=a.match(/(.+)[,\uff0c]\s*([^\uff0c,]*)/);var c=[];e&&(c=e[1].split(/[,\uff0c]/));/[,\uff0c]$/.test(a)?(b=[],e&&(b=c,e=c[c.length-1],(c=(c=this.get("highlightedItem"))&&c.get("content"))&&-1<c.indexOf(e)&&e&&(b[b.length-
1]=c),f.val(b.join(",")+",")),a=""):(e&&(a=e[2]||""),b=c);this.get("enteredItems").length!=b.length&&this.set("enteredItems",b)}var f=this.get("children"),h=a&&RegExp(g.escapeRegExp(a),"ig");g.each(f,function(b){var c=b.get("content");a?-1<c.indexOf(a)?(b.set("visible",!0),b.get("el").html(c.replace(h,function(a){return"<span class='"+d+"menuitem-hit'>"+a+"</span>"}))):b.set("visible",!1):(b.get("el").html(c),b.set("visible",!0))})},reset:function(){this.set("filterStr","");this.set("enteredItems",
[]);this.get("filterInput").val("")}},{ATTRS:{allowTextSelection:{value:!0},placeholder:{view:1},filterStr:{},enteredItems:{value:[]},allowMultiple:{value:!1},xrender:{value:f}},xclass:"filter-menu"})},{requires:["menu","filter-menu/render"]});
