/*
Copyright 2012, KISSY UI Library v1.30dev
MIT Licensed
build time: Mar 6 10:14
*/
KISSY.add("chart/anim",function(j){function n(d,c){this.duration=d*1E3;this.fnEasing=j.isString(c)?k[c]:c}var g=j.namespace("Chart"),k=j.Easing;j.augment(n,{init:function(){this.start=(new Date).getTime();this.finish=this.start+this.duration},get:function(){var d=(new Date).getTime();if(d>this.finish)return 1;return this.fnEasing((d-this.start)/this.duration)}});return g.Anim=n});
KISSY.add("chart/axis",function(j){function n(d,c,a){this.chart=c;this.type=d.type;this.data=d;this.axisData=d.axis();this.cfg=a;this.current_x=-1;this.initEvent();j.each(this.axisData,function(b){b.name="name"in b&&j.isString(b)&&b.name.length>0?"("+b.name+")":false});this.initdata(this.axisData,a)}var g=KISSY.namespace("Chart"),k=j.Event;j.mix(n,{getMax:function(d,c){var a=Math.ceil((c.height-c.paddingBottom-c.paddingTop)/40),b=d/a,e;if(b<=1)b=1;else if(b>1&&b<=5)b=Math.ceil(b);else if(b>5&&b<=
10)b=10;else{e=1;do{e*=10;b/=10}while(b>10);b=Math.ceil(b)*e}return b*a}});j.augment(n,j.EventTarget,{initYLabel:function(d,c){if(d.y.labels)return null;var a=Math.ceil((c.height-c.paddingBottom-c.paddingTop)/40),b=c.max/a,e=[];for(i=0;i<=a;i++)e.push(b*i);d.y.labels=e},initdata:function(d,c){this.initYLabel(d,c);var a=d.x,b=d.y,e=a.labels.length,f=b.labels.length,h=c.height,m=c.width-c.paddingRight,o=c.paddingLeft,p=h-c.paddingBottom,l=c.paddingTop,q=(p-l)/(f-1),r=m-o,s,u,w=Math.ceil(120*e/r);a._lpath=
{x:m*2-o,y:h-p+20};a._path=[];a._area=[];a._showlabel=[];for(i=0;i<e;i++){if(this.type==="line"){s=r/(e-1);h=o+i*s;u=i===0?h:h-s/2;s=i===e-1?h:h+s/2}else{s=r/e;h=o+(i+0.5)*s;u=h-s/2;s=h+s/2}a._showlabel.push(i===0||i%w===0);a._path.push({left:u,right:s,top:l,bottom:p,x:h});a._area.push(new g.RectPath(u,l,s-u,p-l))}b._lpath={x:(p-l)/2+l,y:-10};b._path=[];for(i=0;i<f;i++)b._path.push({y:p-q*i,left:o,right:m})},initEvent:function(){if(this.type==="line"){k.on(this.chart,g.Chart.MOUSE_MOVE,this.chartMouseMove,
this);k.on(this.chart,g.Chart.MOUSE_LEAVE,this.chartMouseLeave,this)}},destory:function(){if(this.type===ATYPE.LINE){k.remove(this.chart,g.Chart.MOUSE_MOVE,this.chartMouseMove);k.remove(this.chart,g.Chart.MOUSE_LEAVE,this.chartMouseLeave)}},chartMouseMove:function(d){var c=this;j.each(c.axisData.x._area,function(a,b){if(b!==c.current_x&&a.inpath(d.x,d.y)){c.current_x=b;c.fire("xaxishover",{index:b,x:c.axisData.x._path[b].x});c.fire("redraw");return false}})},chartMouseLeave:function(){this.current_x=
-1;this.fire("redraw");this.fire("leave")},draw:function(d,c){var a=this.data.config,b=this.data.axis(),e=b.x,f=b.y,h=e.labels.length,m=f.labels.length,o=this.type==="line",p=this.type==="bar",l,q;d.save();for(l=0;l<m;l++){q=f._path[l];b=f.labels[l];if(l%2===1&&l>0){d.save();d.globalAlpha=0.3;d.fillStyle=a.axisBackgroundColor;d.fillRect(q.left,q.y,q.right-q.left,f._path[l-1].y-q.y);d.restore()}if(l!==0&&l!==m-1){d.strokeStyle=a.axisGridColor;d.lineWidth="1.0";d.beginPath();d.moveTo(q.left,q.y);d.lineTo(q.right,
q.y);d.stroke()}if(b){d.font="12px Tohoma";d.textAlign="right";d.textBaseline="middle";d.fillStyle=a.axisTextColor;d.fillText(b,q.left-5,q.y)}}for(l=0;l<h;l++){m=l===this.current_x;f=e._path[l];b=e.labels[l];q=e._showlabel[l];d.strokeStyle=o&&m?"#404040":a.axisGridColor;d.lineWidth=o&&m?"1.6":"1.0";if(p)if(l!==0){d.beginPath();d.moveTo(f.left,f.bottom);d.lineTo(f.left,f.top);d.stroke()}if(o)if(l!==0&&l!==h-1){d.beginPath();d.moveTo(f.x,f.bottom);d.lineTo(f.x,f.top);d.stroke()}if(b&&q){d.font="13px Tahoma";
d.textAlign=o&&l===0?"left":o&&l===h-1?"right":"center";d.textBaseline="top";d.fillStyle=a.axisTextColor;d.fillText(b,f.x,f.bottom+5)}}if(this.current_x!==-1){f=e._path[this.current_x];b=e.labels[this.current_x];d.font="12px Tahoma";e=d.measureText(b).width+6;d.fillStyle="#333";h=Math.max(f.x-e/2,a.paddingLeft);h=Math.min(h,c.width-a.paddingRight-e);d.fillRect(h,f.bottom,e,20);d.textAlign="left";d.fillStyle="#ffffff";d.fillText(b,h+2,f.bottom+5)}d.restore();this.drawLabels(d)},drawLabels:function(d){var c=
this.data.axis(),a=c.y.name,b=c.x.name,e=c.x._lpath;c=c.y._lpath;d.save();d.font="10px Arial";d.fillStyle="#808080";d.textAlign="center";d.textBaseline="middle";b&&d.fillText(b,e.x,e.y);if(a){d.rotate(Math.PI/2);d.translate(c.x,c.y);d.fillText(a,0,0)}d.restore()}});return g.Axis=n});
KISSY.add("chart",function(j){function n(a,b){if(!(this instanceof n))return new n(a,b);var e=this.elCanvas=k.get(a);if(e){var f=e.width,h=e.height;this.elCanvas=e;this.width=f;this.height=h;this.ctx=-1;this.tooltip=n.getTooltip();this._chartAnim=new d.Anim(0.3,"easeIn");if(b){this.data=b;this._initContext()}}}var g=j.Event,k=j.DOM,d=j.namespace("Chart"),c={left:40,top:40};n.getTooltip=function(){if(!n.tooltip)n.tooltip=new d.SimpleTooltip;return n.tooltip};n.MOUSE_LEAVE="mouse_leave";n.MOUSE_MOVE=
"mouse_move";j.augment(n,j.EventTarget,{render:function(a){var b=this;if(b.ctx==-1){b.data=a;b._initContext()}else if(b.ctx===0)b.data=a;else{b._data=new d.Data(a);if(b._data){a=b._data;b.initChart();b._drawcfg=j.merge(c,a.config,{width:b.width,height:b.height});if(a.type==="bar"||a.type==="line"){b._drawcfg.max=a.axis().y.max||d.Axis.getMax(a.max(),b._drawcfg);b.axis=new d.Axis(a,b,b._drawcfg);b._frame=new d.Frame(b._data,b._drawcfg);b.layers.push(b.axis);b.layers.push(b._frame)}b.element=d.Element.getElement(b._data,
b,b._drawcfg);b.layers.push(b.element);a=a.config;var e=b.ctx.createLinearGradient(0,0,0,b.height);b.backgroundFillStyle=null;if(a.backgroundStyle&&typeof a.backgroundStyle==="object"){e.addColorStop(0,a.backgroundStyle.start);e.addColorStop(1,a.backgroundStyle.end);b.backgroundFillStyle=e}else if(j.isString(a.backgroundStyle))b.backgroundFillStyle=a.backgroundStyle;setTimeout(function(){b._redraw();b.initEvent()},100)}}},_initContext:function(){var a=this;if(typeof a.ctx!="object")if(a.elCanvas.getContext)setTimeout(function(){a.ctx=
a.elCanvas.getContext("2d");a._contextReady()},150);else{a.ctx=0;a._count=typeof a._count=="number"?a._count-1:30;if(a._count>=0)setTimeout(function(){a._initContext()},150);else{var b=k.create("<p class='ks-chart-error' > \u7cdf\u4e86\uff0c\u4f60\u7684\u6d4f\u89c8\u5668\u8fd8\u4e0d\u652f\u6301\u6211\u4eec\u7684\u56fe\u8868</p>");k.insertAfter(b,a.elCanvas)}}},_contextReady:function(){this.data&&this.render(this.data)},loading:function(){this.showMessage("\u8f7d\u5165\u4e2d...")},showMessage:function(a){var b=this.ctx,e=this.width/2,f=this.height/2;b.clearRect(0,0,this.width,this.height);b.save();
b.font="12px Arial";b.textAlign="center";b.fillStyle="#808080";b.fillText(a,e,f);b.restore()},initChart:function(){this._chartAnim.init();this.layers=[];this._updateOffset();this.loading();j.each([this.element,this.axis],function(a){if(a){a.destory();g.remove(a)}});this.axis=this.element=null;if(this._event_inited){g.remove(this.elCanvas,"mousemove",this._mousemoveHandle);g.remove(this.elCanvas,"mouseenter",this._mouseenterHandle);g.remove(this.elCanvas,"mouseleave",this._mouseLeaveHandle);g.remove(this,
n.MOUSE_LEAVE,this._drawAreaLeave)}this.tooltip.hide()},initEvent:function(){var a=this;a._event_inited=true;g.on(a.elCanvas,"mousemove",a._mousemoveHandle,a);g.on(a.elCanvas,"mouseenter",a._mouseenterHandle,a);g.on(a.elCanvas,"mouseleave",a._mouseLeaveHandle,a);g.on(a,n.MOUSE_LEAVE,a._drawAreaLeave,a);a.type==="bar"&&g.on(a.element,"barhover",a._barHover,a);if(a.axis){g.on(a.axis,"xaxishover",a._xAxisHover,a);g.on(a.axis,"leave",a._xAxisLeave,a);g.on(a.axis,"redraw",a._redraw,a)}g.on(a.element,"redraw",
a._redraw,a);g.on(a.element,"showtooltip",function(b){b=j.isString(b.message)?b.message:b.message.innerHTML;a.tooltip.show(b)});g.on(a.element,"hidetooltip",function(){a.tooltip.hide()})},draw:function(){var a=this.ctx,b=this._chartAnim.get(),e=this._drawcfg;a.save();a.globalAlpha=b;if(this.backgroundFillStyle){a.fillStyle=this.backgroundFillStyle;a.fillRect(0,0,e.width,e.height)}else a.clearRect(0,0,e.width,e.height);j.each(this.layers,function(f){f.draw(a,e)});a.restore();b<1&&this._redraw()},ctx:function(){if(this.ctx)return this.ctx;
if(this.elCanvas.getContext)return this.ctx=this.elCanvas.getContext("2d");else return null},_redraw:function(){this._redrawmark=true;this._running||this._run()},_run:function(){var a=this;clearTimeout(a._timeoutid);a._running=true;a._redrawmark=false;a._timeoutid=setTimeout(function(){a.draw();if(a._redrawmark)a._run();else a._running=false},1E3/24)},_barHover:function(){},_xAxisLeave:function(){this.fire("axisleave")},_xAxisHover:function(a){this.fire("axishover",{index:a.index,x:a.x});this._redraw()},
_drawAreaLeave:function(){this.tooltip.hide()},_mousemoveHandle:function(a){var b=a.pageX-this.offset.left;a=a.pageY-this.offset.top;this._frame&&this._frame.path&&this._frame.path.inpath(b,a)||!this._frame?this.fire(n.MOUSE_MOVE,{x:b,y:a}):this.fire(n.MOUSE_LEAVE)},_mouseenterHandle:function(){this._updateOffset()},_updateOffset:function(){return this.offset=k.offset(this.elCanvas)},_mouseLeaveHandle:function(a){var b=this.tooltip;(a=a.relatedTarget)&&(a===b.n_c[0]||b.n_c.contains(a))||this.fire(n.MOUSE_LEAVE)}});
return d.Chart=n},{requires:["chart/anim","chart/axis","chart/simpletooltip","chart/frame","chart/element","chart/element-bar","chart/element-line","chart/element-pie","chart/data"]});
KISSY.add("chart/color",function(j){var n=function(){var g=function a(b,e,f,h){var m=arguments.length;if(m<3){if(typeof b==="string"){b=b.substr(b.indexOf("#")+1);var o=b.length===3;b=parseInt(b,16);o&&(b=(b&3840)*4352|(b&240)*272|(b&15)*17)}m===2&&(h=e);e=(b&65280)/256;f=b&255;b>>>=16}if(!(this instanceof a))return new a(b,e,f,h);this.channels=[typeof b==="string"&&parseInt(b,16)||b,typeof e==="string"&&parseInt(e,16)||e,typeof f==="string"&&parseInt(f,16)||f,typeof h!=="string"&&typeof h!=="number"&&
1||typeof h==="string"&&parseFloat(h)||h]},k=g.prototype,d=Math,c;g.RGBtoHSL=function(a){var b=a[0],e=a[1];a=a[2];b/=255;e/=255;a/=255;var f=d.max(b,e,a),h=d.min(b,e,a),m,o=(f+h)/2;if(f===h)m=h=0;else{var p=f-h;h=o>0.5?p/(2-f-h):p/(f+h);switch(f){case b:m=(e-a)/p+(e<a?6:0);break;case e:m=(a-b)/p+2;break;case a:m=(b-e)/p+4}m/=6}return[m,h,o]};g.HSLtoRGB=function(a){var b=a[0],e=a[1],f=a[2];a=function(o,p,l){if(l<0)l+=1;if(l>1)l-=1;if(l<1/6)return o+(p-o)*6*l;if(l<0.5)return p;if(l<2/3)return o+(p-
o)*(2/3-l)*6;return o};if(e===0)e=f=b=f;else{var h=f<0.5?f*(1+e):f+e-f*e,m=2*f-h;e=a(m,h,b+1/3);f=a(m,h,b);b=a(m,h,b-1/3)}return[e*255,f*255,b*255]};g.rgb=function(a,b,e,f){return new g(a,b,e,typeof f!=="undefined"?f:1)};g.hsl=function(a,b,e,f){a=g.HSLtoRGB([a,b,e]);b=d.ceil;return new g(b(a[0]),b(a[1]),b(a[2]),typeof f!=="undefined"?f:1)};g.TO_STRING_METHOD="hexTriplet";g.parse=function(a){a=a.replace(/^\s+/g,"").toLowerCase();if(a[0]==="#")return new g(a);var b=a.substr(0,3),e;a=a.replace(/[^\d,.]/g,
"").split(",");for(e=a.length;e--;)a[e]=a[e]&&parseFloat(a[e])||0;switch(b){case "rgb":return g.rgb.apply(g,a);case "hsl":a[0]/=360;a[1]/=100;a[2]/=100;return g.hsl.apply(g,a)}return null};(g.clearColors=function(){c={transparent:[0,0,0,0]}})();g.define=function(a,b){c[a.toLowerCase()]=b};g.get=function(a){a=a.toLowerCase();if(Object.prototype.hasOwnProperty.call(c,a))return g.apply(null,[].concat(c[a]));return null};g.del=function(a){return delete c[a.toLowerCase()]};g.random=function(a,b){typeof a===
"string"&&(a=g.get(a))&&(a=a.getValue());typeof b==="string"&&(b=g.get(b))&&(b=b.getValue());var e=d.floor,f=d.random;b=(b||16777215)+1;if(!isNaN(a))return new g(e(f()*(b-a)+a));return new g(e(f()*b))};k.toString=function(){return this[g.TO_STRING_METHOD]()};k.valueOf=k.getValue=function(){var a=this.channels;return a[0]*65536|a[1]*256|a[2]};k.setValue=function(a){this.channels.splice(0,3,a>>>16,(a&65280)/256,a&255)};k.hexTriplet="01".substr(-1)==="1"?function(){return"#"+("00000"+this.getValue().toString(16)).substr(-6)}:
function(){var a=this.getValue().toString(16);return"#"+Array(a.length<6?6-a.length+1:0).join("0")+a};k.css=function(){return this.channels[3]===1?this.hexTriplet():this.rgba()};k.rgbData=function(){return this.channels.slice(0,3)};k.hslData=function(){return g.RGBtoHSL(this.rgbData())};k.rgb=function(){return"rgb("+this.rgbData().join(",")+")"};k.rgba=function(){return"rgba("+this.channels.join(",")+")"};k.hsl=function(){var a=this.hslData();return"hsl("+a[0]*360+","+a[1]*100+"%,"+a[2]*100+"%)"};
k.hsla=function(){var a=this.hslData();return"hsla("+a[0]*360+","+a[1]*100+"%,"+a[2]*100+"%,"+this.channels[3]+")"};return g}();return j.namespace("Chart").Color=n});KISSY.add("chart/colors",function(j){j.namespace("Chart").colors=[{c:"#00b0f0"},{c:"#FF4037"},{c:"#39B54A"},{c:"#FEF56F"},{c:"#c821ac"},{c:"#D1EB53"}]});
KISSY.add("chart/data",function(j){function n(a){if(a&&a.type){if(!this instanceof n)return new n(a);var b=a.config;this.origin=a;a=j.clone(a);this.type=a.type.toLowerCase();this.config=b=j.merge(k,d[this.type],b);j.each({left:"paddingLeft",top:"paddingTop",bottom:"paddingBottom",right:"paddingRight"},function(e,f){if(f in b&&j.isNumber(b[f]))b[e]=b[f]});this._elements=this._initElement(a);this._elements=this._expandElement(this._elements);this._initElementItem();this._axis=a.axis}}var g=j.namespace("Chart"),
k={paddingTop:30,paddingLeft:20,paddingRight:20,paddingBottom:20,showLabels:true,colors:[],animationDuration:0.5,animationEasing:"easeInStrong",backgroundStyle:false,axisTextColor:"#999",axisBackgroundColor:"#EEE",axisGridColor:"#e4e4e4",numberFormat:false,frameColor:"#d7d7d7"},d={line:{drawbg:-1},bar:{},pie:{animationDuration:1.8,animationEasing:"bounceOut",paddingTop:10,paddingBottom:10,paddingLeft:10,paddingRight:10,shadow:true,labelTemplete:"{name} {pecent}%",firstPieOut:false}},c={"default":{label:"{name} -  {data}"},
line:{},pie:{},bar:{}};j.augment(n,{axis:function(){return this._axis},elements:function(){return this._elements},maxElementLength:function(){var a=0;j.each(this._elements,function(b){a=j.isArray(b.items)?Math.max(a,b.items.length):Math.max(a,1)});return a},getColor:function(a,b){var e=this._elements.length,f=this.config.colors;if(j.isArray(f)&&f[a])return f[a];if(j.isFunction(f))return f(a);return this.getDefaultColor(a,e,b)},sum:function(){var a=0;this.eachElement(function(b){a+=b.data});return a},
max:function(){return this._max},getDefaultColor:function(a,b){var e=1/3,f=e*a,h,m;if(a<3)f=e*a+0.05;else{if(b%3==0)if(a===b-1)a=b-2;else if(a===b-2)a=b-1;f=a%3;h=Math.ceil(b/3);m=Math.ceil((a+1)/3);f=f*e+e/h*(m-1)}return g.Color.hsl(f,0.7,0.65).hexTriplet()},eachElement:function(a){j.each(this._elements,function(b,e){b.items?j.each(b.items,function(f,h){a(f,e,h)}):a(b,e,-1)})},_initElementItem:function(){var a=this;a._max=null;a.eachElement(function(b,e,f){if(e===0&&!f)a._max=b.data||0;f=j.merge(c["default"],
c[a.type]||{});b.data=j.isNumber(b.data)?b.data:0;if(j.isArray(a.config.numberFormats))b.format=a.config.numberFormats[e];if(typeof b.format=="undefined")b.format=a.config.numberFormat;b.label=b.label||f.label;b.label=j.substitute(b.label,{name:b.name,data:b.format?g.format(b.data,b.format):b.data});a._max=Math.max(a._max,b.data)})},_expandElement:function(a){var b;j.each(a,function(e){if(j.isArray(e.datas)){e.items=e.items||[];j.each(e.datas,function(f,h){b={name:e.name,data:f};if(e.label)b.label=
e.label;if(e.labels&&j.isString(e.labels[h]))b.label=e.labels[h];delete e.datas;e.items.push(b)})}});return a},_initElement:function(a){var b=null,e,f=this;if(a.elements&&j.isArray(a.elements))b=j.clone(a.elements);if(!a.elements&&a.element&&j.isArray(a.element.names)){b=[];e=a.element;j.each(e.names,function(h,m){b.push({name:h,data:f._getLabel(e.datas,m),label:f._getLabel(e.labels,m)||e.label})})}return b},_getLabel:function(a,b){return j.isArray(a)?b<a.length?a[b]:null:false}});return g.Data=n},
{requires:["chart/color"]});
KISSY.add("chart/element",function(j){function n(){}var g=j.namespace("Chart");j.mix(n,{getElement:function(k,d,c){var a;switch(k.type){case "line":a=g.LineElement;break;case "pie":a=g.PieElement;break;case "bar":a=g.BarElement}return new a(k,d,c)},getMax:function(k){var d=k[0].data[0],c,a=k.length,b,e;for(c=0;c<a;c++){element=k[c];b=0;for(e=element.data.length;b<e;b++)d=Math.max(d,element.data[b]||0)}return d}});j.augment(n,j.EventTarget,{drawNames:function(k){var d=this.drawcfg,c=this.data.elements(),
a=c.length-1,b=d.width-d.paddingRight;d=d.paddingTop-12;for(var e,f;a>=0;a--){e=c[a];if(!e.notdraw){f=this.data.getColor(a);k.save();k.textAlign="end";k.textBaseline="middle";k.fillStyle="#808080";k.font="12px Arial";k.fillText(e.name,b,d);b-=k.measureText(e.name).width+10;k.restore();k.save();k.beginPath();k.fillStyle=f;k.arc(b,d,5,0,Math.PI*2,true);k.closePath();k.fill();k.restore();b-=10}}},init:function(){},initdata:function(){},destory:function(){},draw:function(){},drawBar:function(){},getTooltip:function(){}});
return g.Element=n});
KISSY.add("chart/element-bar",function(j){function n(d,c,a){this.data=d;this.chart=c;this.drawcfg=a;this.config=d.config;this.initData(a);this.initEvent();this.current=[-1,-1];this.anim=new g.Anim(this.config.animationDuration,this.config.animationEasing);this.anim.init()}var g=j.namespace("Chart"),k=j.Event;j.extend(n,g.Element,{initData:function(d){var c=this,a=c.data,b=a.elements().length;a=a.maxElementLength();var e=d.paddingLeft,f=d.height-d.paddingBottom,h=(d.width-d.paddingRight-e)/a,m=h/5/
b,o=h/3/b,p=(h-(b-1)*m-2*o)/b,l,q,r,s,u=[];c.maxLength=a;c.items=u;c.data.eachElement(function(w,v,t){if(t===-1)t=0;u[v]||(u[v]={_x:[],_top:[],_left:[],_path:[],_width:[],_height:[],_colors:[],_dcolors:[],_labels:[]});var y=u[v];l=(f-d.top)*w.data/d.max;q=e+t*h+o+v*(p+m);r=f-l;s=g.Color(c.data.getColor(v,"bar"));v=s.hslData();var z=v[2],A=v[1];z=(z+A/2)*0.6-A/2;colord=new g.Color.hsl(v[0],A,z);y._left[t]=q;y._top[t]=r;y._width[t]=p;y._height[t]=l;y._path[t]=new g.RectPath(q,r,p,l);y._x[t]=q+p/2;y._colors[t]=
s;y._dcolors[t]=colord;y._labels[t]=w.label})},draw:function(d){var c=this,a=c.items,b=c.maxLength,e,f,h,m,o,p,l=c.anim.get(),q;c.data.config.showLabels&&c.drawNames(d);j.each(a,function(r,s){for(q=0;q<b;q++){o=r._left[q];h=r._height[q];m=h*l;p=r._top[q]+h-m;barwidth=r._width[q];e=r._colors[q];dcolor=r._dcolors[q];f=d.createLinearGradient(o,p,o,p+m);f.addColorStop(0,e.css());f.addColorStop(1,dcolor.css());d.fillStyle=f;d.fillRect(o,p,barwidth,m);if(b===1&&h>25){d.save();d.fillStyle="#fff";d.font=
"20px bold Arial";d.textBaseline="top";d.textAlign="center";a=c.data.elements()[s];d.fillText(g.format(a.data,a.format),r._x[q],p+2);d.restore()}}});l<1&&c.fire("redraw")},initEvent:function(){k.on(this.chart,g.Chart.MOUSE_MOVE,this.chartMouseMove,this);k.on(this.chart,g.Chart.MOUSE_LEAVE,this.chartMouseLeave,this)},destory:function(){k.remove(this.chart,g.Chart.MOUSE_MOVE,this.chartMouseMove);k.remove(this.chart,g.Chart.MOUSE_LEAVE,this.chartMouseLeave)},chartMouseMove:function(d){var c=[-1,-1],
a=this.items;j.each(this.items,function(b,e){j.each(b._path,function(f,h){if(f.inpath(d.x,d.y))c=[e,h]})});if(!(c[0]===this.current[0]&&c[1]===this.current[1])){this.current=c;if(c[0]+c[1]>=0){this.fire("barhover",{index:c});this.fire("showtooltip",{top:a[c[0]]._top[c[1]],left:a[c[0]]._x[c[1]],message:this.getTooltip(c)})}else this.fire("hidetooltip")}},chartMouseLeave:function(){this.current=[-1,-1]},getTooltip:function(d){var c=d[1];d=this.items[d[0]];return"<div class='bartip'><span style='color:"+
d._colors[c].css()+";'>"+d._labels[c]+"</span></div>"}});return g.BarElement=n},{requires:["chart/element"]});
KISSY.add("chart/element-line",function(j){function n(d,c,a){this.chart=c;this.data=d;this.elements=d.elements();this._current=-1;this.config=d.config;this.drawcfg=a;this.initdata(a);this._ready_idx=-1;this.init();this.anim=new g.Anim(this.config.animationDuration,this.config.animationEasing);this.anim.init()}var g=j.namespace("Chart"),k=j.Event;j.extend(n,g.Element,{initdata:function(d){var c=this.data,a=c.maxElementLength(),b=d.paddingLeft,e=d.height-d.paddingBottom,f=e-d.paddingTop,h=(d.width-
d.paddingRight-b)/(a-1),m=[];this.items=m;c.eachElement(function(o,p,l){m[p]||(m[p]={_points:[],_labels:[],_color:c.getColor(p),_maxtop:e,_drawbg:p===c.config.drawbg});p=m[p];ptop=Math.max(e-o.data/d.max*f,d.paddingTop-5);p._maxtop=Math.min(p._maxtop,ptop);p._labels[l]=o.label;p._points[l]={x:b+h*l,y:ptop,bottom:e}})},draw:function(d,c){var a=this,b=a.data,e=c.paddingLeft,f=c.width-c.paddingRight,h=c.height-c.paddingBottom,m,o,p,l,q,r,s=a.anim.get(),u;b.config.showLabels&&a.drawNames(d,c);if(s>=1&&
this._ready_idx<a.items.length-1){a._ready_idx++;a.anim.init();s=a.anim.get()}if(this._ready_idx!==b.elements().length-1||s!==1)this.fire("redraw");j.each(a.items,function(w,v){var t;r=v!==a._ready_idx?v>a._ready_idx?0:1:s;m=w._color;p=w._points;if(w._drawbg){d.save();d.globalAlpha=0.4;maxtop=h-(h-w._maxtop)*r;u=d.createLinearGradient(e,maxtop,e,h);u.addColorStop(0,m);u.addColorStop(1,"rgb(255,255,255)");d.fillStyle=u;d.beginPath();d.moveTo(e,h);for(l=0;l<p.length;l++){t=p[l];o=h-(h-t.y)*r;d.lineTo(t.x,
o)}d.lineTo(f,h);d.stroke();d.fill();d.restore()}d.save();q=p.length;d.strokeStyle=m;d.lineWidth=2;d.beginPath();for(l=0;l<q;l++){t=p[l];o=h-(h-t.y)*r;l===0?d.moveTo(t.x,o):d.lineTo(t.x,o)}d.stroke();d.restore();d.save();for(l=0;l<q;l++){t=p[l];o=h-(h-t.y)*r;d.fillStyle=m;d.beginPath();d.arc(t.x,o,5,0,Math.PI*2,true);d.closePath();d.fill();if(l!==a._current){d.fillStyle="#fff";d.beginPath();d.arc(t.x,o,3,0,Math.PI*2,true);d.closePath();d.fill()}}d.restore()})},init:function(){this._ready_idx=0;k.on(this.chart,
"axishover",this._axis_hover,this);k.on(this.chart,"axisleave",this._axis_leave,this)},destory:function(){k.remove(this.chart,"axishover",this._axis_hover);k.remove(this.chart,"axisleave",this._axis_leave)},_axis_hover:function(d){d=d.index;if(this._current!==d){this._current=d;this.fire("redraw");this.fire("showtooltip",{message:this.getTooltip(d)})}},_axis_leave:function(){this._current=-1;this.fire("redraw")},getTooltip:function(d){var c,a;c="<ul>";j.each(this.items,function(b){a="<li><p style='color:"+
b._color+"'>"+b._labels[d]+"</p></li>";c+=a});c+="</ul>";return c}});return g.LineElement=n},{requires:["chart/element"]});
KISSY.add("chart/element-pie",function(j){function n(c,a,b){this.data=c;this.chart=a;this.type=0;this.config=c.config;this.drawcfg=b;this.initdata(b);this.init();this.anim=new g.Anim(this.config.animationDuration,this.config.animationEasing);this.anim.init()}var g=j.namespace("Chart"),k=j.Event,d=function(c){if(j.isString(c))c=g.Color(c);c=c.hslData();var a=c[1],b=c[2];b=(b+a*0.5)*1.05-a*0.5;return new g.Color.hsl(c[0],a,b)};j.extend(n,g.Element,{initdata:function(c){var a=this,b=a.data,e=0,f,h,m,
o;a._x=b.config.showLabels?c.width*0.618/2:c.width/2;a._y=c.height/2;a._r=Math.min(c.height-c.paddingTop-c.paddingBottom,c.width-c.paddingLeft-c.paddingRight)/2;a._r=Math.min(a._r,a._x-c.paddingLeft);a._lx=c.width*0.618;a.angleStart=-Math.PI/4;a.antiClock=true;a.items=[];a._currentIndex=-1;e=b.sum();o=0;j.each(b.elements(),function(p,l){m=p.data/e;f=o+m;h=b.getColor(l);a.items.push({start:o,end:f,color:h,color2:d(h).css(),textColor:"#999",labelRight:c.width-50,labelY:50+20*l});o=f;if(l===0)a.angleStart+=
m*Math.PI})},drawLabels:function(c){var a=this,b=a.data,e=a.items,f,h=b.sum(),m,o,p;c.save();c.textBaseline="middle";c.textAlign="right";b.eachElement(function(l,q){f=e[q];p=f.labelY;o=f.labelRight;c.fillStyle=e[q].color;c.beginPath();c.moveTo(o,p);c.font="15px sans-serif";c.fillRect(o-10,p-5,10,10);c.closePath();c.fillStyle=e[q].textColor;m=j.substitute(a.data.config.labelTemplete,{data:g.format(l.data,l.format),name:l.name,pecent:g.format(l.data/h*100,"0.00")});c.fillText(m,o-15,p)});c.restore()},
draw:function(c){var a=this,b=a._x,e=a._y,f=a._r,h,m,o,p,l=a.anim.get(),q=a.data.config;l<1&&a.fire("redraw");q.showLabels&&a.drawLabels(c);if(q.shadow){c.save();c.fillStyle="#fff";c.shadowBlur=10;c.shadowColor="black";c.beginPath();c.moveTo(b,e);o=a.angleStart;p=a.antiClock?o-Math.PI*2*l:o+Math.PI*2*l;c.arc(b,e,f-1,o,p,a.antiClock);c.fill();c.restore()}c.save();c.lineWidth=0.5;c.strokeStyle="#fff";j.each(a.items,function(r,s){h=r.start*l*2*Math.PI;m=r.end*l*2*Math.PI;c.save();c.fillStyle=s===a._currentIndex?
r.color2:r.color;c.beginPath();r._currentStart=a.antiClock?a.angleStart-h:a.angleStart+h;r._currentEnd=a.antiClock?a.angleStart-m-0.0050:a.angleStart+m+0.0050;if(s===0&&l>=1&&q.firstPieOut){c.moveTo(b+2,e-2);c.arc(b+2,e-2,f,r._currentStart,r._currentEnd,a.antiClock)}else{c.moveTo(b,e);c.arc(b,e,f,r._currentStart,r._currentEnd,a.antiClock)}c.closePath();c.fill();c.stroke();c.restore()});c.restore()},init:function(){k.on(this.chart,g.Chart.MOUSE_MOVE,this.chartMouseMove,this);k.on(this.chart,g.Chart.MOUSE_LEAVE,
this.chartMouseLeave,this)},destory:function(){k.remove(this.chart,g.Chart.MOUSE_MOVE,this.chartMouseMove);k.remove(this.chart,g.Chart.MOUSE_LEAVE,this.chartMouseLeave)},chartMouseMove:function(c){var a=this._r,b=c.x-this._x,e=c.y-this._y,f;c=this.items;if(b*b+e*e>a*a){this.fire("hidetooltip");this._currentIndex=-1;this.fire("redraw")}else{if(b!=0){a=Math.atan(e/b);if(e<0&&b>0)a+=2*Math.PI;if(b<0)a+=Math.PI}else a=e>=0?Math.PI/2:3*Math.PI/2;for(i=c.length-1;i>=0;i--){e=c[i];b=e._currentStart;e=e._currentEnd;
if(b>e){f=b;b=e;e=f}f=e-b;b%=Math.PI*2;if(b<0)if(b+f<0||a>Math.PI)b+=Math.PI*2;if(a>b&&a<b+f&&i!==this._currentIndex){this._currentIndex=i;this.fire("redraw");this.fire("showtooltip",{message:this.data.elements()[i].label})}}}},chartMouseLeave:function(){this._currentIndex=-1;this.fire("hidetooltip");this.fire("redraw")}});return g.PieElement=n},{requires:["chart/element"]});
KISSY.add("chart/format",function(j){var n=function(g,k){if(typeof k==="string"){var d=-1<k.indexOf(","),c=k.split(".");if(1<c.length)g=g.toFixed(c[1].length);else if(2<c.length)throw"NumberFormatException: invalid format, formats should have no more than 1 period:"+k;else g=g.toFixed(0);var a=g.toString();if(d){c=a.split(".");d=c[0];a=[];for(var b=d.length,e=Math.floor(b/3),f=d.length%3||3,h=0;h<b;h+=f){if(h!=0)f=3;a[a.length]=d.substr(h,f);e-=1}a=a.join(",");if(c[1])a+="."+c[1]}return k.replace(/[\d,?\.?]+/,
a)}};return j.namespace("Chart").format=n});KISSY.add("chart/frame",function(j){function n(k,d){this.data=k;this.path=new g.RectPath(d.paddingLeft,d.paddingTop,d.width-d.paddingRight-d.paddingLeft,d.height-d.paddingBottom-d.paddingTop)}var g=j.namespace("Chart");j.augment(n,{draw:function(k){k.save();k.strokeStyle=this.data.config.frameColor;k.lineWidth=2;this.path.draw(k);k.stroke();k.restore()}});return g.Frame=n});
KISSY.add("chart/path",function(j){function n(){}function g(c,a,b,e){this.rect={x:c,y:a,w:b,h:e}}function k(c,a,b,e,f,h){this._arc={x:c,y:a,r:b,b:e,e:f,a:h}}var d=j.namespace("Chart");j.augment(n,{draw:function(){},inpath:function(){}});j.extend(g,n,{draw:function(c){var a=this.rect;c.beginPath();c.rect(a.x,a.y,a.w,a.h)},inpath:function(c,a){var b=this.rect,e=b.x,f=b.y,h=e+b.w;b=f+b.h;return c>e&&c<h&&a>f&&a<b}});j.extend(k,n,{draw:function(c){var a=this._arc;c.beginPath();c.moveTo(a,x,a.y);c.arc(a.x,
a.y,a.r,a.b,a.e,a.a);c.closePath()},inpath:function(c,a,b){if(b){this.draw(b);return b.isPointInPath(c,a)}a=this._arc;b=c-a.x;c=c-a.y;if(!(Math.pow(b,2)+Math.pow(c,2)<=Math.pow(a.r,2)))return false;if(b===0)if(c===0)return false;else da=c>0?Math.PI/2:Math.PI*1.5}});d.Path=n;d.RectPath=g;d.ArcPath=k;return{Path:n,RectPath:g,ArcPath:k}});
KISSY.add("chart/simpletooltip",function(j){function n(){var c=this;this.el_c=k.create("<div class='ks-chart-tooltip'>");this.n_c=j.one(this.el_c);this._offset={left:0,top:0};this.hide();j.ready(function(){document.body.appendChild(c.el_c)});d.on(document.body,"mousedown",this._mousemove,this);d.on(document.body,"mousemove",this._mousemove,this)}var g=j.namespace("Chart"),k=j.DOM,d=j.Event;j.augment(n,{_mousemove:function(c){var a=c.pageX;c=c.pageY;if(this._show)this._updateOffset(a,c);else{this._offset.left=
a;this._offset.top=c}},_updateOffset:function(c,a){if(c>k.scrollLeft()+k.viewportWidth()-100)c-=this.n_c.width()+6;if(a>k.scrollTop()+k.viewportHeight()-100)a-=this.n_c.height()+20;this.n_c.offset({left:c,top:a+12})},show:function(c){this._show=true;this.n_c.html(c).css("display","block").offset(this._offset)},hide:function(){this._show=false;this.n_c.css("display","none")},_init:function(){}});return g.SimpleTooltip=n});
