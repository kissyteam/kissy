/*
Copyright 2012, KISSY UI Library v1.30dev
MIT Licensed
build time: Jun 19 14:23
*/
KISSY.add("tree/base",function(d,c,e,f,a){return e.extend([c.DelegateChildren,a],{expandAll:function(){return e.prototype.expandAll.apply(this,arguments)}},{ATTRS:{xrender:{value:f}}},{xclass:"tree",priority:30})},{requires:["component","./basenode","./treeRender","./treemgr"]});
KISSY.add("tree/basenode",function(d,c,e,f){var a=c.all,b=c.KeyCodes,k=e.Controller.extend([e.DecorateChild],{_keyNav:function(j){var a=!0,d,c=this.get("children");switch(j.keyCode){case b.HOME:d=this.get("tree");break;case b.END:d=this.get("tree").getLastVisibleDescendant();break;case b.UP:d=this.getPreviousVisibleNode();break;case b.DOWN:d=this.getNextVisibleNode();break;case b.LEFT:this.get("expanded")&&(c.length||!1===this.get("isLeaf"))?this.set("expanded",!1):d=this.get("parent");break;case b.RIGHT:if(c.length||
!1===this.get("isLeaf"))this.get("expanded")?c[0].select():this.set("expanded",!0);break;default:a=!1}d&&d.select();return a},getLastVisibleDescendant:function(){var a=this.get("children");return!this.get("expanded")||!a.length?this:a[a.length-1].getLastVisibleDescendant()},getNextVisibleNode:function(){var a=this.get("children"),g=this.get("parent");if(this.get("expanded")&&a.length)return a[0];for(a=this.next();g&&!a;)a=g.next(),g=g.get("parent");return a},getPreviousVisibleNode:function(){var a=
this.prev();return a=a?a.getLastVisibleDescendant():this.get("parent")},next:function(){var a=this.get("parent");if(!a)return null;var a=a.get("children"),g=d.indexOf(this,a);return g==a.length-1?null:a[g+1]},prev:function(){var a=this.get("parent");if(!a)return null;var a=a.get("children"),g=d.indexOf(this,a);return 0===g?null:a[g-1]},select:function(){this.get("tree").set("selectedItem",this)},performActionInternal:function(j){var g=a(j.target),b=this.get("tree"),d=this.get("view");b.get("el")[0].focus();
g.equals(d.get("expandIconEl"))?"dblclick"!=j.type&&this.set("expanded",!this.get("expanded")):"dblclick"==j.type?this.set("expanded",!this.get("expanded")):(this.select(),b.fire("click",{target:this}))},decorateChildrenInternal:function(a,b){this.addChild(new a({srcNode:b,tree:this.get("tree"),prefixCls:this.get("prefixCls")}))},addChild:function(a){var b=this.get("tree");a.__set("tree",b);a.__set("depth",this.get("depth")+1);k.superclass.addChild.call(this,a);this._updateRecursive();b._register(a);
d.each(a.get("children"),function(a){b._register(a)})},_computeClass:function(a){this.get("view")._computeClass(this.get("children"),this.get("parent"),a)},_updateRecursive:function(){var a=this.get("children").length;this._computeClass("_updateRecursive");d.each(this.get("children"),function(b,d){b._computeClass("_updateRecursive_children");b.get("view").set("ariaPosInSet",d+1);b.get("view").set("ariaSize",a)})},removeChild:function(a){var b=this.get("tree");b._unRegister(a);d.each(a.get("children"),
function(a){b._unRegister(a)});k.superclass.removeChild.apply(this,d.makeArray(arguments));this._updateRecursive()},_uiSetExpanded:function(a){var b=this.get("tree");this._computeClass("expanded-"+a);a?b.fire("expand",{target:this}):b.fire("collapse",{target:this})},expandAll:function(){this.set("expanded",!0);d.each(this.get("children"),function(a){a.expandAll()})},collapseAll:function(){this.set("expanded",!1);d.each(this.get("children"),function(a){a.collapseAll()})}},{ATTRS:{xrender:{value:f},
handleMouseEvents:{value:!1},isLeaf:{view:1},expandIconEl:{view:1},iconEl:{view:1},selected:{view:1},expanded:{view:1},tooltip:{view:1},tree:{},depth:{view:1},focusable:{value:!1},decorateChildCls:{value:"ks-tree-children"}}},{xclass:"tree-item",priority:10});return k},{requires:["node","component","./basenodeRender"]});
KISSY.add("tree/basenodeRender",function(d,c,e){var f=c.all;return e.Render.extend({_computeClass:function(a,b){var c=this.get("expanded"),e=this.get("isLeaf"),g=this.get("iconEl"),f=this.get("expandIconEl"),l=this.get("childrenEl"),h="ks-tree-icon ks-tree-expand-icon ",n=["ks-tree-icon",c?"ks-tree-expanded-folder-icon":"ks-tree-collapsed-folder-icon",""].join(" ")+" ks-inline-block",i=b&&b.get("children")[b.get("children").length-1],i=!b||!i||i.get("view")==this;!1===e||void 0===e&&a.length?(g.attr("class",
n),f.attr("class",d.substitute(c?h+"ks-tree-expand-icon-{t}minus":h+"ks-tree-expand-icon-{t}plus",{t:i?"l":"t"})+" ks-inline-block")):(g.attr("class","ks-tree-icon ks-tree-file-icon  ks-inline-block"),f.attr("class",d.substitute(h+"ks-tree-expand-icon-{t}",{t:i?"l":"t"})+" ks-inline-block"));l&&l.attr("class",i?"ks-tree-lchildren":"ks-tree-children")},createDom:function(){var a=this.get("el"),b,c,e=this.get("contentEl");c=f("<div class='ks-tree-item-row'/>");b=d.guid("tree-item");this.__set("rowEl",
c);var g=f("<div/>").appendTo(c),m=f("<div />").appendTo(c);e.appendTo(c);a.attr({role:"treeitem","aria-labelledby":b}).prepend(c);this.__set("expandIconEl",g);this.__set("iconEl",m)},_uiSetExpanded:function(a){var b=this.get("childrenEl");b&&(a?a&&b.show():b.hide());this.get("el").attr("aria-expanded",a)},_uiSetSelected:function(a){var b=this.getComponentCssClassWithState("-selected");this.get("rowEl")[a?"addClass":"removeClass"](b);this.get("el").attr("aria-selected",a)},_uiSetDepth:function(a){this.get("el").attr("aria-level",
a)},_uiSetAriaSize:function(a){this.get("el").attr("aria-setsize",a)},_uiSetAriaPosInSet:function(a){this.get("el").attr("aria-posinset",a)},_uiSetTooltip:function(a){this.get("el").attr("title",a)},getContentElement:function(){if(this.get("childrenEl"))return this.get("childrenEl");var a=f("<div "+(this.get("expanded")?"":"style='display:none'")+" role='group'></div>").appendTo(this.get("el"));this.__set("childrenEl",a);return a}},{ATTRS:{ariaSize:{},ariaPosInSet:{},childrenEl:{},expandIconEl:{},
tooltip:{},iconEl:{},expanded:{value:!1},rowEl:{},depth:{value:0},contentEl:{valueFn:function(){return f("<span id='"+d.guid("tree-item")+"' class='ks-tree-item-content'/>")}},isLeaf:{},selected:{}},HTML_PARSER:{childrenEl:function(a){return a.children(".ks-tree-children")},contentEl:function(a){return a.children(".ks-tree-item-content")},isLeaf:function(a){if(a.hasClass(this.getCssClassWithPrefix("tree-item-leaf")))return!0;if(a.hasClass(this.getCssClassWithPrefix("ks-tree-item-folder")))return!1},
expanded:function(a){a=a.one(".ks-tree-children");return!a?!1:"none"!=a.css("display")}}})},{requires:["node","component","dom"]});
KISSY.add("tree/checknode",function(d,c,e,f){var a=c.all,b=e.extend({expandAll:function(){return b.superclass.expandAll.apply(this,arguments)},performActionInternal:function(b){this.get("tree").get("el")[0].focus();var c=a(b.target),d=this.get("view"),e=this.get("tree");if("dblclick"==b.type){if(c.equals(d.get("expandIconEl"))||c.equals(d.get("checkEl")))return;this.set("expanded",!this.get("expanded"))}c.equals(d.get("expandIconEl"))?this.set("expanded",!this.get("expanded")):(b=this.get("checkState"),
this.set("checkState",1==b?0:1),e.fire("click",{target:this}))},_uiSetCheckState:function(a){(1==a||0==a)&&d.each(this.get("children"),function(b){b.set("checkState",a)});var b=this.get("parent");if(b){for(var c=0,e=b.get("children"),f=0;f<e.length;f++){var h=e[f].get("checkState");if(2==h){b.set("checkState",2);return}1==h&&c++}c==e.length?b.set("checkState",1):0===c?b.set("checkState",0):b.set("checkState",2)}}},{ATTRS:{checkState:{view:1},xrender:{value:f}}},{xclass:"tree-check-item",priority:20});
d.mix(b,{PARTIAL_CHECK:2,CHECK:1,EMPTY:0});return b},{requires:["node","./basenode","./checknodeRender"]});
KISSY.add("tree/checknodeRender",function(d,c,e){var f=c.all;return e.extend({createDom:function(){var a=this.get("expandIconEl");this.__set("checkEl",f("<div class='ks-tree-icon ks-inline-block'/>").insertAfter(a))},_uiSetCheckState:function(a){this.get("checkEl").removeClass(this.getCssClassWithPrefix("tree-item-checked0 tree-item-checked1 tree-item-checked2")).addClass(this.getCssClassWithPrefix("tree-item-checked"+a))}},{ATTRS:{checkEl:{},checkState:{value:0}}})},{requires:["node","./basenodeRender"]});
KISSY.add("tree/checktree",function(d,c,e,f,a){var b=e.extend([c.DelegateChildren,a],{expandAll:function(){return b.superclass.expandAll.apply(this,arguments)}},{ATTRS:{xrender:{value:f}}},{xclass:"check-tree",priority:40});return b},{requires:["component","./checknode","./checktreeRender","./treemgr"]});KISSY.add("tree/checktreeRender",function(d,c,e){return c.extend([e])},{requires:["./checknodeRender","./treemgrRender"]});
KISSY.add("tree",function(d,c,e,f,a){c.Node=e;c.CheckNode=f;c.CheckTree=a;return c},{requires:["tree/base","tree/basenode","tree/checknode","tree/checktree"]});KISSY.add("tree/treeRender",function(d,c,e){return c.extend([e])},{requires:["./basenodeRender","./treemgrRender"]});
KISSY.add("tree/treemgr",function(d,c){function e(){}function f(a){var a=a.get("el"),b=a.attr("id");b||a.attr("id",b=d.guid("tree-node"));return b}e.ATTRS={showRootNode:{value:!0,view:1},selectedItem:{},tree:{valueFn:function(){return this}},focusable:{value:!0}};d.augment(e,{__getAllNodes:function(){this._allNodes||(this._allNodes={});return this._allNodes},__renderUI:function(){this.get("children").length||this._computeClass("root_renderUI")},_register:function(a){this.__getAllNodes()[f(a)]=a},
_unRegister:function(a){delete this.__getAllNodes()[f(a)]},handleKeyEventInternal:function(a){var b=this.get("selectedItem");return a.keyCode==c.KeyCodes.ENTER?b.performActionInternal(a):b._keyNav(a)},getOwnerControl:function(a){for(var b,c=this.__getAllNodes(),d=this.get("el")[0];a&&a!==d;){if(b=c[a.id])return b;a=a.parentNode}return this},_uiSetSelectedItem:function(a,b){b.prevVal&&b.prevVal.set("selected",!1);a.set("selected",!0)},_uiSetFocused:function(a){a&&!this.get("selectedItem")&&this.select()}});
return e},{requires:["event"]});KISSY.add("tree/treemgrRender",function(d){function c(){}c.ATTRS={showRootNode:{}};d.augment(c,{__renderUI:function(){this.get("el").attr("role","tree")[0].hideFocus=!0;this.get("rowEl").addClass("ks-tree-row")},_uiSetShowRootNode:function(c){this.get("rowEl")[c?"show":"hide"]()}});return c});
