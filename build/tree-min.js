/*
Copyright 2012, KISSY UI Library v1.30dev
MIT Licensed
build time: May 29 14:52
*/
KISSY.add("tree/base",function(f,e,d,b,a){return d.extend([e.DelegateChildren,a],{expandAll:function(){return d.prototype.expandAll.apply(this,arguments)}},{DefaultRender:b},{xclass:b.TREE_CLS,priority:30})},{requires:["component","./basenode","./treeRender","./treemgr"]});
KISSY.add("tree/basenode",function(f,e,d,b){var a=e.all,g=b.ITEM_CLS,i=e.KeyCodes,h=d.Controller.extend([d.DecorateChild],{_keyNav:function(c){var a=!0,b,d=this.get("children");switch(c.keyCode){case i.HOME:b=this.get("tree");break;case i.END:b=this.get("tree").getLastVisibleDescendant();break;case i.UP:b=this.getPreviousVisibleNode();break;case i.DOWN:b=this.getNextVisibleNode();break;case i.LEFT:this.get("expanded")&&(d.length||!1===this.get("isLeaf"))?this.set("expanded",!1):b=this.get("parent");
break;case i.RIGHT:if(d.length||!1===this.get("isLeaf"))this.get("expanded")?d[0].select():this.set("expanded",!0);break;default:a=!1}b&&b.select();return a},getLastVisibleDescendant:function(){var c=this.get("children");return!this.get("expanded")||!c.length?this:c[c.length-1].getLastVisibleDescendant()},getNextVisibleNode:function(){var c=this.get("children"),a=this.get("parent");if(this.get("expanded")&&c.length)return c[0];for(c=this.next();a&&!c;)c=a.next(),a=a.get("parent");return c},getPreviousVisibleNode:function(){var c=
this.prev();return c=c?c.getLastVisibleDescendant():this.get("parent")},next:function(){var c=this.get("parent");if(!c)return null;var c=c.get("children"),a=f.indexOf(this,c);return a==c.length-1?null:c[a+1]},prev:function(){var c=this.get("parent");if(!c)return null;var c=c.get("children"),a=f.indexOf(this,c);return 0===a?null:c[a-1]},select:function(){this.get("tree").set("selectedItem",this)},performActionInternal:function(c){var b=a(c.target),d=this.get("tree"),e=this.get("view");d.get("el")[0].focus();
b.equals(e.get("expandIconEl"))?"dblclick"!=c.type&&this.set("expanded",!this.get("expanded")):"dblclick"==c.type?this.set("expanded",!this.get("expanded")):(this.select(),d.fire("click",{target:this}))},decorateChildrenInternal:function(c,a){this.addChild(new c({srcNode:a,tree:this.get("tree"),prefixCls:this.get("prefixCls")}))},addChild:function(c){var a=this.get("tree");c.__set("tree",a);c.__set("depth",this.get("depth")+1);h.superclass.addChild.call(this,c);this._updateRecursive();a._register(c);
f.each(c.get("children"),function(c){a._register(c)})},_computeClass:function(c){this.get("view")._computeClass(this.get("children"),this.get("parent"),c)},_updateRecursive:function(){var c=this.get("children").length;this._computeClass("_updateRecursive");f.each(this.get("children"),function(a,b){a._computeClass("_updateRecursive_children");a.get("view").set("ariaPosInSet",b+1);a.get("view").set("ariaSize",c)})},removeChild:function(a){var b=this.get("tree");b._unregister(a);f.each(a.get("children"),
function(a){b._unregister(a)});h.superclass.removeChild.apply(this,f.makeArray(arguments));this._updateRecursive()},_uiSetExpanded:function(a){var b=this.get("tree");this._computeClass("expanded-"+a);a?b.fire("expand",{target:this}):b.fire("collapse",{target:this})},expandAll:function(){this.set("expanded",!0);f.each(this.get("children"),function(a){a.expandAll()})},collapseAll:function(){this.set("expanded",!1);f.each(this.get("children"),function(a){a.collapseAll()})}},{DefaultRender:b,ATTRS:{handleMouseEvents:{value:!1},
id:{getter:function(){var a=this.get("el").attr("id");a||this.get("el").attr("id",a=f.guid("tree-node"));return a}},content:{view:!0},isLeaf:{view:!0},expandIconEl:{view:!0},iconEl:{view:!0},selected:{view:!0},expanded:{value:!1,view:!0},tooltip:{view:!0},tree:{},depth:{value:0,view:!0},focusable:{value:!1},decorateChildCls:{value:"tree-children"}},HTML_PARSER:{expanded:function(a){a=a.one("."+this.getCssClassWithPrefix("tree-children"));return!a?!1:"none"!=a.css("display")}}});d.UIStore.setUIConstructorByCssClass(g,
{priority:10,ui:h});return h},{requires:["node","component","./basenodeRender"]});
KISSY.add("tree/basenodeRender",function(f,e,d){var b=e.all;return d.Render.extend({_computeClass:function(a,b){var d=this.get("expanded"),e=this.get("isLeaf"),c=this.get("iconEl"),j=this.get("expandIconEl"),m=this.get("childrenEl"),k="tree-icon tree-expand-icon ",n=this.getCssClassWithPrefix("tree-icon tree-file-icon ")+" ks-inline-block",o=this.getCssClassWithPrefix(["tree-icon",d?"tree-expanded-folder-icon":"tree-collapsed-folder-icon",""].join(" "))+" ks-inline-block",l=!b||b.get("children")[b.get("children").length-
1].get("view")==this;!1===e||void 0===e&&a.length?(c.attr("class",o),j.attr("class",this.getCssClassWithPrefix(f.substitute(d?k+"tree-expand-icon-{t}minus":k+"tree-expand-icon-{t}plus",{t:l?"l":"t"}))+" ks-inline-block")):(c.attr("class",n),j.attr("class",this.getCssClassWithPrefix(f.substitute(k+"tree-expand-icon-{t}",{t:l?"l":"t"}))+" ks-inline-block"));m&&m.attr("class",this.getCssClassWithPrefix(l?"tree-lchildren":"tree-children"))},createDom:function(){var a=this.get("el"),d,e,h=this.get("labelEl");
e=b("<div class='"+this.getCssClassWithPrefix("tree-row")+"'/>");d=f.guid("tree-item");this.__set("rowEl",e);var c=b("<div/>").appendTo(e),j=b("<div />").appendTo(e);h||(h=b("<span id='"+d+"' class='"+this.getCssClassWithPrefix("tree-item-label")+"'/>"),this.__set("labelEl",h));h.appendTo(e);a.attr({role:"treeitem","aria-labelledby":d}).prepend(e);this.__set("expandIconEl",c);this.__set("iconEl",j)},_uiSetExpanded:function(a){var b=this.get("childrenEl");b&&(a?a&&b.show():b.hide());this.get("el").attr("aria-expanded",
a)},_uiSetSelected:function(a){var b=this.getComponentCssClassWithState("-selected");this.get("rowEl")[a?"addClass":"removeClass"](b);this.get("el").attr("aria-selected",a)},_uiSetContent:function(a){this.get("labelEl").html(a)},_uiSetDepth:function(a){this.get("el").attr("aria-level",a)},_uiSetAriaSize:function(a){this.get("el").attr("aria-setsize",a)},_uiSetAriaPosInSet:function(a){this.get("el").attr("aria-posinset",a)},_uiSetTooltip:function(a){this.get("el").attr("title",a)},getContentElement:function(){if(this.get("childrenEl"))return this.get("childrenEl");
var a=b("<div "+(this.get("expanded")?"":"style='display:none'")+" role='group'></div>").appendTo(this.get("el"));this.__set("childrenEl",a);return a}},{ATTRS:{ariaSize:{},ariaPosInSet:{},childrenEl:{},expandIconEl:{},tooltip:{},iconEl:{},expanded:{},rowEl:{},depth:{},labelEl:{},content:{},isLeaf:{},selected:{}},HTML_PARSER:{childrenEl:function(a){return a.children("."+this.getCssClassWithPrefix("tree-children"))},labelEl:function(a){return a.children("."+this.getCssClassWithPrefix("tree-item-label"))},
content:function(a){return a.children("."+this.getCssClassWithPrefix("tree-item-label")).html()},isLeaf:function(a){if(a.hasClass(this.getCssClassWithPrefix("tree-item-leaf")))return!0;if(a.hasClass(this.getCssClassWithPrefix("tree-item-folder")))return!1}},ITEM_CLS:"tree-item"})},{requires:["node","component"]});
KISSY.add("tree/checknode",function(f,e,d,b){var a=e.all,g=d.extend({expandAll:function(){return g.superclass.expandAll.apply(this,arguments)},performActionInternal:function(b){this.get("tree").get("el")[0].focus();var d=a(b.target),c=this.get("view"),e=this.get("tree");if("dblclick"==b.type){if(d.equals(c.get("expandIconEl"))||d.equals(c.get("checkEl")))return;this.set("expanded",!this.get("expanded"))}d.equals(c.get("expandIconEl"))?this.set("expanded",!this.get("expanded")):(b=this.get("checkState"),
this.set("checkState",1==b?0:1),e.fire("click",{target:this}))},_uiSetCheckState:function(a){(1==a||0==a)&&f.each(this.get("children"),function(b){b.set("checkState",a)});var b=this.get("parent");if(b){for(var c=0,d=b.get("children"),e=0;e<d.length;e++){var g=d[e].get("checkState");if(2==g){b.set("checkState",2);return}1==g&&c++}c==d.length?b.set("checkState",1):0===c?b.set("checkState",0):b.set("checkState",2)}}},{ATTRS:{checkState:{view:!0,value:0}},CHECK_CLS:"tree-item-check",DefaultRender:b},
{xclass:"tree-item-check",priority:20});f.mix(g,{PARTIAL_CHECK:2,CHECK:1,EMPTY:0});return g},{requires:["node","./basenode","./checknodeRender"]});
KISSY.add("tree/checknodeRender",function(f,e,d){var b=e.all;return d.extend({createDom:function(){var a=this.get("expandIconEl");this.__set("checkEl",b("<div class='"+this.getCssClassWithPrefix("tree-icon")+" ks-inline-block'/>").insertAfter(a))},_uiSetCheckState:function(a){this.get("checkEl").removeClass(this.getCssClassWithPrefix("tree-item-checked0 tree-item-checked1 tree-item-checked2")).addClass(this.getCssClassWithPrefix("tree-item-checked"+a))}},{ATTRS:{checkEl:{},checkState:{}},CHECK_CLS:"tree-item-check"})},
{requires:["node","./basenodeRender"]});KISSY.add("tree/checktree",function(f,e,d,b,a){var g=d.extend([e.DelegateChildren,a],{expandAll:function(){return g.superclass.expandAll.apply(this,arguments)}},{},{xclass:b.CHECK_TREE_CLS,priority:40});g.DefaultRender=b;return g},{requires:["component","./checknode","./checktreeRender","./treemgr"]});KISSY.add("tree/checktreeRender",function(f,e,d){return e.extend([d],{},{CHECK_TREE_CLS:"tree-root-check"})},{requires:["./checknodeRender","./treemgrRender"]});
KISSY.add("tree",function(f,e,d,b,a){e.Node=d;e.CheckNode=b;e.CheckTree=a;return e},{requires:["tree/base","tree/basenode","tree/checknode","tree/checktree"]});KISSY.add("tree/treeRender",function(f,e,d){return e.extend([d],{},{TREE_CLS:"tree-root"})},{requires:["./basenodeRender","./treemgrRender"]});
KISSY.add("tree/treemgr",function(f,e){function d(){}d.ATTRS={showRootNode:{view:!0},selectedItem:{},tree:{valueFn:function(){return this}},focusable:{value:!0}};f.augment(d,{__getAllNodes:function(){this._allNodes||(this._allNodes={});return this._allNodes},__renderUI:function(){this.get("children").length||this._computeClass("root_renderUI")},_register:function(b){this.__getAllNodes()[b.get("id")]=b},_unregister:function(b){delete this.__getAllNodes()[b.get("id")]},handleKeyEventInternal:function(b){var a=
this.get("selectedItem");return b.keyCode==e.KeyCodes.ENTER?a.performActionInternal(b):a._keyNav(b)},getOwnerControl:function(b){for(var a,d=this.__getAllNodes(),e=this.get("el")[0];b&&b!==e;){if(a=d[b.id])return a;b=b.parentNode}return this},_uiSetSelectedItem:function(b,a){a.prevVal&&a.prevVal.set("selected",!1);b.set("selected",!0)},_uiSetFocused:function(b){b&&!this.get("selectedItem")&&this.select()}});return d},{requires:["event"]});
KISSY.add("tree/treemgrRender",function(f){function e(){}e.ATTRS={showRootNode:{}};f.augment(e,{__renderUI:function(){this.get("el").attr("role","tree")[0].hideFocus=!0;this.get("rowEl").addClass(this.getCssClassWithPrefix("tree-root-row"))},_uiSetShowRootNode:function(d){this.get("rowEl")[d?"show":"hide"]()},_uiSetFocused:function(d){this.get("el")[d?"addClass":"removeClass"](this.getCssClassWithPrefix("tree-item-focused"))}});return e});
