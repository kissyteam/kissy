/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: Aug 7 12:58
*/
KISSY.add("event/dom/touch/handle-map",function(){return{}});KISSY.add("event/dom/touch/single-touch",function(a){function b(){}b.prototype={constructor:b,requiredTouchCount:1,onTouchStart:function(a){if(a.touches.length!=this.requiredTouchCount)return!1;this.lastTouches=a.touches},onTouchMove:a.noop,onTouchEnd:a.noop};return b});
KISSY.add("event/dom/touch/tap",function(a,b,d,c){function f(a){a.preventDefault()}function h(){h.superclass.constructor.apply(this,arguments)}var j=d.Object;a.extend(h,c,{onTouchMove:function(){return!1},onTouchEnd:function(c){var g=c.changedTouches[0],c=c.target,e=new j({type:"tap",target:c,currentTarget:c});a.mix(e,{pageX:g.pageX,pageY:g.pageY,which:1,touch:g});d.fire(c,"tap",e);if(e.isDefaultPrevented())d.on(c,"click",{fn:f,once:1})}});b.tap={handle:new h};return h},{requires:["./handle-map",
"event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch/swipe",function(a,b,d,c){function f(e,c,a){var i=c.changedTouches[0],m=i.pageX-e.startX,l=i.pageY-e.startY,p=Math.abs(m),f=Math.abs(l);if(a)e.isVertical&&e.isHorizontal&&(f>p?e.isHorizontal=0:e.isVertical=0);else if(e.isVertical&&f<g&&(e.isVertical=0),e.isHorizontal&&p<g)e.isHorizontal=0;if(e.isHorizontal)m=0>m?"left":"right";else if(e.isVertical)m=0>l?"up":"down",p=f;else return!1;d.fire(c.target,a?k:j,{originalEvent:c.originalEvent,pageX:i.pageX,pageY:i.pageY,which:1,
touch:i,direction:m,distance:p,duration:(c.timeStamp-e.startTime)/1E3})}function h(){}var j="swipe",k="swiping",g=50;a.extend(h,c,{onTouchStart:function(e){if(!1===h.superclass.onTouchStart.apply(this,arguments))return!1;var c=e.touches[0];this.startTime=e.timeStamp;this.isVertical=this.isHorizontal=1;this.startX=c.pageX;this.startY=c.pageY;-1!=e.type.indexOf("mouse")&&e.preventDefault()},onTouchMove:function(c){var a=c.changedTouches[0],g=a.pageY-this.startY,a=Math.abs(a.pageX-this.startX),g=Math.abs(g);
if(1E3<c.timeStamp-this.startTime)return!1;this.isVertical&&35<a&&(this.isVertical=0);this.isHorizontal&&35<g&&(this.isHorizontal=0);return f(this,c,1)},onTouchEnd:function(c){return!1===this.onTouchMove(c)?!1:f(this,c,0)}});b[j]=b[k]={handle:new h};return h},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch/double-tap",function(a,b,d,c){function f(){}a.extend(f,c,{onTouchStart:function(c){if(!1===f.superclass.onTouchStart.apply(this,arguments))return!1;this.startTime=c.timeStamp;this.singleTapTimer&&(clearTimeout(this.singleTapTimer),this.singleTapTimer=0)},onTouchMove:function(){return!1},onTouchEnd:function(c){var a=this.lastEndTime,f=c.timeStamp,g=c.target,e=c.changedTouches[0],b=f-this.startTime;this.lastEndTime=f;if(a&&(b=f-a,300>b)){this.lastEndTime=0;d.fire(g,"doubleTap",
{touch:e,duration:b/1E3});return}b=f-this.startTime;300<b?d.fire(g,"singleTap",{touch:e,pageX:e.pageX,which:1,pageY:e.pageY,duration:b/1E3}):this.singleTapTimer=setTimeout(function(){d.fire(g,"singleTap",{touch:e,pageX:e.pageX,which:1,pageY:e.pageY,duration:b/1E3})},300)}});b.singleTap=b.doubleTap={handle:new f};return f},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch/multi-touch",function(a,b){function d(){}d.prototype={constructor:d,requiredTouchCount:2,onTouchStart:function(c){var a=this.requiredTouchCount,b=c.touches.length;b===a?this.start():b>a&&this.end(c)},onTouchEnd:function(c){this.end(c)},start:function(){this.isTracking||(this.isTracking=!0,this.isStarted=!1)},fireEnd:a.noop,getCommonTarget:function(c){var a=c.touches,c=a[0].target,a=a[1].target;if(c==a||b.contains(c,a))return c;for(;;){if(b.contains(a,c))return a;a=a.parentNode}},
end:function(a){this.isTracking&&(this.isTracking=!1,this.isStarted&&(this.isStarted=!1,this.fireEnd(a)))}};return d},{requires:["dom"]});
KISSY.add("event/dom/touch/pinch",function(a,b,d,c){function f(){}function h(a){2==a.touches.length&&a.preventDefault()}a.extend(f,c,{onTouchMove:function(c){if(this.isTracking){var b=c.touches,g,e=b[0],f=b[1];g=e.pageX-f.pageX;e=e.pageY-f.pageY;g=Math.sqrt(g*g+e*e);this.lastTouches=b;this.isStarted?d.fire(this.target,"pinch",a.mix(c,{distance:g,scale:g/this.startDistance})):(this.isStarted=!0,this.startDistance=g,b=this.target=this.getCommonTarget(c),d.fire(b,"pinchStart",a.mix(c,{distance:g,scale:1})))}},
fireEnd:function(c){d.fire(this.target,"pinchEnd",a.mix(c,{touches:this.lastTouches}))}});c=new f;b.pinchStart=b.pinchEnd={handle:c};b.pinch={handle:c,add:function(){d.on(this,"touchmove",h)},remove:function(){d.detach(this,"touchmove",h)}};return f},{requires:["./handle-map","event/dom/base","./multi-touch"]});
KISSY.add("event/dom/touch/tap-hold",function(a,b,d,c){function f(){}function h(a){1==a.touches.length&&a.preventDefault()}a.extend(f,d,{onTouchStart:function(b){if(!1===f.superclass.onTouchStart.call(this,b))return!1;this.timer=setTimeout(function(){var f=b.touches[0];c.fire(b.target,"tapHold",{touch:f,pageX:f.pageX,pageY:f.pageY,which:1,duration:(a.now()-b.timeStamp)/1E3})},1E3)},onTouchMove:function(){clearTimeout(this.timer);return!1},onTouchEnd:function(){clearTimeout(this.timer)}});b.tapHold=
{setup:function(){c.on(this,"touchstart",h)},tearDown:function(){c.detach(this,"touchstart",h)},handle:new f};return f},{requires:["./handle-map","./single-touch","event/dom/base"]});
KISSY.add("event/dom/touch/rotate",function(a,b,d,c,f){function h(){}function j(a){2==a.touches.length&&a.preventDefault()}var k=180/Math.PI;a.extend(h,d,{onTouchMove:function(b){if(this.isTracking){var e=b.touches,d=e[0],h=e[1],i=this.lastAngle,d=Math.atan2(h.pageY-d.pageY,h.pageX-d.pageX)*k;if(i!==f){var h=Math.abs(d-i),m=(d+360)%360,l=(d-360)%360;Math.abs(m-i)<h?d=m:Math.abs(l-i)<h&&(d=l)}this.lastTouches=e;this.lastAngle=d;this.isStarted?c.fire(this.target,"rotate",a.mix(b,{angle:d,rotation:d-
this.startAngle})):(this.isStarted=!0,this.startAngle=d,this.target=this.getCommonTarget(b),c.fire(this.target,"rotateStart",a.mix(b,{angle:d,rotation:0})))}},end:function(){this.lastAngle=f;h.superclass.end.apply(this,arguments)},fireEnd:function(b){c.fire(this.target,"rotateEnd",a.mix(b,{touches:this.lastTouches}))}});d=new h;b.rotateEnd=b.rotateStart={handle:d};b.rotate={handle:d,add:function(){c.on(this,"touchmove",j)},remove:function(){c.detach(this,"touchmove",j)}};return h},{requires:["./handle-map",
"./multi-touch","event/dom/base"]});
KISSY.add("event/dom/touch/handle",function(a,b,d,c){function f(a){this.doc=a;this.eventHandle={};this.init();this.touches=[];this.inTouch=0}var h=a.guid("touch-handle"),j=a.Features,k=j.isMsPointerSupported(),g={},e,n,o;j.isTouchEventSupported()?(j="touchstart mousedown",o="touchend",e="touchmove mousemove",n="touchcancel"):k?(j="MSPointerDown",e="MSPointerMove",o="MSPointerUp",n="MSPointerCancel"):(j="mousedown",e="mousemove",o="mouseup");g[j]="onTouchStart";g[e]="onTouchMove";g[o]="onTouchEnd";
n&&(g[n]="onTouchEnd");f.prototype={constructor:f,addTouch:function(a){a.identifier=a.pointerId;this.touches.push(a)},removeTouch:function(c){var b=this.touches;a.each(b,function(a,d){if(a.pointerId==c.pointerId){b.splice(d,1);return false}})},updateTouch:function(c){var b=this.touches;a.each(b,function(a,d){if(a.pointerId==c.pointerId){b[d]=c;return false}})},init:function(){var a=this.doc,b,d;for(b in g){d=g[b];c.on(a,b,this[d],this)}},normalize:function(c){var b=c.type,d;if(a.startsWith(b,"touch")){d=
b=="touchend"||b=="touchcancel"?c.changedTouches:c.touches;if(d.length==1){c.which=1;c.pageX=d[0].pageX;c.pageY=d[0].pageY}return c}d=this.touches;b=!b.match(/(up|cancel)$/i);c.touches=b?d:[];c.targetTouches=b?d:[];c.changedTouches=d;return c},onTouchStart:function(b){var d,e,f=this.eventHandle;if("touches"in b)this.inTouch=b.touches.length;else{if(this.inTouch)return;if(!k)c.on(this.doc,"mouseup",{fn:this.onTouchEnd,context:this,once:true})}for(d in f){e=f[d].handle;e.isActive=1}"touches"in b?this.touches=
a.makeArray(b.touches):k?this.addTouch(b.originalEvent):this.touches=[b.originalEvent];this.callEventHandle("onTouchStart",b)},onTouchMove:function(a){if(!("touches"in a)){if(this.inTouch)return;k?this.updateTouch(a.originalEvent):this.touches=[a.originalEvent]}this.callEventHandle("onTouchMove",a)},onTouchEnd:function(b){var c="touches"in b;this.callEventHandle("onTouchEnd",b);if(c){this.touches=a.makeArray(b.touches);this.inTouch=this.touches.length}else k?this.removeTouch(b.originalEvent):this.touches=
[]},callEventHandle:function(a,b){var c=this.eventHandle,d,e;if(b=this.normalize(b)){for(d in c){e=c[d].handle;if(!e.processed){e.processed=1;if(e.isActive&&e[a]&&e[a](b)===false)e.isActive=0}}for(d in c){e=c[d].handle;e.processed=0}}},addEventHandle:function(a){var b=this.eventHandle,c=d[a].handle;b[a]?b[a].count++:b[a]={count:1,handle:c}},removeEventHandle:function(a){var b=this.eventHandle;if(b[a]){b[a].count--;b[a].count||delete b[a]}},destroy:function(){var a=this.doc,b,d;for(b in g){d=g[b];
c.detach(a,b,this[d],this)}}};return{addDocumentHandle:function(a,c){var d=b.getDocument(a),e=b.data(d,h);e||b.data(d,h,e=new f(d));c&&e.addEventHandle(c)},removeDocumentHandle:function(c,d){var e=b.getDocument(c),f=b.data(e,h);if(f){d&&f.removeEventHandle(d);if(a.isEmptyObject(f.eventHandle)){f.destroy();b.removeData(e,h)}}}}},{requires:"dom,./handle-map,event/dom/base,./tap,./swipe,./double-tap,./pinch,./tap-hold,./rotate".split(",")});
KISSY.add("event/dom/touch",function(a,b,d,c){function f(a){h.call(this,a);d[a].setup.apply(this,arguments)}function h(a){var b=this.style;g&&b&&(this.__ks_touch_action||(this.__ks_touch_action=b.msTouchAction,this.__ks_user_select=b.msUserSelect,b.msTouchAction=b.msUserSelect="none"),this.__ks_touch_action_count?this.__ks_touch_action_count++:this.__ks_touch_action_count=1);c.addDocumentHandle(this,a)}function j(a){k.call(this,a);d[a].tearDown.apply(this,arguments)}function k(a){var b=this.style;
g&&b&&(this.__ks_touch_action_count--,this.__ks_touch_action_count||(b.msUserSelect=this.__ks_user_select,b.msTouchAction=this.__ks_touch_action,this.__ks_touch_action=""));c.removeDocumentHandle(this,a)}var g=a.Features.isMsPointerSupported(),a=b.Gesture,e=a.start="KSPointerDown",n=a.move="KSPointerMove",o=a.end="KSPointerUp";a.tap="tap";a.doubleTap="doubleTap";d[e]={handle:{isActive:1,onTouchStart:function(a){b.fire(a.target,e,a)}}};d[n]={handle:{isActive:1,onTouchMove:function(a){b.fire(a.target,
n,a)}}};d[o]={handle:{isActive:1,onTouchEnd:function(a){b.fire(a.target,o,a)}}};var a=b.Special,i,m,l;for(m in d)i={},l=d[m],i.setup=l.setup?f:h,i.tearDown=l.tearDown?j:k,l.add&&(i.add=l.add),l.remove&&(i.remove=l.remove),a[m]=i},{requires:["event/dom/base","./touch/handle-map","./touch/handle"]});
