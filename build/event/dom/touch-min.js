/*
Copyright 2012, KISSY UI Library v1.40dev
MIT Licensed
build time: Nov 14 21:53
*/
KISSY.add("event/dom/touch/base-touch",function(h,d){function f(){this.requiredTouchCount=1}f.prototype={onTouchStart:function(b){if(b.touches.length!=this.requiredTouchCount)return!1;this.lastTouches=b.touches},onTouchMove:function(b){if(b.touches.length!=this.requiredTouchCount)return!1;this.lastTouches=b.touches},getCommonTarget:function(b){var a=b.touches,b=a[0].target,a=a[1].target;if(b==a||d.contains(b,a))return b;for(;;){if(d.contains(a,b))return a;a=a.parentNode}},onTouchEnd:h.noop};return f},
{requires:["dom"]});
KISSY.add("event/dom/touch/double-tap",function(h,d,f,b){function a(){this.requiredTouchCount=1}h.extend(a,b,{onTouchStart:function(b){if(!1===a.superclass.onTouchStart.apply(this,arguments))return!1;this.startTime=b.timeStamp;this.singleTapTimer&&(clearTimeout(this.singleTapTimer),this.singleTapTimer=0)},onTouchMove:function(){return!1},onTouchEnd:function(a){var b=this.lastEndTime,c=a.timeStamp,e=a.target,g=a.changedTouches[0],k=c-this.startTime;this.lastEndTime=c;if(b&&(k=c-b,300>k)){this.lastEndTime=
0;f.fire(e,"doubleTap",{touch:g,duration:k});return}k=c-this.startTime;300<k?f.fire(e,"singleTap",{touch:g,duration:k}):this.singleTapTimer=setTimeout(function(){f.fire(e,"singleTap",{touch:g,duration:k})},300)}});return d.singleTap=d.doubleTap=a},{requires:["./handle-map","event/dom/base","./base-touch"]});
KISSY.add("event/dom/touch/gesture",function(h,d){var f=d.Gesture,b=h.Features,a,i,j;b.isTouchSupported?(a="touchstart",i="touchmove",j="touchend"):b.isMsPointerEnabled&&(a="MSPointerDown",i="MSPointerMove",j="MSPointerUp");a&&(f.start=a,f.move=i,f.end=j,f.tap="tap");return f},{requires:["event/dom/base"]});KISSY.add("event/dom/touch/handle-map",function(){return{}});
KISSY.add("event/dom/touch/handle",function(h,d,f,b,a){function i(g){this.doc=g;this.eventHandle={};this.init()}var j=h.guid("touch-handle"),c=h.Features,e={};e[a.start]="onTouchStart";e[a.move]="onTouchMove";e[a.end]="onTouchEnd";"mousedown"!==a.start&&(e.touchcancel="onTouchEnd");i.prototype={init:function(){var g=this.doc,a,c;this.onTouchMove=h.throttle(this.onTouchMove,30);for(a in e){c=e[a];b.on(g,a,this[c],this)}},normalize:function(g){var a=g.type,b;if(!c.isTouchSupported){if(a.indexOf("mouse")!=
-1&&g.which!=1)return;b=[g];a=!a.match(/up$/i);g.touches=a?b:[];g.targetTouches=a?b:[];g.changedTouches=b}return g},onTouchStart:function(g){var a,b;for(a in this.eventHandle){b=this.eventHandle[a];b.isActive=true}this.callEventHandle("onTouchStart",g)},onTouchMove:function(g){this.callEventHandle("onTouchMove",g)},onTouchEnd:function(g){this.callEventHandle("onTouchEnd",g)},callEventHandle:function(g,a){var b,c;if(a=this.normalize(a))for(b in this.eventHandle){c=this.eventHandle[b];if(c.isActive&&
c[g](a)===false)c.isActive=false}},addEventHandle:function(g){var a=f[g];if(!this.eventHandle[g]&&!a.used){this.eventHandle[g]=new a;a.used=1}},removeEventHandle:function(a){delete this.eventHandle[a]},destroy:function(){var a=this.doc,c,d;for(c in e){d=e[c];b.detach(a,c,this[d],this)}}};return{addDocumentHandle:function(a,c){var b=d._getWin(a.ownerDocument||a).document,e=d.data(b,j);e||d.data(b,j,e=new i(b));e.addEventHandle(c)},removeDocumentHandle:function(a,b){var c=d._getWin(a.ownerDocument||
a).document,e=d.data(c,j);if(e){e.removeEventHandle(b);if(h.isEmptyObject(eventHandle)){e.destroy();d.removeData(c,j)}}}}},{requires:"dom,./handle-map,event/dom/base,./gesture,./tap,./swipe,./double-tap,./pinch,./tap-hold,./rotate".split(",")});
KISSY.add("event/dom/touch/pinch",function(h,d,f,b){function a(a,b){var e=a.pageX-b.pageX,g=a.pageY-b.pageY;return Math.sqrt(e*e+g*g)}function i(){this.requiredTouchCount=2;this.event=event}h.extend(i,b,{onTouchStart:function(b){if(!1===i.superclass.onTouchStart.apply(this,arguments))return!1;var c=b.touches,e=a(c[0],c[1]);this.startDistance=e;var g=this.target=this.getCommonTarget(b);f.fire(g,"pinchStart",{touches:c,distance:e,scale:1})},onTouchMove:function(b){var c=i.superclass.onTouchMove.apply(this,
arguments);if(!1===c)return!1;if(!0!==c){var c=b.touches,e=a(c[0],c[1]);f.fire(this.target,"pinch",{touches:c,distance:e,scale:e/this.startDistance})}},onTouchEnd:function(){f.fire(this.target,"pinchEnd",{touches:this.lastTouches})}});return d.pinch=d.pinchEnd=d.pinchEnd=i},{requires:["./handle-map","event/dom/base","./base-touch"]});
KISSY.add("event/dom/touch/rotate",function(h,d,f,b){function a(){this.requiredTouchCount=2}var i=180/Math.PI;h.extend(a,f,{onTouchStart:function(d){if(!1===a.superclass.onTouchStart.call(this,d))return!1;var c=d.touches,e=c[0],c=c[1];this.lastAngle=this.startAngle=e=Math.atan2(c.pageY-e.pageY,c.pageX-e.pageX)*i;this.target=this.getCommonTarget(d);b.fire(this.target,"rotateStart",{touches:d.touches,angle:e,rotation:0})},onTouchMove:function(d){if(!1===a.superclass.onTouchMove.call(this,d))return!1;
var d=d.touches,c=d[0],e=d[1],g=this.lastAngle,c=Math.atan2(e.pageY-c.pageY,e.pageX-c.pageX)*i,e=Math.abs(c-g),f=c+360,h=c-360;Math.abs(f-g)<e?c=f:Math.abs(h-g)<e&&(c=h);this.lastAngle=c;b.fire(this.target,"rotate",{touches:d,angle:c,rotation:c-this.startAngle})},onTouchEnd:function(){b.fire(this.target,"rotateEnd",{touches:this.lastTouches})}});return d.rotate=d.rotateEnd=d.rotateStart=a},{requires:["./handle-map","./base-touch","event/dom/base"]});
KISSY.add("event/dom/touch/swipe",function(h,d,f,b){function a(){this.requiredTouchCount=1;this.event=j}function i(a,b,d){var f=d[0],d=f.pageY,f=Math.abs(f.pageX-a.startX),d=Math.abs(d-a.startY);if(b.timeStamp-a.startTime>c)return!1;a.isVertical&&f>e&&(a.isVertical=0);a.isHorizontal&&d>e&&(a.isHorizontal=0);if(!a.isHorizontal&&!a.isVertical)return!1}var j="swipe",c=1E3,e=35;h.extend(a,b,{onTouchStart:function(b){if(!1===a.superclass.onTouchStart.apply(this,arguments))return!1;var c=b.touches[0];this.startTime=
b.timeStamp;this.isVertical=this.isHorizontal=1;this.startX=c.pageX;this.startY=c.pageY;-1!=b.type.indexOf("mouse")&&b.preventDefault()},onTouchMove:function(b){if(!0!==a.superclass.onTouchMove.apply(this,arguments)&&!1==i(this,b,b.touches))return!1},onTouchEnd:function(a){if(!1==i(this,a,a.changedTouches))return!1;var b=a.changedTouches[0],c=b.pageX-this.startX,d=b.pageY-this.startY,e=Math.abs(c),h=Math.abs(d);this.isVertical&&50>h&&(this.isVertical=0);this.isHorizontal&&50>e&&(this.isHorizontal=
0);if(this.isHorizontal)c=0>c?"left":"right";else if(this.isVertical)c=0>d?"up":"down",e=h;else return!1;f.fire(a.target,this.event,{touch:b,direction:c,distance:e,duration:a.timeStamp-this.startTime})}});return d[j]=a},{requires:["./handle-map","event/dom/base","./base-touch"]});
KISSY.add("event/dom/touch/tap-hold",function(h,d,f,b){function a(){this.requiredTouchCount=1}h.extend(a,f,{onTouchStart:function(d){if(!1===a.superclass.onTouchStart.call(this,d))return!1;this.timer=setTimeout(function(){b.fire(d.target,"tapHold",{touch:d.touches[0],duration:h.now()-d.timeStamp})},1E3)},onTouchMove:function(){clearTimeout(this.timer);return!1},onTouchEnd:function(){clearTimeout(this.timer)}});return d.tapHold=a},{requires:["./handle-map","./base-touch","event/dom/base"]});
KISSY.add("event/dom/touch/tap",function(h,d,f,b){function a(){this.requiredTouchCount=1}h.extend(a,b,{onTouchMove:function(){return!1},onTouchEnd:function(a){f.fire(a.target,"tap",{touch:a.changedTouches[0]})}});return d.tap=a},{requires:["./handle-map","event/dom/base","./base-touch"]});
KISSY.add("event/dom/touch",function(h,d,f,b){var h=d._Special,d={setup:function(a){b.addDocumentHandle(this,a)},tearDown:function(a){b.removeDocumentHandle(this,a)}},a;for(a in f)h[a]=d},{requires:["event/dom/base","./touch/handle-map","./touch/handle"]});
