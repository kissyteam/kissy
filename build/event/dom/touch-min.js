/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: Jul 3 19:20
*/
KISSY.add("event/dom/touch/handle-map",function(){return{}});KISSY.add("event/dom/touch/gesture",function(f,b){var d=b.Gesture,c=f.Features,a,i,j,k;c.isTouchEventSupported()?(a="touchstart",i="touchmove",k="touchend",j="touchcancel"):c.isMsPointerSupported()&&(a="MSPointerDown",i="MSPointerMove",k="MSPointerUp",j="MSPointerCancel");a&&(d.start=a,d.move=i,d.end=k,d.cancel=j,d.tap="tap",d.doubleTap="doubleTap",d.singleTouchStart="singleTouchStart");return d},{requires:["event/dom/base"]});
KISSY.add("event/dom/touch/single-touch",function(f){function b(){}b.prototype={constructor:b,requiredTouchCount:1,onTouchStart:function(d){if(d.touches.length!=this.requiredTouchCount)return!1;this.lastTouches=d.touches},onTouchMove:f.noop,onTouchEnd:f.noop};return b});
KISSY.add("event/dom/touch/tap",function(f,b,d,c){function a(){}f.extend(a,c,{onTouchMove:function(){return!1},onTouchEnd:function(a){var c=a.changedTouches[0];d.fire(a.target,"tap",{pageX:c.pageX,pageY:c.pageY,which:1,touch:c})}});b.tap={handle:new a};return a},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch/swipe",function(f,b,d,c){function a(e,g,h){var m=g.changedTouches[0],a=m.pageX-e.startX,c=m.pageY-e.startY,b=Math.abs(a),i=Math.abs(c);if(h)e.isVertical&&e.isHorizontal&&(i>b?e.isHorizontal=0:e.isVertical=0);else if(e.isVertical&&i<l&&(e.isVertical=0),e.isHorizontal&&b<l)e.isHorizontal=0;if(e.isHorizontal)a=0>a?"left":"right";else if(e.isVertical)a=0>c?"up":"down",b=i;else return!1;d.fire(g.target,h?k:j,{originalEvent:g.originalEvent,pageX:m.pageX,pageY:m.pageY,which:1,
touch:m,direction:a,distance:b,duration:(g.timeStamp-e.startTime)/1E3})}function i(){}var j="swipe",k="swiping",l=50;f.extend(i,c,{onTouchStart:function(e){if(!1===i.superclass.onTouchStart.apply(this,arguments))return!1;var g=e.touches[0];this.startTime=e.timeStamp;this.isVertical=this.isHorizontal=1;this.startX=g.pageX;this.startY=g.pageY;-1!=e.type.indexOf("mouse")&&e.preventDefault()},onTouchMove:function(e){var g=e.changedTouches[0],h=g.pageY-this.startY,g=Math.abs(g.pageX-this.startX),h=Math.abs(h);
if(1E3<e.timeStamp-this.startTime)return!1;this.isVertical&&35<g&&(this.isVertical=0);this.isHorizontal&&35<h&&(this.isHorizontal=0);return a(this,e,1)},onTouchEnd:function(e){return!1===this.onTouchMove(e)?!1:a(this,e,0)}});b[j]=b[k]={handle:new i};return i},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch/double-tap",function(f,b,d,c){function a(){}f.extend(a,c,{onTouchStart:function(c){if(!1===a.superclass.onTouchStart.apply(this,arguments))return!1;this.startTime=c.timeStamp;this.singleTapTimer&&(clearTimeout(this.singleTapTimer),this.singleTapTimer=0)},onTouchMove:function(){return!1},onTouchEnd:function(a){var c=this.lastEndTime,b=a.timeStamp,f=a.target,e=a.changedTouches[0],g=b-this.startTime;this.lastEndTime=b;if(c&&(g=b-c,300>g)){this.lastEndTime=0;d.fire(f,"doubleTap",
{touch:e,duration:g/1E3});return}g=b-this.startTime;300<g?d.fire(f,"singleTap",{touch:e,pageX:e.pageX,which:1,pageY:e.pageY,duration:g/1E3}):this.singleTapTimer=setTimeout(function(){d.fire(f,"singleTap",{touch:e,pageX:e.pageX,which:1,pageY:e.pageY,duration:g/1E3})},300)}});b.singleTap=b.doubleTap={handle:new a};return a},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch/multi-touch",function(f,b){function d(){}d.prototype={constructor:d,requiredTouchCount:2,onTouchStart:function(c){var a=this.requiredTouchCount,b=c.touches.length;b===a?this.start():b>a&&this.end(c)},onTouchEnd:function(c){this.end(c)},start:function(){this.isTracking||(this.isTracking=!0,this.isStarted=!1)},fireEnd:f.noop,getCommonTarget:function(c){var a=c.touches,c=a[0].target,a=a[1].target;if(c==a||b.contains(c,a))return c;for(;;){if(b.contains(a,c))return a;a=a.parentNode}},
end:function(c){this.isTracking&&(this.isTracking=!1,this.isStarted&&(this.isStarted=!1,this.fireEnd(c)))}};return d},{requires:["dom"]});
KISSY.add("event/dom/touch/pinch",function(f,b,d,c,a){function i(){}function j(a){(!a.touches||2==a.touches.length)&&a.preventDefault()}f.extend(i,c,{onTouchMove:function(a){if(this.isTracking){var c=a.touches,e,g=c[0],h=c[1];e=g.pageX-h.pageX;g=g.pageY-h.pageY;e=Math.sqrt(e*e+g*g);this.lastTouches=c;this.isStarted?d.fire(this.target,"pinch",f.mix(a,{distance:e,scale:e/this.startDistance})):(this.isStarted=!0,this.startDistance=e,c=this.target=this.getCommonTarget(a),d.fire(c,"pinchStart",f.mix(a,
{distance:e,scale:1})))}},fireEnd:function(a){d.fire(this.target,"pinchEnd",f.mix(a,{touches:this.lastTouches}))}});c=new i;b.pinchStart=b.pinchEnd={handle:c};b.pinch={handle:c,add:function(){d.on(this,a.move,j)},remove:function(){d.detach(this,a.move,j)}};return i},{requires:["./handle-map","event/dom/base","./multi-touch","./gesture"]});
KISSY.add("event/dom/touch/tap-hold",function(f,b,d,c,a){function i(){}function j(a){(!a.touches||1==a.touches.length)&&a.preventDefault()}f.extend(i,d,{onTouchStart:function(a){if(!1===i.superclass.onTouchStart.call(this,a))return!1;this.timer=setTimeout(function(){var b=a.touches[0];c.fire(a.target,"tapHold",{touch:b,pageX:b.pageX,pageY:b.pageY,which:1,duration:(f.now()-a.timeStamp)/1E3})},1E3)},onTouchMove:function(){clearTimeout(this.timer);return!1},onTouchEnd:function(){clearTimeout(this.timer)}});
b.tapHold={setup:function(){c.on(this,a.start,j)},tearDown:function(){c.detach(this,a.start,j)},handle:new i};return i},{requires:["./handle-map","./single-touch","event/dom/base","./gesture"]});
KISSY.add("event/dom/touch/rotate",function(f,b,d,c,a,i){function j(){}function k(a){(!a.touches||2==a.touches.length)&&a.preventDefault()}var l=180/Math.PI;f.extend(j,d,{onTouchMove:function(a){if(this.isTracking){var g=a.touches,h=g[0],b=g[1],d=this.lastAngle,h=Math.atan2(b.pageY-h.pageY,b.pageX-h.pageX)*l;if(d!==i){var b=Math.abs(h-d),j=(h+360)%360,k=(h-360)%360;Math.abs(j-d)<b?h=j:Math.abs(k-d)<b&&(h=k)}this.lastTouches=g;this.lastAngle=h;this.isStarted?c.fire(this.target,"rotate",f.mix(a,{angle:h,
rotation:h-this.startAngle})):(this.isStarted=!0,this.startAngle=h,this.target=this.getCommonTarget(a),c.fire(this.target,"rotateStart",f.mix(a,{angle:h,rotation:0})))}},end:function(){this.lastAngle=i;j.superclass.end.apply(this,arguments)},fireEnd:function(a){c.fire(this.target,"rotateEnd",f.mix(a,{touches:this.lastTouches}))}});d=new j;b.rotateEnd=b.rotateStart={handle:d};b.rotate={handle:d,add:function(){c.on(this,a.move,k)},remove:function(){c.detach(this,a.move,k)}};return j},{requires:["./handle-map",
"./multi-touch","event/dom/base","./gesture"]});KISSY.add("event/dom/touch/single-touch-start",function(f,b,d,c){function a(){}f.extend(a,c,{onTouchStart:function(b){if(!1!==a.superclass.onTouchStart.apply(this,arguments)){var c=b.touches[0];d.fire(b.target,"singleTouchStart",{touch:c[0],pageX:c.pageX,pageY:c.pageY,which:1,touches:b.touches})}else return!1}});b.singleTouchStart={handle:new a};return a},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch/handle",function(f,b,d,c,a){function i(a){this.doc=a;this.eventHandle={};this.init();this.touches=[]}var j=f.guid("touch-handle"),k=f.Features,l=k.isMsPointerSupported(),e={};e[a.start]="onTouchStart";e[a.move]="onTouchMove";e[a.end]="onTouchEnd";a.cancel&&(e[a.cancel]="onTouchEnd");i.prototype={constructor:i,addTouch:function(a){this.touches.push(a)},removeTouch:function(a){var h=this.touches;f.each(h,function(b,c){if(b.pointerId==a.pointerId)return h.splice(c,1),!1})},
updateTouch:function(a){var h=this.touches;f.each(h,function(b,c){if(b.pointerId==a.pointerId)return h[c]=a,!1})},init:function(){var a=this.doc,h,b;for(h in e)b=e[h],c.on(a,h,this[b],this)},normalize:function(a){var b=a.type,c;if(k.isTouchEventSupported())return c="touchend"==b||"touchcancel"==b?a.changedTouches:a.touches,1==c.length&&(a.which=1,a.pageX=c.pageX,a.pageY=c.pageY),a;if(l)c=this.touches;else{if(-1!=b.indexOf("mouse")&&1!=a.which)return;c=[a]}b=!b.match(/(up|cancel)$/i);a.touches=b?c:
[];a.targetTouches=b?c:[];a.changedTouches=c;return a},onTouchMove:function(a){l&&this.updateTouch(a.originalEvent);this.callEventHandle("onTouchMove",a)},onTouchStart:function(a){var b,c,e=this.eventHandle;for(b in e)c=e[b].handle,c.isActive=1;l&&this.addTouch(a.originalEvent);this.callEventHandle("onTouchStart",a)},onTouchEnd:function(a){this.callEventHandle("onTouchEnd",a);l&&this.removeTouch(a.originalEvent)},callEventHandle:function(a,b){var c=this.eventHandle,e,d;if(b=this.normalize(b)){for(e in c)d=
c[e].handle,d.processed||(d.processed=1,d.isActive&&!1===d[a](b)&&(d.isActive=0));for(e in c)d=c[e].handle,d.processed=0}},addEventHandle:function(a){var b=this.eventHandle,c=d[a].handle;b[a]?b[a].count++:b[a]={count:1,handle:c}},removeEventHandle:function(a){var b=this.eventHandle;b[a]&&(b[a].count--,b[a].count||delete b[a])},destroy:function(){var a=this.doc,b,d;for(b in e)d=e[b],c.detach(a,b,this[d],this)}};return{addDocumentHandle:function(a,c){var e=b.getDocument(a),d=b.data(e,j);d||b.data(e,
j,d=new i(e));d.addEventHandle(c)},removeDocumentHandle:function(a,c){var e=b.getDocument(a),d=b.data(e,j);d&&(d.removeEventHandle(c),f.isEmptyObject(d.eventHandle)&&(d.destroy(),b.removeData(e,j)))}}},{requires:"dom,./handle-map,event/dom/base,./gesture,./tap,./swipe,./double-tap,./pinch,./tap-hold,./rotate,./single-touch-start".split(",")});
KISSY.add("event/dom/touch",function(f,b,d,c){function a(a){i.call(this,a);d[a].setup.apply(this,arguments)}function i(a){var b=this.style;l.isMsPointerSupported()&&b&&(this.__ks_touch_action||(this.__ks_touch_action=b.msTouchAction,this.__ks_user_select=b.msUserSelect,b.msTouchAction=b.msUserSelect="none"),this.__ks_touch_action_count?this.__ks_touch_action_count++:this.__ks_touch_action_count=1);c.addDocumentHandle(this,a)}function j(a){k.call(this,a);d[a].tearDown.apply(this,arguments)}function k(a){var b=
this.style;l.isMsPointerSupported()&&b&&(this.__ks_touch_action_count--,this.__ks_touch_action_count||(b.msUserSelect=this.__ks_user_select,b.msTouchAction=this.__ks_touch_action,this.__ks_touch_action=""));c.removeDocumentHandle(this,a)}var l=f.Features,f=b.Special,e,g;for(e in d)b={},g=d[e],b.setup=g.setup?a:i,b.tearDown=g.tearDown?j:k,g.add&&(b.add=g.add),g.remove&&(b.remove=g.remove),f[e]=b},{requires:["event/dom/base","./touch/handle-map","./touch/handle"]});
