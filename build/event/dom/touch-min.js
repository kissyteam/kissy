/*
Copyright 2012, KISSY UI Library v1.40dev
MIT Licensed
build time: Dec 20 22:27
*/
KISSY.add("event/dom/touch/double-tap",function(e,b,c,d){function a(){}e.extend(a,d,{onTouchStart:function(f){if(!1===a.superclass.onTouchStart.apply(this,arguments))return!1;this.startTime=f.timeStamp;this.singleTapTimer&&(clearTimeout(this.singleTapTimer),this.singleTapTimer=0)},onTouchMove:function(){return!1},onTouchEnd:function(a){var d=this.lastEndTime,b=a.timeStamp,e=a.target,g=a.changedTouches[0],h=b-this.startTime;this.lastEndTime=b;if(d&&(h=b-d,300>h)){this.lastEndTime=0;c.fire(e,"doubleTap",
{touch:g,duration:h/1E3});return}h=b-this.startTime;300<h?c.fire(e,"singleTap",{touch:g,duration:h/1E3}):this.singleTapTimer=setTimeout(function(){c.fire(e,"singleTap",{touch:g,duration:h/1E3})},300)}});b.singleTap=b.doubleTap=new a;return a},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch/gesture",function(e,b){var c=b.Gesture,d,a,f;e.Features.isTouchSupported()&&(d="touchstart",a="touchmove",f="touchend");d&&(c.start=d,c.move=a,c.end=f,c.tap="tap",c.doubleTap="doubleTap");return c},{requires:["event/dom/base"]});KISSY.add("event/dom/touch/handle-map",function(){return{}});
KISSY.add("event/dom/touch/handle",function(e,b,c,d,a){function f(g){this.doc=g;this.eventHandle={};this.init()}var j=e.guid("touch-handle"),n=e.Features,i={};i[a.start]="onTouchStart";i[a.move]="onTouchMove";i[a.end]="onTouchEnd";"mousedown"!==a.start&&(i.touchcancel="onTouchEnd");f.prototype={init:function(){var g=this.doc,a,f;this.onTouchMove=e.throttle(this.onTouchMove,30);for(a in i){f=i[a];d.on(g,a,this[f],this)}},normalize:function(g){var a=g.type,f;if(!n.isTouchSupported()){if(a.indexOf("mouse")!=
-1&&g.which!=1)return;f=[g];a=!a.match(/up$/i);g.touches=a?f:[];g.targetTouches=a?f:[];g.changedTouches=f}return g},onTouchStart:function(a){var f,b,d=this.eventHandle;for(f in d){b=d[f];b.isActive=1}this.callEventHandle("onTouchStart",a)},onTouchMove:function(a){this.callEventHandle("onTouchMove",a)},onTouchEnd:function(a){this.callEventHandle("onTouchEnd",a)},callEventHandle:function(a,f){var b=this.eventHandle,d,c;if(f=this.normalize(f)){for(d in b){c=b[d];if(!c.processed){c.processed=1;if(c.isActive&&
c[a](f)===false)c.isActive=0}}for(d in b){c=b[d];c.processed=0}}},addEventHandle:function(a){var f=c[a];this.eventHandle[a]||(this.eventHandle[a]=f)},removeEventHandle:function(a){delete this.eventHandle[a]},destroy:function(){var a=this.doc,f,b;for(f in i){b=i[f];d.detach(a,f,this[b],this)}}};return{addDocumentHandle:function(a,d){var c=b.getWindow(a.ownerDocument||a).document,e=b.data(c,j);e||b.data(c,j,e=new f(c));e.addEventHandle(d)},removeDocumentHandle:function(a,f){var d=b.getWindow(a.ownerDocument||
a).document,c=b.data(d,j);if(c){c.removeEventHandle(f);if(e.isEmptyObject(c.eventHandle)){c.destroy();b.removeData(d,j)}}}}},{requires:"dom,./handle-map,event/dom/base,./gesture,./tap,./swipe,./double-tap,./pinch,./tap-hold,./rotate".split(",")});
KISSY.add("event/dom/touch/multi-touch",function(e,b){function c(){}c.prototype={requiredTouchCount:2,onTouchStart:function(d){var a=this.requiredTouchCount,f=d.touches.length;f===a?this.start():f>a&&this.end(d)},onTouchEnd:function(d){this.end(d)},start:function(){this.isTracking||(this.isTracking=!0,this.isStarted=!1)},fireEnd:e.noop,getCommonTarget:function(d){var a=d.touches,d=a[0].target,a=a[1].target;if(d==a||b.contains(d,a))return d;for(;;){if(b.contains(a,d))return a;a=a.parentNode}},end:function(d){this.isTracking&&
(this.isTracking=!1,this.isStarted&&(this.isStarted=!1,this.fireEnd(d)))}};return c},{requires:["dom"]});
KISSY.add("event/dom/touch/pinch",function(e,b,c,d){function a(){}e.extend(a,d,{onTouchMove:function(a){if(this.isTracking){var d=a.touches,b,e=d[0],g=d[1];b=e.pageX-g.pageX;e=e.pageY-g.pageY;b=Math.sqrt(b*b+e*e);this.lastTouches=d;this.isStarted?c.fire(this.target,"pinch",{touches:d,distance:b,scale:b/this.startDistance}):(this.isStarted=!0,this.startDistance=b,a=this.target=this.getCommonTarget(a),c.fire(a,"pinchStart",{touches:d,distance:b,scale:1}))}},fireEnd:function(){c.fire(this.target,"pinchEnd",
{touches:this.lastTouches})}});b.pinch=b.pinchEnd=b.pinchEnd=new a;return a},{requires:["./handle-map","event/dom/base","./multi-touch"]});
KISSY.add("event/dom/touch/rotate",function(e,b,c,d,a){function f(){}var j=180/Math.PI;e.extend(f,c,{onTouchMove:function(f){if(this.isTracking){var b=f.touches,c=b[0],e=b[1],k=this.lastAngle,c=Math.atan2(e.pageY-c.pageY,e.pageX-c.pageX)*j;if(k!==a){var e=Math.abs(c-k),l=(c+360)%360,m=(c-360)%360;Math.abs(l-k)<e?c=l:Math.abs(m-k)<e&&(c=m)}this.lastTouches=b;this.lastAngle=c;this.isStarted?d.fire(this.target,"rotate",{touches:b,originalEvent:f.originalEvent,angle:c,rotation:c-this.startAngle}):(this.isStarted=
!0,this.startAngle=c,this.target=this.getCommonTarget(f),d.fire(this.target,"rotateStart",{originalEvent:f.originalEvent,touches:f.touches,angle:c,rotation:0}))}},end:function(){this.lastAngle=a;f.superclass.end.apply(this,arguments)},fireEnd:function(a){d.fire(this.target,"rotateEnd",{touches:this.lastTouches,originalEvent:a.originalEvent})}});b.rotate=b.rotateEnd=b.rotateStart=new f;return f},{requires:["./handle-map","./multi-touch","event/dom/base"]});
KISSY.add("event/dom/touch/single-touch",function(e){function b(){}b.prototype={requiredTouchCount:1,onTouchStart:function(b){if(b.touches.length!=this.requiredTouchCount)return!1;this.lastTouches=b.touches},onTouchMove:e.noop,onTouchEnd:e.noop};return b});
KISSY.add("event/dom/touch/swipe",function(e,b,c,d){function a(){}e.extend(a,d,{onTouchStart:function(f){if(!1===a.superclass.onTouchStart.apply(this,arguments))return!1;var b=f.touches[0];this.startTime=f.timeStamp;this.isVertical=this.isHorizontal=1;this.startX=b.pageX;this.startY=b.pageY;-1!=f.type.indexOf("mouse")&&f.preventDefault()},onTouchMove:function(a){var b=a.changedTouches[0],c=b.pageY,b=Math.abs(b.pageX-this.startX),c=Math.abs(c-this.startY);if(1E3<a.timeStamp-this.startTime)return!1;
this.isVertical&&35<b&&(this.isVertical=0);this.isHorizontal&&35<c&&(this.isHorizontal=0);if(!this.isHorizontal&&!this.isVertical)return!1},onTouchEnd:function(a){if(!1===this.onTouchMove(a))return!1;var b=a.changedTouches[0],d=b.pageX-this.startX,e=b.pageY-this.startY,g=Math.abs(d),h=Math.abs(e);this.isVertical&&50>h&&(this.isVertical=0);this.isHorizontal&&50>g&&(this.isHorizontal=0);if(this.isHorizontal)d=0>d?"left":"right";else if(this.isVertical)d=0>e?"up":"down",g=h;else return!1;c.fire(a.target,
"swipe",{touch:b,direction:d,distance:g,duration:(a.timeStamp-this.startTime)/1E3})}});b.swipe=new a;return a},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch/tap-hold",function(e,b,c,d){function a(){}e.extend(a,c,{onTouchStart:function(b){if(!1===a.superclass.onTouchStart.call(this,b))return!1;this.timer=setTimeout(function(){d.fire(b.target,"tapHold",{touch:b.touches[0],duration:(e.now()-b.timeStamp)/1E3})},1E3)},onTouchMove:function(){clearTimeout(this.timer);return!1},onTouchEnd:function(){clearTimeout(this.timer)}});b.tapHold=new a;return a},{requires:["./handle-map","./single-touch","event/dom/base"]});
KISSY.add("event/dom/touch/tap",function(e,b,c,d){function a(){}e.extend(a,d,{onTouchMove:function(){return!1},onTouchEnd:function(a){c.fire(a.target,"tap",{touch:a.changedTouches[0]})}});b.tap=new a;return a},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch",function(e,b,c,d){var e=b._Special,b={setup:function(a){d.addDocumentHandle(this,a)},tearDown:function(a){d.removeDocumentHandle(this,a)}},a;for(a in c)e[a]=b},{requires:["event/dom/base","./touch/handle-map","./touch/handle"]});
