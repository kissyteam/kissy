modulex.add("event-dom/hashchange",["modulex-util","event-dom/base","dom","ua"],function(t,e,n){var o,a=t("modulex-util"),i=t("event-dom/base"),c=t("dom"),r=t("ua");o=function(t){function e(){var t=location.href.match(/#.+$/);return t&&t[0]||"#"}function n(){s.fireHandler(y,_,{newURL:location.href,oldURL:u+l}),l=e()}function o(t){return t.contentWindow.document}t={};var d,h,u,l,m=a,s=i,f=c,p=r,v=s.Special,y=window,w=y.document,x="__ks_replace_history__",b=p.ieMode,_="hashchange",g=50,E="<html><head><title>"+(w&&w.title||"")+" - {hash}</title>{head}</head><body>{hash}</body></html>";s.REPLACE_HISTORY=x,d=b&&8>b?function(t,e){var n=m.substitute(E,{hash:m.escapeHtml(t),head:f.isCustomDomain()?'<script>document.domain = "'+w.domain+'";</script>':""}),a=o(h);try{e?a.open("text/html","replace"):a.open(),a.write(n),a.close()}catch(i){}}:function(){n()};var T,R=function(){var t=e(),n=0;-1!==t.indexOf(x)&&(n=1,t=t.replace(x,""),location.hash=t),t!==l&&d(t,n),T=setTimeout(R,g)},H=function(){T||R()},L=function(){T&&clearTimeout(T),T=0};return b&&8>b&&(H=function(){if(!h){var t=f.getEmptyIframeSrc();h=f.create("<iframe "+(t?'src="'+t+'"':"")+' style="display: none" height="0" width="0" tabindex="-1" title="empty"/>'),f.prepend(h,w.documentElement),s.add(h,"load",function(){s.remove(h,"load"),d(e()),s.add(h,"load",a),R()}),w.attachEvent("propertychange",function(t){t=t||window.event;try{"title"===t.propertyName&&(o(h).title=w.title+" - "+e())}catch(t){}});var a=function(){location.hash=m.trim(o(h).body.innerText),n()}}},L=function(){T&&clearTimeout(T),T=0,s.detach(h),f.remove(h),h=0}),v[_]={setup:function(){this===y&&(l=e(),u=location.href.replace(/#.+/,""),H())},tearDown:function(){this===y&&L()}},t}(),n.exports=o});