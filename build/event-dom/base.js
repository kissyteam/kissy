modulex.add("event-dom/base",["dom","event-base","modulex-util","ua"],function(e,t,r){var n,a,o,i,c,s,u,l,f,v,d=e("dom"),E=e("event-base"),g=e("modulex-util"),p=e("ua");n=function(e){e={};var t=d,r="ksEventTargetId_"+ +new Date,n=document,a=n&&n.addEventListener?function(e,t,r,n){e.addEventListener&&e.addEventListener(t,r,!!n)}:function(e,t,r){e.attachEvent&&e.attachEvent("on"+t,r)},o=n&&n.removeEventListener?function(e,t,r,n){e.removeEventListener&&e.removeEventListener(t,r,!!n)}:function(e,t,r){e.detachEvent&&e.detachEvent("on"+t,r)};return e={simpleAdd:a,simpleRemove:o,data:function(e,n){return t.data(e,r,n)},removeData:function(e){return t.removeData(e,r)}}}(),a=function(e){return e={},e={}}(),o=function(e){function t(e){t.superclass.constructor.call(this,e)}e={};var r=E,n=a,o=g;return o.extend(t,r.Observer,{keys:["fn","filter","data","context","originalType","groups","last"],notifyInternal:function(e,t){var r,a,o,i,c=this,s=e.type;return(i=c.config.originalType)?e.type=i:i=s,(r=n[i])&&r.handle?(a=r.handle(e,c,t),a&&a.length>0&&(o=a[0])):o=c.simpleNotify(e,t),o===!1&&e.halt(),e.type=s,o}}),e=t}(),i=function(e){function t(){return c}function r(){return s}function n(e){var a=this,c=e.type,f="function"==typeof e.stopPropagation||"boolean"==typeof e.cancelBubble;n.superclass.constructor.call(a),a.originalEvent=e;var v=r;"defaultPrevented"in e?v=e.defaultPrevented?t:r:"getPreventDefault"in e?v=e.getPreventDefault()?t:r:"returnValue"in e&&(v=e.returnValue===s?t:r),a.isDefaultPrevented=v;var d,E,g,p=[],h=u.concat();for(o.each(l,function(e){return c.match(e.reg)&&(h=h.concat(e.props),e.fix&&p.push(e.fix)),void 0}),E=h.length;E;)g=h[--E],a[g]=e[g];for(!a.target&&f&&(a.target=e.srcElement||i),a.target&&3===a.target.nodeType&&(a.target=a.target.parentNode),E=p.length;E;)d=p[--E],d(a,e);a.timeStamp=e.timeStamp||o.now()}e={};var a=E,o=g,i=document,c=!0,s=!1,u=["altKey","bubbles","cancelable","ctrlKey","currentTarget","eventPhase","metaKey","shiftKey","target","timeStamp","view","type"],l=[{reg:/^key/,props:["char","charCode","key","keyCode","which"],fix:function(e,t){null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),void 0===e.metaKey&&(e.metaKey=e.ctrlKey)}},{reg:/^touch/,props:["touches","changedTouches","targetTouches"]},{reg:/^hashchange$/,props:["newURL","oldURL"]},{reg:/^gesturechange$/i,props:["rotation","scale"]},{reg:/^(mousewheel|DOMMouseScroll)$/,props:[],fix:function(e,t){var r,n,a,o=t.wheelDelta,i=t.axis,c=t.wheelDeltaY,s=t.wheelDeltaX,u=t.detail;o&&(a=o/120),u&&(a=0-(u%3===0?u/3:u)),void 0!==i&&(i===e.HORIZONTAL_AXIS?(n=0,r=0-a):i===e.VERTICAL_AXIS&&(r=0,n=a)),void 0!==c&&(n=c/120),void 0!==s&&(r=-1*s/120),r||n||(n=a),void 0!==r&&(e.deltaX=r),void 0!==n&&(e.deltaY=n),void 0!==a&&(e.delta=a)}},{reg:/^mouse|contextmenu|click|mspointer|(^DOMMouseScroll$)/i,props:["buttons","clientX","clientY","button","offsetX","relatedTarget","which","fromElement","toElement","offsetY","pageX","pageY","screenX","screenY"],fix:function(e,t){var r,n,a,o=e.target,c=t.button;return o&&null==e.pageX&&null!=t.clientX&&(r=o.ownerDocument||i,n=r.documentElement,a=r.body,e.pageX=t.clientX+(n&&n.scrollLeft||a&&a.scrollLeft||0)-(n&&n.clientLeft||a&&a.clientLeft||0),e.pageY=t.clientY+(n&&n.scrollTop||a&&a.scrollTop||0)-(n&&n.clientTop||a&&a.clientTop||0)),e.which||void 0===c||(e.which=1&c?1:2&c?3:4&c?2:0),!e.relatedTarget&&e.fromElement&&(e.relatedTarget=e.fromElement===o?e.toElement:e.fromElement),e}}];return o.extend(n,a.Object,{constructor:n,preventDefault:function(){var e=this,t=e.originalEvent;t.preventDefault?t.preventDefault():t.returnValue=s,n.superclass.preventDefault.call(e)},stopPropagation:function(){var e=this,t=e.originalEvent;t.stopPropagation?t.stopPropagation():t.cancelBubble=c,n.superclass.stopPropagation.call(e)}}),e=n}(),c=function(e){e={};var t={MAC_ENTER:3,BACKSPACE:8,TAB:9,NUM_CENTER:12,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PRINT_SCREEN:44,INSERT:45,DELETE:46,ZERO:48,ONE:49,TWO:50,THREE:51,FOUR:52,FIVE:53,SIX:54,SEVEN:55,EIGHT:56,NINE:57,QUESTION_MARK:63,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,META:91,WIN_KEY_RIGHT:92,CONTEXT_MENU:93,NUM_ZERO:96,NUM_ONE:97,NUM_TWO:98,NUM_THREE:99,NUM_FOUR:100,NUM_FIVE:101,NUM_SIX:102,NUM_SEVEN:103,NUM_EIGHT:104,NUM_NINE:105,NUM_MULTIPLY:106,NUM_PLUS:107,NUM_MINUS:109,NUM_PERIOD:110,NUM_DIVISION:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUMLOCK:144,SEMICOLON:186,DASH:189,EQUALS:187,COMMA:188,PERIOD:190,SLASH:191,APOSTROPHE:192,SINGLE_QUOTE:222,OPEN_SQUARE_BRACKET:219,BACKSLASH:220,CLOSE_SQUARE_BRACKET:221,WIN_KEY:224,MAC_FF_META:224,WIN_IME:229};return t.isTextModifyingKeyEvent=function(e){var r=e.keyCode;if(e.altKey&&!e.ctrlKey||e.metaKey||r>=t.F1&&r<=t.F12)return!1;switch(r){case t.ALT:case t.CAPS_LOCK:case t.CONTEXT_MENU:case t.CTRL:case t.DOWN:case t.END:case t.ESC:case t.HOME:case t.INSERT:case t.LEFT:case t.MAC_FF_META:case t.META:case t.NUMLOCK:case t.NUM_CENTER:case t.PAGE_DOWN:case t.PAGE_UP:case t.PAUSE:case t.PRINT_SCREEN:case t.RIGHT:case t.SHIFT:case t.UP:case t.WIN_KEY:case t.WIN_KEY_RIGHT:return!1;default:return!0}},t.isCharacterKey=function(e){if(e>=t.ZERO&&e<=t.NINE)return!0;if(e>=t.NUM_ZERO&&e<=t.NUM_MULTIPLY)return!0;if(e>=t.A&&e<=t.Z)return!0;if(-1!==window.navigation.userAgent.indexOf("WebKit")&&0===e)return!0;switch(e){case t.SPACE:case t.QUESTION_MARK:case t.NUM_PLUS:case t.NUM_MINUS:case t.NUM_PERIOD:case t.NUM_DIVISION:case t.SEMICOLON:case t.DASH:case t.EQUALS:case t.COMMA:case t.PERIOD:case t.SLASH:case t.APOSTROPHE:case t.SINGLE_QUOTE:case t.OPEN_SQUARE_BRACKET:case t.BACKSLASH:case t.CLOSE_SQUARE_BRACKET:return!0;default:return!1}},e=t}(),s=function(e){e={};var t=d,r=a,n=g;return n.each([{name:"mouseenter",fix:"mouseover"},{name:"mouseleave",fix:"mouseout"}],function(e){r[e.name]={typeFix:e.fix,handle:function(e,r,n){var a=e.currentTarget,o=e.relatedTarget;return!o||o!==a&&!t.contains(a,o)?[r.simpleNotify(e,n)]:void 0}}}),e}(),u=function(e){function t(e){var t=this;r.mix(t,e),t.reset()}e={};var r=g,c=E,s=d,u=a,l=n,f=o,v=i,p=c.Utils;return r.extend(t,c.Observable,{constructor:t,setup:function(){var e=this,t=e.type,r=u[t]||{},n=e.currentTarget,a=l.data(n),o=a.handle;r.setup&&r.setup.call(n,t)!==!1||l.simpleAdd(n,t,o)},reset:function(){var e=this;t.superclass.reset.call(e),e.delegateCount=0,e.lastCount=0},notify:function(e){var t,r,n,a,o,i,c,u,l,f,v=e.target,d=e.type,E=this,g=E.currentTarget,p=E.observers,h=[],m=E.delegateCount||0;if(m&&v.nodeType)for(;v!==g;){if(v.disabled!==!0||"click"!==d){var T,b,N,O={};for(u=[],o=0;m>o;o++)f=p[o],N=f.config.filter,b=N+"",T=O[b],void 0===T&&(T=O[b]=s.test(v,N)),T&&u.push(f);u.length&&h.push({currentTarget:v,currentTargetObservers:u})}v=v.parentNode||g}for(m<p.length&&h.push({currentTarget:g,currentTargetObservers:p.slice(m)}),o=0,c=h.length;!e.isPropagationStopped()&&c>o;++o)for(a=h[o],u=a.currentTargetObservers,t=a.currentTarget,e.currentTarget=t,i=0;!e.isImmediatePropagationStopped()&&i<u.length;i++)l=u[i],r=l.notify(e,E),n!==!1&&void 0!==r&&(n=r);return n},fire:function(e,n){e=e||{};var a,o,i=this,c=String(i.type),l=u[c]||{},f=l.bubbles!==!1,d=i.currentTarget;if(!(l.fire&&l.fire.call(d,n)===!1||(e.isEventObject||(o=e,e=new v({type:c}),r.mix(e,o)),e.currentTarget=d,e.target=e.target||d,l.preFire&&l.preFire.call(d,e,n)===!1))){var E,g,p=d,h=s.getWindow(p),m=h.document,T=[],b="on"+c,N=0;do T.push(p),p=p.parentNode||p.ownerDocument||p===m&&h;while(!n&&p&&f);p=T[N];do e.currentTarget=p,a=t.getDomEventObservable(p,c),a&&(g=a.notify(e),void 0!==g&&E!==!1&&(E=g)),p[b]&&p[b].call(p)===!1&&e.preventDefault(),p=T[++N];while(!n&&p&&!e.isPropagationStopped());if(!n&&!e.isDefaultPrevented()){try{d[c]&&!r.isWindow(d)&&(t.triggeredEvent=c,d[c]())}catch(O){console.error("event-dom: trigger action error: "+O)}t.triggeredEvent=""}return E}},on:function(e){var t=this,r=t.observers,n=u[t.type]||{},a=e instanceof f?e:new f(e);-1===t.findObserver(a)&&(a.config.filter?(r.splice(t.delegateCount,0,a),t.delegateCount++):a.config.last?(r.push(a),t.lastCount++):r.splice(r.length-t.lastCount,0,a),n.add&&n.add.call(t.currentTarget,a))},detach:function(e){var t,r=this,n=u[r.type]||{},a="filter"in e,o=e.filter,i=e.context,c=e.fn,s=r.currentTarget,l=r.observers,f=e.groups;if(l.length){f&&(t=p.getGroupsRe(f));var v,d,E,g,h,m=l.length;if(c||a||t){for(i=i||s,v=0,d=0,E=[];m>v;++v){g=l[v];var T=g.config;h=T.context||s,i!==h||c&&c!==T.fn||a&&(o&&o!==T.filter||!o&&!T.filter)||t&&!T.groups.match(t)?E[d++]=g:(T.filter&&r.delegateCount&&r.delegateCount--,T.last&&r.lastCount&&r.lastCount--,n.remove&&n.remove.call(s,g))}r.observers=E}else r.reset();r.checkMemory()}},checkMemory:function(){var e,t,n=this,a=n.type,o=u[a]||{},i=n.currentTarget,c=l.data(i);c&&(e=c.observables,n.hasObserver()||(t=c.handle,o.tearDown&&o.tearDown.call(i,a)!==!1||l.simpleRemove(i,a,t),delete e[a]),r.isEmptyObject(e)&&(c.handle=null,l.removeData(i)))}}),t.triggeredEvent="",t.getDomEventObservable=function(e,t){var r,n=l.data(e);return n&&(r=n.observables),r?r[t]:null},t.getDomEventObservablesHolder=function(e,t){var r=l.data(e);return!r&&t&&l.data(e,r={}),r},e=t}(),l=function(e){function t(e,t){var r,n=f[t]||{};return!e.originalType&&(r=n.typeFix)&&(e.originalType=t,t=r),t}function r(e,r,n){var a,o,i,c;n=h.merge(n),r=t(n,r),a=v.getDomEventObservablesHolder(e,1),(c=a.handle)||(c=a.handle=function(e){var t,r=e.type,n=c.currentTarget;return v.triggeredEvent===r?void 0:(t=v.getDomEventObservable(n,r),t?(e.currentTarget=n,e=new p(e),t.notify(e)):void 0)},c.currentTarget=e),(i=a.observables)||(i=a.observables={}),o=i[r],o||(o=i[r]=new v({type:r,currentTarget:e}),o.setup()),o.on(n),e=null}function o(e,r,n){n=h.merge(n);var a;r=t(n,r);var o=v.getDomEventObservablesHolder(e),i=(o||{}).observables;if(o&&i)if(r)a=i[r],a&&a.detach(n);else for(r in i)i[r].detach(n)}e={};var c=E,s=n,l=d,f=a,v=u,p=i,h=g,m=c.Utils,T={on:function(e,t,n,a){return e=l.query(e),m.batchForType(function(e,t,n,a){var o,i,c=m.normalizeParam(t,n,a);for(t=c.type,o=e.length-1;o>=0;o--)i=e[o],r(i,t,c)},1,e,t,n,a),e},detach:function(e,t,r,n){return e=l.query(e),m.batchForType(function(e,t,r,n){var a,i,c,s,u=m.normalizeParam(t,r,n);for(t=u.type,a=e.length-1;a>=0;a--)if(s=e[a],o(s,t,u),u.deep&&s.getElementsByTagName)for(c=s.getElementsByTagName("*"),i=c.length-1;i>=0;i--)o(c[i],t,u)},1,e,t,r,n),e},delegate:function(e,t,r,n,a){return T.on(e,t,{fn:n,context:a,filter:r})},undelegate:function(e,t,r,n,a){return T.detach(e,t,{fn:n,context:a,filter:r})},fire:function(e,t,r,n){var a;return t.isEventObject&&(r=t,t=t.type),r=r||{},r.synthetic=1,m.splitAndRun(t,function(t){var o,i,c,s;m.fillGroupsForEvent(t,r),t=r.type;var u=f[t],d=t;for(u&&u.typeFix&&(d=u.typeFix),e=l.query(e),i=e.length-1;i>=0;i--)c=e[i],s=v.getDomEventObservable(c,d),n||s||(s=new v({type:d,currentTarget:c})),s&&(o=s.fire(r,n),a!==!1&&void 0!==o&&(a=o))}),a},fireHandler:function(e,t,r){return T.fire(e,t,r,1)},clone:function(e,t){var n,a;if(n=v.getDomEventObservablesHolder(e)){var o=s.data(e);o&&o===s.data(t)&&s.removeData(t),a=n.observables,h.each(a,function(e,n){h.each(e.observers,function(e){r(t,n,e.config)})})}},getEventListeners:function(e,t){var r=(v.getDomEventObservablesHolder(e)||{observables:{}}).observables;return t?r[t]:r}};return e=T}(),f=function(e){e={};var t=l,r=a,n=g,o=p,i=o.gecko?"DOMMouseScroll":"mousewheel";return e=n.mix(r,{mousewheel:{typeFix:i},load:{bubbles:!1},click:{fire:function(e){var t=this;return!e&&"checkbox"===String(t.type)&&t.click&&"input"===t.nodeName.toLowerCase()?(t.click(),!1):void 0}},focus:{bubbles:!1,preFire:function(e,r){return r?void 0:t.fire(this,"focusin")},fire:function(e){var t=this;return!e&&t.ownerDocument&&t!==t.ownerDocument.activeElement&&t.focus?(t.focus(),!1):void 0}},blur:{bubbles:!1,preFire:function(e,r){return r?void 0:t.fire(this,"focusout")},fire:function(e){var t=this;return!e&&t.ownerDocument&&t===t.ownerDocument.activeElement&&t.blur?(t.blur(),!1):void 0}}})}(),v=function(e){e={};var t=l,r=i,a=c,o=f,s=n,v=g;return e=v.merge({version:"1.0.0",add:t.on,remove:t.detach,KeyCode:a,Observable:u,Special:o,Object:r,Utils:s},t)}(),r.exports=v});