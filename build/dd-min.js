/*
Copyright 2011, KISSY UI Library v1.20dev
MIT Licensed
build time: Nov 22 10:42
*/
KISSY.add("dd/ddm",function(j,r,m,k,i){function c(){c.superclass.constructor.apply(this,arguments);this._showShimMove=j.throttle(h,A,this)}function h(b){var f=this.get("activeDrag");if(f){b.preventDefault();f._move(b);a(this,b)}}function a(b,f){var n=b.get("activeDrag"),u=n.get("mode"),y=b.get("drops"),q,x=0,v=l(n.get("node")),D=s(v);j.each(y,function(B){var t=B.getNodeFromTarget(f,n.get("dragNode")[0],n.get("node")[0]);if(t)if(u=="point"){if(o(l(t),n.mousePos)){t=s(l(t));if(q){if(t<x){q=B;x=t}}else{q=
B;x=t}}}else if(u=="intersect"){t=s(C(v,l(t)));if(t>x){x=t;q=B}}else if(u=="strict"){t=s(C(v,l(t)));if(t==D){q=B;return false}}});if((y=b.get("activeDrop"))&&y!=q){y._handleOut(f);n._handleOut(f)}b.set("activeDrop",q);if(q)y!=q?q._handleEnter(f):q._handleOver(f)}function e(b,f){b.set("activeDrag",f);f.get("shim")&&d(b);f._start();b.fire("dragstart",{drag:f})}function d(b){var f=document;b._shim=(new k("<div style='background-color:red;position:absolute;left:0;width:100%;top:0;cursor:move;z-index:"+
z+";'></div>")).prependTo(f.body||f.documentElement).css("opacity",0);d=g;g(b)}function g(b){b._shim.css({display:"",height:r.docHeight()})}function p(b){m.on(w,"mouseup",b._end,b);m.on(w,"mousemove",b._showShimMove,b)}function l(b){var f=b.offset();return{left:f.left,right:f.left+b.outerWidth(),top:f.top,bottom:f.top+b.outerHeight()}}function o(b,f){return b.left<=f.left&&b.right>=f.left&&b.top<=f.top&&b.bottom>=f.top}function s(b){if(b.top>=b.bottom||b.left>=b.right)return 0;return(b.right-b.left)*
(b.bottom-b.top)}function C(b,f){return{left:Math.max(b.left,f.left),right:Math.min(b.right,f.right),top:Math.max(b.top,f.top),bottom:Math.min(b.bottom,f.bottom)}}var w=document,A=30,z=999999;c.ATTRS={prefixCls:{value:"ks-dd-"},bufferTime:{value:200},activeDrag:{},activeDrop:{},drops:{value:[]}};j.extend(c,i,{_regDrop:function(b){this.get("drops").push(b)},_unregDrop:function(b){b=j.indexOf(b,this.get("drops"));b!=-1&&this.get("drops").splice(b,1)},_start:function(b){var f=this,n=f.get("bufferTime")||
0;p(f);if(n)f._bufferTimer=setTimeout(function(){e(f,b)},n);else e(f,b)},_end:function(){var b=this.get("activeDrag"),f=this.get("activeDrop"),n={drag:b,drop:f};m.remove(w,"mousemove",this._showShimMove,this);m.remove(w,"mouseup",this._end,this);if(this._bufferTimer){clearTimeout(this._bufferTimer);this._bufferTimer=null}this._shim&&this._shim.hide();if(b){b._end();if(f){f._end();this.fire("drophit",n);this.fire("dragdrophit",n)}else this.fire("dragdropmiss",{drag:b});this.fire("dragend",{drag:b});
this.set("activeDrag",null);this.set("activeDrop",null)}}});i=new c;i.inRegion=o;i.region=l;i.area=s;return i},{requires:["dom","event","node","base"]});
KISSY.add("dd/draggable",function(j,r,m,k,i){function c(){c.superclass.constructor.apply(this,arguments);this._init()}var h=j.each;c.POINT="point";c.INTERSECT="intersect";c.STRICT="strict";c.ATTRS={node:{setter:function(a){return m.one(a)}},dragNode:{},shim:{value:true},handlers:{value:[],getter:function(a){var e=this,d=e.get("cursor");a.length||(a[0]=e.get("node"));h(a,function(g,p){if(j.isFunction(g))g=g.call(e);if(j.isString(g)||g.nodeType)g=m.one(g);g.unselectable();d&&g.css("cursor",d);a[p]=
g});e.__set("handlers",a);return a}},cursor:{value:"move"},mode:{value:"point"}};j.extend(c,k,{_init:function(){var a=this.get("node");this.set("dragNode",a);a.on("mousedown",this._handleMouseDown,this)},destroy:function(){var a=this.get("dragNode"),e=this.get("handlers");h(e,function(d){d.css("cursor","auto")});a.detach("mousedown",this._handleMouseDown,this);this.detach()},_check:function(a){var e=this.get("handlers"),d=0;h(e,function(g){if(g.contains(a)||g[0]==a[0]){d=1;return false}});return d},
_handleMouseDown:function(a){if(this._check(new m(a.target))){a.preventDefault();this._prepare(a)}},_prepare:function(a){i._start(this);var e=this.get("node"),d=a.pageX;a=a.pageY;e=e.offset();this.startMousePos=this.mousePos={left:d,top:a};this.startNodePos=e;this._diff={left:d-e.left,top:a-e.top}},_move:function(a){var e=this._diff,d=a.pageX-e.left;e=a.pageY-e.top;this.mousePos={left:a.pageX,top:a.pageY};a={left:d,top:e,pageX:a.pageX,pageY:a.pageY,drag:this};this.fire("drag",a);i.fire("drag",a)},
_end:function(){var a;this.get("dragNode").removeClass(i.get("prefixCls")+"dragging");this.get("node").removeClass(i.get("prefixCls")+"drag-over");(a=i.get("activeDrop"))?this.fire("dragdrophit",{drag:this,drop:a}):this.fire("dragdropmiss",{drag:this});this.fire("dragend",{drag:this})},_handleOut:function(){this.get("node").removeClass(i.get("prefixCls")+"drag-over");this.fire("dragexit",{drag:this,drop:i.get("activeDrop")})},_handleEnter:function(a){this.get("node").addClass(i.get("prefixCls")+"drag-over");
this.fire("dragenter",a)},_handleOver:function(a){this.fire("dragover",a)},_start:function(){this.get("dragNode").addClass(i.get("prefixCls")+"dragging");this.fire("dragstart",{drag:this})}});return c},{requires:["ua","node","base","./ddm"]});
KISSY.add("dd/droppable",function(j,r,m,k){function i(){i.superclass.constructor.apply(this,arguments);this._init()}i.ATTRS={node:{setter:function(c){if(c)return r.one(c)}}};j.extend(i,m,{getNodeFromTarget:function(c,h,a){c=this.get("node");var e=c[0];return e==h||e==a?null:c},_init:function(){k._regDrop(this)},__getCustomEvt:function(c){return j.mix({drag:k.get("activeDrag"),drop:this},c)},_handleOut:function(){var c=this.__getCustomEvt();this.get("node").removeClass(k.get("prefixCls")+"drop-over");
this.fire("dropexit",c);k.fire("dropexit",c);k.fire("dragexit",c)},_handleEnter:function(c){c=this.__getCustomEvt(c);c.drag._handleEnter(c);this.get("node").addClass(k.get("prefixCls")+"drop-over");this.fire("dropenter",c);k.fire("dragenter",c);k.fire("dropenter",c)},_handleOver:function(c){c=this.__getCustomEvt(c);c.drag._handleOver(c);this.fire("dropover",c);k.fire("dragover",c);k.fire("dropover",c)},_end:function(){var c=this.__getCustomEvt();this.get("node").removeClass(k.get("prefixCls")+"drop-over");
this.fire("drophit",c)},destroy:function(){k._unregDrop(this)}});return i},{requires:["node","base","./ddm"]});
KISSY.add("dd/proxy",function(j,r){function m(){m.superclass.constructor.apply(this,arguments);this[k]={}}var k="__proxy_destructors",i=j.stamp,c=j.guid("__dd_proxy"),h="__proxy";m.ATTRS={node:{value:function(a){return new r(a.get("node").clone(true))}},destroyOnEnd:{value:false}};j.extend(m,j.Base,{attach:function(a){function e(){var l=g.get("node"),o=a.get("node");if(g[h])l=g[h];else if(j.isFunction(l)){l=l(a);l.addClass("ks-dd-proxy");l.css("position","absolute");g[h]=l}o.parent().append(l);l.show();
l.offset(o.offset());a.set("dragNode",o);a.set("node",l)}function d(){var l=g[h];a.get("dragNode").offset(l.offset());l.hide();if(g.get("destroyOnEnd")){l.remove();g[h]=0}a.set("node",a.get("dragNode"))}var g=this,p;if(!(p=i(a,1,c)&&g[k][p])){a.on("dragstart",e);a.on("dragend",d);p=i(a,0,c);g[k][p]={drag:a,fn:function(){a.detach("dragstart",e);a.detach("dragend",d)}}}},unAttach:function(a){a=i(a,1,c);var e=this[k];if(a&&e[a]){e[a].fn();delete e[a]}},destroy:function(){var a=this.get("node"),e=this[k];
a&&!j.isFunction(a)&&a.remove();for(var d in e)this.unAttach(e[d].drag)}});return m},{requires:["node"]});
KISSY.add("dd/draggable-delegate",function(j,r,m,k,i){function c(){c.superclass.constructor.apply(this,arguments)}j.extend(c,m,{_init:function(){this.get("container").on("mousedown",this._handleMouseDown,this)},_getHandler:function(h){for(var a,e=this.get("container"),d=this.get("handlers");h&&h[0]!==e[0];){j.each(d,function(g){if(k.test(h[0],g)){a=h;return false}});if(a)break;h=h.parent()}return a},_getNode:function(h){return h.closest(this.get("selector"),this.get("container"))},_handleMouseDown:function(h){var a;
a=this.get("handlers");var e=new i(h.target);if(a=(a=a.length?this._getHandler(e):e)&&this._getNode(a)){h.preventDefault();this.set("node",a);this.set("dragNode",a);this._prepare(h)}},destroy:function(){this.get("container").detach("mousedown",this._handleMouseDown,this);this.detach()}},{ATTRS:{container:{setter:function(h){return i.one(h)}},selector:{},handlers:{value:[],getter:0}}});return c},{requires:["./ddm","./draggable","dom","node"]});
KISSY.add("dd/droppable-delegate",function(j,r,m,k,i){function c(){var a=this.get("container"),e=this.get("selector");this.__allNodes=a.all(e)}function h(){h.superclass.constructor.apply(this,arguments);r.on("dragstart",c,this)}j.extend(h,m,{getNodeFromTarget:function(a,e,d){var g={left:a.pageX,top:a.pageY};a=this.__allNodes;var p=0,l=Number.MAX_VALUE;a&&a.each(function(o){var s=o[0];if(!(s===d||s===e))if(r.inRegion(r.region(o),g)){s=r.area(r.region(o));if(s<l){l=s;p=o}}});if(p){this.set("lastNode",
this.get("node"));this.set("node",p)}return p},_handleOut:function(){h.superclass._handleOut.apply(this,arguments);this.set("node",0);this.set("lastNode",0)},_handleOver:function(a){var e=this.get("node"),d=h.superclass._handleOut,g=h.superclass._handleOver,p=h.superclass._handleEnter,l=this.get("lastNode");if(l[0]!==e[0]){this.set("node",l);d.apply(this,arguments);this.set("node",e);p.call(this,a)}else g.call(this,a)}},{ATTRS:{lastNode:{},selector:{},container:{setter:function(a){return i.one(a)}}}});
return h},{requires:["./ddm","./droppable","dom","node"]});
KISSY.add("dd/scroll",function(j,r,m,k){function i(){i.superclass.constructor.apply(this,arguments);this[a]={}}var c=j.stamp,h=100,a="__dd_scrolls";i.ATTRS={node:{valueFn:function(){return m.one(window)},setter:function(d){return m.one(d)}},rate:{value:[10,10]},diff:{value:[20,20]}};var e=j.isWindow;j.extend(i,r,{getRegion:function(d){return e(d[0])?{width:k.viewportWidth(),height:k.viewportHeight()}:{width:d.outerWidth(),height:d.outerHeight()}},getOffset:function(d){return e(d[0])?{left:k.scrollLeft(),
top:k.scrollTop()}:d.offset()},getScroll:function(d){return{left:d.scrollLeft(),top:d.scrollTop()}},setScroll:function(d,g){d.scrollLeft(g.left);d.scrollTop(g.top)},unAttach:function(d){var g,p=this[a];if((g=c(d,1,"__dd-scroll-id-"))&&p[g]){p[g].fn();delete p[g]}},destroy:function(){var d=this[a],g;for(g in d)this.unAttach(d[g].drag)},attach:function(d){function g(n){if(!n.fake){var u=o.get("node");z=n;b=j.clone(d.mousePos);n=o.getOffset(u);b.left-=n.left;b.top-=n.top;f||l()}}function p(){clearTimeout(f);
f=null}function l(){var n=o.get("node"),u=o.getRegion(n),y=u.width;u=u.height;var q=o.getScroll(n),x=j.clone(q),v=false;if(b.top-u>=-A[1]){q.top+=w[1];v=true}if(b.top<=A[1]){q.top-=w[1];v=true}if(b.left-y>=-A[0]){q.left+=w[0];v=true}if(b.left<=A[0]){q.left-=w[0];v=true}if(v){o.setScroll(n,q);f=setTimeout(l,h);z.fake=true;if(e(n[0])){q=o.getScroll(n);z.left+=q.left-x.left;z.top+=q.top-x.top}d.fire("drag",z)}else f=null}var o=this,s=c(d,0,"__dd-scroll-id-"),C=o[a];if(!C[s]){var w=o.get("rate"),A=o.get("diff"),
z,b,f=null;d.on("drag",g);d.on("dragend",p);C[s]={drag:d,fn:function(){d.detach("drag",g);d.detach("dragend",p)}}}}});return i},{requires:["base","node","dom"]});KISSY.add("dd",function(j,r,m,k,i,c,h,a){r={Draggable:m,Droppable:k,DDM:r,Proxy:i,DraggableDelegate:c,DroppableDelegate:h,Scroll:a};j.mix(j,r);return r},{requires:["dd/ddm","dd/draggable","dd/droppable","dd/proxy","dd/draggable-delegate","dd/droppable-delegate","dd/scroll"]});
