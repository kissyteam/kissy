/*
Copyright 2012, KISSY UI Library v1.30rc
MIT Licensed
build time: Sep 10 10:08
*/
KISSY.add("dd/constrain",function(g,l,k){function j(){j.superclass.constructor.apply(this,arguments);this[c]={}}function h(c){var b,o,c=c.drag.get("dragNode"),a=this.get("constrain");if(a){if(!0===a||a.setTimeout){var e;e=!0===a?d(f):d(a);this.__constrainRegion={left:b=e.scrollLeft(),top:o=e.scrollTop(),right:b+e.width(),bottom:o+e.height()}}if(a.nodeType||g.isString(a))a=d(a);a.getDOMNode?(b=a.offset(),this.__constrainRegion={left:b.left,top:b.top,right:b.left+a.outerWidth(),bottom:b.top+a.outerHeight()}):
g.isPlainObject(a)&&(this.__constrainRegion=a);this.__constrainRegion&&(this.__constrainRegion.right-=c.outerWidth(),this.__constrainRegion.bottom-=c.outerHeight())}}function i(c){var b={},a=c.left,f=c.top,e=this.__constrainRegion;e&&(b.left=Math.min(Math.max(e.left,a),e.right),b.top=Math.min(Math.max(e.top,f),e.bottom),c.drag.setInternal("actualPos",b))}function a(){this.__constrainRegion=null}var d=k.all,c="__constrain_destructors",e=g.stamp,n=g.guid("__dd_constrain"),f=g.Env.host;g.extend(j,l,
{__constrainRegion:null,attachDrag:function(f){var b=this[c],o=e(f,0,n);if(b[o])return this;b[o]=f;f.on("dragstart",h,this).on("dragend",a,this).on("dragalign",i,this);return this},detachDrag:function(f){var b=e(f,1,n),o=this[c];b&&o[b]&&(f.detach("dragstart",h,this).detach("dragend",a,this).detach("dragalign",i,this),delete o[b]);return this},destroy:function(){var a=this,b=g.merge(a[c]);g.each(b,function(b){a.detachDrag(b)})}},{ATTRS:{constrain:{value:!0}}});return j},{requires:["base","node"]});
KISSY.add("dd",function(g,l,k,j,h,i,a,d,c){g={Draggable:k,Droppable:j,DDM:l,Constrain:i,Proxy:h,DraggableDelegate:a,DroppableDelegate:d,Scroll:c};return KISSY.DD=g},{requires:"dd/ddm,dd/draggable,dd/droppable,dd/proxy,dd/constrain,dd/draggable-delegate,dd/droppable-delegate,dd/scroll".split(",")});
KISSY.add("dd/ddm",function(g,l,k,j,h,i){function a(){a.superclass.constructor.apply(this,arguments)}function d(a,c,f){var e=f.get("mode"),i=a.get("validDrops"),d=0,h=0,n=u(f.get("node")),k=o(n);g.each(i,function(a){var p;if(p=a.getNodeFromTarget(c,f.get("dragNode")[0],f.get("node")[0]))if("point"==e)b(u(p),f.mousePos)&&(p=o(u(p)),d?p<h&&(d=a,h=p):(d=a,h=p));else if("intersect"==e)p=o(y(n,u(p))),p>h&&(h=p,d=a);else if("strict"==e&&(p=o(y(n,u(p))),p==k))return d=a,!1});if((i=a.get("activeDrop"))&&
i!=d)i._handleOut(c),f._handleOut(c);a.setInternal("activeDrop",d);d&&(i!=d?d._handleEnter(c):d._handleOver(c))}function c(b){b._shim=(new h('<div style="background-color:red;position:'+(w?"absolute":"fixed")+";left:0;width:100%;height:100%;top:0;cursor:"+m.get("dragCursor")+";z-index:"+x+';"></div>')).prependTo(q.body||q.documentElement).css("opacity",0);c=e;if(w)j.on(r,"resize scroll",s,b);e(b)}function e(b){var a=b.get("activeDrag").get("activeHandler"),c="auto";a&&(c=a.css("cursor"));"auto"==
c&&(c=b.get("dragCursor"));b._shim.css({cursor:c,display:"block"});w&&s.call(b)}function n(b){var a=b.get("drops");b.setInternal("validDrops",[]);g.each(a,function(b){b._active()})}function f(b){var a=b.get("drops");b.setInternal("validDrops",[]);g.each(a,function(b){b._deActive()})}function u(b){var a=b.offset();return{left:a.left,right:a.left+(b.__dd_cached_width||b.outerWidth()),top:a.top,bottom:a.top+(b.__dd_cached_height||b.outerHeight())}}function b(b,a){return b.left<=a.left&&b.right>=a.left&&
b.top<=a.top&&b.bottom>=a.top}function o(b){return b.top>=b.bottom||b.left>=b.right?0:(b.right-b.left)*(b.bottom-b.top)}function y(b,a){var c=Math.max(b.top,a.top),f=Math.min(b.right,a.right),o=Math.min(b.bottom,a.bottom);return{left:Math.max(b.left,a.left),right:f,top:c,bottom:o}}function z(b){b&&(b.__dd_cached_width=b.outerWidth(),b.__dd_cached_height=b.outerHeight())}var r=g.Env.host,q=r.document,w=6===l.ie,v=g.throttle(function(b){var a;if(a=this.__activeToDrag)b.preventDefault(),a._move(b);else if(a=
this.get("activeDrag"))b.preventDefault(),a._move(b),d(this,b,a)},30),x=999999;a.ATTRS={dragCursor:{value:"move"},clickPixelThresh:{value:3},bufferTime:{value:1},activeDrag:{},activeDrop:{},drops:{value:[]},validDrops:{value:[]}};var s=g.throttle(function(){var b;(b=this.get("activeDrag"))&&b.get("shim")&&this._shim.css({width:k.docWidth(),height:k.docHeight()})},30);g.extend(a,i,{__activeToDrag:0,_regDrop:function(b){this.get("drops").push(b)},_unRegDrop:function(b){b=g.indexOf(b,this.get("drops"));
-1!=b&&this.get("drops").splice(b,1)},_regToDrag:function(b){this.__activeToDrag=b;j.on(q,A,this._end,this);j.on(q,t,v,this);6===l.ie&&q.body.setCapture()},_start:function(){this.get("drops");var b=this.__activeToDrag;this.setInternal("activeDrag",b);this.__activeToDrag=0;b.get("shim")&&c(this);z(b.get("node"));n(this)},_addValidDrop:function(b){this.get("validDrops").push(b)},_end:function(){var b=this.get("activeDrag"),a=this.get("activeDrop");j.remove(q,t,v,this);j.remove(q,A,this._end,this);6===
l.ie&&q.body.releaseCapture();this.__activeToDrag&&(this.__activeToDrag._end(),this.__activeToDrag=0);this._shim&&this._shim.hide();b&&(b._end(),f(this),a&&a._end(),this.setInternal("activeDrag",null),this.setInternal("activeDrop",null))}});var m=new a;m.inRegion=b;m.region=u;m.area=o;m.cacheWH=z;m.PREFIX_CLS="ks-dd-";i="ontouchstart"in q;m.DRAG_START_EVENT=i?"touchstart":"mousedown";var t=m.DRAG_MOVE_EVENT=i?"touchmove":"mousemove",A=m.DRAG_END_EVENT=i?"touchend":"mouseup";m._normalHandlePreDragStart=
function(b){return function(a){var c;if(c=a.originalEvent.touches){if(1!=c.length)return;c=c[0];a.target=a.target||c.target;a.currentTarget=a.currentTarget||c.currentTarget;a.button=a.button||0}b.call(this,a)}};return m},{requires:["ua","dom","event","node","base"]});
KISSY.add("dd/draggable-delegate",function(g,l,k,j,h){function i(){i.superclass.constructor.apply(this,arguments)}var a=l.PREFIX_CLS,d=l._normalHandlePreDragStart(function(a){var e,d;if(this._checkDragStartValid(a)){e=this.get("handlers");var f=new h(a.target);(e=e.length?this._getHandler(f):f)&&(d=this._getNode(e));d&&(this.setInternal("activeHandler",e),this.setInternal("node",d),this.setInternal("dragNode",d),this._prepare(a))}});g.extend(i,k,{_uiSetDisabledChange:function(c){this.get("container")[c?
"addClass":"removeClass"](a+"-disabled")},_init:function(){this.get("container").on(l.DRAG_START_EVENT,d,this).on("dragstart",this._fixDragStart)},_getHandler:function(a){for(var e=void 0,d=this.get("container"),f=this.get("handlers");a&&a[0]!==d[0];){g.each(f,function(f){if(j.test(a[0],f))return e=a,!1});if(e)break;a=a.parent()}return e},_getNode:function(a){return a.closest(this.get("selector"),this.get("container"))},destroy:function(){this.get("container").detach(l.DRAG_START_EVENT,d,this).detach("dragstart",
this._fixDragStart);this.detach()}},{ATTRS:{container:{setter:function(a){return h.one(a)}},selector:{},handlers:{value:[],getter:0}}});return i},{requires:["./ddm","./draggable","dom","node"]});
KISSY.add("dd/draggable",function(g,l,k,j,h){function i(){var b=this;i.superclass.constructor.apply(b,arguments);b.addTarget(h);g.each("dragalign,drag,dragdrophit,dragend,dragdropmiss,dragexit,dragenter,dragover,dragstart".split(","),function(a){b.publish(a,{bubbles:1})});b.setInternal("dragNode",b.get("node"));b.on("afterDisabledChange",b._uiSetDisabledChange,b);var a;(a=b.get("disabled"))&&b._uiSetDisabledChange(a);b._init()}function a(){return!1}var d=g.each,c=l.ie,e=h.PREFIX_CLS,n=g.Env.host.document;
i.ATTRS={node:{setter:function(b){if(!(b instanceof k))return k.one(b)}},clickPixelThresh:{valueFn:function(){return h.get("clickPixelThresh")}},bufferTime:{valueFn:function(){return h.get("bufferTime")}},dragNode:{},shim:{value:!0},handlers:{value:[],getter:function(b){var a=this;b.length||(b[0]=a.get("node"));d(b,function(c,f){g.isFunction(c)&&(c=c.call(a));if(g.isString(c)||c.nodeType)c=k.one(c);b[f]=c});a.setInternal("handlers",b);return b}},activeHandler:{},dragging:{value:!1,setter:function(b){this.get("dragNode")[b?
"addClass":"removeClass"](e+"dragging")}},mode:{value:"point"},disabled:{value:!1},move:{value:!1},primaryButtonOnly:{value:!0},halt:{value:!0},groups:{value:{}},startMousePos:{},startNodePos:{},deltaPos:{},actualPos:{}};i.DropMode={POINT:"point",INTERSECT:"intersect",STRICT:"strict"};g.mix(i,i.DropMode);var f,u=h._normalHandlePreDragStart(function(b){var a=b.target;this._checkDragStartValid(b)&&this._checkHandler(a)&&this._prepare(b)});g.extend(i,j,{_bufferTimer:null,_uiSetDisabledChange:function(b){this.get("dragNode")[b?
"addClass":"removeClass"](e+"-disabled")},_init:function(){this.get("node").on(h.DRAG_START_EVENT,u,this).on("dragstart",this._fixDragStart)},_fixDragStart:function(b){b.preventDefault()},_checkHandler:function(b){var a=this,c=a.get("handlers"),f=0;d(c,function(c){if(c.contains(b)||c[0]==b)return f=1,a.setInternal("activeHandler",c),!1});return f},_checkDragStartValid:function(b){return this.get("primaryButtonOnly")&&1<b.button||this.get("disabled")?0:1},_prepare:function(b){var e=this;c&&(f=n.body.onselectstart,
n.body.onselectstart=a);e.get("halt")?b.halt():b.preventDefault();var d=e.get("node"),g=b.pageX,b=b.pageY,d=d.offset();e.setInternal("startMousePos",e.mousePos={left:g,top:b});e.setInternal("startNodePos",d);e.setInternal("deltaPos",{left:g-d.left,top:b-d.top});h._regToDrag(e);if(g=e.get("bufferTime"))e._bufferTimer=setTimeout(function(){e._start()},1E3*g)},_clearBufferTimer:function(){this._bufferTimer&&(clearTimeout(this._bufferTimer),this._bufferTimer=0)},_move:function(b){var a;a=b.pageX;b=b.pageY;
if(this.get("dragging")){var c=this.get("deltaPos"),f=a-c.left,c=b-c.top;this.mousePos={left:a,top:b};a={left:f,top:c,pageX:a,pageY:b,drag:this};this.setInternal("actualPos",{left:f,top:c});this.fire("dragalign",a);b=1;!1===this.fire("drag",a)&&(b=0);b&&this.get("move")&&this.get("node").offset(this.get("actualPos"))}else f=this.get("startMousePos"),c=this.get("clickPixelThresh"),(Math.abs(a-f.left)>=c||Math.abs(b-f.top)>=c)&&this._start()},stopDrag:function(){this.get("dragging")&&h._end()},_end:function(){var b;
this._clearBufferTimer();c&&(n.body.onselectstart=f);this.get("dragging")&&(this.get("node").removeClass(e+"drag-over"),(b=h.get("activeDrop"))?this.fire("dragdrophit",{drag:this,drop:b}):this.fire("dragdropmiss",{drag:this}),this.setInternal("dragging",0),this.fire("dragend",{drag:this}))},_handleOut:function(){this.get("node").removeClass(e+"drag-over");this.fire("dragexit",{drag:this,drop:h.get("activeDrop")})},_handleEnter:function(b){this.get("node").addClass(e+"drag-over");this.fire("dragenter",
b)},_handleOver:function(b){this.fire("dragover",b)},_start:function(){this._clearBufferTimer();this.setInternal("dragging",1);h._start();this.fire("dragstart",{drag:this})},destroy:function(){this.get("dragNode").detach(h.DRAG_START_EVENT,u,this).detach("dragstart",this._fixDragStart);this.detach()}});return i},{requires:["ua","node","base","./ddm"]});
KISSY.add("dd/droppable-delegate",function(g,l,k,j,h){function i(){var a=this.get("container"),c=[],e=this.get("selector");a.all(e).each(function(a){l.cacheWH(a);c.push(a)});this.__allNodes=c}function a(){a.superclass.constructor.apply(this,arguments);l.on("dragstart",i,this)}g.extend(a,k,{destroy:function(){a.superclass.destroy.apply(this,arguments)},getNodeFromTarget:function(a,c,e){var i={left:a.pageX,top:a.pageY},a=this.__allNodes,f=0,h=Number.MAX_VALUE;a&&g.each(a,function(a){var d=a[0];d===
e||d===c||(d=l.region(a),l.inRegion(d,i)&&(d=l.area(d),d<h&&(h=d,f=a)))});f&&(this.setInternal("lastNode",this.get("node")),this.setInternal("node",f));return f},_handleOut:function(){a.superclass._handleOut.apply(this,arguments);this.setInternal("node",0);this.setInternal("lastNode",0)},_handleOver:function(d){var c=this.get("node"),e=a.superclass._handleOut,g=a.superclass._handleOver,f=a.superclass._handleEnter,i=this.get("lastNode");i[0]!==c[0]?(this.setInternal("node",i),e.apply(this,arguments),
this.setInternal("node",c),f.call(this,d)):g.call(this,d)},_end:function(){a.superclass._end.apply(this,arguments);this.setInternal("node",0)}},{ATTRS:{lastNode:{},selector:{},container:{setter:function(a){return h.one(a)}}}});return a},{requires:["./ddm","./droppable","dom","node"]});
KISSY.add("dd/droppable",function(g,l,k,j){function h(){var a=this;h.superclass.constructor.apply(a,arguments);a.addTarget(j);g.each(["dropexit","dropenter","dropover","drophit"],function(d){a.publish(d,{bubbles:1})});a._init()}var i=j.PREFIX_CLS;h.ATTRS={node:{setter:function(a){if(a)return l.one(a)}},groups:{value:!0}};g.extend(h,k,{getNodeFromTarget:function(a,d,c){var a=this.get("node"),e=a[0];return e==d||e==c?null:a},_init:function(){j._regDrop(this)},_active:function(){var a=j.get("activeDrag"),
d=this.get("node"),c=this.get("groups");a:if(a=a.get("groups"),!0===c)c=1;else{for(var e in c)if(c.hasOwnProperty(e)&&a[e]){c=1;break a}c=0}c?(j._addValidDrop(this),d&&(d.addClass(i+"drop-active-valid"),j.cacheWH(d))):d&&d.addClass(i+"drop-active-invalid")},_deActive:function(){var a=this.get("node");a&&a.removeClass(i+"drop-active-valid").removeClass(i+"drop-active-invalid")},__getCustomEvt:function(a){return g.mix({drag:j.get("activeDrag"),drop:this},a)},_handleOut:function(){var a=this.__getCustomEvt();
this.get("node").removeClass(i+"drop-over");this.fire("dropexit",a)},_handleEnter:function(a){a=this.__getCustomEvt(a);a.drag._handleEnter(a);this.get("node").addClass(i+"drop-over");this.fire("dropenter",a)},_handleOver:function(a){a=this.__getCustomEvt(a);a.drag._handleOver(a);this.fire("dropover",a)},_end:function(){var a=this.__getCustomEvt();this.get("node").removeClass(i+"drop-over");this.fire("drophit",a)},destroy:function(){j._unRegDrop(this)}});return h},{requires:["node","base","./ddm"]});
KISSY.add("dd/proxy",function(g,l,k,j){function h(){h.superclass.constructor.apply(this,arguments);this[i]={}}var i="__proxy_destructors",a=g.stamp,d=g.guid("__dd_proxy");h.ATTRS={node:{value:function(a){return new l(a.get("node").clone(!0))}},destroyOnEnd:{value:!1},moveOnEnd:{value:!0},proxyNode:{}};g.extend(h,k,{attachDrag:function(c){function e(){var a=f.get("node"),b=c.get("node");f.get("proxyNode")?a=f.get("proxyNode"):g.isFunction(a)&&(a=a(c),a.addClass("ks-dd-proxy"),a.css("position","absolute"),
f.set("proxyNode",a));a.show();b.parent().append(a);j.cacheWH(a);a.offset(b.offset());c.setInternal("dragNode",b);c.setInternal("node",a)}function h(){var a=f.get("proxyNode");f.get("moveOnEnd")&&c.get("dragNode").offset(a.offset());f.get("destroyOnEnd")?(a.remove(),f.set("proxyNode",0)):a.hide();c.setInternal("node",c.get("dragNode"))}var f=this,k=f[i],b=a(c,0,d);if(k[b])return f;c.on("dragstart",e);c.on("dragend",h);k[b]={drag:c,fn:function(){c.detach("dragstart",e);c.detach("dragend",h)}};return f},
detachDrag:function(c){var c=a(c,1,d),e=this[i];c&&e[c]&&(e[c].fn(),delete e[c]);return this},destroy:function(){var a=this.get("node"),e=this[i];a&&!g.isFunction(a)&&a.remove();for(var d in e)e.hasOwnProperty(d)&&this.detachDrag(e[d].drag)}});k=h.prototype;k.attach=k.attachDrag;k.unAttach=k.detachDrag;return h},{requires:["node","base","./ddm"]});
KISSY.add("dd/scroll",function(g,l,k,j,h){function i(){i.superclass.constructor.apply(this,arguments);this[e]={}}var a=g.Env.host,d=g.stamp,c=100,e="__dd_scrolls";i.ATTRS={node:{valueFn:function(){return j.one(a)},setter:function(a){return j.one(a)}},rate:{value:[10,10]},diff:{value:[20,20]}};var n=g.isWindow;g.extend(i,k,{getRegion:function(a){return n(a[0])?{width:h.viewportWidth(),height:h.viewportHeight()}:{width:a.outerWidth(),height:a.outerHeight()}},getOffset:function(a){return n(a[0])?{left:h.scrollLeft(),
top:h.scrollTop()}:a.offset()},getScroll:function(a){return{left:a.scrollLeft(),top:a.scrollTop()}},setScroll:function(a,c){a.scrollLeft(c.left);a.scrollTop(c.top)},detachDrag:function(a){var c,b=this[e];if(!(c=d(a,1,"__dd-scroll-id-"))||!b[c])return this;b[c].fn();delete b[c];return this},destroy:function(){var a=this;g.each(a[e],function(c){a.detachDrag(c.drag)})},attachDrag:function(a){function i(){if(n(r[0]))return 0;var b=a.mousePos,c=l.region(r);return!l.inRegion(c,b)?(clearTimeout(t),t=0,1):
0}function b(b){!b.fake&&!i()&&(s=b,m=g.clone(a.mousePos),b=j.getOffset(r),m.left-=b.left,m.top-=b.top,t||k())}function h(){clearTimeout(t);t=null}function k(){if(!i()){var b=j.getRegion(r),e=b.width,b=b.height,d=j.getScroll(r),h=g.clone(d),l=!1;m.top-b>=-x[1]&&(d.top+=v[1],l=!0);m.top<=x[1]&&(d.top-=v[1],l=!0);m.left-e>=-x[0]&&(d.left+=v[0],l=!0);m.left<=x[0]&&(d.left-=v[0],l=!0);l?(j.setScroll(r,d),t=setTimeout(k,c),s.fake=!0,n(r[0])&&(d=j.getScroll(r),s.left+=d.left-h.left,s.top+=d.top-h.top),
a.get("move")&&a.get("node").offset(s),a.fire("drag",s)):t=null}}var j=this,r=j.get("node"),q=d(a,0,"__dd-scroll-id-"),w=j[e];if(w[q])return this;var v=j.get("rate"),x=j.get("diff"),s,m,t=null;a.on("drag",b);a.on("dragstart",function(){l.cacheWH(r)});a.on("dragend",h);w[q]={drag:a,fn:function(){a.detach("drag",b);a.detach("dragend",h)}};return this}});k=i.prototype;k.attach=k.attachDrag;k.unAttach=k.detachDrag;return i},{requires:["./ddm","base","node","dom"]});
