/*
Copyright 2012, KISSY UI Library v1.30dev
MIT Licensed
build time: May 24 11:31
*/
KISSY.add("dd/constrain",function(g,k,h){function i(){i.superclass.constructor.apply(this,arguments)}function e(a){var d,j,a=a.drag.get("dragNode"),b=this.get("constrain");if(b){if(!0===b){var s=f(c);this.__constrainRegion={left:d=s.scrollLeft(),top:j=s.scrollTop(),right:d+s.width(),bottom:j+s.height()}}if(b.nodeType||g.isString(b))b=f(b);b.getDOMNode?(d=b.offset(),this.__constrainRegion={left:d.left,top:d.top,right:d.left+b.outerWidth(),bottom:d.top+b.outerHeight()}):g.isPlainObject(b)&&(this.__constrainRegion=
b);this.__constrainRegion&&(this.__constrainRegion.right-=a.outerWidth(),this.__constrainRegion.bottom-=a.outerHeight())}}function a(a){var a=a.info,c=a.left,j=a.top,b=this.__constrainRegion;b&&(a.left=Math.min(Math.max(b.left,c),b.right),a.top=Math.min(Math.max(b.top,j),b.bottom))}function d(){this.__constrainRegion=null}var f=h.all,c=g.Env.host;g.extend(i,k,{__constrainRegion:null,attachDrag:function(c){c.on("dragstart",e,this).on("dragend",d,this).on("dragalign",a,this)},detachDrag:function(c){c.detach("dragstart",
e,this).detach("dragend",d,this).detach("dragalign",a,this)}},{ATTRS:{constrain:{value:!0}}});return i},{requires:["base","node"]});KISSY.add("dd",function(g,k,h,i,e,a,d,f,c){return{Draggable:h,Droppable:i,DDM:k,Constrain:a,Proxy:e,DraggableDelegate:d,DroppableDelegate:f,Scroll:c}},{requires:"dd/ddm,dd/draggable,dd/droppable,dd/proxy,dd/constrain,dd/draggable-delegate,dd/droppable-delegate,dd/scroll".split(",")});
KISSY.add("dd/ddm",function(g,k,h,i,e,a){function d(){d.superclass.constructor.apply(this,arguments)}function f(m,a,c){var j=c.get("mode"),f=m.get("validDrops"),d=0,e=0,l=b(c.get("node")),i=w(l);g.each(f,function(m){var f;if(f=m.getNodeFromTarget(a,c.get("dragNode")[0],c.get("node")[0]))if("point"==j)s(b(f),c.mousePos)&&(f=w(b(f)),d?f<e&&(d=m,e=f):(d=m,e=f));else if("intersect"==j)f=w(x(l,b(f))),f>e&&(e=f,d=m);else if("strict"==j&&(f=w(x(l,b(f))),f==i))return d=m,!1});if((f=m.get("activeDrop"))&&
f!=d)f._handleOut(a),c._handleOut(a);m.__set("activeDrop",d);d&&(f!=d?d._handleEnter(a):d._handleOver(a))}function c(b){b._shim=(new e("<div style='background-color:red;position:"+(u?"absolute":"fixed")+";left:0;width:100%;height:100%;top:0;cursor:"+n.get("dragCursor")+";z-index:"+v+";'></div>")).prependTo(p.body||p.documentElement).css("opacity",0);c=l;if(u)i.on(o,"resize scroll",q,b);l(b)}function l(b){var a=b.get("activeDrag").get("activeHandler"),f="auto";a&&(f=a.css("cursor"));"auto"==f&&(f=
b.get("dragCursor"));b._shim.css({cursor:f,display:"block"});u&&q.call(b)}function r(b){var a=b.get("drops");b.__set("validDrops",[]);g.each(a,function(b){b._active()})}function j(b){var a=b.get("drops");b.__set("validDrops",[]);g.each(a,function(b){b._deActive()})}function b(b){var a=b.offset();return{left:a.left,right:a.left+(b.__dd_cached_width||b.outerWidth()),top:a.top,bottom:a.top+(b.__dd_cached_height||b.outerHeight())}}function s(b,a){return b.left<=a.left&&b.right>=a.left&&b.top<=a.top&&
b.bottom>=a.top}function w(b){return b.top>=b.bottom||b.left>=b.right?0:(b.right-b.left)*(b.bottom-b.top)}function x(b,a){var f=Math.max(b.top,a.top),c=Math.min(b.right,a.right),j=Math.min(b.bottom,a.bottom);return{left:Math.max(b.left,a.left),right:c,top:f,bottom:j}}function y(b){b&&(b.__dd_cached_width=b.outerWidth(),b.__dd_cached_height=b.outerHeight())}var o=g.Env.host,p=o.document,u=6===k.ie,t=g.throttle(function(b){var a;if(a=this.__activeToDrag)b.preventDefault(),a._move(b);else if(a=this.get("activeDrag"))b.preventDefault(),
a._move(b),f(this,b,a)},30),v=999999;d.ATTRS={prefixCls:{value:"ks-dd-"},dragCursor:{value:"move"},clickPixelThresh:{value:3},bufferTime:{value:1E3},activeDrag:{},activeDrop:{},drops:{value:[]},validDrops:{value:[]}};var q=g.throttle(function(){var b;(b=this.get("activeDrag"))&&b.get("shim")&&this._shim.css({width:h.docWidth(),height:h.docHeight()})},30);g.extend(d,a,{__activeToDrag:0,_regDrop:function(b){this.get("drops").push(b)},_unRegDrop:function(b){b=g.indexOf(b,this.get("drops"));-1!=b&&this.get("drops").splice(b,
1)},_regToDrag:function(b){this.__activeToDrag=b;i.on(p,"mouseup",this._end,this);i.on(p,"mousemove",t,this);6===k.ie&&p.body.setCapture()},_start:function(){this.get("drops");var b=this.__activeToDrag;this.__set("activeDrag",b);this.__activeToDrag=0;b.get("shim")&&c(this);y(b.get("node"));r(this)},_addValidDrop:function(b){this.get("validDrops").push(b)},_end:function(){var b=this.get("activeDrag"),a=this.get("activeDrop");i.remove(p,"mousemove",t,this);i.remove(p,"mouseup",this._end,this);6===k.ie&&
p.body.releaseCapture();this.__activeToDrag&&(this.__activeToDrag._end(),this.__activeToDrag=0);this._shim&&this._shim.hide();b&&(b._end(),j(this),a&&a._end(),this.__set("activeDrag",null),this.__set("activeDrop",null))}});var n=new d;n.inRegion=s;n.region=b;n.area=w;n.cacheWH=y;return n},{requires:["ua","dom","event","node","base"]});
KISSY.add("dd/draggable-delegate",function(g,k,h,i,e){function a(){a.superclass.constructor.apply(this,arguments)}function d(a){var c,d;if(this._checkMouseDown(a)){c=this.get("handlers");var g=new e(a.target);(c=c.length?this._getHandler(g):g)&&(d=this._getNode(c));d&&(this.__set("activeHandler",c),this.__set("node",d),this.__set("dragNode",d),this._prepare(a))}}g.extend(a,h,{_uiSetDisabledChange:function(a){this.get("container")[a?"addClass":"removeClass"](k.get("prefixCls")+"-disabled")},_init:function(){this.get("container").on("mousedown",
d,this).on("dragstart",this._fixDragStart)},_getHandler:function(a){for(var c=void 0,d=this.get("container"),e=this.get("handlers");a&&a[0]!==d[0];){g.each(e,function(d){if(i.test(a[0],d))return c=a,!1});if(c)break;a=a.parent()}return c},_getNode:function(a){return a.closest(this.get("selector"),this.get("container"))},destroy:function(){this.get("container").detach("mousedown",d,this).detach("dragstart",this._fixDragStart);this.detach()}},{ATTRS:{container:{setter:function(a){return e.one(a)}},selector:{},
handlers:{value:[],getter:0}}});return a},{requires:["./ddm","./draggable","dom","node"]});
KISSY.add("dd/draggable",function(g,k,h,i,e){function a(){var b=this;a.superclass.constructor.apply(b,arguments);b.addTarget(e);g.each("dragalign,drag,dragdrophit,dragend,dragdropmiss,dragexit,dragenter,dragover,dragstart".split(","),function(a){b.publish(a,{bubbles:1})});b.__set("dragNode",b.get("node"));b.on("afterDisabledChange",b._uiSetDisabledChange,b);var c;(c=b.get("disabled"))&&b._uiSetDisabledChange(c);b._init()}function d(){return!1}function f(b){var a=b.target;this._checkMouseDown(b)&&
this._check(a)&&this._prepare(b)}var c=g.each,l=k.ie,r=g.Env.host.document;a.POINT="point";a.INTERSECT="intersect";a.STRICT="strict";a.ATTRS={node:{setter:function(b){if(!(b instanceof h))return h.one(b)}},clickPixelThresh:{valueFn:function(){return e.get("clickPixelThresh")}},bufferTime:{valueFn:function(){return e.get("bufferTime")}},dragNode:{},shim:{value:!0},handlers:{value:[],getter:function(b){var a=this;b.length||(b[0]=a.get("node"));c(b,function(c,d){g.isFunction(c)&&(c=c.call(a));if(g.isString(c)||
c.nodeType)c=h.one(c);b[d]=c});a.__set("handlers",b);return b}},activeHandler:{},dragging:{value:!1,setter:function(b){this.get("dragNode")[b?"addClass":"removeClass"](e.get("prefixCls")+"dragging")}},mode:{value:"point"},disabled:{value:!1},move:{value:!1},primaryButtonOnly:{value:!0},halt:{value:!0},groups:{value:{}}};var j;g.extend(a,i,{startMousePos:null,startNodePos:null,_diff:null,_bufferTimer:null,_uiSetDisabledChange:function(b){this.get("dragNode")[b?"addClass":"removeClass"](e.get("prefixCls")+
"-disabled")},_init:function(){this.get("node").on("mousedown",f,this).on("dragstart",this._fixDragStart)},_fixDragStart:function(b){b.preventDefault()},_check:function(b){var a=this,d=a.get("handlers"),j=0;c(d,function(c){if(c.contains(b)||c[0]==b)return j=1,a.__set("activeHandler",c),!1});return j},_checkMouseDown:function(b){return this.get("primaryButtonOnly")&&1<b.button||this.get("disabled")?0:1},_prepare:function(b){var a=this;l&&(j=r.body.onselectstart,r.body.onselectstart=d);a.get("halt")?
b.halt():b.preventDefault();var c=a.get("node"),f=b.pageX,b=b.pageY,c=c.offset();a.startMousePos=a.mousePos={left:f,top:b};a.startNodePos=c;a._diff={left:f-c.left,top:b-c.top};e._regToDrag(a);if(f=a.get("bufferTime"))a._bufferTimer=setTimeout(function(){a._start()},f)},_clearBufferTimer:function(){this._bufferTimer&&(clearTimeout(this._bufferTimer),this._bufferTimer=0)},_move:function(b){var a,c=this._diff;a=this.startMousePos;var d=b.pageX,b=b.pageY,f=d-c.left,c=b-c.top;this.get("dragging")?(this.mousePos=
{left:d,top:b},a={left:f,top:c,pageX:d,pageY:b,drag:this},this.fire("dragalign",{info:a}),d=1,!1===this.fire("drag",a)&&(d=0),d&&this.get("move")&&this.get("node").offset(a)):(c=this.get("clickPixelThresh"),(Math.abs(d-a.left)>=c||Math.abs(b-a.top)>=c)&&this._start())},stopDrag:function(){this.get("dragging")&&e._end()},_end:function(){var b;this._clearBufferTimer();l&&(r.body.onselectstart=j);this.get("dragging")&&(this.get("node").removeClass(e.get("prefixCls")+"drag-over"),(b=e.get("activeDrop"))?
this.fire("dragdrophit",{drag:this,drop:b}):this.fire("dragdropmiss",{drag:this}),this.__set("dragging",0),this.fire("dragend",{drag:this}))},_handleOut:function(){this.get("node").removeClass(e.get("prefixCls")+"drag-over");this.fire("dragexit",{drag:this,drop:e.get("activeDrop")})},_handleEnter:function(b){this.get("node").addClass(e.get("prefixCls")+"drag-over");this.fire("dragenter",b)},_handleOver:function(b){this.fire("dragover",b)},_start:function(){this._clearBufferTimer();this.__set("dragging",
1);e._start();this.fire("dragstart",{drag:this})},destroy:function(){this.get("dragNode").detach("mousedown",f,this).detach("dragstart",this._fixDragStart);this.detach()}});return a},{requires:["ua","node","base","./ddm"]});
KISSY.add("dd/droppable-delegate",function(g,k,h,i,e){function a(){var a=this.get("container"),c=[],d=this.get("selector");a.all(d).each(function(a){k.cacheWH(a);c.push(a)});this.__allNodes=c}function d(){d.superclass.constructor.apply(this,arguments);k.on("dragstart",a,this)}g.extend(d,h,{getNodeFromTarget:function(a,c,d){var e={left:a.pageX,top:a.pageY},a=this.__allNodes,j=0,b=Number.MAX_VALUE;a&&g.each(a,function(a){var f=a[0];f===d||f===c||(f=k.region(a),k.inRegion(f,e)&&(f=k.area(f),f<b&&(b=
f,j=a)))});j&&(this.__set("lastNode",this.get("node")),this.__set("node",j));return j},_handleOut:function(){d.superclass._handleOut.apply(this,arguments);this.__set("node",0);this.__set("lastNode",0)},_handleOver:function(a){var c=this.get("node"),e=d.superclass._handleOut,g=d.superclass._handleOver,j=d.superclass._handleEnter,b=this.get("lastNode");b[0]!==c[0]?(this.__set("node",b),e.apply(this,arguments),this.__set("node",c),j.call(this,a)):g.call(this,a)},_end:function(){d.superclass._end.apply(this,
arguments);this.__set("node",0)}},{ATTRS:{lastNode:{},selector:{},container:{setter:function(a){return e.one(a)}}}});return d},{requires:["./ddm","./droppable","dom","node"]});
KISSY.add("dd/droppable",function(g,k,h,i){function e(){var a=this;e.superclass.constructor.apply(a,arguments);a.addTarget(i);g.each(["dropexit","dropenter","dropover","drophit"],function(d){a.publish(d,{bubbles:1})});a._init()}e.ATTRS={node:{setter:function(a){if(a)return k.one(a)}},groups:{value:!0}};g.extend(e,h,{getNodeFromTarget:function(a,d,f){var a=this.get("node"),c=a[0];return c==d||c==f?null:a},_init:function(){i._regDrop(this)},_active:function(){var a=i.get("activeDrag"),d=this.get("node"),
f=this.get("groups"),c=a.get("groups"),a=i.get("prefixCls");a:if(!0===f)f=1;else{for(var e in f)if(c[e]){f=1;break a}f=0}f?(i._addValidDrop(this),d&&(d.addClass(a+"drop-active-valid"),i.cacheWH(d))):d&&d.addClass(a+"drop-active-invalid")},_deActive:function(){var a=this.get("node"),d=i.get("prefixCls");a&&a.removeClass(d+"drop-active-valid").removeClass(d+"drop-active-invalid")},__getCustomEvt:function(a){return g.mix({drag:i.get("activeDrag"),drop:this},a)},_handleOut:function(){var a=this.__getCustomEvt();
this.get("node").removeClass(i.get("prefixCls")+"drop-over");this.fire("dropexit",a)},_handleEnter:function(a){a=this.__getCustomEvt(a);a.drag._handleEnter(a);this.get("node").addClass(i.get("prefixCls")+"drop-over");this.fire("dropenter",a)},_handleOver:function(a){a=this.__getCustomEvt(a);a.drag._handleOver(a);this.fire("dropover",a)},_end:function(){var a=this.__getCustomEvt();this.get("node").removeClass(i.get("prefixCls")+"drop-over");this.fire("drophit",a)},destroy:function(){i._unRegDrop(this)}});
return e},{requires:["node","base","./ddm"]});
KISSY.add("dd/proxy",function(g,k,h,i){function e(){e.superclass.constructor.apply(this,arguments);this[a]={}}var a="__proxy_destructors",d=g.stamp,f=g.guid("__dd_proxy");e.ATTRS={node:{value:function(a){return new k(a.get("node").clone(!0))}},destroyOnEnd:{value:!1},moveOnEnd:{value:!0},proxyNode:{}};g.extend(e,h,{attachDrag:function(c){function e(){var a=j.get("node"),b=c.get("node");j.get("proxyNode")?a=j.get("proxyNode"):g.isFunction(a)&&(a=a(c),a.addClass("ks-dd-proxy"),a.css("position","absolute"),
j.set("proxyNode",a));a.show();b.parent().append(a);i.cacheWH(a);a.offset(b.offset());c.__set("dragNode",b);c.__set("node",a)}function h(){var a=j.get("proxyNode");j.get("moveOnEnd")&&c.get("dragNode").offset(a.offset());j.get("destroyOnEnd")?(a.remove(),j.set("proxyNode",0)):a.hide();c.__set("node",c.get("dragNode"))}var j=this,b=d(c,1,f);if(!b||!j[a][b])c.on("dragstart",e),c.on("dragend",h),b=d(c,0,f),j[a][b]={drag:c,fn:function(){c.detach("dragstart",e);c.detach("dragend",h)}}},detachDrag:function(c){var c=
d(c,1,f),e=this[a];c&&e[c]&&(e[c].fn(),delete e[c])},destroy:function(){var c=this.get("node"),d=this[a];c&&!g.isFunction(c)&&c.remove();for(var f in d)this.detachDrag(d[f].drag)}});h=e.prototype;h.attach=h.attachDrag;h.unAttach=h.detachDrag;return e},{requires:["node","base","./ddm"]});
KISSY.add("dd/scroll",function(g,k,h,i,e){function a(){a.superclass.constructor.apply(this,arguments);this[l]={}}var d=g.Env.host,f=g.stamp,c=100,l="__dd_scrolls";a.ATTRS={node:{valueFn:function(){return i.one(d)},setter:function(a){return i.one(a)}},rate:{value:[10,10]},diff:{value:[20,20]}};var r=g.isWindow;g.extend(a,h,{getRegion:function(a){return r(a[0])?{width:e.viewportWidth(),height:e.viewportHeight()}:{width:a.outerWidth(),height:a.outerHeight()}},getOffset:function(a){return r(a[0])?{left:e.scrollLeft(),
top:e.scrollTop()}:a.offset()},getScroll:function(a){return{left:a.scrollLeft(),top:a.scrollTop()}},setScroll:function(a,b){a.scrollLeft(b.left);a.scrollTop(b.top)},detachDrag:function(a){var b,c=this[l];if((b=f(a,1,"__dd-scroll-id-"))&&c[b])c[b].fn(),delete c[b]},destroy:function(){var a=this[l],b;for(b in a)this.detachDrag(a[b].drag)},attachDrag:function(a){function b(){if(r(o[0]))return 0;var b=a.mousePos,c=k.region(o);return!k.inRegion(c,b)?(clearTimeout(m),m=0,1):0}function d(c){!c.fake&&!b()&&
(q=c,n=g.clone(a.mousePos),c=h.getOffset(o),n.left-=c.left,n.top-=c.top,m||i())}function e(){clearTimeout(m);m=null}function i(){if(!b()){var d=h.getRegion(o),f=d.width,d=d.height,e=h.getScroll(o),k=g.clone(e),l=!1;n.top-d>=-v[1]&&(e.top+=t[1],l=!0);n.top<=v[1]&&(e.top-=t[1],l=!0);n.left-f>=-v[0]&&(e.left+=t[0],l=!0);n.left<=v[0]&&(e.left-=t[0],l=!0);l?(h.setScroll(o,e),m=setTimeout(i,c),q.fake=!0,r(o[0])&&(e=h.getScroll(o),q.left+=e.left-k.left,q.top+=e.top-k.top),a.get("move")&&a.get("node").offset(q),
a.fire("drag",q)):m=null}}var h=this,o=h.get("node"),p=f(a,0,"__dd-scroll-id-"),u=h[l];if(!u[p]){var t=h.get("rate"),v=h.get("diff"),q,n,m=null;a.on("drag",d);a.on("dragstart",function(){k.cacheWH(o)});a.on("dragend",e);u[p]={drag:a,fn:function(){a.detach("drag",d);a.detach("dragend",e)}}}}});h=a.prototype;h.attach=h.attachDrag;h.unAttach=h.detachDrag;return a},{requires:["./ddm","base","node","dom"]});
