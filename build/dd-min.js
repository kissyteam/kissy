/*
Copyright 2012, KISSY UI Library v1.30dev
MIT Licensed
build time: Mar 22 14:46
*/
KISSY.add("dd/constrain",function(i,r,s){function n(){n.superclass.constructor.apply(this,arguments)}function m(h){var o,e;h=h.drag.get("dragNode");var a=this.get("constrain");if(a){if(a===true){var d=g(f);this.__constrainRegion={left:o=d.scrollLeft(),top:e=d.scrollTop(),right:o+d.width(),bottom:e+d.height()}}if(a.nodeType||i.isString(a))a=g(a);if(a.getDOMNode){o=a.offset();this.__constrainRegion={left:o.left,top:o.top,right:o.left+a.outerWidth(),bottom:o.top+a.outerHeight()}}else if(i.isPlainObject(a))this.__constrainRegion=
a;if(this.__constrainRegion){this.__constrainRegion.right-=h.outerWidth();this.__constrainRegion.bottom-=h.outerHeight()}}}function c(h){h=h.info;var o=h.left,e=h.top,a=this.__constrainRegion;if(a){h.left=Math.min(Math.max(a.left,o),a.right);h.top=Math.min(Math.max(a.top,e),a.bottom)}}function l(){this.__constrainRegion=null}var g=s.all,f=i.Env.host;i.extend(n,r,{__constrainRegion:null,attach:function(h){h.on("dragstart",m,this).on("dragend",l,this).on("dragalign",c,this)},unAttach:function(h){h.detach("dragstart",
m,this).detach("dragend",l,this).detach("dragalign",c,this)}},{ATTRS:{constrain:{value:true}}});return n},{requires:["base","node"]});KISSY.add("dd",function(i,r,s,n,m,c,l,g,f){return{Draggable:s,Droppable:n,DDM:r,Constrain:c,Proxy:m,DraggableDelegate:l,DroppableDelegate:g,Scroll:f}},{requires:["dd/ddm","dd/draggable","dd/droppable","dd/proxy","dd/constrain","dd/draggable-delegate","dd/droppable-delegate","dd/scroll"]});
KISSY.add("dd/ddm",function(i,r,s,n,m,c){function l(){l.superclass.constructor.apply(this,arguments)}function g(b,k){var p=b.get("activeDrag"),A=p.get("mode"),u=b.get("validDrops"),w=0,z=0,G=a(p.get("node")),H=j(G);i.each(u,function(E){var x;if(x=E.getNodeFromTarget(k,p.get("dragNode")[0],p.get("node")[0]))if(A=="point"){if(d(a(x),p.mousePos)){x=j(a(x));if(w){if(x<z){w=E;z=x}}else{w=E;z=x}}}else if(A=="intersect"){x=j(q(G,a(x)));if(x>z){z=x;w=E}}else if(A=="strict"){x=j(q(G,a(x)));if(x==H){w=E;return false}}});
if((u=b.get("activeDrop"))&&u!=w){u._handleOut(k);p._handleOut(k)}b.__set("activeDrop",w);if(w)u!=w?w._handleEnter(k):w._handleOver(k)}function f(b){b._shim=(new m("<div style='background-color:red;position:"+(C?"absolute":"fixed")+";left:0;width:100%;height:100%;top:0;cursor:"+y.get("dragCursor")+";z-index:"+D+";'></div>")).prependTo(v.body||v.documentElement).css("opacity",0);f=h;C&&n.on(t,"resize scroll",B,b);h(b)}function h(b){var k=b.get("activeDrag").get("activeHandler"),p="auto";if(k)p=k.css("cursor");
if(p=="auto")p=b.get("dragCursor");b._shim.css({cursor:p,display:"block"});C&&B.call(b)}function o(b){var k=b.get("drops");b.__set("validDrops",[]);i.each(k,function(p){p._active()})}function e(b){var k=b.get("drops");b.__set("validDrops",[]);i.each(k,function(p){p._deActive()})}function a(b){var k=b.offset();return{left:k.left,right:k.left+b.outerWidth(),top:k.top,bottom:k.top+b.outerHeight()}}function d(b,k){return b.left<=k.left&&b.right>=k.left&&b.top<=k.top&&b.bottom>=k.top}function j(b){if(b.top>=
b.bottom||b.left>=b.right)return 0;return(b.right-b.left)*(b.bottom-b.top)}function q(b,k){return{left:Math.max(b.left,k.left),right:Math.min(b.right,k.right),top:Math.max(b.top,k.top),bottom:Math.min(b.bottom,k.bottom)}}var t=i.Env.host,v=t.document,C=r.ie===6,F=i.throttle(function(b){var k=this.__activeToDrag,p=this.get("activeDrag");if(p||k)b.preventDefault();if(p){p._move(b);g(this,b)}else k&&k._move(b)},30),D=999999;l.ATTRS={prefixCls:{value:"ks-dd-"},dragCursor:{value:"move"},clickPixelThresh:{value:3},
bufferTime:{value:1E3},activeDrag:{},activeDrop:{},drops:{value:[]},validDrops:{value:[]}};var B=i.throttle(function(){var b;if((b=this.get("activeDrag"))&&b.get("shim"))this._shim.css({width:s.docWidth(),height:s.docHeight()})},30);i.extend(l,c,{__activeToDrag:0,_regDrop:function(b){this.get("drops").push(b)},_unRegDrop:function(b){b=i.indexOf(b,this.get("drops"));b!=-1&&this.get("drops").splice(b,1)},_regToDrag:function(b){n.on(v,"mouseup",this._end,this);n.on(v,"mousemove",F,this);this.__activeToDrag=
b},_start:function(){this.get("drops");var b=this.__activeToDrag;this.__set("activeDrag",b);this.__activeToDrag=0;b.get("shim")&&f(this);o(this)},_addValidDrop:function(b){this.get("validDrops").push(b)},_end:function(){var b=this.get("activeDrag"),k=this.get("activeDrop");n.remove(v,"mousemove",F,this);n.remove(v,"mouseup",this._end,this);if(this.__activeToDrag){this.__activeToDrag._end();this.__activeToDrag=0}this._shim&&this._shim.hide();if(b){b._end();e(this);k&&k._end();this.__set("activeDrag",
null);this.__set("activeDrop",null)}}});var y=new l;y.inRegion=d;y.region=a;y.area=j;return y},{requires:["ua","dom","event","node","base"]});
KISSY.add("dd/draggable-delegate",function(i,r,s,n,m){function c(){c.superclass.constructor.apply(this,arguments)}function l(g){var f,h;if(this._checkMouseDown(g)){f=this.get("handlers");var o=new m(g.target);if(f=f.length?this._getHandler(o):o)h=this._getNode(f);if(h){this.__set("activeHandler",f);this.__set("node",h);this.__set("dragNode",h);this._prepare(g)}}}i.extend(c,s,{_init:function(){this.get("container").on("mousedown",l,this).on("dragstart",this._fixDragStart)},_getHandler:function(g){for(var f=
undefined,h=this.get("container"),o=this.get("handlers");g&&g[0]!==h[0];){i.each(o,function(e){if(n.test(g[0],e)){f=g;return false}});if(f)break;g=g.parent()}return f},_getNode:function(g){return g.closest(this.get("selector"),this.get("container"))},destroy:function(){this.get("container").detach("mousedown",l,this).detach("dragstart",this._fixDragStart);this.detach()}},{ATTRS:{container:{setter:function(g){return m.one(g)}},selector:{},handlers:{value:[],getter:0}}});return c},{requires:["./ddm",
"./draggable","dom","node"]});
KISSY.add("dd/draggable",function(i,r,s,n,m){function c(){var a=this;c.superclass.constructor.apply(a,arguments);a.addTarget(m);i.each(["dragalign","drag","dragdrophit","dragend","dragdropmiss","dragexit","dragenter","dragover","dragstart"],function(d){a.publish(d,{bubbles:1})});a._init()}function l(){return false}function g(a){var d=a.target;this._checkMouseDown(a)&&this._check(d)&&this._prepare(a)}var f=i.each,h=r.ie,o=i.Env.host.document;c.POINT="point";c.INTERSECT="intersect";c.STRICT="strict";
c.ATTRS={node:{setter:function(a){return s.one(a)}},clickPixelThresh:{valueFn:function(){return m.get("clickPixelThresh")}},bufferTime:{valueFn:function(){return m.get("bufferTime")}},dragNode:{},shim:{value:true},handlers:{value:[],getter:function(a){var d=this;a.length||(a[0]=d.get("node"));f(a,function(j,q){if(i.isFunction(j))j=j.call(d);if(i.isString(j)||j.nodeType)j=s.one(j);a[q]=j});d.__set("handlers",a);return a}},activeHandler:{},dragging:{value:false,setter:function(a){this.get("dragNode")[a?
"addClass":"removeClass"](m.get("prefixCls")+"dragging")}},mode:{value:"point"},disabled:{value:false,setter:function(a){this.get("dragNode")[a?"addClass":"removeClass"](m.get("prefixCls")+"-disabled");return a}},move:{value:false},primaryButtonOnly:{value:true},halt:{value:true},groups:{value:{}}};var e;i.extend(c,n,{startMousePos:null,startNodePos:null,_diff:null,_bufferTimer:null,_init:function(){var a=this.get("node");this.__set("dragNode",a);a.on("mousedown",g,this).on("dragstart",this._fixDragStart)},
_fixDragStart:function(a){a.preventDefault()},_check:function(a){var d=this,j=d.get("handlers"),q=0;f(j,function(t){if(t.contains(a)||t[0]==a){q=1;d.__set("activeHandler",t);return false}});return q},_checkMouseDown:function(a){if(this.get("primaryButtonOnly")&&a.button>1||this.get("disabled"))return 0;return 1},_prepare:function(a){var d=this;if(h){e=o.body.onselectstart;o.body.onselectstart=l}d.get("halt")?a.halt():a.preventDefault();var j=d.get("node"),q=a.pageX;a=a.pageY;j=j.offset();d.startMousePos=
d.mousePos={left:q,top:a};d.startNodePos=j;d._diff={left:q-j.left,top:a-j.top};m._regToDrag(d);if(q=d.get("bufferTime"))d._bufferTimer=setTimeout(function(){d._start()},q)},_clearBufferTimer:function(){if(this._bufferTimer){clearTimeout(this._bufferTimer);this._bufferTimer=0}},_move:function(a){var d,j=this._diff;d=this.startMousePos;var q=a.pageX;a=a.pageY;var t=q-j.left;j=a-j.top;if(this.get("dragging")){this.mousePos={left:q,top:a};d={left:t,top:j,pageX:q,pageY:a,drag:this};this.fire("dragalign",
{info:d});q=1;if(this.fire("drag",d)===false)q=0;q&&this.get("move")&&this.get("node").offset(d)}else{j=this.get("clickPixelThresh");if(Math.abs(q-d.left)>=j||Math.abs(a-d.top)>=j)this._start()}},_end:function(){var a;this._clearBufferTimer();if(h)o.body.onselectstart=e;if(this.get("dragging")){this.get("node").removeClass(m.get("prefixCls")+"drag-over");(a=m.get("activeDrop"))?this.fire("dragdrophit",{drag:this,drop:a}):this.fire("dragdropmiss",{drag:this});this.__set("dragging",0);this.fire("dragend",
{drag:this})}},_handleOut:function(){this.get("node").removeClass(m.get("prefixCls")+"drag-over");this.fire("dragexit",{drag:this,drop:m.get("activeDrop")})},_handleEnter:function(a){this.get("node").addClass(m.get("prefixCls")+"drag-over");this.fire("dragenter",a)},_handleOver:function(a){this.fire("dragover",a)},_start:function(){this._clearBufferTimer();this.__set("dragging",1);m._start();this.fire("dragstart",{drag:this})},destroy:function(){this.get("dragNode").detach("mousedown",g,this).detach("dragstart",
this._fixDragStart);this.detach()}});return c},{requires:["ua","node","base","./ddm"]});
KISSY.add("dd/droppable-delegate",function(i,r,s,n,m){function c(){var g=this.get("container"),f=this.get("selector");this.__allNodes=g.all(f)}function l(){l.superclass.constructor.apply(this,arguments);r.on("dragstart",c,this)}i.extend(l,s,{getNodeFromTarget:function(g,f,h){var o={left:g.pageX,top:g.pageY};g=this.__allNodes;var e=0,a=Number.MAX_VALUE;g&&g.each(function(d){var j=d[0];if(!(j===h||j===f))if(r.inRegion(r.region(d),o)){j=r.area(r.region(d));if(j<a){a=j;e=d}}});if(e){this.__set("lastNode",
this.get("node"));this.__set("node",e)}return e},_handleOut:function(){l.superclass._handleOut.apply(this,arguments);this.__set("node",0);this.__set("lastNode",0)},_handleOver:function(g){var f=this.get("node"),h=l.superclass._handleOut,o=l.superclass._handleOver,e=l.superclass._handleEnter,a=this.get("lastNode");if(a[0]!==f[0]){this.__set("node",a);h.apply(this,arguments);this.__set("node",f);e.call(this,g)}else o.call(this,g)},_end:function(){l.superclass._end.apply(this,arguments);this.__set("node",
0)}},{ATTRS:{lastNode:{},selector:{},container:{setter:function(g){return m.one(g)}}}});return l},{requires:["./ddm","./droppable","dom","node"]});
KISSY.add("dd/droppable",function(i,r,s,n){function m(){var c=this;m.superclass.constructor.apply(c,arguments);c.addTarget(n);i.each(["dropexit","dropenter","dropover","drophit"],function(l){c.publish(l,{bubbles:1})});c._init()}m.ATTRS={node:{setter:function(c){if(c)return r.one(c)}},groups:{value:true}};i.extend(m,s,{getNodeFromTarget:function(c,l,g){c=this.get("node");var f=c[0];return f==l||f==g?null:c},_init:function(){n._regDrop(this)},_active:function(){var c=n.get("activeDrag"),l=this.get("node"),
g=this.get("groups"),f=c.get("groups");c=n.get("prefixCls");a:if(g===true)g=1;else{for(var h in g)if(f[h]){g=1;break a}g=0}if(g){n._addValidDrop(this);l&&l.addClass(c+"drop-active-valid")}else l&&l.addClass(c+"drop-active-invalid")},_deActive:function(){var c=this.get("node"),l=n.get("prefixCls");c&&c.removeClass(l+"drop-active-valid").removeClass(l+"drop-active-invalid")},__getCustomEvt:function(c){return i.mix({drag:n.get("activeDrag"),drop:this},c)},_handleOut:function(){var c=this.__getCustomEvt();
this.get("node").removeClass(n.get("prefixCls")+"drop-over");this.fire("dropexit",c)},_handleEnter:function(c){c=this.__getCustomEvt(c);c.drag._handleEnter(c);this.get("node").addClass(n.get("prefixCls")+"drop-over");this.fire("dropenter",c)},_handleOver:function(c){c=this.__getCustomEvt(c);c.drag._handleOver(c);this.fire("dropover",c)},_end:function(){var c=this.__getCustomEvt();this.get("node").removeClass(n.get("prefixCls")+"drop-over");this.fire("drophit",c)},destroy:function(){n._unRegDrop(this)}});
return m},{requires:["node","base","./ddm"]});
KISSY.add("dd/proxy",function(i,r,s){function n(){n.superclass.constructor.apply(this,arguments);this[m]={}}var m="__proxy_destructors",c=i.stamp,l=i.guid("__dd_proxy"),g="__proxy";n.ATTRS={node:{value:function(f){return new r(f.get("node").clone(true))}},destroyOnEnd:{value:false},moveOnEnd:{value:true}};i.extend(n,s,{attach:function(f){function h(){var d=e.get("node"),j=f.get("node");if(e[g])d=e[g];else if(i.isFunction(d)){d=d(f);d.addClass("ks-dd-proxy");d.css("position","absolute");e[g]=d}j.parent().append(d);
d.show();d.offset(j.offset());f.__set("dragNode",j);f.__set("node",d)}function o(){var d=e[g];e.get("moveOnEnd")&&f.get("dragNode").offset(d.offset());if(e.get("destroyOnEnd")){d.remove();e[g]=0}else d.hide();f.__set("node",f.get("dragNode"))}var e=this,a=c(f,1,l);if(!(a&&e[m][a])){f.on("dragstart",h);f.on("dragend",o);a=c(f,0,l);e[m][a]={drag:f,fn:function(){f.detach("dragstart",h);f.detach("dragend",o)}}}},unAttach:function(f){f=c(f,1,l);var h=this[m];if(f&&h[f]){h[f].fn();delete h[f]}},destroy:function(){var f=
this.get("node"),h=this[m];f&&!i.isFunction(f)&&f.remove();for(var o in h)this.unAttach(h[o].drag)}});return n},{requires:["node","base"]});
KISSY.add("dd/scroll",function(i,r,s,n,m){function c(){c.superclass.constructor.apply(this,arguments);this[h]={}}var l=i.Env.host,g=i.stamp,f=100,h="__dd_scrolls";c.ATTRS={node:{valueFn:function(){return n.one(l)},setter:function(e){return n.one(e)}},rate:{value:[10,10]},diff:{value:[20,20]}};var o=i.isWindow;i.extend(c,s,{getRegion:function(e){return o(e[0])?{width:m.viewportWidth(),height:m.viewportHeight()}:{width:e.outerWidth(),height:e.outerHeight()}},getOffset:function(e){return o(e[0])?{left:m.scrollLeft(),
top:m.scrollTop()}:e.offset()},getScroll:function(e){return{left:e.scrollLeft(),top:e.scrollTop()}},setScroll:function(e,a){e.scrollLeft(a.left);e.scrollTop(a.top)},unAttach:function(e){var a,d=this[h];if((a=g(e,1,"__dd-scroll-id-"))&&d[a]){d[a].fn();delete d[a]}},destroy:function(){var e=this[h],a;for(a in e)this.unAttach(e[a].drag)},attach:function(e){function a(){if(o(v[0]))return 0;var p=e.mousePos,A=r.region(v);if(!r.inRegion(A,p)){clearTimeout(k);k=0;return 1}return 0}function d(p){if(!p.fake)if(!a()){y=
p;b=i.clone(e.mousePos);p=t.getOffset(v);b.left-=p.left;b.top-=p.top;k||q()}}function j(){clearTimeout(k);k=null}function q(){if(!a()){var p=t.getRegion(v),A=p.width;p=p.height;var u=t.getScroll(v),w=i.clone(u),z=false;if(b.top-p>=-B[1]){u.top+=D[1];z=true}if(b.top<=B[1]){u.top-=D[1];z=true}if(b.left-A>=-B[0]){u.left+=D[0];z=true}if(b.left<=B[0]){u.left-=D[0];z=true}if(z){t.setScroll(v,u);k=setTimeout(q,f);y.fake=true;if(o(v[0])){u=t.getScroll(v);y.left+=u.left-w.left;y.top+=u.top-w.top}e.get("move")&&
e.get("node").offset(y);e.fire("drag",y)}else k=null}}var t=this,v=t.get("node"),C=g(e,0,"__dd-scroll-id-"),F=t[h];if(!F[C]){var D=t.get("rate"),B=t.get("diff"),y,b,k=null;e.on("drag",d);e.on("dragend",j);F[C]={drag:e,fn:function(){e.detach("drag",d);e.detach("dragend",j)}}}}});return c},{requires:["./ddm","base","node","dom"]});
