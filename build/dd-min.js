/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: Jul 3 13:50
*/
KISSY.add("dd/ddm",function(i,l,j){function d(){d.superclass.constructor.apply(this,arguments)}function k(c){var a;if(c=h(c))if(c.preventDefault(),a=this.__activeToDrag)a._move(c);else{if(a=this.get("activeDrag"))a._move(c),this.__needDropCheck&&f(this,c,a)}else d._end()}function b(c){c.preventDefault();G.call(this,c)}function f(c,a,b){var h=c.get("validDrops"),o=b.get("mode"),e=0,d=0,f=m(b.get("node")),g=p(f);i.each(h,function(c){var h;if(h=c.getNodeFromTarget(a,b.get("dragNode")[0],b.get("node")[0]))if("point"==
o)s(m(h),b.mousePos)&&(h=p(m(h)),e?h<d&&(e=c,d=h):(e=c,d=h));else if("intersect"==o)h=p(t(f,m(h))),h>d&&(d=h,e=c);else if("strict"==o&&(h=p(t(f,m(h))),h==g))return e=c,!1});if((h=c.get("activeDrop"))&&h!=e)h._handleOut(a),b._handleOut(a);c.setInternal("activeDrop",e);e&&(h!=e?e._handleEnter(a):e._handleOver(a))}function g(c){c._shim=(new l('<div style="background-color:red;position:'+(y?"absolute":"fixed")+";left:0;width:100%;height:100%;top:0;cursor:"+r.get("dragCursor")+";z-index:"+H+';"></div>')).prependTo(u.body||
u.documentElement).css("opacity",0);g=e;if(y)I.on("resize scroll",B,c);e(c)}function e(c){var a=c.get("activeDrag").get("activeHandler"),h="auto";a&&(h=a.css("cursor"));"auto"==h&&(h=c.get("dragCursor"));c._shim.css({cursor:h,display:"block"});y&&B.call(c)}function v(c){var a=c.get("drops");c.setInternal("validDrops",[]);a.length&&i.each(a,function(c){c._active()})}function w(c){var a=c.get("drops");c.setInternal("validDrops",[]);a.length&&i.each(a,function(c){c._deActive()})}function m(c){var a=
c.offset();return{left:a.left,right:a.left+(c.__dd_cached_width||c.outerWidth()),top:a.top,bottom:a.top+(c.__dd_cached_height||c.outerHeight())}}function s(c,a){return c.left<=a.left&&c.right>=a.left&&c.top<=a.top&&c.bottom>=a.top}function p(c){return c.top>=c.bottom||c.left>=c.right?0:(c.right-c.left)*(c.bottom-c.top)}function t(c,a){var h=Math.max(c.top,a.top),b=Math.min(c.right,a.right),e=Math.min(c.bottom,a.bottom);return{left:Math.max(c.left,a.left),right:b,top:h,bottom:e}}function a(c){c&&(c.__dd_cached_width=
c.outerWidth(),c.__dd_cached_height=c.outerHeight())}function h(c){var a=""+c.type,a=(a=a==n.end||a==n.cancel?c.changedTouches:c.touches)||[];if((C.isTouchEventSupported()||C.isMsPointerSupported())&&a.length){if(1!=a.length)return;a=a[0];c[z]=c[z]||a[z];c[A]=c[A]||a[A];c.pageX=a.pageX;c.pageY=a.pageY}c.which=1;return c}var o=i.UA,D=l.all,C=i.Features,E=i.Env.host,u=E.document,q=D(u),I=D(E),y=6===o.ie,H=999999,z="target",n=l.Gesture,A="currentTarget",F=n.move,x=n.end;n.cancel&&(x+=" "+n.cancel);d.ATTRS=
{dragCursor:{value:"move"},clickPixelThresh:{value:3},bufferTime:{value:1},activeDrag:{},activeDrop:{},drops:{value:[]},validDrops:{value:[]}};var G=o.ie&&8>o.ie?i.throttle(k,30):k,B=i.throttle(function(){var c;(c=this.get("activeDrag"))&&c.get("shim")&&this._shim.css({width:q.width(),height:q.height()})},30);i.extend(d,j,{__activeToDrag:0,_regDrop:function(c){this.get("drops").push(c)},_unRegDrop:function(c){var a=this.get("drops"),c=i.indexOf(c,a);-1!=c&&a.splice(c,1)},_regToDrag:function(a){this.__activeToDrag=
a;q.on(x,this._end,this);if(n.cancel)q.on(n.cancel,this._end,this);q.on(F,b,this);6===o.ie&&u.body.setCapture()},_start:function(){this.get("drops");var c=this.__activeToDrag;this.setInternal("activeDrag",c);this.__activeToDrag=0;c.get("shim")&&g(this);this.__needDropCheck=0;c.get("groups")&&(v(this),this.get("validDrops").length&&(a(c.get("node")),this.__needDropCheck=1))},_addValidDrop:function(a){this.get("validDrops").push(a)},_end:function(a){var e=this.__activeToDrag,d=this.get("activeDrag"),
f=this.get("activeDrop"),a=a&&h(a);e&&e._move(a);d&&d._move(a);q.detach(F,b,this);q.detach(x,this._end,this);n.cancel&&q.detach(n.cancel,this._end,this);6===o.ie&&u.body.releaseCapture();e&&(e._end(a),this.__activeToDrag=0);this._shim&&this._shim.hide();d&&(d._end(a),w(this),f&&f._end(a),this.setInternal("activeDrag",null),this.setInternal("activeDrop",null))}});var r=new d;r.inRegion=s;r.region=m;r.area=p;r.cacheWH=a;r.PREFIX_CLS="ks-dd-";return r},{requires:["node","base"]});
KISSY.add("dd/draggable",function(i,l,j,d){function k(){return!1}var b=i.UA,f=l.all,g=i.Features,g=g.isTouchEventSupported()||g.isMsPointerSupported(),e=i.each,v=g?"singleTouchStart":l.Gesture.start,w=b.ie,m=d.PREFIX_CLS,s=i.Env.host.document,j=j.extend({initializer:function(){this.addTarget(d);this._allowMove=this.get("move")},_onSetNode:function(a){this.setInternal("dragNode",a);this.bindDragEvent()},bindDragEvent:function(){this.get("node").on(v,t,this).on("dragstart",this._fixDragStart)},detachDragEvent:function(){this.get("node").detach(v,
t,this).detach("dragstart",this._fixDragStart)},_bufferTimer:null,_onSetDisabledChange:function(a){this.get("dragNode")[a?"addClass":"removeClass"](m+"-disabled")},_fixDragStart:function(a){a.preventDefault()},_checkHandler:function(a){var h=this,b=h.get("handlers"),d=0;e(b,function(b){if(b[0]==a||b.contains(a))return d=1,h.setInternal("activeHandler",b),!1});return d},_checkDragStartValid:function(a){return this.get("primaryButtonOnly")&&1!=a.which||this.get("disabled")?0:1},_prepare:function(a){if(a){var b=
this;w&&(p=s.body.onselectstart,s.body.onselectstart=k);b.get("halt")&&a.stopPropagation();a.preventDefault();var e=a.pageX,f=a.pageY;b.setInternal("startMousePos",b.mousePos={left:e,top:f});if(b._allowMove){var g=b.get("node").offset();b.setInternal("startNodePos",g);b.setInternal("deltaPos",{left:e-g.left,top:f-g.top})}d._regToDrag(b);if(e=b.get("bufferTime"))b._bufferTimer=setTimeout(function(){b._start(a)},1E3*e)}},_clearBufferTimer:function(){this._bufferTimer&&(clearTimeout(this._bufferTimer),
this._bufferTimer=0)},_move:function(a){var b=a.pageX,e=a.pageY;if(!this.get("dragging")){var d=this.get("startMousePos"),f=0,g=this.get("clickPixelThresh");if(Math.abs(b-d.left)>=g||Math.abs(e-d.top)>=g)this._start(a),f=1;if(!f)return}this.mousePos={left:b,top:e};a={pageX:b,pageY:e,drag:this};if(d=this._allowMove)f=this.get("deltaPos"),b-=f.left,e-=f.top,a.left=b,a.top=e,this.setInternal("actualPos",{left:b,top:e}),this.fire("dragalign",a);e=1;!1===this.fire("drag",a)&&(e=0);e&&d&&this.get("node").offset(this.get("actualPos"))},
stopDrag:function(){d._end()},_end:function(a){var a=a||{},b;this._clearBufferTimer();w&&(s.body.onselectstart=p);this.get("dragging")&&(this.get("node").removeClass(m+"drag-over"),(b=d.get("activeDrop"))?this.fire("dragdrophit",{drag:this,drop:b}):this.fire("dragdropmiss",{drag:this}),this.setInternal("dragging",0),this.fire("dragend",{drag:this,pageX:a.pageX,pageY:a.pageY}))},_handleOut:function(){this.get("node").removeClass(m+"drag-over");this.fire("dragexit",{drag:this,drop:d.get("activeDrop")})},
_handleEnter:function(a){this.get("node").addClass(m+"drag-over");this.fire("dragenter",a)},_handleOver:function(a){this.fire("dragover",a)},_start:function(a){this._clearBufferTimer();this.setInternal("dragging",1);this.setInternal("dragStartMousePos",{left:a.pageX,top:a.pageY});d._start();this.fire("dragstart",{drag:this,pageX:a.pageX,pageY:a.pageY})},destructor:function(){this.detachDragEvent();this.detach()}},{name:"Draggable",DRAG_START_EVENT:v,ATTRS:{node:{setter:function(a){if(!(a instanceof
l))return f(a)}},clickPixelThresh:{valueFn:function(){return d.get("clickPixelThresh")}},bufferTime:{valueFn:function(){return d.get("bufferTime")}},dragNode:{},shim:{value:!g},handlers:{value:[],getter:function(a){var b=this;a.length||(a[0]=b.get("node"));e(a,function(e,d){i.isFunction(e)&&(e=e.call(b));"string"==typeof e&&(e=b.get("node").one(e));e.nodeType&&(e=f(e));a[d]=e});b.setInternal("handlers",a);return a}},activeHandler:{},dragging:{value:!1,setter:function(a){this.get("dragNode")[a?"addClass":
"removeClass"](m+"dragging")}},mode:{value:"point"},disabled:{value:!1},move:{value:!1},primaryButtonOnly:{value:!0},halt:{value:!0},groups:{value:!0},startMousePos:{},dragStartMousePos:{},startNodePos:{},deltaPos:{},actualPos:{}}});j.DropMode={POINT:"point",INTERSECT:"intersect",STRICT:"strict"};i.mix(j,j.DropMode);var p,t=function(a){var b=a.target;this._checkDragStartValid(a)&&this._checkHandler(b)&&this._prepare(a)};return j},{requires:["node","rich-base","./ddm"]});
KISSY.add("dd/draggable-delegate",function(i,l,j,d){var k=l.PREFIX_CLS,b=d.all,f=j.DRAG_START_EVENT,g=function(e){var d,f;if(this._checkDragStartValid(e)){d=this.get("handlers");var g=b(e.target);(d=d.length?this._getHandler(g):g)&&(f=this._getNode(d));f&&(this.setInternal("activeHandler",d),this.setInternal("node",f),this.setInternal("dragNode",f),this._prepare(e))}};return j.extend({_onSetNode:function(){},_onSetContainer:function(){this.bindDragEvent()},_onSetDisabledChange:function(b){this.get("container")[b?
"addClass":"removeClass"](k+"-disabled")},bindDragEvent:function(){this.get("container").on(f,g,this).on("dragstart",this._fixDragStart)},detachDragEvent:function(){this.get("container").detach(f,g,this).detach("dragstart",this._fixDragStart)},_getHandler:function(b){for(var d=void 0,f=this.get("container"),g=this.get("handlers");b&&b[0]!==f[0];){i.each(g,function(f){if(b.test(f))return d=b,!1});if(d)break;b=b.parent()}return d},_getNode:function(b){return b.closest(this.get("selector"),this.get("container"))}},
{ATTRS:{container:{setter:function(e){return b(e)}},selector:{},handlers:{value:[],getter:0}}})},{requires:["./ddm","./draggable","node"]});
KISSY.add("dd/droppable",function(i,l,j,d){var k=d.PREFIX_CLS;return j.extend({initializer:function(){this.addTarget(d);d._regDrop(this)},getNodeFromTarget:function(b,d,g){var b=this.get("node"),e=b[0];return e==d||e==g?null:b},_active:function(){var b=d.get("activeDrag"),f=this.get("node"),g=this.get("groups"),b=b.get("groups");a:if(!0===b)g=1;else{for(var e in g)if(b[e]){g=1;break a}g=0}g?(d._addValidDrop(this),f&&(f.addClass(k+"drop-active-valid"),d.cacheWH(f))):f&&f.addClass(k+"drop-active-invalid")},
_deActive:function(){var b=this.get("node");b&&b.removeClass(k+"drop-active-valid").removeClass(k+"drop-active-invalid")},__getCustomEvt:function(b){return i.mix({drag:d.get("activeDrag"),drop:this},b)},_handleOut:function(){var b=this.__getCustomEvt();this.get("node").removeClass(k+"drop-over");this.fire("dropexit",b)},_handleEnter:function(b){b=this.__getCustomEvt(b);b.drag._handleEnter(b);this.get("node").addClass(k+"drop-over");this.fire("dropenter",b)},_handleOver:function(b){b=this.__getCustomEvt(b);
b.drag._handleOver(b);this.fire("dropover",b)},_end:function(){var b=this.__getCustomEvt();this.get("node").removeClass(k+"drop-over");this.fire("drophit",b)},destructor:function(){d._unRegDrop(this)}},{name:"Droppable",ATTRS:{node:{setter:function(b){if(b)return l.one(b)}},groups:{value:{}}}})},{requires:["node","rich-base","./ddm"]});
KISSY.add("dd/droppable-delegate",function(i,l,j,d){function k(){var b=this.get("container"),d=[],e=this.get("selector");b.all(e).each(function(b){l.cacheWH(b);d.push(b)});this.__allNodes=d}var b=j.extend({initializer:function(){l.on("dragstart",k,this)},getNodeFromTarget:function(b,d,e){var k={left:b.pageX,top:b.pageY},b=this.__allNodes,j=0,m=Number.MAX_VALUE;b&&i.each(b,function(b){var f=b[0];f===e||f===d||(f=l.region(b),l.inRegion(f,k)&&(f=l.area(f),f<m&&(m=f,j=b)))});j&&(this.setInternal("lastNode",
this.get("node")),this.setInternal("node",j));return j},_handleOut:function(){b.superclass._handleOut.apply(this,arguments);this.setInternal("node",0);this.setInternal("lastNode",0)},_handleOver:function(d){var g=this.get("node"),e=b.superclass._handleOut,i=b.superclass._handleOver,j=b.superclass._handleEnter,k=this.get("lastNode");k[0]!==g[0]?(this.setInternal("node",k),e.apply(this,arguments),this.setInternal("node",g),j.call(this,d)):i.call(this,d)},_end:function(){b.superclass._end.apply(this,
arguments);this.setInternal("node",0)}},{ATTRS:{lastNode:{},selector:{},container:{setter:function(b){return d.one(b)}}}});return b},{requires:["./ddm","./droppable","node"]});KISSY.add("dd",function(i,l,j,d,k,b){i={Draggable:j,DDM:l,Droppable:k,DroppableDelegate:b,DraggableDelegate:d};return KISSY.DD=i},{requires:["dd/ddm","dd/draggable","dd/draggable-delegate","dd/droppable","dd/droppable-delegate"]});
