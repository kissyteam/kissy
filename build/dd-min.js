/*
Copyright 2012, KISSY UI Library v1.40dev
MIT Licensed
build time: Aug 21 20:54
*/
KISSY.add("dd/constrain",function(d,k,i){function j(){j.superclass.constructor.apply(this,arguments);this[c]={}}function g(c){var a,l,c=c.drag.get("dragNode"),b=this.get("constrain");if(b){if(!0===b||b.setTimeout){var m;m=!0===b?f(e):f(b);this.__constrainRegion={left:a=m.scrollLeft(),top:l=m.scrollTop(),right:a+m.width(),bottom:l+m.height()}}if(b.nodeType||d.isString(b))b=f(b);b.getDOMNode?(a=b.offset(),this.__constrainRegion={left:a.left,top:a.top,right:a.left+b.outerWidth(),bottom:a.top+b.outerHeight()}):
d.isPlainObject(b)&&(this.__constrainRegion=b);this.__constrainRegion&&(this.__constrainRegion.right-=c.outerWidth(),this.__constrainRegion.bottom-=c.outerHeight())}}function h(c){var c=c.info,a=c.left,b=c.top,e=this.__constrainRegion;e&&(c.left=Math.min(Math.max(e.left,a),e.right),c.top=Math.min(Math.max(e.top,b),e.bottom))}function b(){this.__constrainRegion=null}var f=i.all,c="__constrain_destructors",m=d.stamp,o=d.guid("__dd_constrain"),e=d.Env.host;d.extend(j,k,{__constrainRegion:null,attachDrag:function(e){var a=
this[c],l=m(e,0,o);if(a[l])return this;a[l]=e;e.on("dragstart",g,this).on("dragend",b,this).on("dragalign",h,this);return this},detachDrag:function(e){var a=m(e,1,o),l=this[c];a&&l[a]&&(e.detach("dragstart",g,this).detach("dragend",b,this).detach("dragalign",h,this),delete l[a]);return this},destroy:function(){var b=this,a=d.merge(b[c]);d.each(a,function(a){b.detachDrag(a)})}},{ATTRS:{constrain:{value:!0}}});return j},{requires:["base","node"]});
KISSY.add("dd",function(d,k,i,j,g,h,b,f,c){d={Draggable:i,Droppable:j,DDM:k,Constrain:h,Proxy:g,DraggableDelegate:b,DroppableDelegate:f,Scroll:c};return KISSY.DD=d},{requires:"dd/ddm,dd/draggable,dd/droppable,dd/proxy,dd/constrain,dd/draggable-delegate,dd/droppable-delegate,dd/scroll".split(",")});
KISSY.add("dd/ddm",function(d,k,i,j,g,h){function b(){b.superclass.constructor.apply(this,arguments)}function f(c,b,e){var m=e.get("mode"),h=c.get("validDrops"),f=0,g=0,o=u(e.get("node")),i=l(o);d.each(h,function(c){var p;if(p=c.getNodeFromTarget(b,e.get("dragNode")[0],e.get("node")[0]))if("point"==m)a(u(p),e.mousePos)&&(p=l(u(p)),f?p<g&&(f=c,g=p):(f=c,g=p));else if("intersect"==m)p=l(y(o,u(p))),p>g&&(g=p,f=c);else if("strict"==m&&(p=l(y(o,u(p))),p==i))return f=c,!1});if((h=c.get("activeDrop"))&&
h!=f)h._handleOut(b),e._handleOut(b);c.setInternal("activeDrop",f);f&&(h!=f?f._handleEnter(b):f._handleOver(b))}function c(a){a._shim=(new g('<div style="background-color:red;position:'+(w?"absolute":"fixed")+";left:0;width:100%;height:100%;top:0;cursor:"+n.get("dragCursor")+";z-index:"+x+';"></div>')).prependTo(q.body||q.documentElement).css("opacity",0);c=m;if(w)j.on(r,"resize scroll",s,a);m(a)}function m(a){var c=a.get("activeDrag").get("activeHandler"),b="auto";c&&(b=c.css("cursor"));"auto"==
b&&(b=a.get("dragCursor"));a._shim.css({cursor:b,display:"block"});w&&s.call(a)}function o(a){var c=a.get("drops");a.setInternal("validDrops",[]);d.each(c,function(a){a._active()})}function e(a){var c=a.get("drops");a.setInternal("validDrops",[]);d.each(c,function(a){a._deActive()})}function u(a){var c=a.offset();return{left:c.left,right:c.left+(a.__dd_cached_width||a.outerWidth()),top:c.top,bottom:c.top+(a.__dd_cached_height||a.outerHeight())}}function a(a,c){return a.left<=c.left&&a.right>=c.left&&
a.top<=c.top&&a.bottom>=c.top}function l(a){return a.top>=a.bottom||a.left>=a.right?0:(a.right-a.left)*(a.bottom-a.top)}function y(a,c){var b=Math.max(a.top,c.top),e=Math.min(a.right,c.right),l=Math.min(a.bottom,c.bottom);return{left:Math.max(a.left,c.left),right:e,top:b,bottom:l}}function z(a){a&&(a.__dd_cached_width=a.outerWidth(),a.__dd_cached_height=a.outerHeight())}var r=d.Env.host,q=r.document,w=6===k.ie,v=d.throttle(function(a){var c;if(c=this.__activeToDrag)a.preventDefault(),c._move(a);else if(c=
this.get("activeDrag"))a.preventDefault(),c._move(a),f(this,a,c)},30),x=999999;b.ATTRS={dragCursor:{value:"move"},clickPixelThresh:{value:3},bufferTime:{value:1},activeDrag:{},activeDrop:{},drops:{value:[]},validDrops:{value:[]}};var s=d.throttle(function(){var a;(a=this.get("activeDrag"))&&a.get("shim")&&this._shim.css({width:i.docWidth(),height:i.docHeight()})},30);d.extend(b,h,{__activeToDrag:0,_regDrop:function(a){this.get("drops").push(a)},_unRegDrop:function(a){a=d.indexOf(a,this.get("drops"));
-1!=a&&this.get("drops").splice(a,1)},_regToDrag:function(a){this.__activeToDrag=a;j.on(q,A,this._end,this);j.on(q,t,v,this);6===k.ie&&q.body.setCapture()},_start:function(){this.get("drops");var a=this.__activeToDrag;this.setInternal("activeDrag",a);this.__activeToDrag=0;a.get("shim")&&c(this);z(a.get("node"));o(this)},_addValidDrop:function(a){this.get("validDrops").push(a)},_end:function(){var a=this.get("activeDrag"),c=this.get("activeDrop");j.remove(q,t,v,this);j.remove(q,A,this._end,this);6===
k.ie&&q.body.releaseCapture();this.__activeToDrag&&(this.__activeToDrag._end(),this.__activeToDrag=0);this._shim&&this._shim.hide();a&&(a._end(),e(this),c&&c._end(),this.setInternal("activeDrag",null),this.setInternal("activeDrop",null))}});var n=new b;n.inRegion=a;n.region=u;n.area=l;n.cacheWH=z;n.PREFIX_CLS="ks-dd-";h="ontouchstart"in q;n.DRAG_START_EVENT=h?"touchstart":"mousedown";var t=n.DRAG_MOVE_EVENT=h?"touchmove":"mousemove",A=n.DRAG_END_EVENT=h?"touchend":"mouseup";n._normalHandlePreDragStart=
function(a){return function(c){var b;if(b=c.originalEvent.touches){if(1!=b.length)return;b=b[0];c.target=c.target||b.target;c.currentTarget=c.currentTarget||b.currentTarget;c.button=c.button||0}a.call(this,c)}};return n},{requires:["ua","dom","event","node","base"]});
KISSY.add("dd/draggable-delegate",function(d,k,i,j,g){function h(){h.superclass.constructor.apply(this,arguments)}var b=k.PREFIX_CLS,f=k._normalHandlePreDragStart(function(c){var b,f;if(this._checkDragStartValid(c)){b=this.get("handlers");var e=new g(c.target);(b=b.length?this._getHandler(e):e)&&(f=this._getNode(b));f&&(this.setInternal("activeHandler",b),this.setInternal("node",f),this.setInternal("dragNode",f),this._prepare(c))}});d.extend(h,i,{_uiSetDisabledChange:function(c){this.get("container")[c?
"addClass":"removeClass"](b+"-disabled")},_init:function(){this.get("container").on(k.DRAG_START_EVENT,f,this).on("dragstart",this._fixDragStart)},_getHandler:function(c){for(var b=void 0,f=this.get("container"),e=this.get("handlers");c&&c[0]!==f[0];){d.each(e,function(e){if(j.test(c[0],e))return b=c,!1});if(b)break;c=c.parent()}return b},_getNode:function(c){return c.closest(this.get("selector"),this.get("container"))},destroy:function(){this.get("container").detach(k.DRAG_START_EVENT,f,this).detach("dragstart",
this._fixDragStart);this.detach()}},{ATTRS:{container:{setter:function(c){return g.one(c)}},selector:{},handlers:{value:[],getter:0}}});return h},{requires:["./ddm","./draggable","dom","node"]});
KISSY.add("dd/draggable",function(d,k,i,j,g){function h(){var a=this;h.superclass.constructor.apply(a,arguments);a.addTarget(g);d.each("dragalign,drag,dragdrophit,dragend,dragdropmiss,dragexit,dragenter,dragover,dragstart".split(","),function(c){a.publish(c,{bubbles:1})});a.setInternal("dragNode",a.get("node"));a.on("afterDisabledChange",a._uiSetDisabledChange,a);var c;(c=a.get("disabled"))&&a._uiSetDisabledChange(c);a._init()}function b(){return!1}var f=d.each,c=k.ie,m=g.PREFIX_CLS,o=d.Env.host.document;
h.ATTRS={node:{setter:function(a){if(!(a instanceof i))return i.one(a)}},clickPixelThresh:{valueFn:function(){return g.get("clickPixelThresh")}},bufferTime:{valueFn:function(){return g.get("bufferTime")}},dragNode:{},shim:{value:!0},handlers:{value:[],getter:function(a){var c=this;a.length||(a[0]=c.get("node"));f(a,function(b,e){d.isFunction(b)&&(b=b.call(c));if(d.isString(b)||b.nodeType)b=i.one(b);a[e]=b});c.setInternal("handlers",a);return a}},activeHandler:{},dragging:{value:!1,setter:function(a){this.get("dragNode")[a?
"addClass":"removeClass"](m+"dragging")}},mode:{value:"point"},disabled:{value:!1},move:{value:!1},primaryButtonOnly:{value:!0},halt:{value:!0},groups:{value:{}}};h.DropMode={POINT:"point",INTERSECT:"intersect",STRICT:"strict"};d.mix(h,h.DropMode);var e,u=g._normalHandlePreDragStart(function(a){var c=a.target;this._checkDragStartValid(a)&&this._checkHandler(c)&&this._prepare(a)});d.extend(h,j,{startMousePos:null,startNodePos:null,_diff:null,_bufferTimer:null,_uiSetDisabledChange:function(a){this.get("dragNode")[a?
"addClass":"removeClass"](m+"-disabled")},_init:function(){this.get("node").on(g.DRAG_START_EVENT,u,this).on("dragstart",this._fixDragStart)},_fixDragStart:function(a){a.preventDefault()},_checkHandler:function(a){var c=this,b=c.get("handlers"),e=0;f(b,function(b){if(b.contains(a)||b[0]==a)return e=1,c.setInternal("activeHandler",b),!1});return e},_checkDragStartValid:function(a){return this.get("primaryButtonOnly")&&1<a.button||this.get("disabled")?0:1},_prepare:function(a){var l=this;c&&(e=o.body.onselectstart,
o.body.onselectstart=b);l.get("halt")?a.halt():a.preventDefault();var f=l.get("node"),d=a.pageX,a=a.pageY,f=f.offset();l.startMousePos=l.mousePos={left:d,top:a};l.startNodePos=f;l._diff={left:d-f.left,top:a-f.top};g._regToDrag(l);if(d=l.get("bufferTime"))l._bufferTimer=setTimeout(function(){l._start()},1E3*d)},_clearBufferTimer:function(){this._bufferTimer&&(clearTimeout(this._bufferTimer),this._bufferTimer=0)},_move:function(a){var c,b=this._diff;c=this.startMousePos;var e=a.pageX,a=a.pageY,f=e-
b.left,b=a-b.top;this.get("dragging")?(this.mousePos={left:e,top:a},c={left:f,top:b,pageX:e,pageY:a,drag:this},this.fire("dragalign",{info:c}),e=1,!1===this.fire("drag",c)&&(e=0),e&&this.get("move")&&this.get("node").offset(c)):(b=this.get("clickPixelThresh"),(Math.abs(e-c.left)>=b||Math.abs(a-c.top)>=b)&&this._start())},stopDrag:function(){this.get("dragging")&&g._end()},_end:function(){var a;this._clearBufferTimer();c&&(o.body.onselectstart=e);this.get("dragging")&&(this.get("node").removeClass(m+
"drag-over"),(a=g.get("activeDrop"))?this.fire("dragdrophit",{drag:this,drop:a}):this.fire("dragdropmiss",{drag:this}),this.setInternal("dragging",0),this.fire("dragend",{drag:this}))},_handleOut:function(){this.get("node").removeClass(m+"drag-over");this.fire("dragexit",{drag:this,drop:g.get("activeDrop")})},_handleEnter:function(a){this.get("node").addClass(m+"drag-over");this.fire("dragenter",a)},_handleOver:function(a){this.fire("dragover",a)},_start:function(){this._clearBufferTimer();this.setInternal("dragging",
1);g._start();this.fire("dragstart",{drag:this})},destroy:function(){this.get("dragNode").detach(g.DRAG_START_EVENT,u,this).detach("dragstart",this._fixDragStart);this.detach()}});return h},{requires:["ua","node","base","./ddm"]});
KISSY.add("dd/droppable-delegate",function(d,k,i,j,g){function h(){var b=this.get("container"),c=[],d=this.get("selector");b.all(d).each(function(b){k.cacheWH(b);c.push(b)});this.__allNodes=c}function b(){b.superclass.constructor.apply(this,arguments);k.on("dragstart",h,this)}d.extend(b,i,{destroy:function(){b.superclass.destroy.apply(this,arguments)},getNodeFromTarget:function(b,c,h){var g={left:b.pageX,top:b.pageY},b=this.__allNodes,e=0,i=Number.MAX_VALUE;b&&d.each(b,function(a){var b=a[0];b===
h||b===c||(b=k.region(a),k.inRegion(b,g)&&(b=k.area(b),b<i&&(i=b,e=a)))});e&&(this.setInternal("lastNode",this.get("node")),this.setInternal("node",e));return e},_handleOut:function(){b.superclass._handleOut.apply(this,arguments);this.setInternal("node",0);this.setInternal("lastNode",0)},_handleOver:function(f){var c=this.get("node"),d=b.superclass._handleOut,h=b.superclass._handleOver,e=b.superclass._handleEnter,g=this.get("lastNode");g[0]!==c[0]?(this.setInternal("node",g),d.apply(this,arguments),
this.setInternal("node",c),e.call(this,f)):h.call(this,f)},_end:function(){b.superclass._end.apply(this,arguments);this.setInternal("node",0)}},{ATTRS:{lastNode:{},selector:{},container:{setter:function(b){return g.one(b)}}}});return b},{requires:["./ddm","./droppable","dom","node"]});
KISSY.add("dd/droppable",function(d,k,i,j){function g(){var b=this;g.superclass.constructor.apply(b,arguments);b.addTarget(j);d.each(["dropexit","dropenter","dropover","drophit"],function(d){b.publish(d,{bubbles:1})});b._init()}var h=j.PREFIX_CLS;g.ATTRS={node:{setter:function(b){if(b)return k.one(b)}},groups:{value:!0}};d.extend(g,i,{getNodeFromTarget:function(b,d,c){var b=this.get("node"),h=b[0];return h==d||h==c?null:b},_init:function(){j._regDrop(this)},_active:function(){var b=j.get("activeDrag"),
d=this.get("node"),c=this.get("groups");a:if(b=b.get("groups"),!0===c)c=1;else{for(var g in c)if(c.hasOwnProperty(g)&&b[g]){c=1;break a}c=0}c?(j._addValidDrop(this),d&&(d.addClass(h+"drop-active-valid"),j.cacheWH(d))):d&&d.addClass(h+"drop-active-invalid")},_deActive:function(){var b=this.get("node");b&&b.removeClass(h+"drop-active-valid").removeClass(h+"drop-active-invalid")},__getCustomEvt:function(b){return d.mix({drag:j.get("activeDrag"),drop:this},b)},_handleOut:function(){var b=this.__getCustomEvt();
this.get("node").removeClass(h+"drop-over");this.fire("dropexit",b)},_handleEnter:function(b){b=this.__getCustomEvt(b);b.drag._handleEnter(b);this.get("node").addClass(h+"drop-over");this.fire("dropenter",b)},_handleOver:function(b){b=this.__getCustomEvt(b);b.drag._handleOver(b);this.fire("dropover",b)},_end:function(){var b=this.__getCustomEvt();this.get("node").removeClass(h+"drop-over");this.fire("drophit",b)},destroy:function(){j._unRegDrop(this)}});return g},{requires:["node","base","./ddm"]});
KISSY.add("dd/proxy",function(d,k,i,j){function g(){g.superclass.constructor.apply(this,arguments);this[h]={}}var h="__proxy_destructors",b=d.stamp,f=d.guid("__dd_proxy");g.ATTRS={node:{value:function(b){return new k(b.get("node").clone(!0))}},destroyOnEnd:{value:!1},moveOnEnd:{value:!0},proxyNode:{}};d.extend(g,i,{attachDrag:function(c){function g(){var a=e.get("node"),b=c.get("node");e.get("proxyNode")?a=e.get("proxyNode"):d.isFunction(a)&&(a=a(c),a.addClass("ks-dd-proxy"),a.css("position","absolute"),
e.set("proxyNode",a));a.show();b.parent().append(a);j.cacheWH(a);a.offset(b.offset());c.setInternal("dragNode",b);c.setInternal("node",a)}function i(){var a=e.get("proxyNode");e.get("moveOnEnd")&&c.get("dragNode").offset(a.offset());e.get("destroyOnEnd")?(a.remove(),e.set("proxyNode",0)):a.hide();c.setInternal("node",c.get("dragNode"))}var e=this,k=e[h],a=b(c,0,f);if(k[a])return e;c.on("dragstart",g);c.on("dragend",i);k[a]={drag:c,fn:function(){c.detach("dragstart",g);c.detach("dragend",i)}};return e},
detachDrag:function(c){var c=b(c,1,f),d=this[h];c&&d[c]&&(d[c].fn(),delete d[c]);return this},destroy:function(){var b=this.get("node"),g=this[h];b&&!d.isFunction(b)&&b.remove();for(var f in g)g.hasOwnProperty(f)&&this.detachDrag(g[f].drag)}});i=g.prototype;i.attach=i.attachDrag;i.unAttach=i.detachDrag;return g},{requires:["node","base","./ddm"]});
KISSY.add("dd/scroll",function(d,k,i,j,g){function h(){h.superclass.constructor.apply(this,arguments);this[m]={}}var b=d.Env.host,f=d.stamp,c=100,m="__dd_scrolls";h.ATTRS={node:{valueFn:function(){return j.one(b)},setter:function(b){return j.one(b)}},rate:{value:[10,10]},diff:{value:[20,20]}};var o=d.isWindow;d.extend(h,i,{getRegion:function(b){return o(b[0])?{width:g.viewportWidth(),height:g.viewportHeight()}:{width:b.outerWidth(),height:b.outerHeight()}},getOffset:function(b){return o(b[0])?{left:g.scrollLeft(),
top:g.scrollTop()}:b.offset()},getScroll:function(b){return{left:b.scrollLeft(),top:b.scrollTop()}},setScroll:function(b,c){b.scrollLeft(c.left);b.scrollTop(c.top)},detachDrag:function(b){var c,a=this[m];if(!(c=f(b,1,"__dd-scroll-id-"))||!a[c])return this;a[c].fn();delete a[c];return this},destroy:function(){var b=this;d.each(b[m],function(c){b.detachDrag(c.drag)})},attachDrag:function(b){function g(){if(o(r[0]))return 0;var a=b.mousePos,c=k.region(r);return!k.inRegion(c,a)?(clearTimeout(t),t=0,1):
0}function a(a){!a.fake&&!g()&&(s=a,n=d.clone(b.mousePos),a=j.getOffset(r),n.left-=a.left,n.top-=a.top,t||i())}function h(){clearTimeout(t);t=null}function i(){if(!g()){var a=j.getRegion(r),h=a.width,a=a.height,f=j.getScroll(r),k=d.clone(f),l=!1;n.top-a>=-x[1]&&(f.top+=v[1],l=!0);n.top<=x[1]&&(f.top-=v[1],l=!0);n.left-h>=-x[0]&&(f.left+=v[0],l=!0);n.left<=x[0]&&(f.left-=v[0],l=!0);l?(j.setScroll(r,f),t=setTimeout(i,c),s.fake=!0,o(r[0])&&(f=j.getScroll(r),s.left+=f.left-k.left,s.top+=f.top-k.top),
b.get("move")&&b.get("node").offset(s),b.fire("drag",s)):t=null}}var j=this,r=j.get("node"),q=f(b,0,"__dd-scroll-id-"),w=j[m];if(w[q])return this;var v=j.get("rate"),x=j.get("diff"),s,n,t=null;b.on("drag",a);b.on("dragstart",function(){k.cacheWH(r)});b.on("dragend",h);w[q]={drag:b,fn:function(){b.detach("drag",a);b.detach("dragend",h)}};return this}});i=h.prototype;i.attach=i.attachDrag;i.unAttach=i.detachDrag;return h},{requires:["./ddm","base","node","dom"]});
