/*
Copyright 2014, KISSY v5.0.0
MIT Licensed
build time: Jul 18 14:04
*/
KISSY.add("scroll-view/plugin/pull-to-refresh",["base","util","node","util","feature"],function(f,e,n,k){function g(a,b,d){a.isLoading="loading"===b;var c=a.scrollView.get("prefixCls");a.get$El(d).attr("class",c+"scroll-view-pull-"+d+"-to-refresh "+c+"scroll-view-"+b);a.get$LabelEl(d).html(a.getStateHtml(d,b))}var f=e("base"),h=e("util"),l=e("node"),m=e("util").substitute,i=(e=e("feature").getCssVendorInfo("transform"))&&e.propertyName;k.exports=f.extend({pluginId:this.name,get$El:function(a){return this["$"+
a+"El"]},getEl:function(a){return this.get$El(a)[0]},get$LabelEl:function(a){return this["$"+a+"LabelEl"]},getStateHtml:function(a,b){a=h.ucfirst(a);return this.get(b+a+"Html")},_onSetPullUpState:function(a){g(this,a,"up")},_onSetPullDownState:function(a){g(this,a,"down")},_onScrollMove:function(){if(!this.isLoading){var a=this.scrollView.get("scrollTop");0>a?this.get$El("down")&&this.set("pullDownState",a>-this.pulldownElHeight?"pulling":"releasing"):a>this.scrollView.maxScroll.top&&this.get$El("up")&&
this.set("pullUpState",a<this.scrollView.maxScroll.top+this.pullupElHeight?"pulling":"releasing")}},_onDragEnd:function(){var a=this;if(!a.isLoading){var b,d,c=a.scrollView,j=c.get("scrollTop");a.get$El("down")&&j<-a.pulldownElHeight?(c.minScroll.top=-a.pulldownElHeight,b=a.get("pullDownLoadFn"),a.set("pullDownState","loading"),d=function(){c.scrollTo({top:-a.pulldownElHeight});c.scrollTo({top:c.minScroll.top},{duration:c.get("snapDuration"),easing:c.get("snapEasing")});a.set("pullDownState","pulling")}):
a.get$El("up")&&j>c.maxScroll.top+a.pullupElHeight&&(c.maxScroll.top+=a.pullupElHeight,b=a.get("pullUpLoadFn"),a.set("pullUpState","loading"),d=function(){c.scrollTo({top:c.maxScroll.top+a.pullupElHeight});c.scrollTo({top:c.maxScroll.top},{duration:c.get("snapDuration"),easing:c.get("snapEasing")});a.set("pullUpState","pulling")});b&&b.call(a,d)}},_onSetScrollTop:function(a){a=a.newVal;this.get$El("down")&&0>a&&(this.getEl("down").style[i]="translate3d(0,"+-a+"px,0)");if(this.get$El("up")){var b=
this.scrollView.maxScroll.top;this.isLoading&&(b-=this.pullupElHeight);a>b&&(this.getEl("up").style[i]="translate3d(0,"+(b-a)+"px,0)")}},pluginRenderUI:function(a){var b=this;b.scrollView=a;var d=[];b.get("pullUpLoadFn")&&d.push("up");b.get("pullDownLoadFn")&&d.push("down");var c=a.get("prefixCls");h.each(d,function(d){var e=l(m('<div class="{prefixCls}scroll-view-pull-{d}-to-refresh" ontouchmove="return false;"><div class="{prefixCls}scroll-view-pull-{d}-to-refresh-content"><span class="{prefixCls}scroll-view-pull-{d}-icon"></span><span class="{prefixCls}scroll-view-pull-{d}-label"></span></div></div>',
{prefixCls:c,d:d}));b["$"+d+"LabelEl"]=e.one("."+c+"scroll-view-pull-"+d+"-label");a.get("el").prepend(e);b["$"+d+"El"]=e;b["pull"+d+"ElHeight"]=e.height()})},pluginBindUI:function(a){a.on("touchMove",this._onScrollMove,this);a.on("touchEnd",this._onDragEnd,this);a.on("afterScrollTopChange",this._onSetScrollTop,this)},pluginDestructor:function(a){this.get$El("up")&&this.get$El("up").remove();this.get$El("down")&&this.get$El("down").remove();a.detach("touchMove",this._onScrollMove,this);a.detach("touchEnd",
this._onDragEnd,this);a.detach("afterScrollTopChange",this._onSetScrollTop,this)}},{ATTRS:{pullingDownHtml:{value:"Pull down to refresh..."},pullingUpHtml:{value:"Pull up to refresh..."},releasingUpHtml:{value:"release to refresh..."},releasingDownHtml:{value:"release to refresh..."},loadingUpHtml:{value:"loading..."},loadingDownHtml:{value:"loading..."},pullUpLoadFn:{},pullDownLoadFn:{},pullUpState:{},pullDownState:{}}})});
