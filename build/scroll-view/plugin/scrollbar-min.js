/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: Jul 18 22:09
*/
KISSY.add("scroll-view/plugin/scrollbar/scrollbar-tpl",'<div id="ks-scrollbar-arrow-up-{{id}}" class="{{getBaseCssClasses axis+"-arrow-up"}}"> <a href="javascript:void(\'up\')">up</a> </div> <div id="ks-scrollbar-arrow-down-{{id}}" class="{{getBaseCssClasses axis+"-arrow-down"}}"> <a href="javascript:void(\'down\')">down</a> </div> <div id="ks-scrollbar-track-{{id}}" class="{{getBaseCssClasses axis+"-track"}}"> <div id="ks-scrollbar-drag-{{id}}" class="{{getBaseCssClasses axis+"-drag"}}"> <div class="{{getBaseCssClasses axis+"-drag-top"}}"> </div> <div class="{{getBaseCssClasses axis+"-drag-center"}}"> </div> <div class="{{getBaseCssClasses axis+"-drag-bottom"}}"> </div> </div> </div>');
KISSY.add("scroll-view/plugin/scrollbar/render",function(f,h,i){var g=f.Features.isTransformSupported(),d={beforeCreateDom:function(a,b){a.elCls.push(a.prefixCls+"scrollbar-"+a.axis);f.mix(b,{dragEl:"#ks-scrollbar-drag-{id}",downBtn:"#ks-scrollbar-arrow-down-{id}",upBtn:"#ks-scrollbar-arrow-up-{id}",trackEl:"#ks-scrollbar-track-{id}"})},createDom:function(){var a=this.control;a.$dragEl=a.get("dragEl");a.$trackEl=a.get("trackEl");a.$downBtn=a.get("downBtn");a.$upBtn=a.get("upBtn");a.dragEl=a.$dragEl[0];
a.trackEl=a.$trackEl[0];a.downBtn=a.$downBtn[0];a.upBtn=a.$upBtn[0]},syncUI:function(){var a=this.control,b=a.get("scrollView"),c=a.$trackEl,j=a.isX,e=j?"scrollWidth":"scrollHeight",f=j?"width":"height",d=j?"clientWidth":"clientHeight",j=a.dragWhProperty;a.get("rendered");a.scrollView=b;b.isAxisEnabled(a.get("axis"))?(a.scrollLength=b[e],c=a.trackElSize=c[f](),b=b[d]/a.scrollLength,b*=c,a.set(j,b),a.barSize=b,this.syncOnScrollChange(),a.set("visible",!0)):a.set("visible",!1)},syncOnScrollChange:function(){var a=
this.control,b=a.ltProperty,c=a.scrollView,e=a.dragLtProperty,f=a.dragWhProperty,d=a.trackElSize,g=a.barSize,i=a.scrollLength,h=c.get(a.scrollProperty),k=c.minScroll[b],b=c.maxScroll[b];h>b?(d*=b/i,a.set(f,g-(h-b)),a.set(e,d+g-a.get(f))):h<k?(d*=k/i,a.set(f,g-(k-h)),a.set(e,d)):(a.set(e,h/i*d),a.set(f,g))},_onSetDragHeight:function(a){this.control.dragEl.style.height=a+"px"},_onSetDragWidth:function(a){this.control.dragEl.style.width=a+"px"},_onSetDragLeft:function(a){this.control.dragEl.style.left=
a+"px"},_onSetDragTop:function(a){this.control.dragEl.style.top=a+"px"}},e=f.Features.getTransformProperty();g&&(d._onSetDragLeft=function(a){this.control.dragEl.style[e]="translateX("+a+"px) translateZ(0)"},d._onSetDragTop=function(a){this.control.dragEl.style[e]="translateY("+a+"px) translateZ(0)"});return h.getDefaultRender().extend(d,{ATTRS:{contentTpl:{value:i}}})},{requires:["component/control","./scrollbar-tpl"]});
KISSY.add("scroll-view/plugin/scrollbar/control",function(f,h,i,g,d){var e=h.Gesture;return g.extend({initializer:function(){var a="x"==this.get("axis");this.afterScrollChangeEvent=(this.isX=a)?"afterScrollLeftChange":"afterScrollTopChange";this.scrollProperty=a?"scrollLeft":"scrollTop";this.ltProperty=a?"left":"top";this.pageXyProperty=a?"pageX":"pageY";this.dragWhProperty=a?"dragWidth":"dragHeight";this.dragLtProperty=a?"dragLeft":"dragTop"},bindUI:function(){var a=this,b=a.get("autoHide"),c=a.get("scrollView");
b?a.hideFn=f.bind(a.hide,a):(f.each([a.$downBtn,a.$upBtn],function(b){b.on(e.start,a.onUpDownBtnMouseDown,a).on(e.end,a.onUpDownBtnMouseUp,a)}),a.$trackEl.on(e.start,a.onTrackElMouseDown,a),a.dd=(new i.Draggable({node:a.$dragEl,groups:!1,halt:!0})).on("drag",a.onDrag,a).on("dragstart",a.onDragStart,a));c.on(a.afterScrollChangeEvent+".ks-scrollbar",a.afterScrollChange,a).on("scrollEnd.ks-scrollbar",a.onScrollEnd,a).on("afterDisabledChange",a.onScrollViewDisabled,a)},destructor:function(){this.get("scrollView").detach(".ks-scrollbar");
this.clearHideTimer()},onScrollViewDisabled:function(a){this.set("disabled",a.newVal)},onDragStart:function(){var a=this.scrollView;this.startMousePos=this.dd.get("startMousePos")[this.ltProperty];this.startScroll=a.get(this.scrollProperty)},onDrag:function(a){var b=this.scrollView,c={};c[this.ltProperty]=this.startScroll+(a[this.pageXyProperty]-this.startMousePos)/this.trackElSize*this.scrollLength;b.scrollToWithBounds(c)},startHideTimer:function(){this.clearHideTimer();this.hideTimer=setTimeout(this.hideFn,
1E3*this.get("hideDelay"))},clearHideTimer:function(){this.hideTimer&&(clearTimeout(this.hideTimer),this.hideTimer=null)},onUpDownBtnMouseDown:function(a){function b(){var a={};a[e]=c.get(d)+g*f;c.scrollToWithBounds(a)}if(!this.get("disabled")){a.halt();var c=this.scrollView,d=this.scrollProperty,e=this.ltProperty,f=c.scrollStep[this.ltProperty],a=a.target,g=a==this.downBtn||this.$downBtn.contains(a)?1:-1;clearInterval(this.mouseInterval);this.mouseInterval=setInterval(b,100);b()}},onTrackElMouseDown:function(a){if(!this.get("disabled")){var b=
a.target,c=this.$dragEl;if(!(this.dragEl==b||c.contains(b))){var b=this.ltProperty,c=this.scrollView,d=Math.max(0,(a[this.pageXyProperty]-this.$trackEl.offset()[b]-this.barSize/2)/this.trackElSize),e={};e[b]=d*this.scrollLength;c.scrollToWithBounds(e);a.halt()}}},onUpDownBtnMouseUp:function(){clearInterval(this.mouseInterval)},onScrollEnd:function(a){this.hideFn&&this.get("axis")==a.axis&&this.startHideTimer()},afterScrollChange:function(){var a=this.scrollView;this.clearHideTimer();this.show();this.hideFn&&
!a.dd.get("dragging")&&this.startHideTimer();this.view.syncOnScrollChange()},_onSetDisabled:function(a){this.dd&&this.dd.set("disabled",a)}},{ATTRS:{minLength:{value:20},scrollView:{},axis:{view:1},autoHide:{value:f.UA.ios},visible:{valueFn:function(){return!this.get("autoHide")}},hideDelay:{value:0.1},dragWidth:{setter:function(a){var b=this.get("minLength");return a<b?b:a},view:1},dragHeight:{setter:function(a){var b=this.get("minLength");return a<b?b:a},view:1},dragLeft:{view:1},dragTop:{view:1},
dragEl:{},downBtn:{},upBtn:{},trackEl:{},focusable:{value:!1},xrender:{value:d}},xclass:"scrollbar"})},{requires:["node","dd","component/control","./render"]});
KISSY.add("scroll-view/plugin/scrollbar",function(f,h,i){function g(){g.superclass.constructor.apply(this,arguments)}f.extend(g,h,{pluginId:this.getName(),pluginSyncUI:function(d){var e=this.get("minLength"),a=this.get("autoHideX"),b=this.get("autoHideY"),c={scrollView:d,elBefore:d.$contentEl};void 0!==e&&(c.minLength=e);this.scrollBarX?this.scrollBarX.sync():d.isAxisEnabled("x")&&(e={axis:"x"},void 0!==a&&(c.autoHide=a),this.scrollBarX=(new i(f.merge(c,e))).render());this.scrollBarY?this.scrollBarY.sync():
d.isAxisEnabled("y")&&(e={axis:"y"},void 0!==b&&(c.autoHide=b),this.scrollBarY=(new i(f.merge(c,e))).render())},pluginDestructor:function(){this.scrollBarX&&(this.scrollBarX.destroy(),this.scrollBarX=null);this.scrollBarY&&(this.scrollBarY.destroy(),this.scrollBarY=null)}});return g},{requires:["base","./scrollbar/control"]});
