/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: Aug 1 15:51
*/
KISSY.add("scroll-view/base/render",function(j,k,m,n){var j=j.Features,g,k={syncUI:function(){var c=this.control,e=c.el,f=c.contentEl,a=c.$contentEl,d=f.offsetHeight,f=f.offsetWidth,b=e.clientHeight,o=e.clientWidth;c.scrollHeight=d;c.scrollWidth=f;c.clientHeight=b;c.clientWidth=o;e=c.allowScroll={};d>b&&(e.top=1);f>o&&(e.left=1);c.minScroll={left:0,top:0};var i,l;c.maxScroll={left:i=f-o,top:l=d-b};delete c.scrollStep;b=c.get("snap");d=c.get("scrollLeft");f=c.get("scrollTop");if(b){var h=a.offset(),
a=c.pages="string"==typeof b?a.all(b):a.children(),b=c.get("pageIndex"),g=c.pagesOffset=[];a.each(function(b,a){var d=b.offset(),c=d.left-h.left,d=d.top-h.top;c<=i&&d<=l&&(g[a]={left:c,top:d,index:a})});if(b){c.scrollToPage(b);return}}c.scrollToWithBounds({left:d,top:f})},_onSetScrollLeft:function(c){this.control.contentEl.style.left=-c+"px"},_onSetScrollTop:function(c){this.control.contentEl.style.top=-c+"px"}};j.isTransformSupported()&&(g=j.getTransformProperty(),k._onSetScrollLeft=function(c){var e=
this.control;e.contentEl.style[g]="translate3d("+-c+"px,"+-e.get("scrollTop")+"px,0)"},k._onSetScrollTop=function(c){var e=this.control;e.contentEl.style[g]="translate3d("+-e.get("scrollLeft")+"px,"+-c+"px,0)"});return m.getDefaultRender().extend([n],k,{name:"ScrollViewRender"})},{requires:["node","component/container","component/extension/content-render"]});
KISSY.add("scroll-view/base",function(j,k,m,n,g){function c(){var a=this.el,d=a.scrollTop,b=a.scrollLeft;d&&this.set("scrollTop",d+this.get("scrollTop"));b&&this.set("scrollLeft",b+this.get("scrollLeft"));a.scrollTop=a.scrollLeft=0}var e=j.all,j=j.Features.isTouchEventSupported(),f=k.KeyCode;return m.extend({bindUI:function(){this.$el.on("mousewheel",this.handleMouseWheel,this).on("scroll",c,this)},handleKeyDownInternal:function(a){var d=e(a.target),b=d.nodeName();if("input"==b||"textarea"==b||"select"==
b||d.hasAttr("contenteditable"))return g;var a=a.keyCode,b=this.getScrollStep(),d=g,c=this.allowScroll.left;if(this.allowScroll.top){var i=b.top,l=this.clientHeight,h=this.get("scrollTop");a==f.DOWN?(this.scrollToWithBounds({top:h+i}),d=!0):a==f.UP?(this.scrollToWithBounds({top:h-i}),d=!0):a==f.PAGE_DOWN?(this.scrollToWithBounds({top:h+l}),d=!0):a==f.PAGE_UP&&(this.scrollToWithBounds({top:h-l}),d=!0)}c&&(b=b.left,c=this.get("scrollLeft"),a==f.RIGHT?(this.scrollToWithBounds({left:c+b}),d=!0):a==f.LEFT&&
(this.scrollToWithBounds({left:c-b}),d=!0));return d},getScrollStep:function(){if(this.scrollStep)return this.scrollStep;var a=e(el.ownerDocument),d=this.clientHeight,b=this.clientWidth;return this.scrollStep={top:Math.max(0.7*d*d/a.height(),20),left:Math.max(0.7*b*b/a.width(),20)}},handleMouseWheel:function(a){if(!this.get("disabled")){var d,b,c=this.scrollStep,i,f=this.maxScroll,h=this.minScroll;if((i=a.deltaY)&&this.allowScroll.top){var e=this.get("scrollTop");d=f.top;b=h.top;e<=b&&0<i||e>=d&&
0>i||(this.scrollToWithBounds({top:e-a.deltaY*c.top}),a.preventDefault())}if((i=a.deltaX)&&this.allowScroll.left)e=this.get("scrollLeft"),d=f.left,b=h.left,e<=b&&0<i||e>=d&&0>i||(this.scrollToWithBounds({left:e-a.deltaX*c.left}),a.preventDefault())}},isAxisEnabled:function(a){return this.allowScroll["x"==a?"left":"top"]},stopAnimation:function(){this.$contentEl.stop();this.scrollToWithBounds({left:this.get("scrollLeft"),top:this.get("scrollTop")})},_uiSetPageIndex:function(a){this.scrollToPage(a)},
_getPageIndexFromXY:function(a,d,b){var c=this.pagesOffset.concat([]),e=d?"left":"top";c.sort(function(b,a){return b[e]-a[e]});if(0<b)for(d=0;d<c.length;d++){if(b=c[d],b[e]>=a)return b.index}else for(d=c.length-1;0<=d;d--)if(b=c[d],b[e]<=a)return b.index;return g},scrollToPage:function(a,d){var b;if((b=this.pagesOffset)&&b[a])this.set("pageIndex",a),this.scrollTo(b[a],d)},scrollToWithBounds:function(a,d){var b=this.maxScroll,c=this.minScroll;a.left&&(a.left=Math.min(Math.max(a.left,c.left),b.left));
a.top&&(a.top=Math.min(Math.max(a.top,c.top),b.top));this.scrollTo(a,d)},scrollTo:function(a,d){var b=this,c=a.left,e=a.top;if(d){var f=b.get("scrollLeft"),h=b.get("scrollTop");b.$contentEl.animate({xx:{fx:{frame:function(a,d){c!==g&&b.set("scrollLeft",f+d.pos*(c-f));e!==g&&b.set("scrollTop",h+d.pos*(e-h))}}}},d)}else c!==g&&b.set("scrollLeft",c),e!==g&&b.set("scrollTop",e)}},{ATTRS:{contentEl:{},scrollLeft:{view:1,value:0},scrollTop:{view:1,value:0},focusable:{value:!j},allowTextSelection:{value:!0},
handleMouseEvents:{value:!1},snap:{value:!1},snapDuration:{value:0.3},snapEasing:{value:"easeOut"},pageIndex:{value:0},xrender:{value:n}},xclass:"scroll-view"})},{requires:["node","component/container","./base/render"]});
