/*
Copyright 2014, KISSY v5.0.0
MIT Licensed
build time: Jul 18 13:54
*/
KISSY.add("dd",["dd/ddm","dd/draggable","dd/draggable-delegate","dd/droppable-delegate","dd/droppable"],function(j,b,m,n){var j=b("dd/ddm"),m=b("dd/draggable"),l=b("dd/draggable-delegate"),i=b("dd/droppable-delegate"),b=b("dd/droppable");n.exports={Draggable:m,DDM:j,Droppable:b,DroppableDelegate:i,DraggableDelegate:l}});
KISSY.add("dd/ddm",["util","logger-manager","base","ua","node"],function(j,b,m,n){function l(c){var a=c.get("activeDrag").get("activeHandler"),b="auto";a&&(b=a.css("cursor"));"auto"===b&&(b=c.get("dragCursor"));c._shim.css({cursor:b,display:"block"});t&&q.call(c)}function i(c){var a=c.get("drops");c.setInternal("validDrops",[]);a.length&&s.each(a,function(c){c._active()})}function d(c){var a=c.get("drops");c.setInternal("validDrops",[]);a.length&&s.each(a,function(c){c._deActive()})}function h(c){var a=
c.offset();return{left:a.left,right:a.left+(c.__ddCachedWidth||c.outerWidth()),top:a.top,bottom:a.top+(c.__ddCachedHeight||c.outerHeight())}}function a(c,a){return c.left<=a.left&&c.right>=a.left&&c.top<=a.top&&c.bottom>=a.top}function f(c){return c.top>=c.bottom||c.left>=c.right?0:(c.right-c.left)*(c.bottom-c.top)}function p(c,a){var b=Math.max(c.top,a.top),e=Math.min(c.right,a.right),f=Math.min(c.bottom,a.bottom);return{left:Math.max(c.left,a.left),right:e,top:b,bottom:f}}function k(c){c&&(c.__ddCachedWidth=
c.outerWidth(),c.__ddCachedHeight=c.outerHeight())}var s=b("util");b("logger-manager");var j=b("base"),m=b("ua"),r=b("node"),b=window,g=b.document,w=r(g),x=r(b),t=6===m.ie,q=s.throttle(function(){var c;(c=this.get("activeDrag"))&&c.get("shim")&&this._shim.css({width:w.width(),height:w.height()})},30),u=function(c){c._shim=r('<div style="background-color:red;position:'+(t?"absolute":"fixed")+";left:0;width:100%;height:100%;top:0;cursor:"+c.get("dragCursor")+';z-index:999999;"></div>').prependTo(g.body||
g.documentElement).css("opacity",0);u=l;if(t)x.on("resize scroll",q,c);l(c)},b=new (j.extend({addDrop:function(c){this.get("drops").push(c)},removeDrop:function(c){var a=this.get("drops"),c=s.indexOf(c,a);-1!==c&&a.splice(c,1)},start:function(a,b){this.setInternal("activeDrag",b);b.get("shim")&&u(this);this.__needDropCheck=0;b.get("groups")&&(i(this),this.get("validDrops").length&&(k(b.get("node")),this.__needDropCheck=1))},addValidDrop:function(a){this.get("validDrops").push(a)},_notifyDropsMove:function(c,
b){var d=this.get("validDrops"),e=b.get("mode"),o=0,v=0,k=h(b.get("node")),i=f(k);s.each(d,function(d){if(!d.get("disabled")){var g;if(g=d.getNodeFromTarget(c,b.get("dragNode")[0],b.get("node")[0]))if("point"===e)a(h(g),b.mousePos)&&(g=f(h(g)),o?g<v&&(o=d,v=g):(o=d,v=g));else if("intersect"===e)g=f(p(k,h(g))),g>v&&(v=g,o=d);else if("strict"===e&&(g=f(p(k,h(g))),g===i))return o=d,!1}});if((d=this.get("activeDrop"))&&d!==o)d._handleOut(c),b._handleOut(c);this.setInternal("activeDrop",o);o&&(d!==o?o._handleEnter(c):
o._handleOver(c))},move:function(a,b){this.__needDropCheck&&this._notifyDropsMove(a,b)},end:function(a){var b=this.get("activeDrop");this._shim&&this._shim.hide();d(this);b&&b._end(a);this.setInternal("activeDrop",null);this.setInternal("activeDrag",null)}},{ATTRS:{dragCursor:{value:"move"},activeDrag:{},activeDrop:{},drops:{valueFn:function(){return[]}},validDrops:{valueFn:function(){return[]}}}}));b.inRegion=a;b.region=h;b.area=f;b.cacheWH=k;b.PREFIX_CLS="ks-dd-";n.exports=b});
KISSY.add("dd/draggable","event/gesture/basic,./ddm,base,event/gesture/pan,util,ua,node".split(","),function(j,b,m,n){function l(e){return function(){this._isValidDrag&&e.apply(this,arguments)}}function i(){g.body.onselectstart=z;g.body.releaseCapture&&g.body.releaseCapture()}function d(e){e.preventDefault()}function h(){return false}function a(e){this._isValidDrag=0;this.onGestureStart(e)}var f=b("event/gesture/basic"),p=b("./ddm"),j=b("base"),k=b("event/gesture/pan"),m=b("util"),s=b("ua"),r=b("node"),
g=document,w=r(g),x=m.each,t=s.ie,q=p.PREFIX_CLS,u=l(function(e){this._start(e)}),c=l(function(e){this._move(e)}),y=l(function(e){this._end(e)}),b=j.extend({initializer:function(){this.addTarget(p);this._allowMove=this.get("move")},_onSetNode:function(e){this.setInternal("dragNode",e)},onGestureStart:function(e){var a=e.target;this._checkDragStartValid(e)&&this._checkHandler(a)&&this._prepare(e)},getEventTargetEl:function(){return this.get("node")},start:function(){var e=this.getEventTargetEl();if(e)e.on(k.PAN_START,
u,this).on(k.PAN,c,this).on(k.PAN_END,y,this).on(f.START,a,this).on("dragstart",d)},stop:function(){var e=this.getEventTargetEl();e&&e.detach(k.PAN_START,u,this).detach(k.PAN,c,this).detach(k.PAN_END,y,this).detach(f.START,a,this).detach("dragstart",d)},_onSetDisabled:function(e){var a=this.get("dragNode");if(a)a[e?"addClass":"removeClass"](q+"-disabled");this[e?"stop":"start"]()},_checkHandler:function(e){var a=this,b=a.get("handlers"),c=0;x(b,function(b){if(b[0]===e||b.contains(e)){c=1;a.setInternal("activeHandler",
b);return false}});return c},_checkDragStartValid:function(a){return this.get("primaryButtonOnly")&&a.which!==1?0:1},_prepare:function(a){this._isValidDrag=1;if(t){z=g.body.onselectstart;g.body.onselectstart=h;g.body.setCapture&&g.body.setCapture();w.on(f.END,{fn:i,once:true})}this.get("halt")&&a.stopPropagation();a.gestureType==="mouse"&&a.preventDefault();this._allowMove&&this.setInternal("startNodePos",this.get("node").offset())},_start:function(a){a.gestureType==="touch"&&a.preventDefault();this.mousePos=
{left:a.pageX,top:a.pageY};p.start(a,this);this.fire("dragstart",{drag:this,gestureType:a.gestureType,startPos:a.startPos,deltaX:a.deltaX,deltaY:a.deltaY,pageX:a.pageX,pageY:a.pageY});this.get("dragNode").addClass(q+"dragging")},_move:function(a){var b=a.pageX,c=a.pageY;a.gestureType==="touch"&&a.preventDefault();this.mousePos={left:b,top:c};b={drag:this,gestureType:a.gestureType,startPos:a.startPos,deltaX:a.deltaX,deltaY:a.deltaY,pageX:a.pageX,pageY:a.pageY};if(c=this._allowMove){var d=this.get("startNodePos"),
f=d.left+a.deltaX,d=d.top+a.deltaY;b.left=f;b.top=d;this.setInternal("actualPos",{left:f,top:d});this.fire("dragalign",b)}f=1;this.fire("drag",b)===false&&(f=0);p.move(a,this);this.get("preventDefaultOnMove")&&a.preventDefault();f&&c&&this.get("node").offset(this.get("actualPos"))},stopDrag:function(){this._isValidDrag&&this._end()},_end:function(a){var a=a||{},b;this._isValidDrag=0;this.get("node").removeClass(q+"drag-over");this.get("dragNode").removeClass(q+"dragging");(b=p.get("activeDrop"))?
this.fire("dragdrophit",{drag:this,drop:b}):this.fire("dragdropmiss",{drag:this});p.end(a,this);this.fire("dragend",{drag:this,gestureType:a.gestureType,startPos:a.startPos,deltaX:a.deltaX,deltaY:a.deltaY,pageX:a.pageX,pageY:a.pageY})},_handleOut:function(){this.get("node").removeClass(q+"drag-over");this.fire("dragexit",{drag:this,drop:p.get("activeDrop")})},_handleEnter:function(a){this.get("node").addClass(q+"drag-over");this.fire("dragenter",a)},_handleOver:function(a){this.fire("dragover",a)},
destructor:function(){this.stop()}},{name:"Draggable",ATTRS:{node:{setter:function(a){if(!(a instanceof r))return r(a)}},dragNode:{},shim:{value:false},handlers:{valueFn:function(){return[]},getter:function(a){var b=this;a.length||(a[0]=b.get("node"));x(a,function(c,d){typeof c==="function"&&(c=c.call(b));typeof c==="string"&&(c=b.get("node").one(c));c.nodeType&&(c=r(c));a[d]=c});b.setInternal("handlers",a);return a}},activeHandler:{},mode:{value:"point"},disabled:{value:false},move:{value:false},
primaryButtonOnly:{value:true},halt:{value:true},groups:{value:true},startNodePos:{},actualPos:{},preventDefaultOnMove:{value:true}},inheritedStatics:{DropMode:{POINT:"point",INTERSECT:"intersect",STRICT:"strict"}}}),z;n.exports=b});
KISSY.add("dd/draggable-delegate",["./ddm","./draggable","node"],function(j,b,m,n){var j=b("./ddm"),m=b("./draggable"),l=j.PREFIX_CLS,i=b("node");n.exports=m.extend({_onSetNode:function(){},_onSetDisabled:function(b){var h=this.get("container");h&&(h[b?"addClass":"removeClass"](l+"-disabled"),this[b?"stop":"start"]())},getEventTargetEl:function(){return this.get("container")},onGestureStart:function(b){var h,a;if(this._checkDragStartValid(b)){h=this.get("handlers");var f=i(b.target);(h=h.length?this._getHandler(f):
f)&&(a=this._getNode(h));a&&(this.setInternal("activeHandler",h),this.setInternal("node",a),this.setInternal("dragNode",a),this._prepare(b))}},_getHandler:function(b){for(var h=this.get("container"),a=this.get("handlers");b&&b[0]!==h[0];){for(var f=0;f<a.length;f++)if(b.test(a[f]))return b;b=b.parent()}return null},_getNode:function(b){return b.closest(this.get("selector"),this.get("container"))}},{ATTRS:{container:{setter:function(b){return i(b)}},selector:{},handlers:{valueFn:function(){return[]},
getter:0}}})});
KISSY.add("dd/droppable-delegate",["node","./ddm","./droppable","util"],function(j,b,m,n){function l(){var a=this.get("container"),b=[],k=this.get("selector");a.all(k).each(function(a){d.cacheWH(a);b.push(a)});this.__allNodes=b}var i=b("node"),d=b("./ddm"),j=b("./droppable"),h=b("util"),a=j.extend({initializer:function(){d.on("dragstart",l,this)},getNodeFromTarget:function(a,b,k){var i={left:a.pageX,top:a.pageY},a=this.__allNodes,j=0,g=Number.MAX_VALUE;a&&h.each(a,function(a){var f=a[0];f===k||f===
b||(f=d.region(a),d.inRegion(f,i)&&(f=d.area(f),f<g&&(g=f,j=a)))});j&&(this.setInternal("lastNode",this.get("node")),this.setInternal("node",j));return j},_handleOut:function(){this.callSuper();this.setInternal("node",0);this.setInternal("lastNode",0)},_handleOver:function(b){var d=this.get("node"),k=a.superclass._handleOut,i=this.callSuper,h=a.superclass._handleEnter,g=this.get("lastNode");g[0]!==d[0]?(this.setInternal("node",g),k.apply(this,arguments),this.setInternal("node",d),h.call(this,b)):
i.call(this,b)},_end:function(a){this.callSuper(a);this.setInternal("node",0)}},{ATTRS:{lastNode:{},selector:{},container:{setter:function(a){return i(a)}}}});n.exports=a});
KISSY.add("dd/droppable",["node","./ddm","base","util"],function(j,b,m,n){var l=b("node"),i=b("./ddm"),j=b("base"),d=i.PREFIX_CLS,h=b("util");n.exports=j.extend({initializer:function(){this.addTarget(i);i.addDrop(this)},getNodeFromTarget:function(a,b,d){var a=this.get("node"),i=a[0];return i===b||i===d?null:a},_active:function(){var a=i.get("activeDrag"),b=this.get("node"),h=this.get("groups"),a=a.get("groups");a:if(!0===a)h=1;else{for(var j in h)if(a[j]){h=1;break a}h=0}h?(i.addValidDrop(this),b&&
(b.addClass(d+"drop-active-valid"),i.cacheWH(b))):b&&b.addClass(d+"drop-active-invalid")},_deActive:function(){var a=this.get("node");a&&a.removeClass(d+"drop-active-valid").removeClass(d+"drop-active-invalid")},__getCustomEvt:function(a){return h.mix({drag:i.get("activeDrag"),drop:this},a)},_handleOut:function(){var a=this.__getCustomEvt();this.get("node").removeClass(d+"drop-over");this.fire("dropexit",a)},_handleEnter:function(a){a=this.__getCustomEvt(a);a.drag._handleEnter(a);this.get("node").addClass(d+
"drop-over");this.fire("dropenter",a)},_handleOver:function(a){a=this.__getCustomEvt(a);a.drag._handleOver(a);this.fire("dropover",a)},_end:function(){var a=this.__getCustomEvt();this.get("node").removeClass(d+"drop-over");this.fire("drophit",a)},destructor:function(){i.removeDrop(this)}},{name:"Droppable",ATTRS:{node:{setter:function(a){if(a)return l(a)}},groups:{valueFn:function(){return{}}},disabled:{}}})});
