/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: Aug 13 19:04
*/
KISSY.add("html-parser/dtd",function(a){var a=a.merge,e={isindex:1,fieldset:1},f={input:1,button:1,select:1,textarea:1,label:1},l=a({a:1},f),b=a({iframe:1},l),c={hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1},n={ins:1,del:1,script:1,style:1},m=a({b:1,acronym:1,bdo:1,"var":1,"#text":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1},n),k=a({sub:1,img:1,object:1,
sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1},m),r=a({p:1},k),f=a({iframe:1},k,f),k={img:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#text":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,
u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1},d=a({a:1},f),o={tr:1},h={"#text":1},g=a({param:1},k),i=a({form:1},e,b,c,r),q={li:1},j={base:1,link:1,meta:1,title:1},p=a(j,{style:1,script:1}),t={head:1,body:1},s={address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1},a={$nonBodyContent:a({html:1},t,j),$block:s,$blockLimit:{body:1,div:1,td:1,th:1,caption:1,form:1},$inline:d,$body:a({script:1,style:1},
s),$cdata:{script:1,style:1},$empty:{area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1},$listItem:{dd:1,dt:1,li:1},$list:{ul:1,ol:1,dl:1},$nonEditable:{applet:1,button:1,embed:1,iframe:1,map:1,object:1,option:1,script:1,textarea:1,param:1},$removeEmpty:{abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},$tabIndex:{a:1,area:1,button:1,input:1,object:1,
select:1,textarea:1},$tableContent:{caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1},html:t,head:p,style:h,body:i,base:{},link:{},meta:{},title:h,col:{},tr:{td:1,th:1},img:{},colgroup:{col:1},noscript:i,td:i,br:{},th:i,center:i,kbd:d,button:a(r,c),basefont:{},h5:d,h4:d,samp:d,h6:d,ol:q,h1:d,h3:d,option:h,h2:d,form:a(e,b,c,r),select:{optgroup:1,option:1},font:d,ins:d,menu:q,abbr:d,label:d,table:{thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1},code:d,script:h,tfoot:o,cite:d,
li:i,input:{},iframe:i,strong:d,textarea:h,noframes:i,big:d,small:d,span:d,hr:{},dt:d,sub:d,optgroup:{option:1},param:{},bdo:d,"var":d,div:i,object:g,sup:d,dd:i,strike:d,area:{},dir:q,map:a({area:1,form:1,p:1},e,n,c),applet:g,dl:{dt:1,dd:1},del:d,isindex:{},fieldset:a({legend:1},k),thead:o,ul:q,acronym:d,b:d,a:f,blockquote:i,caption:d,i:d,u:d,tbody:o,s:d,address:a(b,r),tt:d,legend:d,q:d,pre:a(m,l),p:d,em:d,dfn:d},l="article,figure,nav,aside,section,footer".split(","),u;for(u in a)for(var v in a[u])if("div"==
v)for(e=0;e<l.length;e++)a[u][l[e]]=a[u][v];for(e=0;e<l.length;e++)a[l[e]]=a.div;a.$empty["!doctype"]=1;return a});KISSY.add("html-parser/lexer/cursor",function(){function a(a){this.position=a||0}a.prototype={constructor:a,advance:function(){this.position++},retreat:function(){this.position=Math.max(--this.position,0)}};return a});
KISSY.add("html-parser/lexer/index",function(){function a(){this.lineCursors=[]}function e(a,b){for(var c=0;c<a.length;c++)if(a[c].position===b.position)return c;return-1}function f(a,b){for(var c=0;c<a.length&&!(a[c].position>b.position);c++);return c}a.prototype={constructor:a,add:function(a){-1==e(this.lineCursors,a)&&this.lineCursors.splice(f(this.lineCursors,a),0,a)},remove:function(a){var b=this.lineCursors,a=e(this.lineCursors,a);-1!=a&&b.splice(a,1)},row:function(a){return f(this.lineCursors,
a)-1},col:function(a){var b=f(this.lineCursors,a)-1;return a.position-this.lineCursors[b]}};return a});
KISSY.add("html-parser/lexer/page",function(a,e){function f(a){this.source=a;this.lineIndex=new e}f.prototype={constructor:f,getChar:function(a){var b=this.source,c=a.position;if(c>=b.length)return-1;var e=b.charAt(c);a.advance();"\r"===e&&(e="\n",c=a.position,"\n"===b.charAt(c)&&a.advance());"\n"===e&&this.lineIndex.add(a);return e},ungetChar:function(a){var b=this.source;a.retreat();var c=a.position,e=b.charAt(c);"\n"===e&&0!=c&&(e=b.charAt(c-1),"\r"===e&&a.retreat())},getText:function(a,b){return this.source.slice(a,
b)},row:function(a){return this.lineIndex.row(a)},col:function(a){return this.lineIndex.col(a)}};return f},{requires:["./index"]});
KISSY.add("html-parser/nodes/node",function(a){function e(a){var b=0;a.replace(/\n/g,function(){b++});return b}function f(f,b,c){this.parentNode=null;this.page=f;this.startPosition=b;this.endPosition=c;this.nextSibling=this.previousSibling=this.nodeName=null;f&&(this.startLine=e(this.page.getText(0,b)),this.endLine=e(this.page.getText(0,c)));a.Config.debug&&(this.toHTMLContent=this.toHtml())}f.prototype={constructor:f,toHtml:function(){if(this.page&&this.page.getText)return this.page.getText(this.startPosition,
this.endPosition)},toString:function(){var a=[];a.push(this.nodeName+"  [ "+this.startPosition+"|"+this.startLine+" : "+this.endPosition+"|"+this.endLine+" ]\n");a.push(this.toHtml());return a.join("")}};return f});
KISSY.add("html-parser/nodes/text",function(a,e){function f(a){"string"==typeof a?(this.nodeValue=a,f.superclass.constructor.apply(this,[null,-1,-1])):(f.superclass.constructor.apply(this,arguments),this.nodeValue=this.toHtml());this.nodeType=3;this.nodeName="#text"}a.extend(f,e,{writeHtml:function(a,b){var c;if(!b||!1!==(c=b.onText(this)))c&&this!==c?c.writeHtml(a,b):a.text(this.toHtml())},toHtml:function(){return this.nodeValue?this.nodeValue:f.superclass.toHtml.apply(this,arguments)}});return f},
{requires:["./node"]});KISSY.add("html-parser/nodes/cdata",function(a,e){function f(){f.superclass.constructor.apply(this,arguments);this.nodeType=4;this.nodeName="#cdata"}a.extend(f,e,{writeHtml:function(a,b){var c;if(!b||!1!==(c=b.onCData(this)))c&&this!==c?c.writeHtml(a,b):a.cdata(this.toHtml())}});return f},{requires:["./text"]});
KISSY.add("html-parser/utils",function(){return{collapseWhitespace:function(a){return a.replace(/[\s\xa0]+/g," ")},isLetter:function(a){return"a"<=a&&"z">=a||"A"<=a&&"Z">=a},isValidAttributeNameStartChar:function(a){return!this.isWhitespace(a)&&'"'!=a&&"'"!=a&&">"!=a&&"<"!=a&&"/"!=a&&"="!=a},isWhitespace:function(a){return/^[\s\xa0]$/.test(a)}}});
KISSY.add("html-parser/nodes/attribute",function(a){function e(a,e,b,c){this.nodeType=2;this.name=a;this.assignMent=e;this.value=b;this.quote=c}a.augment(e,{clone:function(){var f=new e;a.mix(f,this);return f},equals:function(a){return this.name==a.name&&this.value==a.value&&this.nodeType==a.nodeType}});e.prototype.clone=function(){var f=new e;a.mix(f,this);return f};return e});
KISSY.add("html-parser/nodes/tag",function(a,e,f,l){function b(k,b,d){k.nodeName=k.tagName=b.toLowerCase();k._updateSelfClosed();a.each(d,function(d,a){k.setAttribute(a,d)})}function c(k,e,d,o){this.childNodes=[];this.lastChild=this.firstChild=null;this.attributes=o||[];this.nodeType=1;if("string"==typeof k)b.apply(null,[this].concat(a.makeArray(arguments)));else{c.superclass.constructor.apply(this,arguments);o=this.attributes;o[0]&&(this.nodeName=o[0].name.toLowerCase(),this.tagName=this.nodeName.replace(/\//,
""),this._updateSelfClosed(),o.splice(0,1));var h=o[o.length-1];if(h=!(!h||!/\/$/.test(h.name)))o.length-=1;this.closed=this.isSelfClosed=this.isSelfClosed||h}this.closedEndPosition=this.closedStartPosition=-1}function n(a){var b=a.childNodes;a.firstChild=b[0];a.lastChild=b[b.length-1];1<=b.length&&(b[0].nextSibling=b[0].nextSibling=null,b[0].parentNode=a);if(1<b.length){for(var d=0;d<b.length-1;d++)b[d].nextSibling=b[d+1],b[d+1].previousSibling=b[d],b[d+1].parentNode=a;b[b.length-1].nextSibling=
null}}function m(a,b){for(var d=0;d<a.length;d++)if(a[d].name==b)return a[d];return null}a.extend(c,e,{_updateSelfClosed:function(){this.isSelfClosed=!!l.$empty[this.nodeName];this.isSelfClosed||(this.isSelfClosed=/\/$/.test(this.nodeName));this.closed=this.isSelfClosed},clone:function(){var b=new c,e=[];a.each(this.attributes,function(d){e.push(d.clone())});a.mix(b,{childNodes:[],firstChild:null,lastChild:null,attributes:e,nodeType:this.nodeType,nodeName:this.nodeName,tagName:this.tagName,isSelfClosed:this.isSelfClosed,
closed:this.closed,closedStartPosition:this.closedStartPosition,closedEndPosition:this.closedEndPosition});return b},setTagName:function(a){(this.nodeName=this.tagName=a)&&this._updateSelfClosed()},equals:function(a){if(!a||this.nodeName!=a.nodeName||this.nodeType!=a.nodeType||this.attributes.length!=a.attributes.length)return 0;for(var b=0;b<this.attributes.length;b++)if(!this.attributes[b].equals(a.attributes[b]))return 0;return 1},isEndTag:function(){return/^\//.test(this.nodeName)},appendChild:function(a){this.childNodes.push(a);
n(this)},replace:function(b){var c=b.parentNode.childNodes,d=a.indexOf(b,c);c[d]=this;n(b.parentNode)},replaceChild:function(b,c){var d=this.childNodes,o=a.indexOf(c,d);d[o]=b;n(this)},prepend:function(a){this.childNodes.unshift(a);n(this)},insertBefore:function(b){var c=b.parentNode.childNodes,d=a.indexOf(b,c);c.splice(d,0,this);n(b.parentNode)},insertAfter:function(b){var c=b.parentNode.childNodes,d=a.indexOf(b,c);d==c.length-1?b.parentNode.appendChild(this):this.insertBefore(b.parentNode.childNodes[[d+
1]])},empty:function(){this.childNodes=[];n(this)},removeChild:function(b){var c=b.parentNode.childNodes,d=a.indexOf(b,c);c.splice(d,1);n(b.parentNode)},getAttribute:function(a){return(a=m(this.attributes,a))&&a.value},setAttribute:function(a,b){var d=m(this.attributes,a);d?d.value=b:this.attributes.push(new f(a,"=",b,'"'))},removeAttribute:function(b){(b=m(this.attributes,b))&&this.attributes.splice(a.indexOf(b,this.attributes),1)},filterChildren:function(){var b=this;if(!b.isChildrenFiltered){var c=
new (a.require("html-parser/writer/basic"));b._writeChildrenHTML(c);c=(new (a.require("html-parser/parser"))(c.getHtml())).parse().childNodes;b.empty();a.each(c,function(d){b.appendChild(d)});b.isChildrenFiltered=1}},writeHtml:function(a,b){var d=this,c;c=d.tagName;if("!doctype"==c)a.append(this.toHtml()+"\n");else{d.__filter=b;d.isChildrenFiltered=0;if(b){if(!(c=b.onTagName(c)))return;d.tagName=c;c=b.onTag(d);if(!1===c)return;c&&(d=c);if(1!==d.nodeType){d.writeHtml(a,b);return}if(!d.tagName){d._writeChildrenHTML(a);
return}}a.openTag(d);for(var h=d.attributes,g=0;g<h.length;g++){var i=h[g];c=i.name;if(b){if(!(c=b.onAttributeName(c,d)))continue;i.name=c;if(!1===b.onAttribute(i,d))continue}a.attribute(i,d)}a.openTagClose(d);d.isSelfClosed||(d._writeChildrenHTML(a),a.closeTag(d))}},_writeChildrenHTML:function(b){var c=this.isChildrenFiltered?0:this.__filter;a.each(this.childNodes,function(a){a.writeHtml(b,c)})}});return c},{requires:["./node","./attribute","../dtd"]});
KISSY.add("html-parser/nodes/comment",function(a,e){function f(){f.superclass.constructor.apply(this,arguments);this.nodeType=8;this.nodeName="#comment"}a.extend(f,e,{writeHtml:function(a,b){var c;if(!b||!1!==(c=b.onComment(this)))c&&this!==c?c.writeHtml(a,b):a.comment(this.toHtml())},toHtml:function(){if(this.nodeValue)return this.nodeValue;var a=e.superclass.toHtml.apply(this,arguments);return a.substring(4,a.length-3)}});return f},{requires:["./text"]});
KISSY.add("html-parser/lexer/lexer",function(a,e,f,l,b,c,n,m,k){function r(a){this.page=new f(a);this.cursor=new e;this.nodeFactory=this}r.prototype={constructor:r,setPosition:function(a){this.cursor.position=a},getPosition:function(){return this.cursor.position},nextNode:function(a){var b,h,g=this.cursor,i=this.page;b=g.position;h=i.getChar(g);switch(h){case -1:a=null;break;case "<":h=i.getChar(g);-1==h?a=this.makeString(b,g.position):"/"==h||c.isLetter(h)?(i.ungetChar(g),a=this.parseTag(b)):"!"==
h||"?"==h?(h=i.getChar(g),-1==h?a=this.makeString(b,g.position):">"==h?a=this.makeComment(b,g.position):(i.ungetChar(g),"-"==h?a=this.parseComment(b,a):(i.ungetChar(g),a=this.parseTag(b)))):(i.ungetChar(g),a=this.parseString(b,a));break;default:i.ungetChar(g),a=this.parseString(b,a)}return a},makeComment:function(a,b){var c;c=b-a;if(0!=c){if(2>c)return this.makeString(a,b);c=this.nodeFactory.createCommentNode(this.page,a,b)}else c=null;return c},makeString:function(a,b){var c=null;0<b-a&&(c=this.nodeFactory.createStringNode(this.page,
a,b));return c},makeCData:function(a,b){var c=null;0<b-a&&(c=this.nodeFactory.createCDataNode(this.page,a,b));return c},makeTag:function(a,b,c){var g;g=b-a;if(0!=g){if(2>g)return this.makeString(a,b);a=this.nodeFactory.createTagNode(this.page,a,b,c)}else a=null;return a},createTagNode:function(a,b,c,g){return new m(a,b,c,g)},createStringNode:function(a,b,c){return new l(a,b,c)},createCDataNode:function(a,c,h){return new b(a,c,h)},createCommentNode:function(a,b,c){return new k(a,b,c)},parseTag:function(a){var b,
h=[],g=[],i,q=this.page,j=0,e=this.cursor;for(h[0]=e.position;!b;)switch(h[j+1]=e.position,i=q.getChar(e),j){case 0:if(-1==i||">"==i||"<"==i)"<"==i&&(q.ungetChar(e),h[j+1]=e.position),b=!0;else if("/"==i||c.isValidAttributeNameStartChar(i))j=1;break;case 1:-1==i||">"==i||"<"==i?("<"==i&&(q.ungetChar(e),h[j+1]=e.getPosition),this.standalone(g,h),b=!0):c.isWhitespace(i)?(h[6]=h[2],j=6):"="==i&&(j=2);break;case 2:-1==i||">"==i?(this.standalone(g,h),b=!0):"'"==i?(j=4,h[4]=h[3]):'"'==i?(j=5,h[5]=h[3]):
c.isWhitespace(i)||(j=3);break;case 3:-1==i||">"==i?(this.naked(g,h),b=!0):c.isWhitespace(i)&&(this.naked(g,h),h[0]=h[4],j=0);break;case 4:-1==i?(this.single_quote(g,h),b=!0):"'"==i&&(this.single_quote(g,h),h[0]=h[5]+1,j=0);break;case 5:-1==i?(this.double_quote(g,h),b=!0):'"'==i&&(this.double_quote(g,h),h[0]=h[6]+1,j=0);break;case 6:-1==i?(this.standalone(g,h),h[0]=h[6],q.ungetChar(e),j=0):c.isWhitespace(i)||("="==i?(h[2]=h[6],h[3]=h[7],j=2):(this.standalone(g,h),h[0]=h[6],q.ungetChar(e),j=0));break;
default:throw Error("how ** did we get in state "+j);}return this.makeTag(a,e.position,g)},parseComment:function(a,b){var h,g,i=this.page,e=this.cursor,j;h=!1;for(j=0;!h;)if(g=i.getChar(e),-1==g)h=!0;else switch(j){case 0:">"==g&&(h=!0);if("-"==g)j=1;else return this.parseString(a,b);break;case 1:if("-"==g)g=i.getChar(e),-1==g?h=!0:">"==g?h=!0:(i.ungetChar(e),j=2);else return this.parseString(a,b);break;case 2:if("-"==g)j=3;else if(-1==g)return this.parseString(a,b);break;case 3:j="-"==g?4:2;break;
case 4:">"==g?h=!0:c.isWhitespace(g)||(j=2);break;default:throw Error("how ** did we get in state "+j);}return this.makeComment(a,e.position)},parseString:function(a,b){for(var h=0,g,i=this.page,e=this.cursor,j=0;!h;)if(g=i.getChar(e),-1==g)h=1;else if(b&&0==j&&("'"==g||'"'==g))j=g;else if(b&&0!=j&&"\\"==g)g=i.getChar(e),-1!=g&&"\\"!=g&&g!=j&&i.ungetChar(e);else if(b&&g==j)j=0;else if(b&&0==j&&"/"==g)if(g=i.getChar(e),-1==g)h=1;else if("/"==g){do g=i.getChar(e);while(-1!=g&&"\n"!=g)}else if("*"==
g){do{do g=i.getChar(e);while(-1!=g&&"*"!=g);g=i.getChar(e);"*"==g&&i.ungetChar(e)}while(-1!=g&&"/"!=g)}else i.ungetChar(e);else if(0==j&&"<"==g)if(g=i.getChar(e),-1==g)h=1;else{if("/"==g||c.isLetter(g)||"!"==g||"?"==g)h=1,i.ungetChar(e);i.ungetChar(e)}return this.makeString(a,e.position)},parseCDATA:function(a,b){var h,g,i,e,j,m,f=this.cursor,k=this.page;h=f.position;g=0;i=!1;e="";for(m=!1;!i;)switch(j=k.getChar(f),g){case 0:switch(j){case -1:i=!0;break;case "'":a&&!m&&(""==e?e="'":"'"==e&&(e=""));
break;case '"':a&&!m&&(""==e?e='"':'"'==e&&(e=""));break;case "\\":a&&""!=e&&(j=k.getChar(f),-1==j?i=!0:"\\"!=j&&j!=e&&k.ungetChar(f));break;case "/":if(a&&""==e)if(j=k.getChar(f),-1==j)i=!0;else if("/"==j)m=!0;else if("*"==j){do{do j=k.getChar(f);while(-1!=j&&"*"!=j);j=k.getChar(f);"*"==j&&k.ungetChar(f)}while(-1!=j&&"/"!=j)}else k.ungetChar(f);break;case "\n":m=!1;break;case "<":a?""==e&&(g=1):g=1}break;case 1:switch(j){case -1:i=!0;break;case "/":g=!b||k.getText(f.position,f.position+b.length)===
b&&!k.getText(f.position+b.length,f.position+b.length+1).match(/\w/)?2:0;break;case "!":j=k.getChar(f);-1==j?i=!0:"-"==j?(j=k.getChar(f),-1==j?i=!0:g="-"==j?3:0):g=0;break;default:g=0}break;case 2:m=!1;-1==j?i=!0:c.isLetter(j)?(i=!0,k.ungetChar(f),k.ungetChar(f),k.ungetChar(f)):g=0;break;case 3:m=!1;-1==j?i=!0:"-"==j&&(j=k.getChar(f),-1==j?i=!0:"-"==j?(j=k.getChar(f),-1==j?i=!0:">"==j?g=0:(k.ungetChar(f),k.ungetChar(f))):k.ungetChar(f));break;default:throw Error("unexpected "+g);}return this.makeCData(h,
f.position)},single_quote:function(a,b){var c=this.page;a.push(new n(c.getText(b[1],b[2]),"=",c.getText(b[4]+1,b[5]),"'"))},double_quote:function(a,b){var c=this.page;a.push(new n(c.getText(b[1],b[2]),"=",c.getText(b[5]+1,b[6]),'"'))},standalone:function(a,b){a.push(new n(this.page.getText(b[1],b[2])))},naked:function(a,b){var c=this.page;a.push(new n(c.getText(b[1],b[2]),"=",c.getText(b[3],b[4])))}};return r},{requires:"./cursor,./page,../nodes/text,../nodes/cdata,../utils,../nodes/attribute,../nodes/tag,../nodes/comment".split(",")});
KISSY.add("html-parser/nodes/fragment",function(a,e){function f(){this.childNodes=[];this.nodeType=9;this.nodeName="#fragment"}a.extend(f,e,{writeHtml:function(a,b){this.__filter=b;this.isChildrenFiltered=0;if(b)b.onFragment(this);this._writeChildrenHTML(a)}});return f},{requires:["./tag"]});
KISSY.add("html-parser/nodes/document",function(a,e){function f(){this.childNodes=[];this.nodeType=9;this.nodeName="#document"}a.extend(f,e,{writeHtml:function(a,b){this.__filter=b;this._writeChildrenHTML(a)}});return f},{requires:["./tag"]});KISSY.add("html-parser/scanners/special-scanners",function(){return{}});
KISSY.add("html-parser/scanners/tag-scanner",function(a,e,f,l){function b(m,l){function d(){g.childNodes.length&&(g.insertAfter(i),i=g,g=m.clone())}m.closed=1;if(!l.fixByDtd)return 0;var o=1,h=[].concat(m.childNodes);a.each(h,function(a){if(!c(m,a))return o=0,!1});if(o)return 0;for(var g=m.clone(),i=m,q=[],j=0;j<h.length;j++){var p=h[j];if(c(g,p))g.appendChild(p);else if(1==p.nodeType){var t=p.tagName;if(e.$listItem[t]){d();var p=n[p.tagName],s=new f;for(s.nodeName=s.tagName=p;j<h.length;){if(h[j].tagName==
t)s.appendChild(h[j]);else if((3!=h[j].nodeType||a.trim(h[j].toHtml()))&&3==h[j].nodeType)break;j++}s.insertAfter(i);i=s;j--}else d(),p.equals(g)?(p.insertAfter(i),i=p):c(p,g)?(g=m.clone(),a.each(p.childNodes,function(a){g.appendChild(a)}),p.empty(),p.insertAfter(i),i=p,p.appendChild(g),q.push(g),g=m.clone()):(p.insertAfter(i),i=p)}}g.childNodes.length&&g.insertAfter(i);m.parentNode.removeChild(m);a.each(q,function(a){b(a,l)});return 1}function c(a,b){return 9==a.nodeType||8==b.nodeType?1:!!e[a.tagName][b.tagName||
b.nodeName]}var n={li:"ul",dt:"dl",dd:"dl"},m={dd:{dl:1},dt:{dl:1},li:{ul:1,ol:1},option:{select:1},optgroup:{select:1}};return{scan:function(a,c,d){function e(c,g){for(i=c;i>g;i--){var h=f[i];f[i-1].appendChild(h);b(h,d)}a=f[g];f.length=g}function h(a){var b=0,g;if(g=m[a.tagName]){for(var c=f.length-1,d=f[c];d&&!(d.tagName in g);){if(d.tagName==a.tagName){b=1;break}c--;d=f[c]}b&&e(f.length-1,c-1)}return b}var g,i,f;f=d.stack=d.stack||[];do{if(g=c.nextNode())if(1===g.nodeType)if(g.isEndTag()&&g.tagName==
a.tagName)g=null;else if(g.isEndTag()){if(g.isEndTag()){var j=-1;for(i=f.length-1;0<=i;i--)if(f[i].tagName===g.tagName){j=i;break}-1!=j&&(f[f.length-1].appendChild(a),b(a,d),e(f.length-1,j),g=null)}}else l[g.tagName]?(l[g.tagName].scan(g,c,d),a.appendChild(g)):g.isSelfClosed?a.appendChild(g):(f.push(a),h(g)&&f.push(a),a=g);else a.appendChild(g);null==g&&0<f.length&&(g=f[f.length-1],l[g.tagName]?g=null:(f.length-=1,g.appendChild(a),b(a,d),a=g))}while(g);b(a,d)}}},{requires:["../dtd","../nodes/tag",
"./special-scanners"]});KISSY.add("html-parser/scanners/cdata-scanner",function(){return{scan:function(a,e,f){var f=e.parseCDATA(f.quoteSmart,a.nodeName),l=e.getPosition(),b=e.nextNode();b&&(1!=b.nodeType||!(b.isEndTag()&&b.tagName==a.tagName))&&e.setPosition(l);a.closed=!0;f&&a.appendChild(f)}}});
KISSY.add("html-parser/scanners/quote-cdata-scanner",function(a,e,f,l){var a={scan:function(a,b,f){f=f||{};f.quoteSmart=1;e.scan(a,b,f);f.quoteSmart=0}},b;for(b in f.$cdata)l[b]=a;return a},{requires:["./cdata-scanner","../dtd","./special-scanners"]});KISSY.add("html-parser/scanners/textarea-scanner",function(a,e,f){return f.textarea={scan:function(a,b,c){c=c||{};e.scan(a,b,c)}}},{requires:["./cdata-scanner","./special-scanners"]});
KISSY.add("html-parser/scanner",function(a,e,f){return{getScanner:function(a){return f[a]||e}}},{requires:["./scanners/tag-scanner","./scanners/special-scanners","./scanners/quote-cdata-scanner","./scanners/textarea-scanner"]});
KISSY.add("html-parser/parser",function(a,e,f,l,b,c,n,m){function k(b,d){this.originalHTML=b=a.trim(b);b=/^(<!doctype|<html|<body)/i.test(b)?"<document>"+b+"</document>":"<body>"+b+"</body>";this.lexer=new c(b);this.opts=d||{}}function r(b){var c=o(b,"body",3);if(c){var b=c.parentNode,d=b.childNodes,e=a.indexOf(c,d);if(e!=d.length-1){d=d.slice(e+1,d.length);for(e=0;e<d.length;e++)b.removeChild(d[e]),"body"==d[e].tagName?a.each(d[e].childNodes,function(a){c.appendChild(a)}):c.appendChild(d[e])}}return c}
function d(a){var b=a.childNodes,c,d,h=e.p,m=0;for(d=0;d<b.length;d++)if(c=b[d],3==c.nodeType||1==c.nodeType&&h[c.nodeName]){m=1;break}if(m){var m=[],n=new f;n.nodeName=n.tagName="p";for(d=0;d<b.length;d++)c=b[d],3==c.nodeType||1==c.nodeType&&h[c.nodeName]?n.appendChild(c):(n.childNodes.length&&(m.push(n),n=n.clone()),m.push(c));n.childNodes.length&&m.push(n);a.empty();for(d=0;d<m.length;d++)a.appendChild(m[d])}}function o(a,b,c){if(0===c)return 0;"number"===typeof c&&c--;var d=a.childNodes;if(d)for(var e=
0;e<d.length;e++){if(d[e].tagName===b)return d[e];if(a=o(d[e],b,c))return a}return 0}function h(b){for(var c=[].concat(b.childNodes),d=0;d<c.length;d++)if("html"==c[d].nodeName){for(var e=c[d],h=0;h<d;h++)3==c[h].nodeType&&!a.trim(c[h].toHtml())&&b.removeChild(c[h]);for(;e.firstChild&&3==e.firstChild.nodeType&&!a.trim(e.firstChild.toHtml());)e.removeChild(e.firstChild);break}}k.prototype={constructor:k,elements:function(){var b,c,e=this.lexer,f=this.opts;c=b=e.nextNode();"document"!=b.tagName&&(c=
new n,c.appendChild(b));c.nodeType=9;m.getScanner("div").scan(b,e,f);(b=r(c))&&f.autoParagraph&&d(b);h(c);var f=this.originalHTML,k=new l;c=/^(<!doctype|<html|<body)/i.test(f)?c.childNodes:b.childNodes;a.each(c,function(a){k.appendChild(a)});return k},parse:function(){return this.elements()}};return k},{requires:"./dtd,./nodes/tag,./nodes/fragment,./lexer/cursor,./lexer/lexer,./nodes/document,./scanner".split(",")});
KISSY.add("html-parser/writer/basic",function(){function a(){this.output=[]}a.prototype={constructor:a,append:function(){for(var a=this.output,f=arguments,l,b=0;b<f.length;b++)if(l=f[b],1<l.length)for(var c=0;c<l.length;c++)a.push(l.charAt(c));else a.push(l);return this},openTag:function(a){this.append("<",a.tagName)},openTagClose:function(a){a.isSelfClosed&&this.append(" ","/");this.append(">")},closeTag:function(a){this.append("</",a.tagName,">")},attribute:function(a){this.append(" ",a.name,'="',
(""+(a.value||a.name)).replace(/"/g,"&quote;"),'"')},text:function(a){this.append(a)},cdata:function(a){this.append(a)},comment:function(a){this.append("<\!--"+a+"--\>")},getHtml:function(){return this.output.join("")}};return a});
KISSY.add("html-parser/writer/beautify",function(a,e,f,l){function b(){b.superclass.constructor.apply(this,arguments);this.inPre=0;this.indentChar="\t";this.allowIndent=this.indentLevel=0;this.rules={};for(var c in a.merge(f.$nonBodyContent,f.$block,f.$listItem,f.$tableContent,{select:1,script:1,style:1}))this.setRules(c,{allowIndent:1,breakBeforeOpen:1,breakAfterOpen:1,breakBeforeClose:1,breakAfterClose:1});this.setRules("option",{breakBeforeOpen:1});this.setRules("optiongroup",{breakBeforeOpen:1});
this.setRules("br",{breakAfterOpen:1});this.setRules("title",{allowIndent:0,breakBeforeClose:0,breakAfterOpen:0});this.setRules("pre",{allowIndent:0})}a.extend(b,e,{indentation:function(){this.inPre||this.append(Array(this.indentLevel+1).join(this.indentChar));this.allowIndent=0},lineBreak:function(){var a=this.output;if(!this.inPre&&a.length){for(var b=a.length-1;0<=b&&/[\r\n\t ]/.test(a[b]);b--);a.length=b+1;this.append("\n")}this.allowIndent=1},setRules:function(b,e){this.rules[b]||(this.rules[b]=
{});a.mix(this.rules[b],e)},openTag:function(a){var e=this.rules[a.tagName]||{};this.allowIndent?this.indentation():e.breakBeforeOpen&&(this.lineBreak(),this.indentation());b.superclass.openTag.apply(this,arguments)},openTagClose:function(a){var b=a.tagName,e=this.rules[b]||{};a.isSelfClosed?this.append(" />"):(this.append(">"),e.allowIndent&&this.indentLevel++);e.breakAfterOpen&&this.lineBreak();"pre"===b&&(this.inPre=1)},closeTag:function(a){var e=a.tagName,f=this.rules[e]||{};f.allowIndent&&this.indentLevel--;
this.allowIndent?this.indentation():f.breakBeforeClose&&(this.lineBreak(),this.indentation());b.superclass.closeTag.apply(this,arguments);"pre"===e&&(this.inPre=0);f.breakAfterClose&&this.lineBreak()},text:function(a){this.allowIndent&&this.indentation();this.inPre||(a=l.collapseWhitespace(a));this.append(a)},comment:function(a){this.allowIndent&&this.indentation();this.append("<\!--"+a+"--\>")},cdata:function(b){this.allowIndent&&this.indentation();this.append(a.trim(b))}});return b},{requires:["./basic",
"../dtd","../utils"]});
KISSY.add("html-parser/writer/minify",function(a,e,f){function l(){l.superclass.constructor.apply(this,arguments);this.inPre=0}var b=a.trim,c=f.collapseWhitespace,n=RegExp("^(?:class|id|style|title|lang|dir|on(?:focus|blur|change|click|dblclick|mouse(?:down|up|over|move|out)|key(?:press|down|up)))$");a.extend(l,e,{comment:function(a){/\[if[^\]]+\]/.test(a)&&(a=a.replace(/^(\[[^\]]+\]>)[\s\xa0]*/,"$1").replace(/[\s\xa0]*(<!\[endif\])$/,"$1"),l.superclass.comment.call(this,a))},openTag:function(a){"pre"==
a.tagName&&(this.inPre=1);l.superclass.openTag.apply(this,arguments)},closeTag:function(a){"pre"==a.tagName&&(this.inPre=0);l.superclass.closeTag.apply(this,arguments)},cdata:function(a){a=b(a).replace(/^(?:[\s\xa0]*\/\*[\s\xa0]*<!\[CDATA\[[\s\xa0]*\*\/|[\s\xa0]*\/\/[\s\xa0]*<!\[CDATA\[.*)/,"").replace(/(?:\/\*[\s\xa0]*\]\]>[\s\xa0]*\*\/|\/\/[\s\xa0]*\]\]>)[\s\xa0]*$/,"");l.superclass.cdata.call(this,a)},attribute:function(a,e){var f=a.name,d,l=a.value||"";d=a.name;if(!(d=!b(a.value||"")?"input"===
e&&"value"===d||n.test(d):0)){d=e.nodeName;var h=a.name,g=a.value||"",g=b(g.toLowerCase());d="script"===d&&"language"===h&&"javascript"===g||"form"===d&&"method"===h&&"get"===g||"input"===d&&"type"===h&&"text"===g||"script"===d&&"type"===h&&"text/javascript"===g||"style"===d&&"type"===h&&"text/css"===g||"area"===d&&"shape"===h&&"rect"===g}if(!d)if(/^(?:checked|disabled|selected|readonly|defer|multiple|nohref|noshape|nowrap|noresize|compact|ismap)$/i.test(f))this.append(" ",f);else{d=e.nodeName;h=
a.name;g=a.value||"";/^on[a-z]+/.test(h)?g=b(g).replace(/^javascript:[\s\xa0]*/i,"").replace(/[\s\xa0]*;$/,""):"class"===h?g=c(b(g)):/^(?:a|area|link|base)$/.test(d)&&"href"===h||"img"===d&&/^(?:src|longdesc|usemap)$/.test(h)||"object"===d&&/^(?:classid|codebase|data|usemap)$/.test(h)||"q"===d&&"cite"===h||"blockquote"===d&&"cite"===h||("ins"===d||"del"===d)&&"cite"===h||"form"===d&&"action"===h||"input"===d&&("src"===h||"usemap"===h)||"head"===d&&"profile"===h||"script"===d&&("src"===h||"for"===
h)||/^(?:a|area|object|button)$/.test(d)&&"tabindex"===h||"input"===d&&("maxlength"===h||"tabindex"===h)||"select"===d&&("size"===h||"tabindex"===h)||"textarea"===d&&/^(?:rows|cols|tabindex)$/.test(h)||"colgroup"===d&&"span"===h||"col"===d&&"span"===h||("th"===d||"td"==d)&&("rowspan"===h||"colspan"===h)?g=b(g):"style"===h&&(g=b(g).replace(/[\s\xa0]*;[\s\xa0]*$/,""));d=(""+g).replace(/"/g,"&quote;");if(!l||/[ "'=<>`]/.test(l))d='"'+d+'"';this.append(" ",f,"=",d)}},text:function(a){this.inPre||(a=c(a));
this.append(a)}});return l},{requires:["./basic","../utils"]});
KISSY.add("html-parser/writer/filter",function(a){function e(){this.tagNames=[];this.attributeNames=[];this.tags=[];this.comment=[];this.text=[];this.cdata=[];this.attributes=[];this.root=[]}function f(b,c){for(var e=0;b&&e<b.length;e++)a.each(b[e].value,function(a){c=c.replace(a[0],a[1])});return c}function l(a,c,e){var f,k;for(k=0;a&&k<a.length;k++){f=a[k].value;if(!1===(f=f.apply(null,c)))return!1;if(e&&f&&f!=e){if("string"==typeof f){if(e.toHtml()==f)break;e.nodeValue=f;f=e}return this.onNode(f)}}return e}
e.prototype={constructor:e,addRules:function(a,c){var c=c||10,e;for(e in a){var f=this[e];if(f){var k;a:{for(k=0;f&&k<f.length;k++)if(f[k].priority>c)break a;k=f.length}f.splice(k,0,{value:a[e],priority:c})}}},onTagName:function(a){return f(this.tagNames,a)},onAttributeName:function(a){return f(this.attributeNames,a)},onText:function(a){return l.call(this,this.text,[a.toHtml(),a],a)},onCData:function(a){return l.call(this,this.cdata,[a.toHtml(),a],a)},onAttribute:function(a,c){var e;a:{e=this.attributes;
for(var f=0;e&&f<e.length;f++){var k=e[f].value,l,d=a.name;if(k[d]&&!1===(l=k[d].call(null,a.value,c))){e=l;break a}"string"==typeof l&&(a.value=l)}e=a}return e},onComment:function(a){return l.call(this,this.comment,[a.toHtml(),a],a)},onNode:function(a){var c=a.nodeType;if(1===c)return this.onTag(a);if(3===c)return this.onText(a);if(8===c)return this.onComment(a)},onFragment:function(a){return l.call(this,this.root,[a],a)},onTag:function(a){for(var c=["^",a.tagName,"$"],e=this.tags,f,k=0;k<c.length;k++)for(var l=
c[k],d=0;d<e.length;d++)if(f=e[d].value,f[l]){if(!1===(f=f[l](a)))return!1;if(f&&f!=a)return this.onNode(f);if(!a.tagName)return a}return a}};return e});KISSY.add("html-parser",function(a,e,f,l,b,c,n,m,k,r,d,o,h){return{CData:k,Comment:r,Node:d,Tag:o,Text:h,Lexer:f,Parser:l,BasicWriter:b,BeautifyWriter:c,MinifyWriter:n,Filter:m,DTD:e,serialize:function(a,c){var d=new b;a.writeHtml(d,c);return d.getHtml()},parse:function(a){return(new l(a)).parse()}}},{requires:"html-parser/dtd,html-parser/lexer/lexer,html-parser/parser,html-parser/writer/basic,html-parser/writer/beautify,html-parser/writer/minify,html-parser/writer/filter,html-parser/nodes/cdata,html-parser/nodes/comment,html-parser/nodes/node,html-parser/nodes/tag,html-parser/nodes/text".split(",")});
