/*
Copyright 2013, KISSY v1.50dev
MIT Licensed
build time: Nov 12 16:22
*/
KISSY.add("html-parser/dtd",function(a){var a=a.merge,f={isindex:1,fieldset:1},c={input:1,button:1,select:1,textarea:1,label:1},j=a({a:1},c),b=a({iframe:1},j),d={hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1},m={ins:1,del:1,script:1,style:1},o=a({b:1,acronym:1,bdo:1,"var":1,"#text":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1},m),i=a({sub:1,img:1,object:1,
sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1},o),q=a({p:1},i),c=a({iframe:1},i,c),i={img:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#text":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,
u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1},h=a({a:1},c),n={tr:1},l={"#text":1},e=a({param:1},i),g=a({form:1},f,b,d,q),p={li:1},k={base:1,link:1,meta:1,title:1},v=a(k,{style:1,script:1}),s={head:1,body:1},r={address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1},a={$nonBodyContent:a({html:1},s,k),$block:r,$blockLimit:{body:1,div:1,td:1,th:1,caption:1,form:1},$inline:h,$body:a({script:1,style:1},
r),$cdata:{script:1,style:1},$empty:{area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1},$listItem:{dd:1,dt:1,li:1},$list:{ul:1,ol:1,dl:1},$nonEditable:{applet:1,button:1,embed:1,iframe:1,map:1,object:1,option:1,script:1,textarea:1,param:1},$removeEmpty:{abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},$tabIndex:{a:1,area:1,button:1,input:1,object:1,
select:1,textarea:1},$tableContent:{caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1},html:s,head:v,style:l,body:g,base:{},link:{},meta:{},title:l,col:{},tr:{td:1,th:1},img:{},colgroup:{col:1},noscript:g,td:g,br:{},th:g,center:g,kbd:h,button:a(q,d),basefont:{},h5:h,h4:h,samp:h,h6:h,ol:p,h1:h,h3:h,option:l,h2:h,form:a(f,b,d,q),select:{optgroup:1,option:1},font:h,ins:h,menu:p,abbr:h,label:h,table:{thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1},code:h,script:l,tfoot:n,cite:h,
li:g,input:{},iframe:g,strong:h,textarea:l,noframes:g,big:h,small:h,span:h,hr:{},dt:h,sub:h,optgroup:{option:1},param:{},bdo:h,"var":h,div:g,object:e,sup:h,dd:g,strike:h,area:{},dir:p,map:a({area:1,form:1,p:1},f,m,d),applet:e,dl:{dt:1,dd:1},del:h,isindex:{},fieldset:a({legend:1},i),thead:n,ul:p,acronym:h,b:h,a:c,blockquote:g,caption:h,i:h,u:h,tbody:n,s:h,address:a(b,q),tt:h,legend:h,q:h,pre:a(o,j),p:h,em:h,dfn:h},j="article,figure,nav,aside,section,footer".split(","),t;for(t in a)for(var u in a[t])if("div"===
u)for(f=0;f<j.length;f++)a[t][j[f]]=a[t][u];for(f=0;f<j.length;f++)a[j[f]]=a.div;a.$empty["!doctype"]=1;return a});KISSY.add("html-parser/lexer/cursor",function(){function a(a){this.position=a||0}a.prototype={constructor:a,advance:function(){this.position++},clone:function(){var f=new a;f.position=this.position;return f},retreat:function(){this.position=Math.max(--this.position,0)}};return a});
KISSY.add("html-parser/lexer/index",function(){function a(){this.lineCursors=[]}a.prototype={constructor:a,add:function(a){var c;a:{c=this.lineCursors;for(var j=a.position,b=0;b<c.length;b++){var d=c[b].position;if(d===j){c=-1;break a}if(d>j)break}c=b}-1!=c&&this.lineCursors.splice(c,0,a.clone())},remove:function(a){var c=this.lineCursors,j;a:{j=this.lineCursors;for(var a=a.position,b=0;b<j.length;b++){var d=j[b].position;if(d===a){j=b;break a}if(d<a)break}j=-1}-1!==j&&c.splice(j,1)},row:function(a){for(var c=
this.lineCursors,j=0;j<c.length;j++)if(c[j].position>a.position)return j-1;return j},col:function(a){var c=0,j;if(j=this.lineCursors[this.row(a)-1])c=j.position;return a.position-c}};return a});
KISSY.add("html-parser/lexer/page",function(a,f){function c(a){this.source=a;this.lineIndex=new f}c.prototype={constructor:c,getChar:function(a){var b=this.source,d=a.position;if(d>=b.length)return-1;var c=b.charAt(d);a.advance();"\r"===c&&(c="\n",d=a.position,"\n"===b.charAt(d)&&a.advance());"\n"===c&&this.lineIndex.add(a);return c},ungetChar:function(a){var b=this.source;a.retreat();var d=a.position,c=b.charAt(d);"\n"===c&&0!==d&&(c=b.charAt(d-1),"\r"===c&&a.retreat())},getText:function(a,b){return this.source.slice(a,
b)},row:function(a){return this.lineIndex.row(a)},col:function(a){return this.lineIndex.col(a)}};return c},{requires:["./index"]});
KISSY.add("html-parser/nodes/node",function(){function a(a){var j=0;a.replace(/\n/g,function(){j++});return j}function f(a,j,b){this.parentNode=null;this.page=a;this.startPosition=j;this.endPosition=b;this.nextSibling=this.previousSibling=this.nodeName=null}f.prototype={constructor:f,getStartLine:function(){if(this.page){if("startLine"in this)return this.startLine;this.startLine=a(this.page.getText(0,this.startPosition))}return-1},getEndLine:function(){if(this.page){if("endLine"in this)return this.endLine;
this.endLine=a(this.page.getText(0,this.endPosition))}return-1},toHtml:function(){return this.page&&this.page.getText?this.page.getText(this.startPosition,this.endPosition):""},toDebugString:function(){var a=[];a.push(this.nodeName+"  [ "+this.startPosition+"|"+this.getStartLine()+" : "+this.endPosition+"|"+this.getEndLine()+" ]\n");a.push(this.toHtml());return a.join("")}};return f});
KISSY.add("html-parser/nodes/text",function(a,f){function c(a){"string"==typeof a?(this.nodeValue=a,c.superclass.constructor.apply(this,[null,-1,-1])):(c.superclass.constructor.apply(this,arguments),this.nodeValue=this.toHtml());this.nodeType=3;this.nodeName="#text"}a.extend(c,f,{writeHtml:function(a,b){var d;if(!b||!1!==(d=b.onText(this)))d&&this!==d?d.writeHtml(a,b):a.text(this.toHtml())},toHtml:function(){return this.nodeValue?this.nodeValue:c.superclass.toHtml.apply(this,arguments)}});return c},
{requires:["./node"]});KISSY.add("html-parser/nodes/cdata",function(a,f){function c(){c.superclass.constructor.apply(this,arguments);this.nodeType=4;this.nodeName="#cdata"}a.extend(c,f,{writeHtml:function(a,b){var d;if(!b||!1!==(d=b.onCData(this)))d&&this!==d?d.writeHtml(a,b):a.cdata(this.toHtml())}});return c},{requires:["./text"]});
KISSY.add("html-parser/utils",function(){return{isBooleanAttribute:function(a){return/^(?:checked|disabled|selected|readonly|defer|multiple|nohref|noshape|nowrap|noresize|compact|ismap)$/i.test(a)},collapseWhitespace:function(a){return a.replace(/[\s\xa0]+/g," ")},isLetter:function(a){return"a"<=a&&"z">=a||"A"<=a&&"Z">=a},isValidAttributeNameStartChar:function(a){return!this.isWhitespace(a)&&'"'!==a&&"'"!==a&&">"!==a&&"<"!==a&&"/"!==a&&"="!==a},isWhitespace:function(a){return/^[\s\xa0]$/.test(a)}}});
KISSY.add("html-parser/nodes/attribute",function(a){function f(a,j,b,d){this.nodeType=2;this.name=a;this.assignMent=j;this.value=b;this.quote=d}a.augment(f,{clone:function(){var c=new f;a.mix(c,this);return c},equals:function(a){return this.name==a.name&&this.value==a.value&&this.nodeType==a.nodeType}});f.prototype.clone=function(){var c=new f;a.mix(c,this);return c};return f});
KISSY.add("html-parser/nodes/tag",function(a,f,c,j){function b(i,b,h){i.nodeName=i.tagName=b.toLowerCase();i._updateSelfClosed();a.each(h,function(h,a){i.setAttribute(a,h)})}function d(i,c,h,n){this.childNodes=[];this.lastChild=this.firstChild=null;this.attributes=n||[];this.nodeType=1;if("string"==typeof i)b.apply(null,[this].concat(a.makeArray(arguments)));else{d.superclass.constructor.apply(this,arguments);n=this.attributes;n[0]&&(this.nodeName=n[0].name.toLowerCase(),this.tagName=this.nodeName.replace(/\//,
""),this._updateSelfClosed(),n.splice(0,1));var l=n[n.length-1];if(l=!(!l||!/\/$/.test(l.name)))n.length-=1;this.closed=this.isSelfClosed=this.isSelfClosed||l}this.closedEndPosition=this.closedStartPosition=-1}function m(a){var b=a.childNodes;a.firstChild=b[0];a.lastChild=b[b.length-1];1<=b.length&&(b[0].nextSibling=b[0].nextSibling=null,b[0].parentNode=a);if(1<b.length){for(var h=0;h<b.length-1;h++)b[h].nextSibling=b[h+1],b[h+1].previousSibling=b[h],b[h+1].parentNode=a;b[b.length-1].nextSibling=
null}}function o(a,b){if(a&&a.length)for(var h=0;h<a.length;h++)if(a[h].name==b)return a[h];return null}a.extend(d,f,{_updateSelfClosed:function(){this.isSelfClosed=!!j.$empty[this.nodeName];this.isSelfClosed||(this.isSelfClosed=/\/$/.test(this.nodeName));this.closed=this.isSelfClosed},clone:function(){var b=new d,c=[];a.each(this.attributes,function(a){c.push(a.clone())});a.mix(b,{childNodes:[],firstChild:null,lastChild:null,attributes:c,nodeType:this.nodeType,nodeName:this.nodeName,tagName:this.tagName,
isSelfClosed:this.isSelfClosed,closed:this.closed,closedStartPosition:this.closedStartPosition,closedEndPosition:this.closedEndPosition});return b},setTagName:function(a){(this.nodeName=this.tagName=a)&&this._updateSelfClosed()},equals:function(a){if(!a||this.nodeName!==a.nodeName||this.nodeType!==a.nodeType||this.attributes.length!==a.attributes.length)return 0;for(var b=0;b<this.attributes.length;b++)if(!this.attributes[b].equals(a.attributes[b]))return 0;return 1},isEndTag:function(){return/^\//.test(this.nodeName)},
appendChild:function(a){this.childNodes.push(a);m(this)},replace:function(b){var d=b.parentNode.childNodes,h=a.indexOf(b,d);d[h]=this;m(b.parentNode)},replaceChild:function(b,d){var h=this.childNodes,n=a.indexOf(d,h);h[n]=b;m(this)},prepend:function(a){this.childNodes.unshift(a);m(this)},insertBefore:function(b){var d=b.parentNode.childNodes,h=a.indexOf(b,d);d.splice(h,0,this);m(b.parentNode)},insertAfter:function(b){var d=b.parentNode.childNodes,h=a.indexOf(b,d);h==d.length-1?b.parentNode.appendChild(this):
this.insertBefore(b.parentNode.childNodes[[h+1]])},empty:function(){this.childNodes=[];m(this)},removeChild:function(b){var d=b.parentNode.childNodes,h=a.indexOf(b,d);d.splice(h,1);m(b.parentNode)},getAttribute:function(a){return(a=o(this.attributes,a))&&a.value},setAttribute:function(a,b){var h=o(this.attributes,a);h?h.value=b:this.attributes.push(new c(a,"=",b,'"'))},removeAttribute:function(b){(b=o(this.attributes,b))&&this.attributes.splice(a.indexOf(b,this.attributes),1)},filterChildren:function(){var b=
this;if(!b.isChildrenFiltered){var d=new (a.require("html-parser/writer/basic"));b._writeChildrenHTML(d);d=(new (a.require("html-parser/parser"))(d.getHtml())).parse().childNodes;b.empty();a.each(d,function(a){b.appendChild(a)});b.isChildrenFiltered=1}},writeHtml:function(a,b){var h=this,n;n=h.tagName;if("!doctype"==n)a.append(this.toHtml()+"\n");else{h.__filter=b;h.isChildrenFiltered=0;if(b){if(!(n=b.onTagName(n)))return;h.tagName=n;n=b.onTag(h);if(!1===n)return;n&&(h=n);if(1!==h.nodeType){h.writeHtml(a,
b);return}if(!h.tagName){h._writeChildrenHTML(a);return}}a.openTag(h);for(var d=h.attributes,e=0;e<d.length;e++){var g=d[e];n=g.name;if(b){if(!(n=b.onAttributeName(n,h)))continue;g.name=n;if(!1===b.onAttribute(g,h))continue}a.attribute(g,h)}a.openTagClose(h);h.isSelfClosed||(h._writeChildrenHTML(a),a.closeTag(h))}},_writeChildrenHTML:function(b){var d=this.isChildrenFiltered?0:this.__filter;a.each(this.childNodes,function(a){a.writeHtml(b,d)})}});return d},{requires:["./node","./attribute","../dtd"]});
KISSY.add("html-parser/nodes/comment",function(a,f){function c(){c.superclass.constructor.apply(this,arguments);this.nodeType=8;this.nodeName="#comment"}a.extend(c,f,{writeHtml:function(a,b){var d;if(!b||!1!==(d=b.onComment(this)))d&&this!==d?d.writeHtml(a,b):a.comment(this.toHtml())},toHtml:function(){if(this.nodeValue)return this.nodeValue;var a=f.superclass.toHtml.apply(this,arguments);return a.substring(4,a.length-3)}});return c},{requires:["./text"]});
KISSY.add("html-parser/lexer/lexer",function(a,f,c,j,b,d,m,o,i){function q(a,b){this.page=new c(a);this.cursor=new f;this.nodeFactory=this;this.cfg=b||{}}q.prototype={constructor:q,setPosition:function(a){this.cursor.position=a},getPosition:function(){return this.cursor.position},nextNode:function(a){var b,l,e=this.cursor,g=this.page;b=e.position;l=g.getChar(e);switch(l){case -1:a=null;break;case "<":l=g.getChar(e);-1==l?a=this.makeString(b,e.position):"/"==l||d.isLetter(l)?(g.ungetChar(e),a=this.parseTag(b)):
"!"==l||"?"==l?(l=g.getChar(e),-1==l?a=this.makeString(b,e.position):">"==l?a=this.makeComment(b,e.position):(g.ungetChar(e),"-"==l?a=this.parseComment(b,a):(g.ungetChar(e),a=this.parseTag(b)))):(g.ungetChar(e),a=this.parseString(b,a));break;default:g.ungetChar(e),a=this.parseString(b,a)}return a},makeComment:function(a,b){var d;d=b-a;if(0!==d){if(2>d)return this.makeString(a,b);d=this.nodeFactory.createCommentNode(this.page,a,b)}else d=null;return d},makeString:function(a,b){var d=null;0<b-a&&(d=
this.nodeFactory.createStringNode(this.page,a,b));return d},makeCData:function(a,b){var d=null;0<b-a&&(d=this.nodeFactory.createCDataNode(this.page,a,b));return d},makeTag:function(a,b,d){var e;e=b-a;if(0!==e){if(2>e)return this.makeString(a,b);a=this.nodeFactory.createTagNode(this.page,a,b,d)}else a=null;return a},createTagNode:function(a,b,d,e){return new o(a,b,d,e)},createStringNode:function(a,b,d){return new j(a,b,d)},createCDataNode:function(a,d,l){return new b(a,d,l)},createCommentNode:function(a,
b,d){return new i(a,b,d)},parseTag:function(b){var n,l=[],e=[],g,p=this.cfg.strict,k=a.noop,c=this.page,i=0,j=this.cursor;p&&(k=function(){if(p&&-1===g&&e.length)throw Error(e[0].name+" syntax error at row "+(c.row(j)+1)+" , col "+(c.col(j)+1));});for(l[0]=j.position;!n;){l[i+1]=j.position;g=c.getChar(j);switch(i){case 0:if(-1==g||">"==g||"<"==g)"<"==g&&(c.ungetChar(j),l[i+1]=j.position),n=!0;else if("/"==g||d.isValidAttributeNameStartChar(g))i=1;break;case 1:-1==g||">"==g||"<"==g?("<"==g&&(c.ungetChar(j),
l[i+1]=j.getPosition),this.standalone(e,l),n=!0):d.isWhitespace(g)?(l[6]=l[2],i=6):"="==g&&(i=2);break;case 2:-1==g||">"==g?(this.standalone(e,l),n=!0):"'"==g?(i=4,l[4]=l[3]):'"'==g?(i=5,l[5]=l[3]):d.isWhitespace(g)||(i=3);break;case 3:-1==g||">"==g?(this.naked(e,l),n=!0):d.isWhitespace(g)&&(this.naked(e,l),l[0]=l[4],i=0);break;case 4:-1==g?(this.single_quote(e,l),n=!0):"'"==g&&(this.single_quote(e,l),l[0]=l[5]+1,i=0);break;case 5:-1==g?(this.double_quote(e,l),n=!0):'"'==g&&(this.double_quote(e,l),
l[0]=l[6]+1,i=0);break;case 6:-1==g?(this.standalone(e,l),l[0]=l[6],c.ungetChar(j),i=0):d.isWhitespace(g)||("="==g?(l[2]=l[6],l[3]=l[7],i=2):(this.standalone(e,l),l[0]=l[6],c.ungetChar(j),i=0));break;default:throw Error("how ** did we get in state "+i);}k()}return this.makeTag(b,j.position,e)},parseComment:function(a,b){var i,e,g=this.page,c=this.cursor,k;i=!1;for(k=0;!i;)if(e=g.getChar(c),-1==e)i=!0;else switch(k){case 0:">"==e&&(i=!0);if("-"==e)k=1;else return this.parseString(a,b);break;case 1:if("-"==
e)e=g.getChar(c),-1==e?i=!0:">"==e?i=!0:(g.ungetChar(c),k=2);else return this.parseString(a,b);break;case 2:if("-"==e)k=3;else if(-1==e)return this.parseString(a,b);break;case 3:k="-"==e?4:2;break;case 4:">"==e?i=!0:d.isWhitespace(e)||(k=2);break;default:throw Error("how ** did we get in state "+k);}return this.makeComment(a,c.position)},parseString:function(a,b){for(var i=0,e,g=this.page,c=this.cursor,k=0;!i;)if(e=g.getChar(c),-1==e)i=1;else if(b&&0==k&&("'"==e||'"'==e))k=e;else if(b&&0!==k&&"\\"===
e)e=g.getChar(c),-1!==e&&"\\"!==e&&e!==k&&g.ungetChar(c);else if(b&&e==k)k=0;else if(b&&0==k&&"/"==e)if(e=g.getChar(c),-1==e)i=1;else if("/"==e){do e=g.getChar(c);while(-1!==e&&"\n"!==e)}else if("*"==e){do{do e=g.getChar(c);while(-1!==e&&"*"!==e);e=g.getChar(c);"*"==e&&g.ungetChar(c)}while(-1!==e&&"/"!==e)}else g.ungetChar(c);else if(0==k&&"<"==e)if(e=g.getChar(c),-1==e)i=1;else{if("/"==e||d.isLetter(e)||"!"==e||"?"==e)i=1,g.ungetChar(c);g.ungetChar(c)}return this.makeString(a,c.position)},parseCDATA:function(a,
b){var i,e,g,c,k,j,m=this.cursor,f=this.page;i=m.position;e=0;g=!1;c="";for(j=!1;!g;)switch(k=f.getChar(m),e){case 0:switch(k){case -1:g=!0;break;case "'":a&&!j&&(""==c?c="'":"'"==c&&(c=""));break;case '"':a&&!j&&(""==c?c='"':'"'==c&&(c=""));break;case "\\":a&&""!==c&&(k=f.getChar(m),-1==k?g=!0:"\\"!==k&&k!==c&&f.ungetChar(m));break;case "/":if(a&&""==c)if(k=f.getChar(m),-1==k)g=!0;else if("/"==k)j=!0;else if("*"==k){do{do k=f.getChar(m);while(-1!==k&&"*"!==k);k=f.getChar(m);"*"==k&&f.ungetChar(m)}while(-1!==
k&&"/"!==k)}else f.ungetChar(m);break;case "\n":j=!1;break;case "<":a?""==c&&(e=1):e=1}break;case 1:switch(k){case -1:g=!0;break;case "/":e=!b||f.getText(m.position,m.position+b.length)===b&&!f.getText(m.position+b.length,m.position+b.length+1).match(/\w/)?2:0;break;case "!":k=f.getChar(m);-1==k?g=!0:"-"==k?(k=f.getChar(m),-1==k?g=!0:e="-"==k?3:0):e=0;break;default:e=0}break;case 2:j=!1;-1==k?g=!0:d.isLetter(k)?(g=!0,f.ungetChar(m),f.ungetChar(m),f.ungetChar(m)):e=0;break;case 3:j=!1;-1==k?g=!0:"-"==
k&&(k=f.getChar(m),-1==k?g=!0:"-"==k?(k=f.getChar(m),-1==k?g=!0:">"==k?e=0:(f.ungetChar(m),f.ungetChar(m))):f.ungetChar(m));break;default:throw Error("unexpected "+e);}return this.makeCData(i,m.position)},single_quote:function(a,b){var d=this.page;a.push(new m(d.getText(b[1],b[2]),"=",d.getText(b[4]+1,b[5]),"'"))},double_quote:function(a,b){var d=this.page;a.push(new m(d.getText(b[1],b[2]),"=",d.getText(b[5]+1,b[6]),'"'))},standalone:function(a,b){a.push(new m(this.page.getText(b[1],b[2])))},naked:function(a,
b){var d=this.page;a.push(new m(d.getText(b[1],b[2]),"=",d.getText(b[3],b[4])))}};return q},{requires:"./cursor,./page,../nodes/text,../nodes/cdata,../utils,../nodes/attribute,../nodes/tag,../nodes/comment".split(",")});KISSY.add("html-parser/nodes/fragment",function(a,f){function c(){this.childNodes=[];this.nodeType=9;this.nodeName="#fragment"}a.extend(c,f,{writeHtml:function(a,b){this.__filter=b;this.isChildrenFiltered=0;if(b)b.onFragment(this);this._writeChildrenHTML(a)}});return c},{requires:["./tag"]});
KISSY.add("html-parser/nodes/document",function(a,f){function c(){this.childNodes=[];this.nodeType=9;this.nodeName="#document"}a.extend(c,f,{writeHtml:function(a,b){this.__filter=b;this._writeChildrenHTML(a)}});return c},{requires:["./tag"]});KISSY.add("html-parser/scanners/special-scanners",function(){return{}});
KISSY.add("html-parser/scanners/tag-scanner",function(a,f,c,j){function b(i,j){function h(){e.childNodes.length&&(e.insertAfter(g),g=e,e=i.clone())}i.closed=1;if(!j.fixByDtd)return 0;var n=1,l=[].concat(i.childNodes);a.each(l,function(a){if(!d(i,a))return n=0,!1});if(n)return 0;for(var e=i.clone(),g=i,p=[],k=0;k<l.length;k++){var o=l[k];if(d(e,o))e.appendChild(o);else if(1===o.nodeType){var s=o.tagName;if(f.$listItem[s]){h();var o=m[o.tagName],r=new c;for(r.nodeName=r.tagName=o;k<l.length;){if(l[k].tagName==
s)r.appendChild(l[k]);else if((3!=l[k].nodeType||a.trim(l[k].toHtml()))&&3==l[k].nodeType)break;k++}r.insertAfter(g);g=r;k--}else h(),o.equals(e)?(o.insertAfter(g),g=o):d(o,e)?(e=i.clone(),a.each(o.childNodes,function(a){e.appendChild(a)}),o.empty(),o.insertAfter(g),g=o,o.appendChild(e),p.push(e),e=i.clone()):(o.insertAfter(g),g=o)}}e.childNodes.length&&e.insertAfter(g);i.parentNode.removeChild(i);a.each(p,function(a){b(a,j)});return 1}function d(a,b){if(9==a.nodeType)return 1;f[a.tagName]||"dtd["+
a.tagName+"] === undefined!";return 8==b.nodeType?1:!!f[a.tagName][b.tagName||b.nodeName]}var m={li:"ul",dt:"dl",dd:"dl"},o={dd:{dl:1},dt:{dl:1},li:{ul:1,ol:1},option:{select:1},optgroup:{select:1}};return{scan:function(a,d,c){function m(e,d){for(g=e;g>d;g--){var k=p[g];p[g-1].appendChild(k);b(k,c)}a=p[d];p.length=d}function f(a){var b=0,e;if(e=o[a.tagName]){for(var d=p.length-1,g=p[d];g&&!(g.tagName in e);){if(g.tagName==a.tagName){b=1;break}d--;g=p[d]}b&&m(p.length-1,d-1)}return b}var e,g,p;p=c.stack=
c.stack||[];do{if(e=d.nextNode())if(1===e.nodeType)if(e.isEndTag()&&e.tagName==a.tagName)e=null;else if(e.isEndTag()){if(e.isEndTag()){var k=-1;for(g=p.length-1;0<=g;g--)if(p[g].tagName===e.tagName){k=g;break}-1!==k&&(p[p.length-1].appendChild(a),b(a,c),m(p.length-1,k),e=null)}}else j[e.tagName]?(j[e.tagName].scan(e,d,c),a.appendChild(e)):e.isSelfClosed?a.appendChild(e):(p.push(a),f(e)&&p.push(a),a=e);else a.appendChild(e);null==e&&0<p.length&&(e=p[p.length-1],j[e.tagName]?e=null:(p.length-=1,e.appendChild(a),
b(a,c),a=e))}while(e);b(a,c)}}},{requires:["../dtd","../nodes/tag","./special-scanners"]});KISSY.add("html-parser/scanners/cdata-scanner",function(){return{scan:function(a,f,c){var c=f.parseCDATA(c.quoteSmart,a.nodeName),j=f.getPosition(),b=f.nextNode();b&&(1!==b.nodeType||!(b.isEndTag()&&b.tagName==a.tagName))&&f.setPosition(j);a.closed=!0;c&&a.appendChild(c)}}});
KISSY.add("html-parser/scanners/quote-cdata-scanner",function(a,f,c,j){var a={scan:function(a,b,c){c=c||{};c.quoteSmart=1;f.scan(a,b,c);c.quoteSmart=0}},b;for(b in c.$cdata)j[b]=a;return a},{requires:["./cdata-scanner","../dtd","./special-scanners"]});KISSY.add("html-parser/scanners/textarea-scanner",function(a,f,c){return c.textarea={scan:function(a,b,d){d=d||{};f.scan(a,b,d)}}},{requires:["./cdata-scanner","./special-scanners"]});
KISSY.add("html-parser/scanner",function(a,f,c){return{getScanner:function(a){return c[a]||f}}},{requires:["./scanners/tag-scanner","./scanners/special-scanners","./scanners/quote-cdata-scanner","./scanners/textarea-scanner"]});
KISSY.add("html-parser/parser",function(a,f,c,j,b,d,m,o){function i(b,g){this.originalHTML=b=a.trim(b);b=/^(<!doctype|<html|<body)/i.test(b)?"<document>"+b+"</document>":"<body>"+b+"</body>";this.lexer=new d(b);this.opts=g||{}}function q(b){var d=n(b,"body",3);if(d){var b=d.parentNode,c=b.childNodes,k=a.indexOf(d,c);if(k!==c.length-1){c=c.slice(k+1,c.length);for(k=0;k<c.length;k++)b.removeChild(c[k]),"body"===c[k].tagName?a.each(c[k].childNodes,function(a){d.appendChild(a)}):d.appendChild(c[k])}}return d}
function h(a){var b=a.childNodes,d,k,i=f.p,h=0;for(k=0;k<b.length;k++)if(d=b[k],3==d.nodeType||1==d.nodeType&&i[d.nodeName]){h=1;break}if(h){var h=[],m=new c;m.nodeName=m.tagName="p";for(k=0;k<b.length;k++)d=b[k],3==d.nodeType||1==d.nodeType&&i[d.nodeName]?m.appendChild(d):(m.childNodes.length&&(h.push(m),m=m.clone()),h.push(d));m.childNodes.length&&h.push(m);a.empty();for(k=0;k<h.length;k++)a.appendChild(h[k])}}function n(a,b,d){if(0===d)return 0;"number"===typeof d&&d--;var c=a.childNodes;if(c)for(var i=
0;i<c.length;i++){if(c[i].tagName===b)return c[i];if(a=n(c[i],b,d))return a}return 0}function l(b){for(var d=[].concat(b.childNodes),c=0;c<d.length;c++)if("html"==d[c].nodeName){for(var i=d[c],h=0;h<c;h++)3==d[h].nodeType&&!a.trim(d[h].toHtml())&&b.removeChild(d[h]);for(;i.firstChild&&3==i.firstChild.nodeType&&!a.trim(i.firstChild.toHtml());)i.removeChild(i.firstChild);break}}i.prototype={constructor:i,elements:function(){var b,d,c=this.lexer,i=this.opts;d=b=c.nextNode();"document"!==b.tagName&&(d=
new m,d.appendChild(b));d.nodeType=9;o.getScanner("div").scan(b,c,i);(b=q(d))&&i.autoParagraph&&h(b);l(d);var i=this.originalHTML,f=new j;d=/^(<!doctype|<html|<body)/i.test(i)?d.childNodes:b.childNodes;a.each(d,function(a){f.appendChild(a)});return f},parse:function(){return this.elements()}};return i},{requires:"./dtd,./nodes/tag,./nodes/fragment,./lexer/cursor,./lexer/lexer,./nodes/document,./scanner".split(",")});
KISSY.add("html-parser/writer/basic",function(a,f){function c(){this.output=[]}var j=f.isBooleanAttribute;c.prototype={constructor:c,append:function(){for(var a=this.output,d=arguments,c,f=0;f<d.length;f++)if(c=d[f],1<c.length)for(var i=0;i<c.length;i++)a.push(c.charAt(i));else a.push(c);return this},openTag:function(a){this.append("<",a.tagName)},openTagClose:function(a){a.isSelfClosed&&this.append(" ","/");this.append(">")},closeTag:function(a){this.append("</",a.tagName,">")},attribute:function(a){var d=
a.value||"",a=a.name;j(a)&&!d&&(d=a);this.append(" ",a,'="',(""+d).replace(/"/g,"&quote;"),'"')},text:function(a){this.append(a)},cdata:function(a){this.append(a)},comment:function(a){this.append("<\!--"+a+"--\>")},getHtml:function(){return this.output.join("")}};return c},{requires:["../utils"]});
KISSY.add("html-parser/writer/beautify",function(a,f,c,j){function b(){var d=this;b.superclass.constructor.apply(d,arguments);d.inPre=0;d.indentChar="\t";d.indentLevel=0;d.allowIndent=0;d.rules={};for(var m in a.merge(c.$nonBodyContent,c.$block,c.$listItem,c.$tableContent,{select:1,script:1,style:1}))d.setRules(m,{allowIndent:1,breakBeforeOpen:1,breakAfterOpen:1,breakBeforeClose:1,breakAfterClose:1});a.each("p,h1,h2,h3,h4,h5,h6".split(","),function(a){d.setRules(a,{allowIndent:0,breakAfterOpen:0,
breakBeforeClose:0})});d.setRules("option",{breakBeforeOpen:1});d.setRules("optiongroup",{breakBeforeOpen:1});d.setRules("br",{breakAfterOpen:1});d.setRules("title",{allowIndent:0,breakBeforeClose:0,breakAfterOpen:0});d.setRules("pre",{breakAfterOpen:1,allowIndent:0})}a.extend(b,f,{indentation:function(){this.inPre||this.append(Array(this.indentLevel+1).join(this.indentChar));this.allowIndent=0},lineBreak:function(){var a=this.output;if(!this.inPre&&a.length){for(var b=a.length-1;0<=b&&/[\r\n\t ]/.test(a[b]);b--);
a.length=b+1;this.append("\n")}this.allowIndent=1},setRules:function(b,c){this.rules[b]||(this.rules[b]={});a.mix(this.rules[b],c)},openTag:function(a){var c=this.rules[a.tagName]||{};this.allowIndent?this.indentation():c.breakBeforeOpen&&(this.lineBreak(),this.indentation());b.superclass.openTag.apply(this,arguments)},openTagClose:function(a){var b=a.tagName,c=this.rules[b]||{};a.isSelfClosed?this.append(" />"):(this.append(">"),c.allowIndent&&this.indentLevel++);c.breakAfterOpen&&this.lineBreak();
"pre"===b&&(this.inPre=1)},closeTag:function(a){var c=a.tagName,f=this.rules[c]||{};f.allowIndent&&this.indentLevel--;this.allowIndent?this.indentation():f.breakBeforeClose&&(this.lineBreak(),this.indentation());b.superclass.closeTag.apply(this,arguments);"pre"===c&&(this.inPre=0);f.breakAfterClose&&this.lineBreak()},text:function(a){this.allowIndent&&this.indentation();this.inPre||(a=j.collapseWhitespace(a));this.append(a)},comment:function(a){this.allowIndent&&this.indentation();this.append("<\!--"+
a+"--\>")},cdata:function(b){this.allowIndent&&this.indentation();this.append(a.trim(b))}});return b},{requires:["./basic","../dtd","../utils"]});
KISSY.add("html-parser/writer/minify",function(a,f,c){function j(){j.superclass.constructor.apply(this,arguments);this.inPre=0}var b=a.trim,d=c.isBooleanAttribute,m=c.collapseWhitespace,o=RegExp("^(?:class|id|style|title|lang|dir|on(?:focus|blur|change|click|dblclick|mouse(?:down|up|over|move|out)|key(?:press|down|up)))$");a.extend(j,f,{comment:function(a){/\[if[^\]]+\]/.test(a)&&(a=a.replace(/^(\[[^\]]+\]>)[\s\xa0]*/,"$1").replace(/[\s\xa0]*(<!\[endif\])$/,"$1"),j.superclass.comment.call(this,a))},
openTag:function(a){"pre"==a.tagName&&(this.inPre=1);j.superclass.openTag.apply(this,arguments)},closeTag:function(a){"pre"==a.tagName&&(this.inPre=0);j.superclass.closeTag.apply(this,arguments)},cdata:function(a){a=b(a).replace(/^(?:[\s\xa0]*\/\*[\s\xa0]*<!\[CDATA\[[\s\xa0]*\*\/|[\s\xa0]*\/\/[\s\xa0]*<!\[CDATA\[.*)/,"").replace(/(?:\/\*[\s\xa0]*\]\]>[\s\xa0]*\*\/|\/\/[\s\xa0]*\]\]>)[\s\xa0]*$/,"");j.superclass.cdata.call(this,a)},attribute:function(a,c){var h=a.name,f,j=a.value||"";f=a.name;if(!(f=
!b(a.value||"")?"input"===c&&"value"===f||o.test(f):0)){f=c.nodeName;var e=a.name,g=a.value||"",g=b(g.toLowerCase());f="script"===f&&"language"===e&&"javascript"===g||"form"===f&&"method"===e&&"get"===g||"input"===f&&"type"===e&&"text"===g||"script"===f&&"type"===e&&"text/javascript"===g||"style"===f&&"type"===e&&"text/css"===g||"area"===f&&"shape"===e&&"rect"===g}if(!f)if(d(h))this.append(" ",h);else{f=c.nodeName;e=a.name;g=a.value||"";/^on[a-z]+/.test(e)?g=b(g).replace(/^javascript:[\s\xa0]*/i,
"").replace(/[\s\xa0]*;$/,""):"class"===e?g=m(b(g)):/^(?:a|area|link|base)$/.test(f)&&"href"===e||"img"===f&&/^(?:src|longdesc|usemap)$/.test(e)||"object"===f&&/^(?:classid|codebase|data|usemap)$/.test(e)||"q"===f&&"cite"===e||"blockquote"===f&&"cite"===e||("ins"===f||"del"===f)&&"cite"===e||"form"===f&&"action"===e||"input"===f&&("src"===e||"usemap"===e)||"head"===f&&"profile"===e||"script"===f&&("src"===e||"for"===e)||/^(?:a|area|object|button)$/.test(f)&&"tabindex"===e||"input"===f&&("maxlength"===
e||"tabindex"===e)||"select"===f&&("size"===e||"tabindex"===e)||"textarea"===f&&/^(?:rows|cols|tabindex)$/.test(e)||"colgroup"===f&&"span"===e||"col"===f&&"span"===e||("th"===f||"td"==f)&&("rowspan"===e||"colspan"===e)?g=b(g):"style"===e&&(g=b(g).replace(/[\s\xa0]*;[\s\xa0]*$/,""));f=(""+g).replace(/"/g,"&quote;");if(!j||/[ "'=<>`]/.test(j))f='"'+f+'"';this.append(" ",h,"=",f)}},text:function(a){this.inPre||(a=m(a));this.append(a)}});return j},{requires:["./basic","../utils"]});
KISSY.add("html-parser/writer/filter",function(a){function f(){this.tagNames=[];this.attributeNames=[];this.tags=[];this.comment=[];this.text=[];this.cdata=[];this.attributes=[];this.root=[]}function c(b,d){for(var c=0;b&&c<b.length;c++)a.each(b[c].value,function(a){d=d.replace(a[0],a[1])});return d}function j(a,d,c){var f,i;for(i=0;a&&i<a.length;i++){f=a[i].value;if(!1===(f=f.apply(null,d)))return!1;if(c&&f&&f!==c){if("string"==typeof f){if(c.toHtml()===f)break;c.nodeValue=f;f=c}return this.onNode(f)}}return c}
f.prototype={constructor:f,addRules:function(a,d){var d=d||10,c;for(c in a){var f=this[c];if(f){var i;a:{for(i=0;f&&i<f.length;i++)if(f[i].priority>d)break a;i=f.length}f.splice(i,0,{value:a[c],priority:d})}}},onTagName:function(a){return c(this.tagNames,a)},onAttributeName:function(a){return c(this.attributeNames,a)},onText:function(a){return j.call(this,this.text,[a.toHtml(),a],a)},onCData:function(a){return j.call(this,this.cdata,[a.toHtml(),a],a)},onAttribute:function(a,c){var f;a:{f=this.attributes;
for(var j=0;f&&j<f.length;j++){var i=f[j].value,q,h=a.name;if(i[h]&&!1===(q=i[h].call(null,a.value,c))){f=q;break a}"string"==typeof q&&(a.value=q)}f=a}return f},onComment:function(a){return j.call(this,this.comment,[a.toHtml(),a],a)},onNode:function(a){var c=a.nodeType;if(1===c)return this.onTag(a);if(3===c)return this.onText(a);if(8===c)return this.onComment(a)},onFragment:function(a){return j.call(this,this.root,[a],a)},onTag:function(a){for(var c=["^",a.tagName,"$"],f=this.tags,j,i=0;i<c.length;i++)for(var q=
c[i],h=0;h<f.length;h++)if(j=f[h].value,j[q]){if(!1===(j=j[q](a)))return!1;if(j&&j!==a)return this.onNode(j);if(!a.tagName)return a}return a}};return f});KISSY.add("html-parser",function(a,f,c,j,b,d,m,o,i,q,h,n,l){return{CData:i,Comment:q,Node:h,Tag:n,Text:l,Lexer:c,Parser:j,BasicWriter:b,BeautifyWriter:d,MinifyWriter:m,Filter:o,DTD:f,serialize:function(a,c){var d=new b;a.writeHtml(d,c);return d.getHtml()},parse:function(a){return(new j(a)).parse()}}},{requires:"html-parser/dtd,html-parser/lexer/lexer,html-parser/parser,html-parser/writer/basic,html-parser/writer/beautify,html-parser/writer/minify,html-parser/writer/filter,html-parser/nodes/cdata,html-parser/nodes/comment,html-parser/nodes/node,html-parser/nodes/tag,html-parser/nodes/text".split(",")});
