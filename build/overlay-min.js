/*
Copyright 2012, KISSY UI Library v1.40dev
MIT Licensed
build time: Oct 22 17:01
*/
KISSY.add("overlay/base",function(c,d,f){function a(a){var g=a.get("el"),h=c.all,g=g[0].cloneNode(!0);g.style.visibility="";g.style.overflow="hidden";g.className+=" "+a.get("prefixCls")+"overlay-ghost";var b;if(b=a.get("body"))a=h("."+a.get("prefixCls")+"stdmod-body",g),a.css({height:b.height(),width:b.width()}),a.html("");return h(g)}function h(j,g,h){j.__effectGhost&&j.__effectGhost.stop(1);var b=j.get("el"),k=c.all,i=j.get("effect"),e=k(i.target),k=i.duration,e=c.mix(e.offset(),{width:e.width(),
height:e.height()}),f=c.mix(b.offset(),{width:b.width(),height:b.height()}),d=a(j),i=i.easing;d.insertAfter(b);b.hide();g?(g=e,e=f):g=f;d.css(g);j.__effectGhost=d;d.animate(e,{duration:k,easing:i,complete:function(){j.__effectGhost=null;d.remove();b.show();h()}})}function e(a,b,c){var e=a.get("el"),d=a.get("effect"),f=d.effect||k,l=d.target;if(f==k&&!l)c();else if(l)h(a,b,c);else{var a=d.duration,d=d.easing,m=e.css("visibility"),l=b?1:0;e.stop(1,1);e.css({visibility:"visible",display:b?"none":"block"});
e[f+i[f][l]](a,function(){e.css({display:"block",visibility:m});c()},d)}}function b(a){return c.require("component/uibase/"+a)}var k="none",i={fade:["Out","In"],slide:["Up","Down"]};return d.Controller.extend([b("content-box"),b("position"),b("loading"),b("align"),b("close"),b("resize"),b("mask")],{_uiSetVisible:function(a){var b=this;b.get("rendered")&&e(b,a,function(){b.fire(a?"show":"hide")})}},{ATTRS:{effect:{value:{effect:"",target:null,duration:0.5,easing:"easeOut"},setter:function(a){var b=
a.effect;"string"==typeof b&&!i[b]&&(a.effect="")}},focusable:{value:!1},allowTextSelection:{value:!0},closable:{value:!1},handleMouseEvents:{value:!1},xrender:{value:f}}},{xclass:"overlay",priority:10})},{requires:["component","./overlay-render"]});
KISSY.add("overlay/dialog-render",function(c,d){return d.extend([c.require("component/uibase/stdmod-render")],{createDom:function(){var d=this.get("el"),a,h=this.get("header");if(!(a=h.attr("id")))h.attr("id",a=c.guid("ks-dialog-header"));d.attr("role","dialog").attr("aria-labelledby",a);d.append("<div tabindex='0' style='position:absolute;'></div>")}})},{requires:["./overlay-render"]});
KISSY.add("overlay/dialog",function(c,d,f,a){var h=a.all,e=d.extend([c.require("component/uibase/stdmod"),c.require("component/uibase/drag")],{initializer:function(){var a=this,b;if((b=a.get("draggable"))&&!b.handlers)b.handlers=[function(){return a.get("header")}]},handleKeyEventInternal:function(c){if(this.get("escapeToClose")&&c.keyCode===a.KeyCodes.ESC){if("select"!=c.target.nodeName.toLowerCase()||c.target.disabled)this.close(),c.halt()}else a:if(c.keyCode==b){var e=this.get("el"),d=h(c.target),
f=e.last();if(d.equals(e)&&c.shiftKey)f[0].focus(),c.halt();else if(d.equals(f)&&!c.shiftKey)e[0].focus(),c.halt();else if(d.equals(e)||e.contains(d))break a;c.halt()}},_uiSetVisible:function(a){var b=this.get("el");a?(this.__lastActive=b[0].ownerDocument.activeElement,b[0].focus&&b[0].focus(),b.attr("aria-hidden","false")):(b.attr("aria-hidden","true"),this.__lastActive&&this.__lastActive.focus());e.superclass._uiSetVisible.apply(this,arguments)}},{ATTRS:{closable:{value:!0},xrender:{value:f},focusable:{value:!0},
escapeToClose:{value:!0}}},{xclass:"dialog",priority:20}),b=a.KeyCodes.TAB;return e},{requires:["./base","./dialog-render","node"]});KISSY.add("overlay/overlay-render",function(c,d,f){function a(a){return c.require("component/uibase/"+a)}return f.Render.extend([a("content-box-render"),a("position-render"),a("loading-render"),6===d.ie?a("shim-render"):null,a("close-render"),a("mask-render")])},{requires:["ua","component"]});
KISSY.add("overlay",function(c,d,f,a,h,e){d.Render=f;a.Render=h;d.Dialog=a;c.Dialog=a;d.Popup=e;return c.Overlay=d},{requires:["overlay/base","overlay/overlay-render","overlay/dialog","overlay/dialog-render","overlay/popup"]});
KISSY.add("overlay/popup",function(c,d,f){return d.extend({initializer:function(){var a=this;a.get("trigger")&&("mouse"===a.get("triggerType")?(a._bindTriggerMouse(),a.on("afterRenderUI",function(){a._bindContainerMouse()})):a._bindTriggerClick())},_bindTriggerMouse:function(){var a=this,d=a.get("trigger"),e;a.__mouseEnterPopup=function(b){a._clearHiddenTimer();e=c.later(function(){a._showing(b);e=f},1E3*a.get("mouseDelay"))};c.each(d,function(b){c.one(b).on("mouseenter",a.__mouseEnterPopup)});a._mouseLeavePopup=
function(){e&&(e.cancel(),e=f);a._setHiddenTimer()};c.each(d,function(b){c.one(b).on("mouseleave",a._mouseLeavePopup)})},_bindContainerMouse:function(){this.get("el").on("mouseleave",this._setHiddenTimer,this).on("mouseenter",this._clearHiddenTimer,this)},_setHiddenTimer:function(){var a=this;a._hiddenTimer=c.later(function(){a._hiding()},1E3*a.get("mouseDelay"))},_clearHiddenTimer:function(){this._hiddenTimer&&(this._hiddenTimer.cancel(),this._hiddenTimer=f)},_bindTriggerClick:function(){var a=this;
a.__clickPopup=function(c){c.halt();if(a.get("toggle"))a[a.get("visible")?"_hiding":"_showing"](c);else a._showing(c)};c.each(a.get("trigger"),function(d){c.one(d).on("click",a.__clickPopup)})},_showing:function(a){this.set("currentTrigger",c.one(a.target));this.show()},_hiding:function(){this.set("currentTrigger",f);this.hide()},destructor:function(){var a=this,c,d=a.get("trigger");d&&(a.__clickPopup&&d.each(function(b){b.detach("click",a.__clickPopup)}),a.__mouseEnterPopup&&d.each(function(b){b.detach("mouseenter",
a.__mouseEnterPopup)}),a._mouseLeavePopup&&d.each(function(b){b.detach("mouseleave",a._mouseLeavePopup)}));(c=a.get("el"))&&c.detach("mouseleave",a._setHiddenTimer,a).detach("mouseenter",a._clearHiddenTimer,a)}},{ATTRS:{trigger:{setter:function(a){"string"==typeof a&&(a=c.all(a));return a}},triggerType:{value:"click"},currentTrigger:{},mouseDelay:{value:0.1},toggle:{value:!1}}},{xclass:"popup",priority:20})},{requires:["./base"]});
