/*
Copyright 2012, KISSY UI Library v1.40dev
MIT Licensed
build time: Dec 6 01:11
*/
KISSY.add("overlay/base",function(d,g,b,a,c,f,e){function k(a){var e=a.get("el"),c=d.all,e=e[0].cloneNode(!0);e.style.visibility="";e.style.overflow="hidden";e.className+=" "+a.get("prefixCls")+"overlay-ghost";var b;if(b=a.get("body"))a=c("."+a.get("prefixCls")+"stdmod-body",e),a.css({height:b.height(),width:b.width()}),a.html("");return c(e)}function h(a,e,c){a.__effectGhost&&a.__effectGhost.stop(1);var b=a.get("el"),f=d.all,i=a.get("effect"),h=f(i.target),f=i.duration,h=d.mix(h.offset(),{width:h.width(),
height:h.height()}),g=d.mix(b.offset(),{width:b.width(),height:b.height()}),j=k(a),i=i.easing;j.insertAfter(b);b.hide();e?(e=h,h=g):e=g;j.css(e);a.__effectGhost=j;j.animate(h,{duration:f,easing:i,complete:function(){a.__effectGhost=null;j.remove();b.show();c()}})}function i(a,e,b){var c=a.get("el"),f=a.get("effect"),i=f.effect||j,d=f.target;if(i==j&&!d)b();else if(d)h(a,e,b);else{var a=f.duration,f=f.easing,g=c.css("visibility"),d=e?1:0;c.stop(1,1);c.css({visibility:"visible",display:e?"none":"block"});
c[i+l[i][d]](a,function(){c.css({display:"block",visibility:g});b()},f)}}var j="none",l={fade:["Out","In"],slide:["Up","Down"]};return g.Controller.extend([b.ContentBox,b.Position,a,b.Align,c,f],{_onSetVisible:function(a){var e=this;e.get("rendered")&&i(e,a,function(){e.fire(a?"show":"hide")})}},{ATTRS:{effect:{value:{effect:"",target:null,duration:0.5,easing:"easeOut"},setter:function(a){var e=a.effect;"string"==typeof e&&!l[e]&&(a.effect="")}},focusable:{value:!1},allowTextSelection:{value:!0},
closable:{value:!1},handleMouseEvents:{value:!1},xrender:{value:e}}},{xclass:"overlay",priority:10})},{requires:"component/base,component/extension,./extension/loading,./extension/close,./extension/mask,./overlay-render".split(",")});
KISSY.add("overlay/dialog-render",function(d,g,b){return g.extend([b],{createDom:function(){var a=this.get("el"),c,b=this.get("header");if(!(c=b.attr("id")))b.attr("id",c=d.guid("ks-dialog-header"));a.attr("role","dialog").attr("aria-labelledby",c);a.append("<div tabindex='0' style='position:absolute;'></div>")}})},{requires:["./overlay-render","./extension/stdmod-render"]});
KISSY.add("overlay/dialog",function(d,g,b,a,c){var f=a.all,e=g.extend([c],{handleKeyEventInternal:function(e){if(this.get("escapeToClose")&&e.keyCode===a.KeyCodes.ESC){if("select"!=e.target.nodeName.toLowerCase()||e.target.disabled)this.close(),e.halt()}else a:if(e.keyCode==k){var b=this.get("el"),c=f(e.target),d=b.last();if(c.equals(b)&&e.shiftKey)d[0].focus(),e.halt();else if(c.equals(d)&&!e.shiftKey)b[0].focus(),e.halt();else if(c.equals(b)||b.contains(c))break a;e.halt()}},_onSetVisible:function(a){var b=
this.get("el");a?(this.__lastActive=b[0].ownerDocument.activeElement,b[0].focus&&b[0].focus(),b.attr("aria-hidden","false")):(b.attr("aria-hidden","true"),this.__lastActive&&this.__lastActive.focus());e.superclass._onSetVisible.apply(this,arguments)}},{ATTRS:{closable:{value:!0},xrender:{value:b},focusable:{value:!0},escapeToClose:{value:!0}}},{xclass:"dialog",priority:20}),k=a.KeyCodes.TAB;return e},{requires:["./base","./dialog-render","node","./extension/stdmod"]});
KISSY.add("overlay/extension/close-render",function(d,g){function b(a){return new g("<a tabindex='0' href='javascript:void(\"\u5173\u95ed\")' role='button' style='z-index:9' class='"+a+c+"close'><span class='"+a+c+"close-x'>\u5173\u95ed</span></a>")}function a(){}var c="ext-";a.ATTRS={closable:{value:!0},closeBtn:{}};a.HTML_PARSER={closeBtn:function(a){return a.one("."+this.get("prefixCls")+c+"close")}};a.prototype={_onSetClosable:function(a){var e=this.get("closeBtn");a?(e||this.setInternal("closeBtn",e=b(this.get("prefixCls"))),
this.get("el").prepend(e)):e&&e.remove()}};return a},{requires:["node"]});
KISSY.add("overlay/extension/close",function(){function d(){}d.ATTRS={closable:{view:1},closeBtn:{view:1},closeAction:{value:"hide"}};var g={hide:"hide",destroy:"destroy"};d.prototype={_onSetClosable:function(b){var a=this;b&&!a.__bindCloseEvent&&(a.__bindCloseEvent=1,a.get("closeBtn").on("click",function(b){a.close();b.preventDefault()}))},close:function(){this[g[this.get("closeAction")]||"hide"]();return this},__destructor:function(){var b=this.get("closeBtn");b&&b.detach()}};return d});
KISSY.add("overlay/extension/loading-render",function(d,g){function b(){}b.prototype={loading:function(){this._loadingExtEl||(this._loadingExtEl=(new g("<div class='"+this.get("prefixCls")+"ext-loading' style='position: absolute;border: none;width: 100%;top: 0;left: 0;z-index: 99999;height:100%;*height: expression(this.parentNode.offsetHeight);'/>")).appendTo(this.get("el")));this._loadingExtEl.show()},unloading:function(){var a=this._loadingExtEl;a&&a.hide()}};return b},{requires:["node"]});
KISSY.add("overlay/extension/loading",function(){function d(){}d.prototype={loading:function(){this.get("view").loading();return this},unloading:function(){this.get("view").unloading();return this}};return d});
KISSY.add("overlay/extension/mask-render",function(d,g){function b(a){a=a.get("prefixCls")+"ext-mask "+a.getCssClassWithState("-mask");a=f("<div  style='width:"+(c?"expression(KISSY.DOM.docWidth())":"100%")+";left:0;top:0;height:"+(c?"expression(KISSY.DOM.docHeight())":"100%")+";position:"+(c?"absolute":"fixed")+";' class='"+a+"'>"+(c?"<iframe style='position:absolute;left:0;top:0;background:red;width: expression(this.parentNode.offsetWidth);height: expression(this.parentNode.offsetHeight);filter:alpha(opacity=0);z-index:-1;'></iframe>":
"")+"</div>").prependTo("body");a.unselectable();a.on("mousedown",function(a){a.preventDefault()});return a}function a(){}var c=6===d.UA.ie,f=g.all;a.ATTRS={mask:{value:!1},maskNode:{}};a.prototype={__renderUI:function(){this.get("mask")&&this.set("maskNode",b(this))},__syncUI:function(){this.get("mask")&&this.ksSetMaskVisible(this.get("visible"),1)},ksSetMaskVisible:function(a,b){var c=this.getCssClassWithState("-mask-shown"),d=this.get("maskNode"),f=this.getCssClassWithState("-mask-hidden");a?d.removeClass(f).addClass(c):
d.removeClass(c).addClass(f);b||d.css("visibility",a?"visible":"hidden")},__destructor:function(){var a;(a=this.get("maskNode"))&&a.remove()}};return a},{requires:["node"]});
KISSY.add("overlay/extension/mask",function(d,g){function b(){}b.ATTRS={mask:{view:1},maskNode:{view:1}};var a={fade:["Out","In"],slide:["Up","Down"]};b.prototype={__bindUI:function(){var b=this,d,e,k=b.get("el"),h=b.get("view");if(e=b.get("mask")){d=b.get("maskNode");if(e.hideOnClick)d.on(g.Gesture.tap,function(){b.hide()});b.on("afterVisibleChange",function(b){if(b=b.newVal){var c=parseInt(k.css("z-index"))||1;d.css("z-index",c-1)}c=e.effect||"none";if("none"==c)h.ksSetMaskVisible(b);else{h.ksSetMaskVisible(b,
1);var g=e.duration,m=e.easing,n=b?1:0;d.stop(1,1);d.css("display",b?"none":"block");d[c+a[c][n]](g,null,m)}})}}};return b},{requires:["event"]});
KISSY.add("overlay/extension/stdmod-render",function(d,g){function b(){}function a(a,b){var c=a.get("contentEl"),d=a.get(b);d||(d=new g("<div class='"+a.get("prefixCls")+f+b+"'  ></div>"),d.appendTo(c),a.setInternal(b,d))}function c(a,b,c){b=a.get(b);"string"==typeof c?b.html(c):b.html("").append(c)}var f="stdmod-";b.ATTRS={header:{},body:{},footer:{},bodyStyle:{},footerStyle:{},headerStyle:{},headerContent:{},bodyContent:{},footerContent:{}};b.HTML_PARSER={header:function(a){return a.one("."+this.get("prefixCls")+
f+"header")},body:function(a){return a.one("."+this.get("prefixCls")+f+"body")},footer:function(a){return a.one("."+this.get("prefixCls")+f+"footer")}};b.prototype={__createDom:function(){a(this,"header");a(this,"body");a(this,"footer")},_onSetBodyStyle:function(a){this.get("body").css(a)},_onSetHeaderStyle:function(a){this.get("header").css(a)},_onSetFooterStyle:function(a){this.get("footer").css(a)},_onSetBodyContent:function(a){c(this,"body",a)},_onSetHeaderContent:function(a){c(this,"header",
a)},_onSetFooterContent:function(a){c(this,"footer",a)}};return b},{requires:["node"]});KISSY.add("overlay/extension/stdmod",function(){function d(){}d.ATTRS={header:{view:1},body:{view:1},footer:{view:1},bodyStyle:{view:1},footerStyle:{view:1},headerStyle:{view:1},headerContent:{view:1},bodyContent:{view:1},footerContent:{view:1}};return d});
KISSY.add("overlay/overlay-render",function(d,g,b,a,c,f){return g.Render.extend([b.ContentBox.Render,b.Position.Render,a,6===d.UA.ie?b.Shim.Render:null,c,f])},{requires:["component/base","component/extension","./extension/loading-render","./extension/close-render","./extension/mask-render"]});
KISSY.add("overlay",function(d,g,b,a,c,f){g.Render=b;a.Render=c;g.Dialog=a;d.Dialog=a;g.Popup=f;return d.Overlay=g},{requires:["overlay/base","overlay/overlay-render","overlay/dialog","overlay/dialog-render","overlay/popup"]});
KISSY.add("overlay/popup",function(d,g,b){return g.extend({initializer:function(){var a=this;a.get("trigger")&&("mouse"===a.get("triggerType")?(a._bindTriggerMouse(),a.on("afterRenderUI",function(){a._bindContainerMouse()})):a._bindTriggerClick())},_bindTriggerMouse:function(){var a=this,c=a.get("trigger"),f;a.__mouseEnterPopup=function(c){a._clearHiddenTimer();f=d.later(function(){a._showing(c);f=b},1E3*a.get("mouseDelay"))};c.on("mouseenter",a.__mouseEnterPopup);a._mouseLeavePopup=function(){f&&
(f.cancel(),f=b);a._setHiddenTimer()};c.on("mouseleave",a._mouseLeavePopup)},_bindContainerMouse:function(){this.get("el").on("mouseleave",this._setHiddenTimer,this).on("mouseenter",this._clearHiddenTimer,this)},_setHiddenTimer:function(){var a=this;a._hiddenTimer=d.later(function(){a._hiding()},1E3*a.get("mouseDelay"))},_clearHiddenTimer:function(){this._hiddenTimer&&(this._hiddenTimer.cancel(),this._hiddenTimer=b)},_bindTriggerClick:function(){var a=this;a.__clickPopup=function(b){b.halt();if(a.get("toggle"))a[a.get("visible")?
"_hiding":"_showing"](b);else a._showing(b)};a.get("trigger").on("click",a.__clickPopup)},_showing:function(a){this.set("currentTrigger",d.one(a.target));this.show()},_hiding:function(){this.set("currentTrigger",b);this.hide()},destructor:function(){var a,b=this.get("trigger");b&&(this.__clickPopup&&b.detach("click",this.__clickPopup),this.__mouseEnterPopup&&b.detach("mouseenter",this.__mouseEnterPopup),this._mouseLeavePopup&&b.detach("mouseleave",this._mouseLeavePopup));(a=this.get("el"))&&a.detach("mouseleave",
this._setHiddenTimer,this).detach("mouseenter",this._clearHiddenTimer,this)}},{ATTRS:{trigger:{setter:function(a){return d.all(a)}},triggerType:{value:"click"},currentTrigger:{},mouseDelay:{value:0.1},toggle:{value:!1}}},{xclass:"popup",priority:20})},{requires:["./base"]});
