/*
Copyright 2012, KISSY UI Library v1.40dev
MIT Licensed
build time: Sep 10 21:09
*/
KISSY.add("overlay/base",function(b,c,f){function a(a){var h=a.get("el"),g=b.all,h=h[0].cloneNode(!0);h.style.visibility="";h.style.overflow="hidden";h.className+=" "+a.get("prefixCls")+"overlay-ghost";var d;if(d=a.get("body"))a=g("."+a.get("prefixCls")+"stdmod-body",h),a.css({height:d.height(),width:d.width()}),a.html("");return g(h)}function g(g,d,l){g.__effectGhost&&g.__effectGhost.stop(1);var e=g.get("el"),i=b.all,f=g.get("effect"),c=i(f.target),i=f.duration,c=b.mix(c.offset(),{width:c.width(),
height:c.height()}),m=b.mix(e.offset(),{width:e.width(),height:e.height()}),k=a(g),f=f.easing;k.insertAfter(e);e.hide();d?(d=c,c=m):d=m;k.css(d);g.__effectGhost=k;k.animate(c,{duration:i,easing:f,complete:function(){g.__effectGhost=null;k.remove();e.show();l()}})}function e(a,d,b){var e=a.get("el"),c=a.get("effect"),f=c.effect||l,j=c.target;f==l&&!j?b():j?g(a,d,b):(a=c.duration,c=c.easing,j=d?1:0,e.stop(1,1),e.css({visibility:"visible",display:m[j]}),e[f+i[f][j]](a,function(){e.css({display:m[0],
visibility:d?"visible":"hidden"});b()},c))}function d(a){return b.require("component/uibase/"+a)}var l="none",i={fade:["Out","In"],slide:["Up","Down"]},m=["block",l];return c.Controller.extend([d("contentbox"),d("position"),d("loading"),d("align"),d("close"),d("resize"),d("mask")],{_uiSetVisible:function(a){var d=this;d.get("rendered")&&e(d,a,function(){d.fire(a?"show":"hide")})}},{ATTRS:{effect:{value:{effect:"",target:null,duration:0.5,easing:"easeOut"},setter:function(a){var d=a.effect;b.isString(d)&&
!i[d]&&(a.effect="")}},focusable:{value:!1},allowTextSelection:{value:!0},closable:{value:!1},handleMouseEvents:{value:!1},xrender:{value:f}}},{xclass:"overlay",priority:10})},{requires:["component","./overlay-render"]});
KISSY.add("overlay/dialog-render",function(b,c){return c.extend([b.require("component/uibase/stdmodrender")],{createDom:function(){var c=this.get("el"),a,g=this.get("header");if(!(a=g.attr("id")))g.attr("id",a=b.guid("ks-dialog-header"));c.attr("role","dialog").attr("aria-labelledby",a);c.append("<div tabindex='0' style='position:absolute;'></div>")}})},{requires:["./overlay-render"]});
KISSY.add("overlay/dialog",function(b,c,f,a){var g=a.all,e=c.extend([b.require("component/uibase/stdmod"),b.require("component/uibase/drag")],{initializer:function(){var a=this,d;if((d=a.get("draggable"))&&!d.handlers)d.handlers=[function(){return a.get("header")}]},handleKeyEventInternal:function(b){if(this.get("escapeToClose")&&b.keyCode===a.KeyCodes.ESC){if("select"!=b.target.nodeName.toLowerCase()||b.target.disabled)this.close(),b.halt()}else a:if(b.keyCode==d){var c=this.get("el"),e=g(b.target),
f=c.last();if(e.equals(c)&&b.shiftKey)f[0].focus(),b.halt();else if(e.equals(f)&&!b.shiftKey)c[0].focus(),b.halt();else if(e.equals(c)||c.contains(e))break a;b.halt()}},_uiSetVisible:function(a){var b=this.get("el");a?(this.__lastActive=b[0].ownerDocument.activeElement,b[0].focus(),b.attr("aria-hidden","false")):(b.attr("aria-hidden","true"),this.__lastActive&&this.__lastActive.focus());e.superclass._uiSetVisible.apply(this,arguments)}},{ATTRS:{closable:{value:!0},xrender:{value:f},focusable:{value:!0},
escapeToClose:{value:!0}}},{xclass:"dialog",priority:20}),d=a.KeyCodes.TAB;return e},{requires:["./base","./dialog-render","node"]});KISSY.add("overlay/overlay-render",function(b,c,f){function a(a){return b.require("component/uibase/"+a)}return f.Render.extend([a("contentboxrender"),a("positionrender"),a("loadingrender"),6===c.ie?a("shimrender"):null,a("closerender"),a("maskrender")])},{requires:["ua","component"]});
KISSY.add("overlay",function(b,c,f,a,g,e){c.Render=f;a.Render=g;c.Dialog=a;b.Dialog=a;c.Popup=e;return b.Overlay=c},{requires:["overlay/base","overlay/overlay-render","overlay/dialog","overlay/dialog-render","overlay/popup"]});
KISSY.add("overlay/popup",function(b,c,f){return c.extend({initializer:function(){var a=this;a.get("trigger")&&("mouse"===a.get("triggerType")?(a._bindTriggerMouse(),a.on("afterRenderUI",function(){a._bindContainerMouse()})):a._bindTriggerClick())},_bindTriggerMouse:function(){var a=this,c=a.get("trigger"),e;a.__mouseEnterPopup=function(d){a._clearHiddenTimer();e=b.later(function(){a._showing(d);e=f},1E3*a.get("mouseDelay"))};b.each(c,function(d){b.one(d).on("mouseenter",a.__mouseEnterPopup)});a._mouseLeavePopup=
function(){e&&(e.cancel(),e=f);a._setHiddenTimer()};b.each(c,function(d){b.one(d).on("mouseleave",a._mouseLeavePopup)})},_bindContainerMouse:function(){this.get("el").on("mouseleave",this._setHiddenTimer,this).on("mouseenter",this._clearHiddenTimer,this)},_setHiddenTimer:function(){var a=this;a._hiddenTimer=b.later(function(){a._hiding()},1E3*a.get("mouseDelay"))},_clearHiddenTimer:function(){this._hiddenTimer&&(this._hiddenTimer.cancel(),this._hiddenTimer=f)},_bindTriggerClick:function(){var a=this;
a.__clickPopup=function(b){b.halt();if(a.get("toggle"))a[a.get("visible")?"_hiding":"_showing"](b);else a._showing(b)};b.each(a.get("trigger"),function(c){b.one(c).on("click",a.__clickPopup)})},_showing:function(a){this.set("currentTrigger",b.one(a.target));this.show()},_hiding:function(){this.set("currentTrigger",f);this.hide()},destructor:function(){var a=this,b,c=a.get("trigger");c&&(a.__clickPopup&&c.each(function(b){b.detach("click",a.__clickPopup)}),a.__mouseEnterPopup&&c.each(function(b){b.detach("mouseenter",
a.__mouseEnterPopup)}),a._mouseLeavePopup&&c.each(function(b){b.detach("mouseleave",a._mouseLeavePopup)}));(b=a.get("el"))&&b.detach("mouseleave",a._setHiddenTimer,a).detach("mouseenter",a._clearHiddenTimer,a)}},{ATTRS:{trigger:{setter:function(a){b.isString(a)&&(a=b.all(a));return a}},triggerType:{value:"click"},currentTrigger:{},mouseDelay:{value:0.1},toggle:{value:!1}}},{xclass:"popup",priority:20})},{requires:["./base"]});
