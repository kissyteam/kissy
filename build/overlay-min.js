/*
Copyright 2012, KISSY UI Library v1.40dev
MIT Licensed
build time: Nov 28 02:50
*/
KISSY.add("overlay/base",function(e,d,b,a,c,f,g,j){function k(a){var b=a.get("el"),g=e.all,b=b[0].cloneNode(!0);b.style.visibility="";b.style.overflow="hidden";b.className+=" "+a.get("prefixCls")+"overlay-ghost";var c;if(c=a.get("body"))a=g("."+a.get("prefixCls")+"stdmod-body",b),a.css({height:c.height(),width:c.width()}),a.html("");return g(b)}function h(a,b,g){a.__effectGhost&&a.__effectGhost.stop(1);var c=a.get("el"),h=e.all,f=a.get("effect"),d=h(f.target),h=f.duration,d=e.mix(d.offset(),{width:d.width(),
height:d.height()}),j=e.mix(c.offset(),{width:c.width(),height:c.height()}),i=k(a),f=f.easing;i.insertAfter(c);c.hide();b?(b=d,d=j):b=j;i.css(b);a.__effectGhost=i;i.animate(d,{duration:h,easing:f,complete:function(){a.__effectGhost=null;i.remove();c.show();g()}})}function i(a,b,g){var c=a.get("el"),f=a.get("effect"),d=f.effect||m,e=f.target;if(d==m&&!e)g();else if(e)h(a,b,g);else{var a=f.duration,f=f.easing,j=c.css("visibility"),e=b?1:0;c.stop(1,1);c.css({visibility:"visible",display:b?"none":"block"});
c[d+l[d][e]](a,function(){c.css({display:"block",visibility:j});g()},f)}}var m="none",l={fade:["Out","In"],slide:["Up","Down"]};return d.Controller.extend([b.ContentBox,b.Position,a,b.Align,c,f,g],{_onSetVisible:function(a){var b=this;b.get("rendered")&&i(b,a,function(){b.fire(a?"show":"hide")})}},{ATTRS:{effect:{value:{effect:"",target:null,duration:0.5,easing:"easeOut"},setter:function(a){var b=a.effect;"string"==typeof b&&!l[b]&&(a.effect="")}},focusable:{value:!1},allowTextSelection:{value:!0},
closable:{value:!1},handleMouseEvents:{value:!1},xrender:{value:j}}},{xclass:"overlay",priority:10})},{requires:"component/base,component/extension,./extension/loading,./extension/close,./extension/resize,./extension/mask,./overlay-render".split(",")});
KISSY.add("overlay/dialog-render",function(e,d,b){return d.extend([b],{createDom:function(){var a=this.get("el"),b,f=this.get("header");if(!(b=f.attr("id")))f.attr("id",b=e.guid("ks-dialog-header"));a.attr("role","dialog").attr("aria-labelledby",b);a.append("<div tabindex='0' style='position:absolute;'></div>")}})},{requires:["./overlay-render","./extension/stdmod-render"]});
KISSY.add("overlay/dialog",function(e,d,b,a,c,f){var g=a.all,j=d.extend([c,f],{initializer:function(){var a=this,b;if((b=a.get("draggable"))&&!b.handlers)b.handlers=[function(){return a.get("header")}]},handleKeyEventInternal:function(b){if(this.get("escapeToClose")&&b.keyCode===a.KeyCodes.ESC){if("select"!=b.target.nodeName.toLowerCase()||b.target.disabled)this.close(),b.halt()}else a:if(b.keyCode==k){var c=this.get("el"),f=g(b.target),d=c.last();if(f.equals(c)&&b.shiftKey)d[0].focus(),b.halt();
else if(f.equals(d)&&!b.shiftKey)c[0].focus(),b.halt();else if(f.equals(c)||c.contains(f))break a;b.halt()}},_onSetVisible:function(a){var b=this.get("el");a?(this.__lastActive=b[0].ownerDocument.activeElement,b[0].focus&&b[0].focus(),b.attr("aria-hidden","false")):(b.attr("aria-hidden","true"),this.__lastActive&&this.__lastActive.focus());j.superclass._onSetVisible.apply(this,arguments)}},{ATTRS:{closable:{value:!0},xrender:{value:b},focusable:{value:!0},escapeToClose:{value:!0}}},{xclass:"dialog",
priority:20}),k=a.KeyCodes.TAB;return j},{requires:["./base","./dialog-render","node","./extension/stdmod","./extension/drag"]});
KISSY.add("overlay/extension/close-render",function(e,d){function b(a){return new d("<a tabindex='0' href='javascript:void(\"\u5173\u95ed\")' role='button' style='z-index:9' class='"+a+c+"close'><span class='"+a+c+"close-x'>\u5173\u95ed</span></a>")}function a(){}var c="ext-";a.ATTRS={closable:{value:!0},closeBtn:{}};a.HTML_PARSER={closeBtn:function(a){return a.one("."+this.get("prefixCls")+c+"close")}};a.prototype={_onSetClosable:function(a){var c=this.get("closeBtn");a?(c||this.setInternal("closeBtn",c=b(this.get("prefixCls"))),
this.get("el").prepend(c)):c&&c.remove()}};return a},{requires:["node"]});
KISSY.add("overlay/extension/close",function(){function e(){}e.ATTRS={closable:{view:1},closeBtn:{view:1},closeAction:{value:"hide"}};var d={hide:"hide",destroy:"destroy"};e.prototype={_onSetClosable:function(b){var a=this;b&&!a.__bindCloseEvent&&(a.__bindCloseEvent=1,a.get("closeBtn").on("click",function(b){a.close();b.preventDefault()}))},close:function(){this[d[this.get("closeAction")]||"hide"]();return this},__destructor:function(){var b=this.get("closeBtn");b&&b.detach()}};return e});
KISSY.add("overlay/extension/drag",function(e){function d(){}d.ATTRS={draggable:{setter:function(b){if(!0===b)return{}},value:{}}};d.prototype={_onSetDraggable:function(b){var a=this,c,f=e.require("dd/base"),g,d,k;d=a.__drag;var h=a.__constrain,i=a.get("el");if(b&&!d&&f){d=f.Draggable;d=a.__drag=new d({node:i,move:1});if(b.proxy&&(c=e.require("dd/proxy")))b.proxy.moveOnEnd=!0,d.plug(new c(b.proxy));d.on("dragend",function(){var b;b=i.offset();a.set("x",b.left);a.set("y",b.top)});(k=b.scroll)&&(g=
e.require("dd/scroll"))&&d.plug(new g(k))}d&&d.set("disabled",!b);if(b&&d){c=b.handlers;if(g=e.require("dd/constrain"))(b=b.constrain)?(h||(h=a.__constrain=new g,d.plug(h)),h.set("constrain",b)):h&&h.set("constrain",!1);c&&0<c.length&&d.set("handlers",c)}},__destructor:function(){var b=this.__drag;b&&b.destroy()}};return d});
KISSY.add("overlay/extension/loading-render",function(e,d){function b(){}b.prototype={loading:function(){this._loadingExtEl||(this._loadingExtEl=(new d("<div class='"+this.get("prefixCls")+"ext-loading' style='position: absolute;border: none;width: 100%;top: 0;left: 0;z-index: 99999;height:100%;*height: expression(this.parentNode.offsetHeight);'/>")).appendTo(this.get("el")));this._loadingExtEl.show()},unloading:function(){var a=this._loadingExtEl;a&&a.hide()}};return b},{requires:["node"]});
KISSY.add("overlay/extension/loading",function(){function e(){}e.prototype={loading:function(){this.get("view").loading();return this},unloading:function(){this.get("view").unloading();return this}};return e});
KISSY.add("overlay/extension/mask-render",function(e,d){function b(a){a=a.get("prefixCls")+"ext-mask "+a.getCssClassWithState("-mask");a=f("<div  style='width:"+(c?"expression(KISSY.DOM.docWidth())":"100%")+";left:0;top:0;height:"+(c?"expression(KISSY.DOM.docHeight())":"100%")+";position:"+(c?"absolute":"fixed")+";' class='"+a+"'>"+(c?"<iframe style='position:absolute;left:0;top:0;background:red;width: expression(this.parentNode.offsetWidth);height: expression(this.parentNode.offsetHeight);filter:alpha(opacity=0);z-index:-1;'></iframe>":
"")+"</div>").prependTo("body");a.unselectable();a.on("mousedown",function(a){a.preventDefault()});return a}function a(){}var c=6===e.UA.ie,f=d.all;a.ATTRS={mask:{value:!1},maskNode:{}};a.prototype={__renderUI:function(){this.get("mask")&&this.set("maskNode",b(this))},__syncUI:function(){this.get("mask")&&this.ksSetMaskVisible(this.get("visible"),1)},ksSetMaskVisible:function(a,b){var c=this.getCssClassWithState("-mask-shown"),d=this.get("maskNode"),f=this.getCssClassWithState("-mask-hidden");a?d.removeClass(f).addClass(c):
d.removeClass(c).addClass(f);b||d.css("visibility",a?"visible":"hidden")},__destructor:function(){var a;(a=this.get("maskNode"))&&a.remove()}};return a},{requires:["node"]});
KISSY.add("overlay/extension/mask",function(e,d){function b(){}b.ATTRS={mask:{view:1},maskNode:{view:1}};var a={fade:["Out","In"],slide:["Up","Down"]};b.prototype={__bindUI:function(){var b=this,f,g,e=b.get("el"),k=b.get("view");if(g=b.get("mask")){f=b.get("maskNode");if(g.hideOnClick)f.on(d.Gesture.tap,function(){b.hide()});b.on("afterVisibleChange",function(b){if(b=b.newVal){var c=parseInt(e.css("z-index"))||1;f.css("z-index",c-1)}c=g.effect||"none";if("none"==c)k.ksSetMaskVisible(b);else{k.ksSetMaskVisible(b,
1);var d=g.duration,l=g.easing,n=b?1:0;f.stop(1,1);f.css("display",b?"none":"block");f[c+a[c][n]](d,null,l)}})}}};return b},{requires:["event"]});KISSY.add("overlay/extension/resize",function(e){function d(){}d.ATTRS={resize:{value:{}}};d.prototype={__destructor:function(){var b=this.resizer;b&&b.destroy()},_onSetResize:function(b){var a=e.require("resizable");this.resizer&&this.resizer.destroy();a&&b&&(b.node=this.get("el"),this.resizer=new a(b))}};return d});
KISSY.add("overlay/extension/stdmod-render",function(e,d){function b(){}function a(a,b){var c=a.get("contentEl"),e=a.get(b);e||(e=new d("<div class='"+a.get("prefixCls")+f+b+"'  ></div>"),e.appendTo(c),a.setInternal(b,e))}function c(a,b,c){b=a.get(b);"string"==typeof c?b.html(c):b.html("").append(c)}var f="stdmod-";b.ATTRS={header:{},body:{},footer:{},bodyStyle:{},footerStyle:{},headerStyle:{},headerContent:{},bodyContent:{},footerContent:{}};b.HTML_PARSER={header:function(a){return a.one("."+this.get("prefixCls")+
f+"header")},body:function(a){return a.one("."+this.get("prefixCls")+f+"body")},footer:function(a){return a.one("."+this.get("prefixCls")+f+"footer")}};b.prototype={__createDom:function(){a(this,"header");a(this,"body");a(this,"footer")},_onSetBodyStyle:function(a){this.get("body").css(a)},_onSetHeaderStyle:function(a){this.get("header").css(a)},_onSetFooterStyle:function(a){this.get("footer").css(a)},_onSetBodyContent:function(a){c(this,"body",a)},_onSetHeaderContent:function(a){c(this,"header",
a)},_onSetFooterContent:function(a){c(this,"footer",a)}};return b},{requires:["node"]});KISSY.add("overlay/extension/stdmod",function(){function e(){}e.ATTRS={header:{view:1},body:{view:1},footer:{view:1},bodyStyle:{view:1},footerStyle:{view:1},headerStyle:{view:1},headerContent:{view:1},bodyContent:{view:1},footerContent:{view:1}};return e});
KISSY.add("overlay/overlay-render",function(e,d,b,a,c,f){return d.Render.extend([b.ContentBox.Render,b.Position.Render,a,6===e.UA.ie?b.Shim.Render:null,c,f])},{requires:["component/base","component/extension","./extension/loading-render","./extension/close-render","./extension/mask-render"]});
KISSY.add("overlay",function(e,d,b,a,c,f){d.Render=b;a.Render=c;d.Dialog=a;e.Dialog=a;d.Popup=f;return e.Overlay=d},{requires:["overlay/base","overlay/overlay-render","overlay/dialog","overlay/dialog-render","overlay/popup"]});
KISSY.add("overlay/popup",function(e,d,b){return d.extend({initializer:function(){var a=this;a.get("trigger")&&("mouse"===a.get("triggerType")?(a._bindTriggerMouse(),a.on("afterRenderUI",function(){a._bindContainerMouse()})):a._bindTriggerClick())},_bindTriggerMouse:function(){var a=this,c=a.get("trigger"),d;a.__mouseEnterPopup=function(c){a._clearHiddenTimer();d=e.later(function(){a._showing(c);d=b},1E3*a.get("mouseDelay"))};c.on("mouseenter",a.__mouseEnterPopup);a._mouseLeavePopup=function(){d&&
(d.cancel(),d=b);a._setHiddenTimer()};c.on("mouseleave",a._mouseLeavePopup)},_bindContainerMouse:function(){this.get("el").on("mouseleave",this._setHiddenTimer,this).on("mouseenter",this._clearHiddenTimer,this)},_setHiddenTimer:function(){var a=this;a._hiddenTimer=e.later(function(){a._hiding()},1E3*a.get("mouseDelay"))},_clearHiddenTimer:function(){this._hiddenTimer&&(this._hiddenTimer.cancel(),this._hiddenTimer=b)},_bindTriggerClick:function(){var a=this;a.__clickPopup=function(b){b.halt();if(a.get("toggle"))a[a.get("visible")?
"_hiding":"_showing"](b);else a._showing(b)};a.get("trigger").on("click",a.__clickPopup)},_showing:function(a){this.set("currentTrigger",e.one(a.target));this.show()},_hiding:function(){this.set("currentTrigger",b);this.hide()},destructor:function(){var a,b=this.get("trigger");b&&(this.__clickPopup&&b.detach("click",this.__clickPopup),this.__mouseEnterPopup&&b.detach("mouseenter",this.__mouseEnterPopup),this._mouseLeavePopup&&b.detach("mouseleave",this._mouseLeavePopup));(a=this.get("el"))&&a.detach("mouseleave",
this._setHiddenTimer,this).detach("mouseenter",this._clearHiddenTimer,this)}},{ATTRS:{trigger:{setter:function(a){return e.all(a)}},triggerType:{value:"click"},currentTrigger:{},mouseDelay:{value:0.1},toggle:{value:!1}}},{xclass:"popup",priority:20})},{requires:["./base"]});
