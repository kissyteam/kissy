/*
Copyright 2012, KISSY UI Library v1.30dev
MIT Licensed
build time: Mar 12 21:14
*/
KISSY.add("overlay/aria",function(c,f){function h(){}h.ATTRS={aria:{view:true}};h.prototype={__bindUI:function(){var g=this,d=g.get("el");g.get("aria")&&d.on("keydown",function(a){if(a.keyCode===f.KeyCodes.ESC){g.hide();a.halt()}})}};return h},{requires:["event"]});
KISSY.add("overlay/ariarender",function(c,f){function h(){}function g(b){var e=b.keyCode,i=this.get("el");if(e==a){e=d(b.target);var j=this.__ariaArchor;if(e.equals(i)&&b.shiftKey){j[0].focus();b.halt()}else if(e.equals(j)&&!b.shiftKey){i[0].focus();b.halt()}else if(e.equals(i)||i.contains(e))return;b.halt()}}var d=f.all,a=f.KeyCodes.TAB;h.prototype={__renderUI:function(){var b=this.get("el"),e=this.get("header");if(this.get("aria")){b.attr("role","dialog");b.attr("tabindex",0);e.attr("id")||e.attr("id",
c.guid("ks-dialog-header"));b.attr("aria-labelledby",e.attr("id"));this.__ariaArchor=d("<div tabindex='0'></div>").appendTo(b)}},__bindUI:function(){var b=this;if(b.get("aria")){var e=b.get("el"),i;b.on("afterVisibleChange",function(j){if(j.newVal){i=e[0].ownerDocument.activeElement;e[0].focus();e.attr("aria-hidden","false");e.on("keydown",g,b)}else{e.attr("aria-hidden","true");e.detach("keydown",g,b);i&&i.focus()}})}}};return h},{requires:["node"]});
KISSY.add("overlay/base",function(c,f,h,g,d){function a(b){return c.require("uibase/"+b)}f=f.create(h.ModelControl,[a("contentbox"),a("position"),a("loading"),a("align"),a("close"),a("resize"),a("mask"),d],{},{ATTRS:{focusable:{value:false},closable:{value:false},handleMouseEvents:{value:false},allowTextSelection_:{value:true},visibleMode:{value:"visibility"}}});f.DefaultRender=g;h.UIStore.setUIByClass("overlay",{priority:h.UIStore.PRIORITY.LEVEL1,ui:f});return f},{requires:["uibase","component",
"./overlayrender","./effect"]});KISSY.add("overlay/dialog",function(c,f,h,g,d,a){c=g.create(h,[c.require("uibase/stdmod"),c.require("uibase/drag"),c.require("uibase/constrain"),a],{},{ATTRS:{closable:{value:true},handlers:{valueFn:function(){var b=this;return[function(){return b.get("view").get("header")}]}}}});c.DefaultRender=d;f.UIStore.setUIByClass("dialog",{priority:f.UIStore.PRIORITY.LEVEL2,ui:c});return c},{requires:["component","overlay/base","uibase","overlay/dialogrender","./aria"]});
KISSY.add("overlay/dialogrender",function(c,f,h,g){return f.create(h,[c.require("uibase/stdmodrender"),g])},{requires:["uibase","./overlayrender","./ariarender"]});
KISSY.add("overlay/effect",function(c){function f(){}var h={fade:["Out","In"],slide:["Up","Down"]},g=["block","none"];f.ATTRS={effect:{value:{effect:"none",duration:0.5,easing:"easeOut"},setter:function(d){var a=d.effect;if(c.isString(a)&&!h[a])d.effect="none"}}};f.prototype={__bindUI:function(){var d=this;d.on("afterVisibleChange",function(a){var b=d.get("effect").effect;if(b!="none"){var e=a.newVal;a=Number(e);var i=d.get("el");i.stop(1,1);i.css({visibility:"visible",display:g[a]});i[b+h[b][a]](d.get("effect").duration,
function(){i.css({display:g[0],visibility:e?"visible":"hidden"})},d.get("effect").easing,false)}})}};return f},{requires:["anim"]});KISSY.add("overlay",function(c,f,h,g,d,a){f.Render=h;g.Render=d;f.Dialog=g;c.Dialog=g;f.Popup=c.Popup=a;return f},{requires:["overlay/base","overlay/overlayrender","overlay/dialog","overlay/dialogrender","overlay/popup"]});
KISSY.add("overlay/overlayrender",function(c,f,h,g){function d(a){return c.require("uibase/"+a)}return h.create(g.Render,[d("contentboxrender"),d("positionrender"),d("loadingrender"),f.ie===6?d("shimrender"):null,d("closerender"),d("maskrender")])},{requires:["ua","uibase","component"]});
KISSY.add("overlay/popup",function(c,f,h,g){function d(a,b){if(c.isUndefined(b))b=a;else b.srcNode=a;d.superclass.constructor.call(this,b)}d.ATTRS={trigger:{setter:function(a){if(c.isString(a))a=c.all(a);return a}},triggerType:{value:"click"},currentTrigger:{},mouseDelay:{value:100},toggle:{value:false}};c.extend(d,h,{initializer:function(){var a=this;if(a.get("trigger"))if(a.get("triggerType")==="mouse"){a._bindTriggerMouse();a.on("bindUI",function(){a._bindContainerMouse()})}else a._bindTriggerClick()},
_bindTriggerMouse:function(){var a=this,b=a.get("trigger"),e;a.__mouseEnterPopup=function(i){a._clearHiddenTimer();e=c.later(function(){a._showing(i);e=g},a.get("mouseDelay"))};c.each(b,function(i){c.one(i).on("mouseenter",a.__mouseEnterPopup)});a._mouseLeavePopup=function(){if(e){e.cancel();e=g}a._setHiddenTimer()};c.each(b,function(i){c.one(i).on("mouseleave",a._mouseLeavePopup)})},_bindContainerMouse:function(){this.get("el").on("mouseleave",this._setHiddenTimer,this).on("mouseenter",this._clearHiddenTimer,
this)},_setHiddenTimer:function(a){var b=this;b._hiddenTimer=c.later(function(){b._hiding(a)},b.get("mouseDelay"))},_clearHiddenTimer:function(){if(this._hiddenTimer){this._hiddenTimer.cancel();this._hiddenTimer=g}},_bindTriggerClick:function(){var a=this;a.__clickPopup=function(b){b.halt();a.get("toggle")?a[a.get("visible")?"_hiding":"_showing"](b):a._showing(b)};c.each(a.get("trigger"),function(b){c.one(b).on("click",a.__clickPopup)})},_showing:function(a){this.set("currentTrigger",c.one(a.target));
this.show()},_hiding:function(){this.set("currentTrigger",g);this.hide()},destructor:function(){var a=this,b=a.get("trigger");if(b){a.__clickPopup&&c.each(b,function(e){c.one(e).detach("click",a.__clickPopup)});a.__mouseEnterPopup&&c.each(b,function(e){c.one(e).detach("mouseenter",a.__mouseEnterPopup)});a._mouseLeavePopup&&c.each(b,function(e){c.one(e).detach("mouseleave",a._mouseLeavePopup)})}a.get("el")&&a.get("el").detach("mouseleave",a._setHiddenTimer,a).detach("mouseenter",a._clearHiddenTimer,
a)}});f.UIStore.setUIByClass("popup",{priority:f.UIStore.PRIORITY.LEVEL1,ui:d});return d},{requires:["component","./base"]});
