/*
Copyright 2011, KISSY UI Library v1.20dev
MIT Licensed
build time: ${build.time}
*/
KISSY.add("overlay/overlayrender",function(e,c,f,d){function a(b){return e.require("uibase/"+b)}return f.create(d.Render,[a("contentboxrender"),a("positionrender"),a("loadingrender"),c.ie==6?a("shimrender"):null,a("maskrender")],{renderUI:function(){this.get("el").addClass(this.get("prefixCls")+"overlay")}},{ATTRS:{prefixCls:{value:"ks-"},elOrder:0}})},{requires:["ua","uibase","component"]});
KISSY.add("overlay/ariarender",function(e){function c(){}function f(a){var b=a.keyCode,g=this.get("el");if(b==d){b=a.target;for(var h=g.all("*"),i=[],k=0;k<h.length;k++){var j=e.one(h[k]),l=false;if(-1!=j[0].tabIndex){if(j[0].nodeName.toLowerCase()=="a")l=true;else if((j[0].nodeName.toLowerCase()=="input"||j[0].nodeName.toLowerCase()=="button")&&!j[0].disabled)l=true;else if(j.hasAttr("tabindex")&&j[0].tabIndex==0)l=true;if(l){l=j[0].tabIndex||0;for(var m=0;m<i.length;m++)if((i[m][0].tabIndex||0)>
l){i.splice(m,0,j);break}m==i.length&&i.push(j)}}}h=i[0];i=i[i.length-1];k=h==i;if(b[0]==h[0]&&a.shiftKey){k||i[0].focus();a.halt()}else if(b[0]==i[0]&&!a.shiftKey){k||h[0].focus();a.halt()}else if(b[0]==g[0]||g.contains(b))return;a.halt()}}var d=9;c.prototype={__renderUI:function(){var a=this.get("el"),b=this.get("header");if(this.get("aria")){a.attr("role","dialog");a.attr("tabindex",0);b.attr("id")||b.attr("id",e.guid("ks-dialog-header"));a.attr("aria-labelledby",b.attr("id"))}},__bindUI:function(){var a=
this;if(a.get("aria")){var b=a.get("el"),g;a.on("afterVisibleChange",function(h){if(h.newVal){g=document.activeElement;b[0].focus();b.attr("aria-hidden","false");b.on("keydown",f,a)}else{b.attr("aria-hidden","true");b.detach("keydown",f,a);g&&g.focus()}})}}};return c});
KISSY.add("overlay/aria",function(){function e(){}e.ATTRS={aria:{view:true}};e.prototype={__bindUI:function(){var c=this,f=c.get("view").get("el");c.get("aria")&&f.on("keydown",function(d){if(d.keyCode===27){c.hide();d.halt()}})}};return e});
KISSY.add("overlay/effect",function(e){function c(){}var f={fade:["Out","In"],slide:["Up","Down"]};c.ATTRS={effect:{value:{effect:"none",duration:0.5,easing:"easeOut"},setter:function(d){var a=d.effect;if(e.isString(a)&&!f[a])d.effect="none"}}};c.prototype={__bindUI:function(){var d=this;d.on("afterVisibleChange",function(a){var b=d.get("effect").effect;if(b!="none"){var g=a.newVal,h=d.get("view").get("el");h.stop(true);h.css("visibility","visible");h[b+f[b][Number(g)]](d.get("effect").duration,function(){h.css("display",
"block");h.css("visibility",g?"visible":"hidden")},d.get("effect").easing,false)}})}};return c},{requires:["anim"]});KISSY.add("overlay/overlay",function(e,c,f,d,a){function b(g){return e.require("uibase/"+g)}c=c.create(f.ModelControl,[b("contentbox"),b("position"),b("loading"),b("align"),b("resize"),b("mask"),a]);c.DefaultRender=d;return c},{requires:["uibase","component","./overlayrender","./effect"]});
KISSY.add("overlay/dialogrender",function(e,c,f,d){return c.create(f,[e.require("uibase/stdmodrender"),e.require("uibase/closerender"),d])},{requires:["uibase","./overlayrender","./ariarender"]});
KISSY.add("overlay/dialog",function(e,c,f,d,a){function b(g){return e.require("uibase/"+g)}c=f.create(c,[b("stdmod"),b("close"),b("drag"),b("constrain"),a],{renderUI:function(){this.get("view").get("el").addClass(this.get("view").get("prefixCls")+"dialog");this.set("handlers",[this.get("view").get("header")])}});c.DefaultRender=d;return c},{requires:["overlay/overlay","uibase","overlay/dialogrender","./aria"]});
KISSY.add("overlay/popup",function(e,c,f){function d(a,b){if(e.isUndefined(b))b=a;else b.srcNode=a;d.superclass.constructor.call(this,b)}d.ATTRS={trigger:null,triggerType:{value:"click"}};e.extend(d,c,{initializer:function(){var a=this;if(a.get("trigger"))a.trigger=e.one(a.get("trigger"));if(a.trigger)if(a.get("triggerType")==="mouse"){a._bindTriggerMouse();a.on("bindUI",function(){a._bindContainerMouse()})}else a._bindTriggerClick()},_bindTriggerMouse:function(){var a=this,b=a.trigger,g;a.__mouseEnterPopup=
function(){a._clearHiddenTimer();g=e.later(function(){a.show();g=f},100)};b.on("mouseenter",a.__mouseEnterPopup);a._mouseLeavePopup=function(){if(g){g.cancel();g=f}a._setHiddenTimer()};b.on("mouseleave",a._mouseLeavePopup)},_bindContainerMouse:function(){this.get("el").on("mouseleave",this._setHiddenTimer,this).on("mouseenter",this._clearHiddenTimer,this)},_setHiddenTimer:function(){var a=this;a._hiddenTimer=e.later(function(){a.hide()},120)},_clearHiddenTimer:function(){if(this._hiddenTimer){this._hiddenTimer.cancel();
this._hiddenTimer=f}},_bindTriggerClick:function(){var a=this;a.__clickPopup=function(b){b.halt();a.show()};a.trigger.on("click",a.__clickPopup)},destructor:function(){if(this.trigger){var a=this.trigger;this.__clickPopup&&a.detach("click",this.__clickPopup);this.__mouseEnterPopup&&a.detach("mouseenter",this.__mouseEnterPopup);this._mouseLeavePopup&&a.detach("mouseleave",this._mouseLeavePopup)}this.get("el")&&this.get("el").detach("mouseleave",this._setHiddenTimer,this).detach("mouseenter",this._clearHiddenTimer,
this)}});return d},{requires:["overlay/overlay"]});KISSY.add("overlay",function(e,c,f,d,a,b){c.Render=f;d.Render=a;c.Dialog=d;e.Overlay=c;e.Dialog=d;c.Popup=e.Popup=b;return c},{requires:["overlay/overlay","overlay/overlayrender","overlay/dialog","overlay/dialogrender","overlay/popup"]});
