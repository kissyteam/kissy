/*
Copyright 2012, KISSY UI Library v1.30dev
MIT Licensed
build time: May 29 14:56
*/
KISSY.add("overlay/aria",function(b,e){function d(){}d.ATTRS={aria:{view:!0}};d.prototype={__bindUI:function(){var a=this,c=a.get("el");if(a.get("aria"))c.on("keydown",function(c){c.keyCode===e.KeyCodes.ESC&&(a.hide(),c.halt())})}};return d},{requires:["event"]});
KISSY.add("overlay/ariaRender",function(b,e){function d(){}function a(a){var b=a.keyCode,d=this.get("el");if(b==f){var b=c(a.target),e=this.__ariaArchor;if(b.equals(d)&&a.shiftKey)e[0].focus(),a.halt();else if(b.equals(e)&&!a.shiftKey)d[0].focus(),a.halt();else if(b.equals(d)||d.contains(b))return;a.halt()}}var c=e.all,f=e.KeyCodes.TAB;d.prototype={__renderUI:function(){var a=this.get("el"),d=this.get("header");this.get("aria")&&(a.attr("role","dialog"),a.attr("tabindex",0),d.attr("id")||d.attr("id",
b.guid("ks-dialog-header")),a.attr("aria-labelledby",d.attr("id")),this.__ariaArchor=c("<div tabindex='0'></div>").appendTo(a))},__bindUI:function(){var c=this;if(c.get("aria")){var b=c.get("el"),d;c.on("afterVisibleChange",function(e){e.newVal?(d=b[0].ownerDocument.activeElement,b[0].focus(),b.attr("aria-hidden","false"),b.on("keydown",a,c)):(b.attr("aria-hidden","true"),b.detach("keydown",a,c),d&&d.focus())})}}};return d},{requires:["node"]});
KISSY.add("overlay/base",function(b,e,d,a){function c(a){return b.require("component/uibase/"+a)}return e.Controller.extend([c("contentbox"),c("position"),c("loading"),c("align"),c("close"),c("resize"),c("mask"),a],{},{ATTRS:{focusable:{value:!1},closable:{value:!1},handleMouseEvents:{value:!1},visibleMode:{value:"visibility"}},DefaultRender:d},{xclass:"overlay",priority:10})},{requires:["component","./overlayRender","./effect"]});
KISSY.add("overlay/dialog",function(b,e,d,a){function c(a){return b.require("component/uibase/"+a)}return e.extend([c("stdmod"),c("drag"),c("constrain"),a],{},{ATTRS:{closable:{value:!0},handlers:{valueFn:function(){var a=this;return[function(){return a.get("view").get("header")}]}}},DefaultRender:d},{xclass:"dialog",priority:20})},{requires:["overlay/base","overlay/dialogRender","./aria"]});
KISSY.add("overlay/dialogRender",function(b,e,d){return e.extend([b.require("component/uibase/stdmodrender"),d])},{requires:["./overlayRender","./ariaRender"]});
KISSY.add("overlay/effect",function(b){function e(){}function d(b,d){var e=b.get("el"),g=b.get("effect"),h=g.effect,j=g.duration,g=g.easing;if(h!=a){var i=d?1:0;e.stop(1,1);e.css({visibility:"visible",display:f[i]});e[h+c[h][i]](j,function(){e.css({display:f[0],visibility:d?"visible":"hidden"})},g)}}var a="none",c={fade:["Out","In"],slide:["Up","Down"]},f=["block","none"];e.ATTRS={effect:{value:{effect:a,duration:0.5,easing:"easeOut"},setter:function(d){var e=d.effect;b.isString(e)&&!c[e]&&(d.effect=
a)}}};e.prototype={__bindUI:function(){var a=this;a.on("hide",function(){d(a,0)});a.on("show",function(){d(a,1)})}};return e},{requires:["anim"]});KISSY.add("overlay",function(b,e,d,a,c,f){e.Render=d;a.Render=c;e.Dialog=a;b.Dialog=a;e.Popup=f;return b.Overlay=e},{requires:["overlay/base","overlay/overlayRender","overlay/dialog","overlay/dialogRender","overlay/popup"]});
KISSY.add("overlay/overlayRender",function(b,e,d){function a(a){return b.require("component/uibase/"+a)}return d.Render.extend([a("contentboxrender"),a("positionrender"),a("loadingrender"),6===e.ie?a("shimrender"):null,a("closerender"),a("maskrender")])},{requires:["ua","component"]});
KISSY.add("overlay/popup",function(b,e,d){return e.extend({initializer:function(){var a=this;a.get("trigger")&&("mouse"===a.get("triggerType")?(a._bindTriggerMouse(),a.on("bindUI",function(){a._bindContainerMouse()})):a._bindTriggerClick())},_bindTriggerMouse:function(){var a=this,c=a.get("trigger"),e;a.__mouseEnterPopup=function(c){a._clearHiddenTimer();e=b.later(function(){a._showing(c);e=d},1E3*a.get("mouseDelay"))};b.each(c,function(c){b.one(c).on("mouseenter",a.__mouseEnterPopup)});a._mouseLeavePopup=
function(){e&&(e.cancel(),e=d);a._setHiddenTimer()};b.each(c,function(c){b.one(c).on("mouseleave",a._mouseLeavePopup)})},_bindContainerMouse:function(){this.get("el").on("mouseleave",this._setHiddenTimer,this).on("mouseenter",this._clearHiddenTimer,this)},_setHiddenTimer:function(){var a=this;a._hiddenTimer=b.later(function(){a._hiding()},1E3*a.get("mouseDelay"))},_clearHiddenTimer:function(){this._hiddenTimer&&(this._hiddenTimer.cancel(),this._hiddenTimer=d)},_bindTriggerClick:function(){var a=this;
a.__clickPopup=function(c){c.halt();if(a.get("toggle"))a[a.get("visible")?"_hiding":"_showing"](c);else a._showing(c)};b.each(a.get("trigger"),function(c){b.one(c).on("click",a.__clickPopup)})},_showing:function(a){this.set("currentTrigger",b.one(a.target));this.show()},_hiding:function(){this.set("currentTrigger",d);this.hide()},destructor:function(){var a=this,c,b=a.get("trigger");b&&(a.__clickPopup&&b.each(function(b){b.detach("click",a.__clickPopup)}),a.__mouseEnterPopup&&b.each(function(b){b.detach("mouseenter",
a.__mouseEnterPopup)}),a._mouseLeavePopup&&b.each(function(b){b.detach("mouseleave",a._mouseLeavePopup)}));(c=a.get("el"))&&c.detach("mouseleave",a._setHiddenTimer,a).detach("mouseenter",a._clearHiddenTimer,a)}},{ATTRS:{trigger:{setter:function(a){b.isString(a)&&(a=b.all(a));return a}},triggerType:{value:"click"},currentTrigger:{},mouseDelay:{value:0.1},toggle:{value:!1}}},{xclass:"popup",priority:20})},{requires:["./base"]});
