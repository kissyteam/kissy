/*
Copyright 2012, KISSY UI Library v1.40dev
MIT Licensed
build time: Jul 3 14:34
*/
KISSY.add("grid/bar",function(e,g,c,d){return g.Container.extend({initializer:function(){for(var b=this.get("children"),a=0;a<b.length;a++){var k=b[a];k instanceof g.Controller||(b[a]=this._createItem(k))}},getItem:function(b){var a=this.get("children"),k=null;e.each(a,function(a){if(a.get("id")===b)return k=a,!1});return k},_createItem:function(b){if(b instanceof g.Controller)return b;b.xtype||(b.xtype="button");var a=d.types[b.xtype],k=null;return k=a?new a(b):new d(b)}},{ATTRS:{focusable:{value:!1},
xrender:{value:c}},BarItem:d},{xclass:"bar",priority:1})},{requires:["component","./barrender","./baritem"]});
KISSY.add("grid/baritem",function(e,g,c){var d=g.Render.extend({renderUI:function(){this.get("el").addClass("ks-inline-block")}}),g=g.Controller.extend({renderUI:function(){var a=this.get("el");a.attr("id")||a.attr("id",e.guid("ks-bar-item"))},bindUI:function(){var a=this.get("listeners"),b;for(b in a)if(a.hasOwnProperty(b)&&e.isFunction(a[b]))this.get("el").on(b,a[b])}},{ATTRS:{listeners:{value:{}},focusable:{value:!1},xrender:{value:d}}},{xclass:"bar-item",priority:1}),d=g.extend({initializer:function(){var a=
this.get("children"),b=this.get("text");a.push(new c({content:b,disabled:this.get("disabled")}))},handleKeyEventInternal:function(a){return a.keyCode==KeyCodes.ENTER&&"keydown"==a.type||a.keyCode==KeyCodes.SPACE&&"keyup"==a.type?this.performActionInternal(a):a.keyCode==KeyCodes.SPACE},performActionInternal:function(){this.fire("click")},_uiSetDisabled:function(a){var b=this.get("children");b[0]&&b[0].set("disabled",a)},_uiSetChecked:function(a){var b=this.get("children");if(b[0])b[0].get("el")[a?
"addClass":"removeClass"]("ks-button-checked")},_uiSetText:function(a){var b=this.get("children");b[0]&&b[0].set("content",a)}},{ATTRS:{checked:{value:!1},text:{value:""}}},{xclass:"bar-item-button",priority:2}),b=g.extend({renderUI:function(){this.get("el").attr("role","separator")}},{xclass:"bar-item-separator",priority:2}),a=g.extend({},{ATTRS:{width:{value:2}}},{xclass:"bar-item-spacer",priority:2}),k=g.extend({_uiSetText:function(a){this.get("el").html(a)}},{ATTRS:{text:{value:""}}},{xclass:"bar-item-text",
priority:2});g.types={button:d,separator:b,spacer:a,text:k};return g},{requires:["component","button"]});KISSY.add("grid/barrender",function(e,g){return g.Render.extend({renderUI:function(){var c=this.get("el");c.attr("role","toolbar");c.attr("id")||c.attr("id",e.guid("ks-bar"))}},"Grid_Bar_Render")},{requires:["component"]});
KISSY.add("grid/base",function(e,g,c,d,b){return g.Container.extend({initializer:function(){var a=this.get("children"),b=null,f=null;this._initHeader();this._initBody();this._initBars();b=this.get("tbar");f=this.get("bbar");b&&a.push(b);a.push(this.get("header"));a.push(this.get("body"));f&&a.push(f);this._initLoadMask()},addColumn:function(a,b){return a=this.get("header").addColumn(a,b)},bindUI:function(){this._bindHeaderEvent();this._bindBodyEvent()},clearSelection:function(){this.get("body").clearSelection()},
removeColumn:function(a){this.get("header").removeColumn(a)},setSelection:function(a){this.get("body").setSelection(a)},setAllSelection:function(){this.get("body").setAllSelection()},showData:function(a){this.get("body").showData(a)},_initHeader:function(){var a=this.get("header");a||(a=new c({columns:this.get("columns"),tableCls:this.get("tableCls"),forceFit:this.get("forceFit"),width:this.get("width")}),this.set("header",a))},_initBody:function(){var a=this.get("body");if(!a){var a=this.getAttrs(),
b={},f=null,c;for(c in a)a.hasOwnProperty(c)&&a[c].toBody&&(b[c]=this.get(c));f=e.merge(b,this.get("bodyConfig"));a=new d(f);this.set("body",a)}},_initBars:function(){var a=this.get("bbar"),b=this.get("tbar");this._initBar(a,"ks-grid-bbar","bbar");this._initBar(b,"ks-grid-tbar","tbar")},_initBar:function(a,b,f){a&&(a.xclass&&(a=g.create(a)),a.set("elCls",b),this.set(f,a));return a},_initLoadMask:function(){var a=this.get("loadMask");a&&!a.show&&(a=new b.LoadMask(this.get("el")),this.set("loadMask",
a))},_bindHeaderEvent:function(){var a=this,b=a.get("header"),f=a.get("body"),c=a.get("store");b.on("afterWidthChange",function(a){a=a.target;a!==b&&f.resetColumnsWidth(a)});b.on("afterSortStateChange",function(a){var b=a.target;a.newVal&&c&&c.sort(b.get("dataIndex"),b.get("sortState"))});b.on("afterVisibleChange",function(a){a=a.target;a!==b&&f.setColumnVisible(a)});b.on("forceFitWidth",function(){a.get("rendered")&&f.resetColumns()});b.on("add",function(){a.get("rendered")&&f.resetColumns()});b.on("remove",
function(){a.get("rendered")&&f.resetColumns()})},_bindBodyEvent:function(){var a=this.get("body"),b=this.get("header");a.on("scroll",function(a){b.scrollTo({left:a.scrollLeft,top:a.scrollTop})})},_uiSetWidth:function(a){this.get("header").set("width",a);this.get("body").set("width",a);this.get("el").addClass("ks-grid-width")},_uiSetHeight:function(a){var b=this.get("header"),f=this.get("tbar"),c=this.get("bbar"),a=a-b.get("el").height();f&&(a-=f.get("el").height()+10);c&&(a-=c.get("el").height()+
10);this.get("body").set("height",a);this.get("rendered")&&(this.get("forceFit")&&b.forceFitColumns(),b.setTableWidth());this.get("el").addClass("ks-grid-height")},_uiSetForceFit:function(a){this.get("header").set("forceFit",a);this.get("body").set("forceFit",a)},_uiSetMultiSelect:function(a){this.get("body").set("multiSelect",a)}},{ATTRS:{header:{},body:{},bodyConfig:{value:{}},checkable:{value:!1},columns:{toBody:!0,value:[]},forceFit:{toBody:!0,value:!1},height:{sync:!0},tableCls:{toBody:!0,value:""},
multiSelect:{toBody:!0,value:!1},stripeRows:{toBody:!0,value:!0},store:{toBody:!0},loadMask:{toBody:!0},width:{toBody:!0,sync:!0},events:{value:"aftershow,cellclick,rowclick,rowcreated,rowremoved,rowselected,rowunselected,scroll".split(",")}}},{xclass:"grid",priority:1})},{requires:["component","./header","./gridbody","./util"]});
KISSY.add("grid/bindable",function(e){function g(){}g.ATTRS={store:{},loadMask:{value:!0}};e.augment(g,{__bindUI:function(){var c=this,d=c.get("store"),b=c.get("loadMask");if(d&&(d.on("beforeload",function(){b&&b.show&&b.show()}),d.on("load",function(a){c.onLoad(a);b&&b.hide&&b.hide()}),d.on("exception",function(a){c.onException(a)}),d.on("addrecords",function(a){c.onAdd(a)}),d.on("removerecords",function(a){c.onRemove(a)}),d.on("updaterecord",function(a){c.onUpdate(a)}),d.on("localsort",function(a){c.onLocalSort(a)}),
d.autoLoad&&d.getCount()))c.onLoad(d.oldParams)},onLoad:function(){},onException:function(){},onAdd:function(){},onRemove:function(){},onUpdate:function(){},onLocalSort:function(){}});return g});
KISSY.add("grid/column",function(e,g,c){var d=g.Render.extend({renderUI:function(){this._setContent()},_getTemplate:function(){var b=this.__attrVals,a=this.get("template");return c(a).render(b)},_setContent:function(){var b=this.get("el"),a=this._getTemplate();b.children().remove();(new e.Node(a)).appendTo(b)},_uiSetTitle:function(){this.get("rendered")&&this._setContent()},_uiSetDraggable:function(){this.get("rendered")&&this._setContent()},_uiSetSortable:function(){this.get("rendered")&&this._setContent()},
_uiSetTemplate:function(){this.get("rendered")&&this._setContent()},_uiSetSortState:function(b){var a=this.get("el");a.removeClass("sort-asc sort-desc");"ASC"===b?a.addClass("sort-asc"):"DESC"===b&&a.addClass("sort-desc")}},{ATTRS:{elTagName:{value:"th"}}}),g=g.Container.extend({_toggleSortState:function(){var b=this.get("sortState");this.set("sortState",b?"ASC"===b?"DESC":"ASC":"ASC")},_uiSetHide:function(b){this.set("visible",!b)},bindUI:function(){var b=this,a=b.get("events");e.each(a,function(a){b.publish(a,
{bubbles:1});b.addTarget(b.get("parent"))})},performActionInternal:function(b){var b=e.one(b.target),a=this.get("prefixCls");b.hasClass(a+"grid-hd-menu-trigger")||this.get("sortable")&&this._toggleSortState();this.fire("click")},show:function(){this.fire("beforeshow");this.set("hide",!1);this.fire("show")},hide:function(){_self.fire("beforehide");this.set("hide",!0);_self.fire("hide")}},{ATTRS:{dataIndex:{view:!0,value:""},draggable:{view:!0,value:!0},editor:{},focusable:{value:!1},hide:{value:!1},
id:{},originWidth:{view:!0},renderer:{},resizeable:{value:!0},sortable:{view:!0,value:!0},sortState:{view:!0,value:null},title:{view:!0,value:"&#160;"},width:{view:!0,value:100},template:{view:!0,value:'<div class="ks-grid-hd-inner"><span class="ks-grid-hd-title">{{title}}</span>{{#if sortable}}<span class="ks-grid-sort-icon">&nbsp;</span>{{/if}}<span class="ks-grid-hd-menu-trigger"></span></div>'},cellTemplate:{value:""},events:{value:"afterWidthChange,afterSortStateChange,afterVisibleChange,click,resize,move".split(",")},
xrender:{value:d}}},{xclass:"grid-hd",priority:1}),d=g.extend({},{ATTRS:{type:{value:"empty"},sortable:{view:!0,value:!1},width:{view:!0,value:null},template:{value:""}}},{xclass:"grid-hd-empty",priority:1});g.Empty=d;return g},{requires:["component","template"]});KISSY.add("grid",function(e,g,c,d,b,a,k,f){g.Bar=c;g.Store=d;g.PaggingBar=b;g.PaggingBar.Number=a;g.Plugins=k;g.Util=f;return g},{requires:"grid/base,grid/bar,grid/store,grid/paggingbar,grid/numberpaggingbar,grid/plugins,grid/util".split(",")});
KISSY.add("grid/gridbody",function(e,g,c,d){var b=g.Render.extend({renderUI:function(){var a=this.get("el"),b=this._getTemplate(),f=null,f=null;(new e.Node(b)).appendTo(a);f=a.one("tbody");this.set("tbodyEl",f,{silent:!0});f=this._createHeaderRow();this.set("headerRowEl",f)},clearData:function(){this.get("tbodyEl").children(".ks-grid-row").remove()},clearRowSelected:function(){this.get("tbodyEl").all(".ks-grid-row").removeClass("ks-grid-row-selected")},findCell:function(a,b){return b.one(".grid-td-"+
a)},findRow:function(a){if(!a)return null;var b=null;this.get("tbodyEl").children(".ks-grid-row").each(function(f){if(f.data("row-element")===a)return b=f,!1});return b},getSelectedRows:function(){return this.get("tbodyEl").all(".ks-grid-row-selected")},getAllRows:function(){return this.get("tbodyEl").all(".ks-grid-row")},isRowSelected:function(a){return e.one(a).hasClass("ks-grid-row-selected")},isRowHover:function(a){return e.one(a).hasClass("ks-grid-row-hover")},removeRow:function(a){(a=this.findRow(a))&&
a.remove();return a},resetHeaderRow:function(){var a=this.get("headerRowEl"),b=this.get("tbodyEl");a.remove();a=this._createHeaderRow();a.prependTo(b);this.set("headerRowEl",a)},setRowSelected:function(a,b){var f=e.one(a);b?f.addClass("ks-grid-row-selected"):f.removeClass("ks-grid-row-selected")},setRowHover:function(a,b){var f=e.one(a);b?f.addClass("ks-grid-row-hover"):f.removeClass("ks-grid-row-hover")},setColumnVisible:function(a){var b=a.get("hide"),a=a.get("id"),a=this.get("tbodyEl").all(".grid-td-"+
a);b?a.hide():a.show()},setColumnsWidth:function(a){var b=this.get("headerRowEl");(b=this.findCell(a.get("id"),b))&&b.width(a.get("width"));this.setTableWidth()},setTableWidth:function(a){this._getColumns();var b=this.get("width"),f=this.get("height"),c=this.get("tbodyEl").parent();this.get("forceFit");this.get("headerRowEl");a=a||this._getColumnsWidth();b&&(b>=a&&(a=b,f&&(a=b-17)),c.width(a))},updateRow:function(a){var b=this,f=b.findRow(a),c=b._getColumns();f&&e.each(c,function(c){b._updateCell(c,
a,f)})},_updateCell:function(a,b,f){f=this.findCell(a.get("id"),f);a=this._getCellText(a,b);f.one(".ks-grid-cell-inner").html(a)},_createRow:function(a,b){var f=this,d=f._getColumns(),g=f.get("tbodyEl"),j=f.get("rowTemplate"),h=0===b%2?"ks-grid-row-odd":"ks-grid-row-even",i=[],l=null;e.each(d,function(b){var k=b.get("dataIndex");i.push(f._getCellTemplate(b,k,a))});i.push(f._getEmptyCellTemplate());j=c(j).render({cellsTemplate:i.join(""),oddCls:h});l=(new e.Node(j)).appendTo(g);l.data("row-element",
a);0===b&&l.addClass("ks-grid-row-first");return l},_createHeaderRow:function(){var a=this,b=a._getColumns(),f=a.get("tbodyEl"),d=a.get("headerRowTemplate");rowEl=null;hideText="";cellsTemplate=[];e.each(b,function(b){cellsTemplate.push(a._getHeaderCellTemplate(b))});cellsTemplate.push(a._getEmptyCellTemplate());d=c(d).render({cellsTemplate:cellsTemplate.join("")});return rowEl=e.Node(d).appendTo(f)},_getColumns:function(){return this.get("columns")},_getColumnsWidth:function(){var a=null,b=0,f=0,
a=this.get("columns");e.each(a,function(a){a.get("hide")||(f+=a.get("width"),b=e.UA.webkit?0:1,f+=b)});return f},_getCellText:function(a,b){var f=a.get("cellTemplate")||this.get("cellTextTemplate"),d=a.get("dataIndex"),e=a.get("renderer"),e=e?e(b[d],b):b[d];return c(f).render({text:e,tips:this._getTips(a,d,b)})},_getCellTemplate:function(a,b,f){var f=this._getCellText(a,f),d=this.get("cellTemplate");return c(d).render({id:a.get("id"),dataIndex:b,cellText:f,hide:a.get("hide")})},_getTips:function(a,
b,f){var a=a.get("showTip"),c="";a&&(c=f[b],e.isFunction(a)&&(c=a(c,f)));return c},_getHeaderCellTemplate:function(a){var b=this.get("headerCellTemplate");return c(b).render({id:a.get("id"),width:a.get("width"),hide:a.get("hide")})},_getEmptyCellTemplate:function(){return'<td class="ks-grid-cell-empty"></td>'},_getTemplate:function(){var a=this.__attrVals,b=this.get("template");return c(b).render(a)}},{ATTRS:{tbodyEl:{},headerRowEl:{}}});return g.Container.extend([d],{bindUI:function(){this._publishEvent();
this._bindScrollEvent();this._bindRowEvent()},clearData:function(){this.get("view").clearData()},clearSelection:function(){var a=this;a.get("view").getSelectedRows().each(function(b){a.onRowSelected(b,!1)})},findCell:function(a,b){var f=null;return(f=b instanceof e.Node?b:this.findRow(b))?this.get("view").findCell(a,f):null},findRow:function(a){return this.get("view").findRow(a)},setColumnVisible:function(a){this.get("view").setColumnVisible(a)},onLoad:function(){this.showData(this.get("store").getResult())},
onAdd:function(a){var a=a.data,b=this.get("store").getCount();this._addData(a,b)},onRemove:function(a){var b=this,f=null;e.each(a.data,function(a){(f=b.get("view").removeRow(a))&&b.fire("rowremoved",{record:a,row:f[0]})})},onUpdate:function(a){a=a.record;this.get("view").updateRow(a)},onLocalSort:function(){this.onLoad()},onRowSelected:function(a,b){var f=this.get("view"),c=null,c=b?"rowselected":"rowunselected";f.setRowSelected(a,b);this.fire(c,{row:a[0],record:a.data("row-element")})},setSelection:function(a){var b=
this,f=b.get("view");a&&(e.isArray(a)||(a=[a]),e.each(a,function(a){if((a=b.findRow(a))&&!f.isRowSelected(a))b.onRowSelected(a,!0)}))},showData:function(a){var b=this,b=this;b.clearData();b._addData(a);b.fire("aftershow")},resetColumns:function(){var a=this.get("store");this.get("view").resetHeaderRow();if(a)this.onLoad()},resetColumnsWidth:function(a){this.get("view").setColumnsWidth(a)},setAllSelection:function(){var a=this;a.get("view").getAllRows().each(function(b){a.onRowSelected(b,!0)})},setTableWidth:function(a){this.get("forceFit")&&
this.resetColumns();this.get("view").setTableWidth(a)},_addData:function(a,b){var b=b||0,f=this;e.each(a,function(a,c){var d=f.get("view")._createRow(a,b+c);f.fire("rowcreated",{record:a,data:a,row:d[0]})})},_bindScrollEvent:function(){var a=this,b=a.get("el");b.on("scroll",function(){var f=b.scrollLeft(),c=b.scrollTop();a.fire("scroll",{scrollLeft:f,scrollTop:c})})},_bindRowEvent:function(){var a=this;a.get("tbodyEl").delegate("click",".ks-grid-row",function(b){a._rowClickEvent(b)})},_publishEvent:function(){var a=
this,b=a.get("parent"),f=a.get("events");b&&e.each(f,function(f){a.publish(f,{bubbles:1});a.addTarget(b)})},_rowClickEvent:function(a){var b=this.get("multiSelect"),f=e.one(a.currentTarget),c=this.get("view"),d=f.data("row-element"),g;g=a.target;g=e.one(g);g=!g?null:g.hasClass("ks-grid-cell")?g:g.parent(".ks-grid-cell");c=c.isRowSelected(f);g&&this.fire("cellclick",{record:d,row:f[0],cell:g[0],field:g.attr("data-column-field"),domTarget:a.target});this.fire("rowclick",{record:d,row:f[0]});if(b)this.onRowSelected(f,
!c);else c||(this.clearSelection(),this.onRowSelected(f,!0))},_uiSetWidth:function(){this.setTableWidth()},_uiSetHeight:function(){this.setTableWidth()}},{ATTRS:{columns:{view:!0,value:[]},tbodyEl:{view:!0},tableCls:{view:!0,value:""},forceFit:{view:!0,value:!1},multiSelect:{value:!1},stripeRows:{view:!0,value:!0},template:{view:!0,value:'<table cellspacing="0" cellpadding="0" class="ks-grid-table {{tableCls}}"><tbody></tbody></table>'},headerRowTemplate:{view:!0,value:'<tr class="ks-grid-header-row">{{cellsTemplate}}</tr>'},
rowTemplate:{view:!0,value:'<tr class="ks-grid-row {{oddCls}}">{{cellsTemplate}}</tr>'},cellTemplate:{view:!0,value:'<td  class="ks-grid-cell grid-td-{{id}}" data-column-id="{{id}}" data-column-field = {{dataIndex}}  {{#if hide}} style="display : none" {{/if}}><div class="ks-grid-cell-inner" >{{cellText}}</div></td>'},cellTextTemplate:{view:!0,value:'<span class="ks-grid-cell-text " title = "{{tips}}">{{text}}</span>'},headerCellTemplate:{view:!0,value:'<td class="grid-td-{{id}}" style=" {{#if width}}width:{{width}}px;{{/if}}height:0;{{#if hide}} display : none {{/if}}"></td>'},
width:{toBody:!0,sync:!0},events:{value:"aftershow,cellclick,rowclick,rowcreated,rowremoved,rowselected,rowunselected,scroll".split(",")},xrender:{value:b}}},{xclass:"grid-body",priority:1})},{requires:["component","template","./bindable"]});
KISSY.add("grid/header",function(e,g,c){var d=g.Render.extend({renderUI:function(){var b=this.get("el"),a=this.get("tableCls"),b=(new e.Node('<table cellspacing="0" class="ks-grid-table" cellpadding="0"><thead><tr></tr></thead></table>')).appendTo(b);b.addClass(a);this.set("tableEl",b)},getContentElement:function(){return this.get("el").one("tr")},scrollTo:function(b){var a=this.get("el");void 0!==b.top&&a.scrollTop(b.top);void 0!==b.left&&a.scrollLeft(b.left)},_setTableWidth:function(b){var a=this.get("width"),
c=this.get("tableEl");a&&(a>b&&(b=a),c.width(b))}},{ATTRS:{emptyCellEl:{},tableEl:{}}});return g.Container.extend({addColumn:function(b,a){var c=0,f=this.get("columns"),b=this._createColumn(b);void 0===a&&(a=f.length,c=this.get("children").length-1);f.splice(a,0,b);this.addChild(b,c);this.fire("add",{column:b,index:a});return b},removeColumn:function(b){var a=this.get("columns"),c=-1,b=e.isNumber(b)?a[b]:b,c=e.indexOf(b,a);a.splice(c,1);this.fire("remove",{column:b,index:c});return this.removeChild(b,
!0)},bindUI:function(){this._bindColumnsEvent()},initializer:function(){var b=this,a=b.get("children"),c=b.get("columns");b._createEmptyColumn();e.each(c,function(f,d){var e=b._createColumn(f);a[d]=e;c[d]=e});a.push(b._createEmptyColumn())},getColumns:function(){return this.get("columns")},getColumnsWidth:function(){var b=this.getColumns(),a=0,c=0;e.each(b,function(b){b.get("hide")||(a+=b.get("width"),c=e.UA.webkit?0:1,a+=c)});return a},getColumnByIndex:function(b){return this.getColumns()[b]},getColumnById:function(b){var a=
this.getColumns(),c=null;e.each(a,function(a){if(a.get("id")===b)return c=a,!1});return c},getColumnIndex:function(b){var a=this.getColumns();return e.indexOf(b,a)},scrollTo:function(b){this.get("view").scrollTo(b)},_bindColumnsEvent:function(){var b=this;b.on("afterWidthChange",function(a){a.target!==b&&b.setTableWidth()});b.on("afterVisibleChange",function(a){a.target!==b&&b.setTableWidth()});b.on("afterSortStateChange",function(a){var c=a.target,f=b.getColumns();a.newVal&&e.each(f,function(a){a!==
c&&a.set("sortState","")})})},_createColumn:function(b){if(b instanceof c)return b;b.id||(b.id=e.guid("col"));return new c(b)},_createEmptyColumn:function(){return new c.Empty},_isAllowScrollLeft:function(){var b=this.get("parent");return b&&b.get("height")?!0:!1},forceFitColumns:function(){var b=this.getColumns(),a=this.get("width"),c=0,f=this._isAllowScrollLeft(),d=0,g=1,j=null,h=0,i=0,l=i=i=0;a&&(e.each(b,function(a){var b=a.get("originWidth")||a.get("width");!a.get("hide")&&b&&(l+=b,a.get("resizeable")||
(c+=a.get("width")),h++)}),i=e.UA.webkit?0:1*h,i=(f?17:0)+i,g=(a-i-c)/(l-c),1!==g&&(e.each(b,function(a){if(!a.get("hide")&&a.get("resizeable")){var b=a.get("originWidth")||a.get("width"),b=Math.floor(b*g);a.set("width",b,{silent:!0});a.get("el").width(b);a.set("originWidth",b,{silent:!0});d+=b;j=a}}),i=a-(d+i+c),h&&j&&(b=j.get("width")+i,j.set("width",b,{silent:!0}),j.get("el").width(b))),this.fire("forceFitWidth"))},setTableWidth:function(){var b=this.getColumnsWidth();this.get("forceFit")&&this.forceFitColumns();
this._isAllowScrollLeft()&&(b+=17);this.get("view")._setTableWidth(b)},_uiSetWidth:function(){this.setTableWidth()},_uiSetForceFit:function(b){b&&this.setTableWidth()}},{ATTRS:{activeItem:{value:null},columns:{value:[]},emptyColumn:{},focusable:{value:!1},forceFit:{view:!0,value:!1},width:{view:!0},tableCls:{view:!0,value:"ks-grid-table"},xrender:{value:d},events:{value:["add","remove"]}}},{xclass:"grid-header",priority:1})},{requires:["component","./column"]});
KISSY.add("grid/numberpaggingbar",function(e,g,c,d){g=c.extend({_getItems:function(){var b=this.get("items"),a=null;if(b)return b;b=[];b.push(this._getButtonItem(c.ID_PREV));a=new d({id:"numberContainer",elCls:"ks-inline-block"});b.push(a);this.set("numberContainer",a);b.push(this._getButtonItem(c.ID_NEXT));b.push(this._getTextItem(c.ID_TOTAL_PAGE));b.push(this._getTextItem(c.ID_CURRENT_PAGE));b.push(this._getButtonItem(c.ID_SKIP));return b},_bindButtonEvent:function(){var b=this,a=b.get("numberContainer");
b.constructor.superclass._bindButtonEvent.call(this);a.get("el").delegate("click",".ks-number-button",function(a){a=e.one(a.target);a=parseInt(a.text(),10);b.skipToPage(a)})},_setNumberPages:function(){this.constructor.superclass._setNumberPages.call(this);this._setNumberButtons()},_setNumberButtons:function(){var b=this,a=b.get("numberContainer"),c=b.get("curPage"),f=b.get("totalPage"),f=b._getNumberItems(c,f),d=null;a.removeChildren(!0);e.each(f,function(c){a.addChild(b._createItem(c))});(d=a.getItem(c))&&
d.set("checked",!0)},_getNumberItems:function(b,a){function c(a,b){for(var e=a;e<=b;e++)d.push(f._getNumberItem(e))}var f=this,d=[],e=f.get("maxLimitCount"),g=f.get("showRangeCount");if(a<e)e=a,c(1,a);else{var h=b<=e?1:b-g,g=b+g,g=g<a?g>e?g:e:a;1<h&&(c(1,1),2<h&&d.push(f._getEllipsisItem()));e=g;c(h,g)}e<a&&(e<a-1&&d.push(f._getEllipsisItem()),c(a,a));return d},_getEllipsisItem:function(){return{xtype:"text",text:this.get("ellipsisTemplate")}},_getNumberItem:function(b){return{id:b,xtype:"button",
text:""+b+"",elCls:this.get("numberButtonCls")}}},{ATTRS:{skipText:{value:"\u786e\u5b9a"},maxLimitCount:{value:4},showRangeCount:{value:1},numberButtonCls:{value:"ks-number-button"},ellipsisTemplate:{value:"..."},curPageTemplate:{value:'\u5230\u7b2c <input type="text" autocomplete="off" class="ks-pb-page" size="20" name="inputItem"> \u9875'}}},{xclass:"number-paggingbar",priority:3});return c.Number=g},{requires:["component","./paggingbar","./bar"]});
KISSY.add("grid/paggingbar",function(e,g,c,d){return c.extend([d],{initializer:function(){var b=this,a=b.get("children"),c=b._getItems(),f=b.get("store");e.each(c,function(c){a.push(b._createItem(c))});f&&f.pageSize&&b.set("pageSize",f.pageSize)},bindUI:function(){this._bindButtonEvent()},skipToPage:function(b){if(!(0>=b||b>this.get("totalPage"))){var a=this.get("store"),c=this.get("pageSize"),f=b-1,d=f*c,b=this.fire("beforepagechange",{from:this.get("curPage"),to:b});a&&!1!==b&&a.load({start:d,limit:c,
pageIndex:f})}},_afterStoreLoad:function(b,a){var c=this.get("pageSize"),f=0,d=0,e=0,g=1,h=1,f=a?a.start||0:0,e=b.getTotalCount(),d=e-f>c?f+b.getCount():e,h=parseInt((e+c-1)/c,10),h=0<h?h:1,g=parseInt(f/c,10)+1;this.set("start",f);this.set("end",d);this.set("totalCount",e);this.set("curPage",g);this.set("totalPage",h);this._setAllButtonsState();this._setNumberPages()},_bindButtonEvent:function(){function b(){var b=parseInt(a._getCurrentPageValue(),10);a._isPageAllowRedirect(b)?a.skipToPage(b):a._setCurrentPageValue(a.get("curPage"))}
var a=this;a._bindButtonItemEvent("first",function(){a.skipToPage(1)});a._bindButtonItemEvent("prev",function(){a.skipToPage(a.get("curPage")-1)});a._bindButtonItemEvent("next",function(){a.skipToPage(a.get("curPage")+1)});a._bindButtonItemEvent("last",function(){a.skipToPage(a.get("totalPage"))});a._bindButtonItemEvent("skip",function(){b()});a.getItem("curPage").get("el").on("keyup",function(a){a.stopPropagation();13===a.keyCode&&b()})},_bindButtonItemEvent:function(b,a){var c=this.getItem(b);if(c)c.get("el").on("click",
a)},onLoad:function(b){this._afterStoreLoad(this.get("store"),b)},_getItems:function(){var b=this.get("items");if(b)return b;b=[];b.push(this._getButtonItem("first"));b.push(this._getButtonItem("prev"));b.push(this._getSeparator());b.push(this._getTextItem("totalPage"));b.push(this._getTextItem("curPage"));b.push(this._getButtonItem("skip"));b.push(this._getSeparator());b.push(this._getButtonItem("next"));b.push(this._getButtonItem("last"));b.push(this._getSeparator());b.push(this._getTextItem("totalCount"));
return b},_getButtonItem:function(b){return{id:b,xtype:"button",text:this.get(b+"Text"),disabled:!0,elCls:this.get(b+"Cls")}},_getSeparator:function(){return{xtype:"separator"}},_getTextItem:function(b){return{id:b,xtype:"text",text:this._getTextItemTemplate(b)}},_getTextItemTemplate:function(b){var a={};a[b]=this.get(b);return e.substitute(this.get(b+"Template"),a)},_isPageAllowRedirect:function(b){return b&&0<b&&b<=this.get("totalPage")&&b!==this.get("curPage")},_setAllButtonsState:function(){this.get("store")&&
this._setButtonsState(["prev","next","first","last","skip"],!0);1===this.get("curPage")&&this._setButtonsState(["prev","first"],!1);this.get("curPage")===this.get("totalPage")&&this._setButtonsState(["next","last"],!1)},_setButtonsState:function(b,a){var c=this.get("children");e.each(c,function(c){"button"===c.get("xtype")&&e.inArray(c.get("id"),b)&&c.set("disabled",!a)})},_setNumberPages:function(){var b=this.getItem("totalPage");this.getItem("curPage");var a=this.getItem("totalCount");b&&b.set("html",
this._getTextItemTemplate("totalPage"));this._setCurrentPageValue(this.get("curPage"));a&&a.set("html",this._getTextItemTemplate("totalCount"))},_getCurrentPageValue:function(){var b=b||this.getItem("curPage");return b.get("el").one("input").val()},_setCurrentPageValue:function(b,a){a=a||this.getItem("curPage");a.get("el").one("input").val(b)}},{ATTRS:{firstText:{value:"\u9996 \u9875"},fistCls:{value:"ks-pb-first"},prevText:{value:"\u4e0a\u4e00\u9875"},prevCls:{value:"ks-pb-prev"},nextText:{value:"\u4e0b\u4e00\u9875"},nextCls:{value:"ks-pb-next"},
lastText:{value:"\u672b \u9875"},lastCls:{value:"ks-pb-last"},skipText:{value:"\u8df3 \u8f6c"},skipCls:{value:"ks-pb-skip"},totalPageTemplate:{value:"\u5171 {totalPage} \u9875"},curPageTemplate:{value:'\u7b2c <input type="text" autocomplete="off" class="ks-pb-page" size="20" name="inputItem"> \u9875'},totalCountTemplate:{value:"\u5171{totalCount}\u6761\u8bb0\u5f55"},curPage:{value:0},totalPage:{value:0},totalCount:{value:0},pageSize:{value:30},store:{}},ID_FIRST:"first",ID_PREV:"prev",ID_NEXT:"next",ID_LAST:"last",ID_SKIP:"skip",ID_TOTAL_PAGE:"totalPage",
ID_CURRENT_PAGE:"curPage",ID_TOTAL_COUNT:"totalCount"},{xclass:"paggingbar",priority:2})},{requires:["component","./bar","./bindable"]});
KISSY.add("grid/plugins",function(e){function g(c){g.superclass.constructor.call(this,c)}e.extend(g,e.Base);g.ATTRS={width:{value:40},column:{},cellInner:{value:'<span class="ks-grid-checkBox-container"><input  class="ks-grid-checkBox" type="checkbox"></span>'}};e.augment(g,{initializer:function(c){var b={title:"",width:this.get("width"),resizeable:!1,sortable:!1,template:'<div class="ks-grid-hd-inner">'+this.get("cellInner")+"</div>",cellTemplate:this.get("cellInner")},b=c.addColumn(b,0);c.set("multiSelect",
!0);this.set("column",b)},bindUI:function(c){var b=this,a=b.get("column").get("el").one(".ks-grid-checkBox");a.on("click",function(){var b=a.attr("checked");a.attr("checked",b);b?c.setAllSelection():c.clearSelection()});c.on("rowselected",function(a){b._setRowChecked(a.row,!0)});c.on("rowunselected",function(c){b._setRowChecked(c.row,!1);a.attr("checked",!1)})},_setRowChecked:function(c,b){e.one(c).one(".ks-grid-checkBox").attr("checked",b)}});var c=function(d){c.superclass.constructor.call(this,
d)};e.extend(c,e.Base);c.ATTRS={width:{value:40},column:{},cellInner:{value:'<span class="ks-grid-radio-container"><input  class="ks-grid-radio" type="radio"></span>'}};e.augment(c,{initializer:function(c){var b={title:"",width:this.get("width"),resizeable:!1,sortable:!1,cellTemplate:this.get("cellInner")},b=c.addColumn(b,0);c.set("multiSelect",!1);this.set("column",b)},bindUI:function(c){var b=this;c.on("rowselected",function(a){b._setRowChecked(a.row,!0)});c.on("rowunselected",function(a){b._setRowChecked(a.row,
!1)})},_setRowChecked:function(c,b){e.one(c).one(".ks-grid-radio").attr("checked",b)}});return{CheckSelection:g,RadioSelection:c}});
KISSY.add("grid/store",function(e){function g(c){c=c||{};c=e.merge({root:"rows",totalProperty:"results",dataType:"json",autoLoad:!1,sortInfo:{field:"",direction:"ASC"},proxy:{method:"post",url:""},params:{},remoteSort:!1,matchFunction:function(c,b){return c===b},compareFunction:function(c,b){void 0===c&&(c="");void 0===b&&(b="");return e.isString(c)?c.localeCompare(b):c>b?1:c===b?0:-1}},c);e.mix(this,c);e.mix(this,{hasLoad:!1,resultRows:[],newRecords:[],modifiedRecords:[],deletedRecords:[],rowCount:0,
totalCount:0});this.events="acceptchanges,load,beforeload,beforeProcessLoad,addrecords,exception,removerecords,updaterecord,localsort".split(",");this._init()}e.augment(g,e.EventTarget);e.augment(g,{acceptChanges:function(){this._clearChanges();this.fire("acceptchanges")},add:function(c,d,b){var a=this,g=[],b=b||a._getDefaultMatch();e.isArray(c)||(c=[c]);e.each(c,function(c){if(!d||!a.contains(c,b))a._addRecord(c),g.push(c),a.newRecords.push(c),a._removeFrom(c,a.deletedRecords),a._removeFrom(c,a.modifiedRecords)});
a.fire("addrecords",{data:g})},clear:function(){this.setResult([])},compare:function(c,d,b,a){b=b||this.sortInfo.field;a=a||this.sortInfo.direction;return!b||!a?1:this.compareFunction(c[b],d[b])*("ASC"===a?1:-1)},contains:function(c,d){return-1!==this.findIndexBy(c,d)},findIndexBy:function(c,d){var b=-1,a=this.resultRows,d=d||this._getDefaultMatch();if(e.isUndefined(c)||e.isNull(c))return-1;e.each(a,function(a,f){if(d(c,a))return b=f,!1});return b},find:function(c,d){var b=null;e.each(this.resultRows,
function(a){if(a[c]===d)return b=a,!1});return b},findByIndex:function(c){return this.resultRows[c]},findAll:function(c,d){var b=[];e.each(this.resultRows,function(a){a[c]===d&&b.push(a)});return b},findNextRecord:function(c){c=this.findIndexBy(c);if(0<=c)return this.findByIndex(c+1)},load:function(c){this._loadData(c)},getResult:function(){return this.resultRows},getCount:function(){return this.resultRows.length},getNewRecords:function(){return this.newRecords},getModifiedRecords:function(){return this.modifiedRecords},
getDeletedRecords:function(){return this.deletedRecords},getTotalCount:function(){return this.totalCount},remove:function(c,d){var b=this,a=[],d=d||b._getDefaultMatch();e.isArray(c)||(c=[c]);e.each(c,function(c){c=b.findIndexBy(c,d);c=b._removeAt(c);!e.inArray(c,b.newRecords)&&!e.inArray(c,b.deletedRecords)&&b.deletedRecords.push(c);b._removeFrom(c,b.newRecords);b._removeFrom(c,b.modifiedRecords);a.push(c)});b.fire("removerecords",{data:a})},setResult:function(c){this.resultRows=c=c||[];this.totalCount=
this.rowCount=c.length;this._sortData();this.fire("load",this.oldParams)},setValue:function(c,d,b,a){var g=c,f=null,f=null;a&&(f=this._getDefaultMatch(),f=this.findIndexBy(c,f),0<=f&&(g=this.resultRows[f]));g[d]=b;!e.inArray(g,this.newRecords)&&!e.inArray(g,this.modifiedRecords)&&this.modifiedRecords.push(g);this.fire("updaterecord",{record:g,field:d,value:b})},sort:function(c,d){this.sortInfo.field=c||this.sortInfo.field;this.sortInfo.direction=d||this.sortInfo.direction;if(this.remoteSort){var b=
this.proxy.memeryData;b&&this._sortData(c,d,b);this.load()}else this._sortData(c,d),this.fire("localsort",{field:c,direction:d})},update:function(c,d){var b=c,a=null,a=null;d&&(a=this._getDefaultMatch(),a=this.findIndexBy(c,a),0<=a&&(b=this.resultRows[a]));b=e.mix(b,c);!e.inArray(b,this.newRecords)&&!e.inArray(b,this.modifiedRecords)&&this.modifiedRecords.push(b);this.fire("updaterecord",{record:b})},_addRecord:function(c,d){var b=this.resultRows;e.isUndefined(d)&&(d=b.length);b[d]=c},_clearChanges:function(){this.newRecords.splice(0);
this.modifiedRecords.splice(0);this.deletedRecords.splice(0)},_loadData:function(c){var d=this,b=c||{},c=null;d.fire("beforeload");b=e.merge(d.oldParams,d.sortInfo,b);d.oldParams=b;d.proxy.url?(c="post"===d.proxy.method?b:b?e.param(b):"",e.ajax({cache:!1,url:d.proxy.url,dataType:d.dataType,type:d.proxy.method,data:c,success:function(a){d.fire("beforeProcessLoad",{data:a});var c=[],f=0,g=0;if(a.hasError)d.resultRows=c,d.rowCount=f,d.totalCount=g,d.fire("exception",{error:a.error});else{e.isString(a)&&
(a=e.json.parse(a));if(e.isArray(a)||e.isObject(a))e.isArray(a)?(c=a,g=f=c.length):a&&((c=a[d.root])||(c=[]),f=c.length,g=parseInt(a[d.totalProperty],10));d.resultRows=c;d.rowCount=f;d.totalCount=g;d.remoteSort||d._sortData();d.fire("load",b);d._clearChanges()}},error:function(a,b,c){d.resultRows=[];d.rowCount=0;d.totalCount=0;d.fire("exception",{error:b,responseText:c.responseText})}})):d._loadByMemery(b)},_loadByMemery:function(c){var d=this.proxy.memeryData,b=[],a=[];d&&(b=c.filter?e.filter(d,
c.filter):d,c.start=c.start||0,c.limit=c.limit||this.pageSize,a=c.limit?b.slice(c.start,c.start+c.limit):b,this._setResult(a,a.length,b.length),this.remoteSort||this._sortData(),this.fire("load",c))},_removeAt:function(c,d){if(!(0>c)){var b=d||this.resultRows,a=b[c];b.splice(c,1);return a}},_removeFrom:function(c,d){var b=e.indexOf(c,d);0<=b&&this._removeAt(b,d)},_setResult:function(c,d,b){this.resultRows=c;this.rowCount=d;this.totalCount=b},_sortData:function(c,d,b){var a=this,b=b||a.resultRows,
c=c||a.sortInfo.field,d=d||a.sortInfo.direction;c&&d&&b.sort(function(b,f){return a.compare(b,f,c,d)})},_getDefaultMatch:function(){return this.matchFunction},_init:function(){this.oldParams=this.params||{};this.proxy.url||(this.proxy.url=this.url);this.resultRows=[];this.autoLoad&&this.load()}});return g});
KISSY.add("grid/util",function(e){function g(a){return 10>a?"0"+a:a}function c(a,b){this.el=a;c.superclass.constructor.call(this,b);this._init()}var d=e.DOM,b=e.UA,a={maskElement:function(a,c,g){var a=e.one(a),m=a.getDOMNode(),j=e.one(".ks-ext-mask",m),h=null,i=h=null,l=null;if(!j&&(j=e.one(d.create('<div class="ks-ext-mask"></div>')).appendTo(m),a.addClass("x-masked-relative x-masked"),6===b.ie&&j.height(a.height()),c)){h=['<div class="ks-ext-mask-msg"><div>',c,"</div></div>"].join("");h=e.one(d.create(h)).appendTo(m);
g&&h.addClass(g);try{i=(a.height()-h.height())/2,l=(a.width()-h.width())/2,h.css({left:l,top:i})}catch(n){}}return j},unmaskElement:function(a){var a=e.one(a),b=a.children(".ks-ext-mask-msg"),c=a.children(".ks-ext-mask");b&&b.remove();c&&c.remove();a.removeClass("x-masked-relative x-masked")},Format:{dateRenderer:function(a){if(!a)return"";if(e.isString(a))return a;var b=null;try{b=new Date(a)}catch(c){return""}return!b||!b.getFullYear?"":b.getFullYear()+"-"+g(b.getMonth()+1)+"-"+g(b.getDate())},
datetimeRenderer:function(a){if(!a)return"";if(e.isString(a))return a;var b=null;try{b=new Date(a)}catch(c){return""}return!b||!b.getFullYear?"":b.getFullYear()+"-"+g(b.getMonth()+1)+"-"+g(b.getDate())+" "+g(b.getHours())+":"+g(b.getMinutes())+":"+g(b.getSeconds())},cutTextRenderer:function(a){return function(b){b=b||"";return b.toString().length>a?b.toString().substring(0,a)+"...":b}},enumRenderer:function(a){return function(b){return a[b]||""}},multipleItemsRenderer:function(a){var b=Grid.Util.Format.enumRenderer(a);
return function(a){var c=[];if(!a)return"";e.isArray(a)&&(a=a.toString().split(","));e.each(a,function(a){c.push(b(a))});return c.join(",")}},moneyCentRenderer:function(a){e.isString(a)&&(a=parseFloat(a));return e.isNumber(a)?(0.01*a).toFixed(2):a}}};e.extend(c,e.Base);e.augment(c,{msg:"Loading...",msgCls:"x-mask-loading",disabled:!1,_init:function(){this.msg=this.get("msg")||this.msg},disable:function(){this.disabled=!0},enable:function(){this.disabled=!1},onLoad:function(){a.unmaskElement(this.el)},
onBeforeLoad:function(){this.disabled||a.maskElement(this.el,this.msg,this.msgCls)},show:function(){this.onBeforeLoad()},hide:function(){this.onLoad()},destroy:function(){this.el=null}});a.LoadMask=c;return a});
