/*
Copyright 2012, KISSY UI Library v1.30dev
MIT Licensed
build time: Jun 19 16:20
*/
KISSY.add("grid/bar",function(f,g,d,c){return g.define(g.Container,{initializer:function(){for(var a=this.get("children"),b=0;b<a.length;b++){var e=a[b];e instanceof g.Controller||(a[b]=this._createItem(e))}},getItem:function(a){var b=this.get("children"),e=null;f.each(b,function(b){if(b.get("id")===a)return e=b,!1});return e},_createItem:function(a){if(a instanceof g.Controller)return a;a.xtype||(a.xtype="button");var b=c.types[a.xtype],e=null;return e=b?new b(a):new c(a)}},{ATTRS:{focusable:{value:!1},
xrender:{value:d}},BarItem:c},{xclass:"bar",priority:1})},{requires:["component","./barrender","./baritem"]});
KISSY.add("grid/baritem",function(f,g,d){var c=g.define(g.Render,{renderUI:function(){this.get("el").addClass("ks-inline-block")}}),c=g.define(g.Controller,{renderUI:function(){var a=this.get("el");a.attr("id")||a.attr("id",f.guid("ks-bar-item"))},bindUI:function(){var a=this.get("listeners"),b;for(b in a)if(a.hasOwnProperty(b)&&f.isFunction(a[b]))this.get("el").on(b,a[b])}},{ATTRS:{listeners:{value:{}},focusable:{value:!1},xrender:{value:c}}},{xclass:"bar-item",priority:1}),a=g.define(c,{initializer:function(){var a=
this.get("children"),b=this.get("text");a.push(new d({content:b,disabled:this.get("disabled")}))},handleKeyEventInternal:function(a){return a.keyCode==KeyCodes.ENTER&&"keydown"==a.type||a.keyCode==KeyCodes.SPACE&&"keyup"==a.type?this.performActionInternal(a):a.keyCode==KeyCodes.SPACE},performActionInternal:function(){this.fire("click")},_uiSetDisabled:function(a){var b=this.get("children");b[0]&&b[0].set("disabled",a)},_uiSetChecked:function(a){var b=this.get("children");if(b[0])b[0].get("el")[a?
"addClass":"removeClass"]("ks-button-checked")},_uiSetText:function(a){var b=this.get("children");b[0]&&b[0].set("content",a)}},{ATTRS:{checked:{value:!1},text:{value:""}}},{xclass:"bar-item-button",priority:2}),b=g.define(c,{renderUI:function(){this.get("el").attr("role","separator")}},{xclass:"bar-item-separator",priority:2}),e=g.define(c,{},{ATTRS:{width:{value:2}}},{xclass:"bar-item-spacer",priority:2}),g=g.define(c,{_uiSetText:function(a){this.get("el").html(a)}},{ATTRS:{text:{value:""}}},{xclass:"bar-item-text",
priority:2});c.types={button:a,separator:b,spacer:e,text:g};return c},{requires:["component","button"]});KISSY.add("grid/barrender",function(f,g){return g.define(g.Render,{renderUI:function(){var d=this.get("el");d.attr("role","toolbar");d.attr("id")||d.attr("id",f.guid("ks-bar"))}},"Grid_Bar_Render")},{requires:["component"]});
KISSY.add("grid/base",function(f,g,d,c){return g.Container.extend({initializer:function(){var a=this.get("children"),b=null,e=null;this._initHeader();this._initBody();this._initBars();b=this.get("tbar");e=this.get("bbar");b&&a.push(b);a.push(this.get("header"));a.push(this.get("body"));e&&a.push(e)},addColumn:function(a,b){return a=this.get("header").addColumn(a,b)},bindUI:function(){this._bindHeaderEvent();this._bindBodyEvent()},clearSelection:function(){this.get("body").clearSelection()},removeColumn:function(a){this.get("header").removeColumn(a)},
setSelection:function(a){this.get("body").setSelection(a)},setAllSelection:function(){this.get("body").setAllSelection()},showData:function(a){this.get("body").showData(a)},_initHeader:function(){var a=this.get("header");a||(a=new d({columns:this.get("columns"),tableCls:this.get("tableCls"),forceFit:this.get("forceFit"),width:this.get("width")}),this.set("header",a))},_initBody:function(){var a=this.get("body");if(!a){var a=this.getAttrs(),b={},e=null,l;for(l in a)a.hasOwnProperty(l)&&a[l].toBody&&
(b[l]=this.get(l));e=f.merge(b,this.get("bodyConfig"));a=new c(e);this.set("body",a)}},_initBars:function(){var a=this.get("bbar"),b=this.get("tbar");this._initBar(a,"ks-grid-bbar","bbar");this._initBar(b,"ks-grid-tbar","tbar")},_initBar:function(a,b,e){a&&(a.xclass&&(a=g.create(a)),a.set("elCls",b),this.set(e,a));return a},_bindHeaderEvent:function(){var a=this,b=a.get("header"),e=a.get("body"),c=a.get("store");b.on("afterWidthChange",function(a){a=a.target;a!==b&&e.resetColumnsWidth(a)});b.on("afterSortStateChange",
function(a){var b=a.target;a.newVal&&c&&c.sort(b.get("dataIndex"),b.get("sortState"))});b.on("afterVisibleChange",function(a){a=a.target;a!==b&&e.setColumnVisible(a)});b.on("forceFitWidth",function(){a.get("rendered")&&e.resetColumns()});b.on("add",function(){a.get("rendered")&&e.resetColumns()});b.on("remove",function(){a.get("rendered")&&e.resetColumns()})},_bindBodyEvent:function(){var a=this.get("body"),b=this.get("header");a.on("scroll",function(a){b.scrollTo({left:a.scrollLeft,top:a.scrollTop})})},
_uiSetWidth:function(a){this.get("header").set("width",a);this.get("body").set("width",a);this.get("el").addClass("ks-grid-width")},_uiSetHeight:function(a){var b=this.get("header"),e=this.get("tbar"),c=this.get("bbar"),a=a-b.get("el").height();e&&(a-=e.get("el").height()+10);c&&(a-=c.get("el").height()+10);this.get("body").set("height",a);this.get("rendered")&&(this.get("forceFit")&&b.forceFitColumns(),b.setTableWidth());this.get("el").addClass("ks-grid-height")},_uiSetForceFit:function(a){this.get("header").set("forceFit",
a);this.get("body").set("forceFit",a)},_uiSetMultiSelect:function(a){this.get("body").set("multiSelect",a)}},{ATTRS:{header:{},body:{},bodyConfig:{value:{}},checkable:{value:!1},columns:{toBody:!0,value:[]},forceFit:{toBody:!0,value:!1},height:{sync:!0},tableCls:{toBody:!0,value:""},multiSelect:{toBody:!0,value:!1},stripeRows:{toBody:!0,value:!0},store:{toBody:!0},loadMask:{toBody:!0},width:{toBody:!0,sync:!0},events:{value:["aftershow","rowcreated","rowremoved"]}}},{xclass:"grid",priority:1})},{requires:["component",
"./header","./gridbody"]});
KISSY.add("grid/bindable",function(f){function g(){}g.ATTRS={store:{},loadMask:{value:!0}};f.augment(g,{__bindUI:function(){var d=this,c=d.get("store"),a=d.get("loadMask");if(c&&(c.on("beforeload",function(){a&&a.show&&a.show()}),c.on("load",function(b){d.onLoad(b);a&&a.hide&&a.hide()}),c.on("exception",function(a){d.onException(a)}),c.on("addrecords",function(a){d.onAdd(a)}),c.on("removerecords",function(a){d.onRemove(a)}),c.on("updaterecord",function(a){d.onUpdate(a)}),c.on("localsort",function(a){d.onLocalSort(a)}),
c.autoLoad&&c.getCount()))d.onLoad(c.oldParams)},onLoad:function(){},onException:function(){},onAdd:function(){},onRemove:function(){},onUpdate:function(){},onLocalSort:function(){}});return g});
KISSY.add("grid/column",function(f,g,d){var c=g.define(g.Render,{renderUI:function(){this._setContent()},_getTemplate:function(){var a=this.__attrVals,b=this.get("template");return d(b).render(a)},_setContent:function(){var a=this.get("el"),b=this._getTemplate();a.children().remove();(new f.Node(b)).appendTo(a)},_uiSetTitle:function(){this.get("rendered")&&this._setContent()},_uiSetDraggable:function(){this.get("rendered")&&this._setContent()},_uiSetSortable:function(){this.get("rendered")&&this._setContent()},
_uiSetTemplate:function(){this.get("rendered")&&this._setContent()},_uiSetSortState:function(a){var b=this.get("el");b.removeClass("sort-asc sort-desc");"ASC"===a?b.addClass("sort-asc"):"DESC"===a&&b.addClass("sort-desc")}},{ATTRS:{elTagName:{value:"th"}}}),g=g.define(g.Container,{_toggleSortState:function(){var a=this.get("sortState");this.set("sortState",a?"ASC"===a?"DESC":"ASC":"ASC")},_uiSetHide:function(a){this.set("visible",!a)},bindUI:function(){var a=this,b=a.get("events");f.each(b,function(b){a.publish(b,
{bubbles:1});a.addTarget(a.get("parent"))})},performActionInternal:function(a){var a=f.one(a.target),b=this.get("prefixCls");a.hasClass(b+"grid-hd-menu-trigger")||this.get("sortable")&&this._toggleSortState();this.fire("click")},show:function(){this.fire("beforeshow");this.set("hide",!1);this.fire("show")},hide:function(){_self.fire("beforehide");this.set("hide",!0);_self.fire("hide")}},{ATTRS:{dataIndex:{view:!0,value:""},draggable:{view:!0,value:!0},editor:{},focusable:{value:!1},hide:{value:!1},
id:{},originWidth:{view:!0},renderer:{},resizeable:{value:!0},sortable:{view:!0,value:!0},sortState:{view:!0,value:null},title:{view:!0,value:"&#160;"},width:{view:!0,value:100},template:{view:!0,value:'<div class="ks-grid-hd-inner"><span class="ks-grid-hd-title">{{title}}</span>{{#if sortable}}<span class="ks-grid-sort-icon">&nbsp;</span>{{/if}}<span class="ks-grid-hd-menu-trigger"></span></div>'},cellTemplate:{value:""},events:{value:"afterWidthChange,afterSortStateChange,afterVisibleChange,click,resize,move".split(",")},
xrender:{value:c}}},{xclass:"grid-hd",priority:1}),c=g.extend({},{ATTRS:{type:{value:"empty"},sortable:{view:!0,value:!1},width:{view:!0,value:null},template:{value:""}}},{xclass:"grid-hd-empty",priority:1});g.Empty=c;return g},{requires:["component","template"]});KISSY.add("grid",function(f,g,d,c,a,b,e){g.Bar=d;g.Store=c;g.PaggingBar=a;g.PaggingBar.Number=b;g.Plugins=e;return g},{requires:"grid/base,grid/bar,grid/store,grid/paggingbar,grid/numberpaggingbar,grid/plugins".split(",")});
KISSY.add("grid/gridbody",function(f,g,d,c){var a=g.Render.extend({renderUI:function(){var a=this.get("el"),e=this._getTemplate(),c=null,c=null;(new f.Node(e)).appendTo(a);c=a.one("tbody");this.set("tbodyEl",c,{silent:!0});c=this._createHeaderRow();this.set("headerRowEl",c)},clearData:function(){this.get("tbodyEl").children(".ks-grid-row").remove()},clearRowSelected:function(){this.get("tbodyEl").all(".ks-grid-row").removeClass("ks-grid-row-selected")},findCell:function(a,e){return e.one(".grid-td-"+
a)},findRow:function(a){if(!a)return null;var e=null;this.get("tbodyEl").children(".ks-grid-row").each(function(c){if(c.data("row-element")===a)return e=c,!1});return e},getSelectedRows:function(){return this.get("tbodyEl").all(".ks-grid-row-selected")},getAllRows:function(){return this.get("tbodyEl").all(".ks-grid-row")},isRowSelected:function(a){return f.one(a).hasClass("ks-grid-row-selected")},isRowHover:function(a){return f.one(a).hasClass("ks-grid-row-hover")},removeRow:function(a){(a=this.findRow(a))&&
a.remove();return a},resetHeaderRow:function(){var a=this.get("headerRowEl"),e=this.get("tbodyEl");a.remove();a=this._createHeaderRow();a.prependTo(e);this.set("headerRowEl",a)},setRowSelected:function(a,e){var c=f.one(a);e?c.addClass("ks-grid-row-selected"):c.removeClass("ks-grid-row-selected")},setRowHover:function(a,e){var c=f.one(a);e?c.addClass("ks-grid-row-hover"):c.removeClass("ks-grid-row-hover")},setColumnVisible:function(a){var e=a.get("hide"),a=a.get("id"),a=this.get("tbodyEl").all(".grid-td-"+
a);e?a.hide():a.show()},setColumnsWidth:function(a){var e=this.get("headerRowEl");(e=this.findCell(a.get("id"),e))&&e.width(a.get("width"));this.setTableWidth()},setTableWidth:function(a){this._getColumns();var e=this.get("width"),c=this.get("height"),d=this.get("tbodyEl").parent();this.get("forceFit");this.get("headerRowEl");a=a||this._getColumnsWidth();e&&(e>=a&&(a=e,c&&(a=e-17)),d.width(a))},updateRow:function(a){var e=this,c=e.findRow(a),d=e._getColumns();c&&f.each(d,function(d){e._updateCell(d,
a,c)})},_updateCell:function(a,e,c){c=this.findCell(a.get("id"),c);a=this._getCellText(a,e);c.one(".ks-grid-cell-text").html(a)},_createRow:function(a,e){var c=this,g=c._getColumns(),n=c.get("tbodyEl"),h=c.get("rowTemplate"),i=0===e%2?"ks-grid-row-odd":"ks-grid-row-even",j=[],k=null;f.each(g,function(e){var d=e.get("dataIndex");c._getCellText(e,a);j.push(c._getCellTemplate(e,d,a))});j.push(c._getEmptyCellTemplate());h=d(h).render({cellsTemplate:j.join(""),oddCls:i});k=(new f.Node(h)).appendTo(n);
k.data("row-element",a);0===e&&k.addClass("ks-grid-row-first");return k},_createHeaderRow:function(){var a=this,e=a._getColumns(),c=a.get("tbodyEl"),g=a.get("headerRowTemplate");rowEl=null;hideText="";cellsTemplate=[];f.each(e,function(e){cellsTemplate.push(a._getHeaderCellTemplate(e))});cellsTemplate.push(a._getEmptyCellTemplate());g=d(g).render({cellsTemplate:cellsTemplate.join("")});return rowEl=f.Node(g).appendTo(c)},_getColumns:function(){return this.get("columns")},_getColumnsWidth:function(){var a=
null,e=0,a=this.get("columns");f.each(a,function(a){a.get("hide")||(e+=a.get("width"))});return e},_getCellText:function(a,e){var c=a.get("dataIndex"),d=a.get("renderer");return d?d(e[c],e):e[c]},_getCellTemplate:function(a,e,c){var c=this._getCellText(a,c),e=this.get("cellTemplate"),f=a.get("cellTemplate")||this.get("cellTextTemplate"),c=d(f).render({text:c});return d(e).render({id:a.get("id"),dataIndex:a.get("dataIndex"),cellText:c,hide:a.get("hide")})},_getHeaderCellTemplate:function(a){var e=
this.get("headerCellTemplate");return d(e).render({id:a.get("id"),width:a.get("width"),hide:a.get("hide")})},_getEmptyCellTemplate:function(){return'<td class="ks-grid-cell-empty"></td>'},_getTemplate:function(){var a=this.__attrVals,e=this.get("template");return d(e).render(a)}},{ATTRS:{tbodyEl:{},headerRowEl:{}}});return g.Container.extend([c],{bindUI:function(){this._publishEvent();this._bindScrollEvent();this._bindRowEvent()},clearData:function(){this.get("view").clearData()},clearSelection:function(){var a=
this;a.get("view").getSelectedRows().each(function(e){a.onRowSelected(e,!1)})},findCell:function(a,e){var c=null;return(c=e instanceof f.Node?e:this.findRow(e))?this.get("view").findCell(a,c):null},findRow:function(a){return this.get("view").findRow(a)},setColumnVisible:function(a){this.get("view").setColumnVisible(a)},onLoad:function(){this.showData(this.get("store").getResult())},onAdd:function(a){var a=a.data,e=this.get("store").getCount();this._addData(a,e)},onRemove:function(a){var e=this,c=
null;f.each(a.data,function(a){(c=e.get("view").removeRow(a))&&e.fire("rowremoved",{record:a,row:c[0]})})},onUpdate:function(a){a=a.record;this.get("view").updateRow(a)},onLocalSort:function(){this.onLoad()},onRowSelected:function(a,e){var c=this.get("view"),d=null,d=e?"rowselected":"rowunselected";c.setRowSelected(a,e);this.fire(d,{row:a[0],record:a.data("row-element")})},setSelection:function(a){var e=this,c=e.get("view");a&&(f.isArray(a)||(a=[a]),f.each(a,function(a){if((a=e.findRow(a))&&!c.isRowSelected(a))e.onRowSelected(a,
!0)}))},showData:function(a){var e=this,e=this;e.clearData();e._addData(a);e.fire("aftershow")},resetColumns:function(){var a=this.get("store");this.get("view").resetHeaderRow();if(a)this.onLoad()},resetColumnsWidth:function(a){this.get("view").setColumnsWidth(a)},setAllSelection:function(){var a=this;a.get("view").getAllRows().each(function(e){a.onRowSelected(e,!0)})},setTableWidth:function(a){this.get("forceFit")&&this.resetColumns();this.get("view").setTableWidth(a)},_addData:function(a,e){var e=
e||0,c=this;f.each(a,function(a,b){var d=c.get("view")._createRow(a,e+b);c.fire("rowcreated",{record:a,data:a,row:d[0]})})},_bindScrollEvent:function(){var a=this,e=a.get("el");e.on("scroll",function(){var c=e.scrollLeft(),d=e.scrollTop();a.fire("scroll",{scrollLeft:c,scrollTop:d})})},_bindRowEvent:function(){var a=this;a.get("tbodyEl").delegate("click",".ks-grid-row",function(e){a._rowClickEvent(e)})},_publishEvent:function(){var a=this,e=a.get("events");f.each(e,function(e){a.publish(e,{bubbles:1});
a.addTarget(a.get("parent"))})},_rowClickEvent:function(a){var e=this.get("multiSelect"),c=f.one(a.currentTarget),d=this.get("view"),g=c.data("row-element"),h;h=a.target;h=f.one(h);h=!h?null:h.hasClass("ks-grid-cell")?h:h.parent(".ks-grid-cell");d=d.isRowSelected(c);h&&this.fire("cellclick",{record:g,row:c[0],cell:h[0],field:h.attr("data-column-field"),domTarget:a.target});this.fire("rowclick",{record:g,row:c[0]});if(e)this.onRowSelected(c,!d);else d||(this.clearSelection(),this.onRowSelected(c,!0))},
_uiSetWidth:function(){this.setTableWidth()},_uiSetHeight:function(){this.setTableWidth()}},{ATTRS:{columns:{view:!0,value:[]},tbodyEl:{view:!0},tableCls:{view:!0,value:""},forceFit:{view:!0,value:!1},multiSelect:{value:!1},stripeRows:{view:!0,value:!0},template:{view:!0,value:'<table cellspacing="0" cellpadding="0" class="ks-grid-table {{tableCls}}"><tbody></tbody></table>'},headerRowTemplate:{view:!0,value:'<tr class="ks-grid-header-row">{{cellsTemplate}}</tr>'},rowTemplate:{view:!0,value:'<tr class="ks-grid-row {{oddCls}}">{{cellsTemplate}}</tr>'},
cellTemplate:{view:!0,value:'<td  class="ks-grid-cell grid-td-{{id}}" data-column-id="{{id}}" data-column-field = {{dataIndex}}  {{#if hide}} style="display : none" {{/if}}><div class="ks-grid-cell-inner" >{{cellText}}</div></td>'},cellTextTemplate:{view:!0,value:'<span class="ks-grid-cell-text " title = "{{tips}}">{{text}}</span>'},headerCellTemplate:{view:!0,value:'<td class="grid-td-{{id}}" style=" {{#if width}}width:{{width}}px;{{/if}}height:0;{{#if hide}} display : none" {{/if}}"></td>'},width:{toBody:!0,
sync:!0},events:{value:"aftershow,cellclick,rowclick,rowcreated,rowremoved,rowselected,rowunselected,scroll".split(",")},xrender:{value:a}}},{xclass:"grid-body",priority:1})},{requires:["component","template","./bindable"]});
KISSY.add("grid/header",function(f,g,d){var c=g.define(g.Render,{renderUI:function(){var a=this.get("el"),b=this.get("tableCls"),a=(new f.Node('<table cellspacing="0" class="ks-grid-table" cellpadding="0"><thead><tr></tr></thead></table>')).appendTo(a);a.addClass(b);this.set("tableEl",a)},getContentElement:function(){return this.get("el").one("tr")},scrollTo:function(a){var b=this.get("el");void 0!==a.top&&b.scrollTop(a.top);void 0!==a.left&&b.scrollLeft(a.left)},_setTableWidth:function(a){var b=
this.get("width"),e=this.get("tableEl");b&&(b>a&&(a=b),e.width(a))}},{ATTRS:{emptyCellEl:{},tableEl:{}}});return g.define(g.Container,{addColumn:function(a,b){var e=0,c=this.get("columns"),a=this._createColumn(a);void 0===b&&(b=c.length,e=this.get("children").length-1);c.splice(b,0,a);this.addChild(a,e);this.fire("add",{column:a,index:b});return a},removeColumn:function(a){var b=this.get("columns"),e=f.indexOf(a,b);b.splice(e,1);this.fire("remove",{column:a,index:e});return this.removeChild(a,!0)},
bindUI:function(){this._bindColumnsEvent()},initializer:function(){var a=this,b=a.get("children"),e=a.get("columns");a._createEmptyColumn();f.each(e,function(c,d){var f=a._createColumn(c);b[d]=f;e[d]=f});b.push(a._createEmptyColumn())},getColumns:function(){return this.get("columns")},getColumnsWidth:function(){var a=this.getColumns(),b=0;f.each(a,function(a){a.get("hide")||(b+=a.get("width"))});return b},getColumnByIndex:function(a){return this.getColumns()[a]},getColumnById:function(a){var b=this.getColumns(),
e=null;f.each(b,function(b){if(b.get("id")===a)return e=b,!1});return e},getColumnIndex:function(a){var b=this.getColumns();return f.indexOf(a,b)},scrollTo:function(a){this.get("view").scrollTo(a)},_bindColumnsEvent:function(){var a=this;a.on("afterWidthChange",function(b){b.target!==a&&a.setTableWidth()});a.on("afterVisibleChange",function(b){b.target!==a&&a.setTableWidth()});a.on("afterSortStateChange",function(b){var e=b.target,c=a.getColumns();b.newVal&&f.each(c,function(a){a!==e&&a.set("sortState",
"")})})},_createColumn:function(a){if(a instanceof d)return a;a.id||(a.id=f.guid("col"));return new d(a)},_createEmptyColumn:function(){return new d.Empty},_isAllowScrollLeft:function(){var a=this.get("parent");return a&&a.get("height")?!0:!1},forceFitColumns:function(){var a=this.getColumns(),b=this.get("width"),e=0,c=this._isAllowScrollLeft(),d=0,g=1,h=null,i=0,j=0,k=j=0;b&&(f.each(a,function(a){var b=a.get("originWidth")||a.get("width");!a.get("hide")&&b&&(k+=b,a.get("resizeable")||(e+=a.get("width")),
i++)}),j=c?17:0,g=(b-j-e)/(k-e),1!==g&&(f.each(a,function(a){if(!a.get("hide")&&a.get("resizeable")){var b=a.get("originWidth")||a.get("width"),b=Math.floor(b*g);a.set("width",b,{silent:!0});a.get("el").width(b);a.set("originWidth",b,{silent:!0});d+=b;h=a}}),j=b-(d+j+e),i&&h&&(a=h.get("width")+j,h.set("width",a,{silent:!0}),h.get("el").width(a))),this.fire("forceFitWidth"))},setTableWidth:function(){var a=this.getColumnsWidth();this.get("forceFit")&&this.forceFitColumns();this._isAllowScrollLeft()&&
(a+=17);this.get("view")._setTableWidth(a)},_uiSetWidth:function(){this.setTableWidth()},_uiSetForceFit:function(a){a&&this.setTableWidth()}},{ATTRS:{activeItem:{value:null},columns:{value:[]},emptyColumn:{},focusable:{value:!1},forceFit:{view:!0,value:!1},width:{view:!0},tableCls:{view:!0,value:"ks-grid-table"},xrender:{value:c},events:{value:["add","remove"]}}},{xclass:"grid-header",priority:1})},{requires:["component","./column"]});
KISSY.add("grid/numberpaggingbar",function(f,g,d,c){g=d.extend({_getItems:function(){var a=this.get("items"),b=null;if(a)return a;a=[];a.push(this._getButtonItem(d.ID_PREV));b=new c({id:"numberContainer",elCls:"ks-inline-block"});a.push(b);this.set("numberContainer",b);a.push(this._getButtonItem(d.ID_NEXT));a.push(this._getTextItem(d.ID_TOTAL_PAGE));a.push(this._getTextItem(d.ID_CURRENT_PAGE));a.push(this._getButtonItem(d.ID_SKIP));return a},_bindButtonEvent:function(){var a=this,b=a.get("numberContainer");
a.constructor.superclass._bindButtonEvent.call(this);b.get("el").delegate("click",".ks-number-button",function(b){b=f.one(b.target);b=parseInt(b.text(),10);a.skipToPage(b)})},_setNumberPages:function(){this.constructor.superclass._setNumberPages.call(this);this._setNumberButtons()},_setNumberButtons:function(){var a=this,b=a.get("numberContainer"),c=a.get("curPage"),d=a.get("totalPage"),d=a._getNumberItems(c,d),g=null;b.removeChildren(!0);f.each(d,function(c){b.addChild(a._createItem(c))});(g=b.getItem(c))&&
g.set("checked",!0)},_getNumberItems:function(a,b){function c(a,b){for(var e=a;e<=b;e++)f.push(d._getNumberItem(e))}var d=this,f=[],g=d.get("maxLimitCount"),h=d.get("showRangeCount");if(b<g)g=b,c(1,b);else{var i=a<=g?1:a-h,h=a+h,h=h<b?h>g?h:g:b;1<i&&(c(1,1),2<i&&f.push(d._getEllipsisItem()));g=h;c(i,h)}g<b&&(g<b-1&&f.push(d._getEllipsisItem()),c(b,b));return f},_getEllipsisItem:function(){return{xtype:"text",text:this.get("ellipsisTemplate")}},_getNumberItem:function(a){return{id:a,xtype:"button",
text:""+a+"",elCls:this.get("numberButtonCls")}}},{ATTRS:{skipText:{value:"\u786e\u5b9a"},maxLimitCount:{value:4},showRangeCount:{value:1},numberButtonCls:{value:"ks-number-button"},ellipsisTemplate:{value:"..."},curPageTemplate:{value:'\u5230\u7b2c <input type="text" autocomplete="off" class="ks-pb-page" size="20" name="inputItem"> \u9875'}}},{xclass:"number-paggingbar",priority:3});return d.Number=g},{requires:["component","./paggingbar","./bar"]});
KISSY.add("grid/paggingbar",function(f,g,d,c){return d.extend([c],{initializer:function(){var a=this,b=a.get("children"),c=a._getItems(),d=a.get("store");f.each(c,function(c){b.push(a._createItem(c))});d&&d.pageSize&&a.set("pageSize",d.pageSize)},bindUI:function(){this._bindButtonEvent()},skipToPage:function(a){if(!(0>=a||a>this.get("totalPage"))){var b=this.get("store"),c=this.get("pageSize"),d=a-1,f=d*c,a=this.fire("beforepagechange",{from:this.get("curPage"),to:a});b&&!1!==a&&b.load({start:f,limit:c,
pageIndex:d})}},_afterStoreLoad:function(a,b){var c=this.get("pageSize"),d=0,f=0,g=0,h=1,i=1,d=b?b.start||0:0,g=a.getTotalCount(),f=g-d>c?d+a.getCount():g,i=parseInt((g+c-1)/c,10),i=0<i?i:1,h=parseInt(d/c,10)+1;this.set("start",d);this.set("end",f);this.set("totalCount",g);this.set("curPage",h);this.set("totalPage",i);this._setAllButtonsState();this._setNumberPages()},_bindButtonEvent:function(){function a(){var a=parseInt(b._getCurrentPageValue(),10);b._isPageAllowRedirect(a)?b.skipToPage(a):b._setCurrentPageValue(b.get("curPage"))}
var b=this;b._bindButtonItemEvent("first",function(){b.skipToPage(1)});b._bindButtonItemEvent("prev",function(){b.skipToPage(b.get("curPage")-1)});b._bindButtonItemEvent("next",function(){b.skipToPage(b.get("curPage")+1)});b._bindButtonItemEvent("last",function(){b.skipToPage(b.get("totalPage"))});b._bindButtonItemEvent("skip",function(){a()});b.getItem("curPage").get("el").on("keyup",function(b){b.stopPropagation();13===b.keyCode&&a()})},_bindButtonItemEvent:function(a,b){var c=this.getItem(a);if(c)c.get("el").on("click",
b)},onLoad:function(a){this._afterStoreLoad(this.get("store"),a)},_getItems:function(){var a=this.get("items");if(a)return a;a=[];a.push(this._getButtonItem("first"));a.push(this._getButtonItem("prev"));a.push(this._getSeparator());a.push(this._getTextItem("totalPage"));a.push(this._getTextItem("curPage"));a.push(this._getButtonItem("skip"));a.push(this._getSeparator());a.push(this._getButtonItem("next"));a.push(this._getButtonItem("last"));a.push(this._getSeparator());a.push(this._getTextItem("totalCount"));
return a},_getButtonItem:function(a){return{id:a,xtype:"button",text:this.get(a+"Text"),disabled:!0,elCls:this.get(a+"Cls")}},_getSeparator:function(){return{xtype:"separator"}},_getTextItem:function(a){return{id:a,xtype:"text",text:this._getTextItemTemplate(a)}},_getTextItemTemplate:function(a){var b={};b[a]=this.get(a);return f.substitute(this.get(a+"Template"),b)},_isPageAllowRedirect:function(a){return a&&0<a&&a<=this.get("totalPage")&&a!==this.get("curPage")},_setAllButtonsState:function(){this.get("store")&&
this._setButtonsState(["prev","next","first","last","skip"],!0);1===this.get("curPage")&&this._setButtonsState(["prev","first"],!1);this.get("curPage")===this.get("totalPage")&&this._setButtonsState(["next","last"],!1)},_setButtonsState:function(a,b){var c=this.get("children");f.each(c,function(c){"button"===c.get("xtype")&&f.inArray(c.get("id"),a)&&c.set("disabled",!b)})},_setNumberPages:function(){var a=this.getItem("totalPage");this.getItem("curPage");var b=this.getItem("totalCount");a&&a.set("html",
this._getTextItemTemplate("totalPage"));this._setCurrentPageValue(this.get("curPage"));b&&b.set("html",this._getTextItemTemplate("totalCount"))},_getCurrentPageValue:function(){var a=a||this.getItem("curPage");return a.get("el").one("input").val()},_setCurrentPageValue:function(a,b){b=b||this.getItem("curPage");b.get("el").one("input").val(a)}},{ATTRS:{firstText:{value:"\u9996 \u9875"},fistCls:{value:"ks-pb-first"},prevText:{value:"\u4e0a\u4e00\u9875"},prevCls:{value:"ks-pb-prev"},nextText:{value:"\u4e0b\u4e00\u9875"},nextCls:{value:"ks-pb-next"},
lastText:{value:"\u672b \u9875"},lastCls:{value:"ks-pb-last"},skipText:{value:"\u8df3 \u8f6c"},skipCls:{value:"ks-pb-skip"},totalPageTemplate:{value:"\u5171 {totalPage} \u9875"},curPageTemplate:{value:'\u7b2c <input type="text" autocomplete="off" class="ks-pb-page" size="20" name="inputItem"> \u9875'},totalCountTemplate:{value:"\u5171{totalCount}\u6761\u8bb0\u5f55"},curPage:{value:0},totalPage:{value:0},totalCount:{value:0},pageSize:{value:30},store:{}},ID_FIRST:"first",ID_PREV:"prev",ID_NEXT:"next",ID_LAST:"last",ID_SKIP:"skip",ID_TOTAL_PAGE:"totalPage",
ID_CURRENT_PAGE:"curPage",ID_TOTAL_COUNT:"totalCount"},{xclass:"paggingbar",priority:2})},{requires:["component","./bar","./bindable"]});
KISSY.add("grid/plugins",function(f){function g(c){g.superclass.constructor.call(this,c)}f.extend(g,f.Base);g.ATTRS={width:{value:40},column:{},cellInner:{value:'<span class="ks-grid-checkBox-container"><input  class="ks-grid-checkBox" type="checkbox"></span>'}};f.augment(g,{initializer:function(c){var a={title:"",width:this.get("width"),resizeable:!1,sortable:!1,template:'<div class="ks-grid-hd-inner">'+this.get("cellInner")+"</div>",cellTemplate:this.get("cellInner")},a=c.addColumn(a,0);c.set("multiSelect",
!0);this.set("column",a)},bindUI:function(c){var a=this,b=a.get("column").get("el").one(".ks-grid-checkBox");b.on("click",function(){var a=b.attr("checked");b.attr("checked",a);a?c.setAllSelection():c.clearSelection()});c.on("rowselected",function(b){a._setRowChecked(b.row,!0)});c.on("rowunselected",function(c){a._setRowChecked(c.row,!1);b.attr("checked",!1)})},_setRowChecked:function(c,a){f.one(c).one(".ks-grid-checkBox").attr("checked",a)}});var d=function(c){d.superclass.constructor.call(this,
c)};f.extend(d,f.Base);d.ATTRS={width:{value:40},column:{},cellInner:{value:'<span class="ks-grid-radio-container"><input  class="ks-grid-radio" type="radio"></span>'}};f.augment(d,{initializer:function(c){var a={title:"",width:this.get("width"),resizeable:!1,sortable:!1,cellTemplate:this.get("cellInner")},a=c.addColumn(a,0);c.set("multiSelect",!1);this.set("column",a)},bindUI:function(c){var a=this;c.on("rowselected",function(b){a._setRowChecked(b.row,!0)});c.on("rowunselected",function(b){a._setRowChecked(b.row,
!1)})},_setRowChecked:function(c,a){f.one(c).one(".ks-grid-radio").attr("checked",a)}});return{CheckSelection:g,RadioSelection:d}});
KISSY.add("grid/store",function(f){function g(d){d=d||{};d=f.merge({root:"rows",totalProperty:"results",dataType:"json",autoLoad:!1,sortInfo:{field:"",direction:"ASC"},proxy:{method:"post",url:""},params:{},remoteSort:!1,matchFunction:function(c,a){return c===a},compareFunction:function(c,a){void 0===c&&(c="");void 0===a&&(a="");return f.isString(c)?c.localeCompare(a):c>a?1:c===a?0:-1}},d);f.mix(this,d);f.mix(this,{hasLoad:!1,resultRows:[],newRecords:[],modifiedRecords:[],deletedRecords:[],rowCount:0,
totalCount:0});this.events="acceptchanges,load,beforeload,beforeProcessLoad,addrecords,exception,removerecords,updaterecord,localsort".split(",");this._init()}f.augment(g,f.EventTarget);f.augment(g,{acceptChanges:function(){this._clearChanges();this.fire("acceptchanges")},add:function(d,c,a){var b=this,e=[],a=a||b._getDefaultMatch();f.isArray(d)||(d=[d]);f.each(d,function(d){if(!c||!b.contains(d,a))b._addRecord(d),e.push(d),b.newRecords.push(d),b._removeFrom(d,b.deletedRecords),b._removeFrom(d,b.modifiedRecords)});
b.fire("addrecords",{data:e})},clear:function(){this.setResult([])},compare:function(d,c,a,b){a=a||this.sortInfo.field;b=b||this.sortInfo.direction;return!a||!b?1:this.compareFunction(d[a],c[a])*("ASC"===b?1:-1)},contains:function(d,c){return-1!==this.findIndexBy(d,c)},findIndexBy:function(d,c){var a=-1,b=this.resultRows,c=c||this._getDefaultMatch();if(f.isUndefined(d)||f.isNull(d))return-1;f.each(b,function(b,f){if(c(d,b))return a=f,!1});return a},find:function(d,c){var a=null;f.each(this.resultRows,
function(b){if(b[d]===c)return a=b,!1});return a},findByIndex:function(d){return this.resultRows[d]},findAll:function(d,c){var a=[];f.each(this.resultRows,function(b){b[d]===c&&a.push(b)});return a},findNextRecord:function(d){d=this.findIndexBy(d);if(0<=d)return this.findByIndex(d+1)},load:function(d){this._loadData(d)},getResult:function(){return this.resultRows},getCount:function(){return this.resultRows.length},getNewRecords:function(){return this.newRecords},getModifiedRecords:function(){return this.modifiedRecords},
getDeletedRecords:function(){return this.deletedRecords},getTotalCount:function(){return this.totalCount},remove:function(d,c){var a=this,b=[],c=c||a._getDefaultMatch();f.isArray(d)||(d=[d]);f.each(d,function(d){d=a.findIndexBy(d,c);d=a._removeAt(d);!f.inArray(d,a.newRecords)&&!f.inArray(d,a.deletedRecords)&&a.deletedRecords.push(d);a._removeFrom(d,a.newRecords);a._removeFrom(d,a.modifiedRecords);b.push(d)});a.fire("removerecords",{data:b})},setResult:function(d){this.resultRows=d=d||[];this.totalCount=
this.rowCount=d.length;this._sortData();this.fire("load",this.oldParams)},setValue:function(d,c,a,b){var e=d,g=null,g=null;b&&(g=this._getDefaultMatch(),g=this.findIndexBy(d,g),0<=g&&(e=this.resultRows[g]));e[c]=a;!f.inArray(e,this.newRecords)&&!f.inArray(e,this.modifiedRecords)&&this.modifiedRecords.push(e);this.fire("updaterecord",{record:e,field:c,value:a})},sort:function(d,c){this.sortInfo.field=d||this.sortInfo.field;this.sortInfo.direction=c||this.sortInfo.direction;this.remoteSort?this.load():
(this._sortData(d,c),this.fire("localsort",{field:d,direction:c}))},update:function(d,c){var a=d,b=null,b=null;c&&(b=this._getDefaultMatch(),b=this.findIndexBy(d,b),0<=b&&(a=this.resultRows[b]));a=f.mix(a,d);!f.inArray(a,this.newRecords)&&!f.inArray(a,this.modifiedRecords)&&this.modifiedRecords.push(a);this.fire("updaterecord",{record:a})},_addRecord:function(d,c){var a=this.resultRows;f.isUndefined(c)&&(c=a.length);a[c]=d},_clearChanges:function(){this.newRecords.splice(0);this.modifiedRecords.splice(0);
this.deletedRecords.splice(0)},_loadData:function(d){var c=this,a=d||{},d=null;c.fire("beforeload");a=f.merge(c.oldParams,c.sortInfo,a);c.oldParams=a;c.proxy.url?(d="post"===c.proxy.method?a:a?f.param(a):"",f.ajax({cache:!1,url:c.proxy.url,dataType:c.dataType,type:c.proxy.method,data:d,success:function(b){c.fire("beforeProcessLoad",{data:b});var d=[],g=0,m=0;if(b.hasError)c.resultRows=d,c.rowCount=g,c.totalCount=m,c.fire("exception",{error:b.error});else{f.isString(b)&&(b=f.json.parse(b));if(f.isArray(b)||
f.isObject(b))f.isArray(b)?(d=b,m=g=d.length):b&&((d=b[c.root])||(d=[]),g=d.length,m=parseInt(b[c.totalProperty],10));c.resultRows=d;c.rowCount=g;c.totalCount=m;c.remoteSort||c._sortData();c.fire("load",a);c._clearChanges()}},error:function(a,d,f){c.resultRows=[];c.rowCount=0;c.totalCount=0;c.fire("exception",{error:d,responseText:f.responseText})}})):c._loadByMemery(a)},_loadByMemery:function(d){var c=this.proxy.memeryData,a=[],b=[];c&&(a=d.filter?f.filter(c,d.filter):c,d.start=d.start||0,d.limit=
d.limit||this.pageSize,b=d.limit?a.slice(d.start,d.start+d.limit):a,this._setResult(b,b.length,a.length),this.remoteSort||this._sortData(),this.fire("load",d))},_removeAt:function(d,c){if(!(0>d)){var a=c||this.resultRows,b=a[d];a.splice(d,1);return b}},_removeFrom:function(d,c){var a=f.indexOf(d,c);0<=a&&this._removeAt(a,c)},_setResult:function(d,c,a){this.resultRows=d;this.rowCount=c;this.totalCount=a},_sortData:function(d,c){var a=this,d=d||a.sortInfo.field,c=c||a.sortInfo.direction;d&&c&&a.resultRows.sort(function(b,
e){return a.compare(b,e,d,c)})},_getDefaultMatch:function(){return this.matchFunction},_init:function(){this.oldParams=this.params||{};this.proxy.url||(this.proxy.url=this.url);this.resultRows=[];this.autoLoad&&this.load()}});return g});
