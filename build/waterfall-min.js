/*
Copyright 2011, KISSY UI Library v1.20dev
MIT Licensed
build time: Sep 1 19:12
*/
KISSY.add("waterfall/async",function(e,l,n,m,o){function h(){h.superclass.constructor.apply(this,arguments)}function p(){if(!this.__loading)if(this.isAdjusting())this.__onScroll();else{var a=this.get("container").offset().top,b=this.get("diff"),c=this.get("curColHeights");if(c.length)a+=Math.min.apply(Math,c);b+g(window).scrollTop()+g(window).height()>a&&q.call(this)}}function q(){var a=this;this.get("container");a.__loading=true;var b=a.get("remote");if(e.isFunction(b))b=b();a.fire("loadStart");
n(e.mix({success:function(c){c.end&&g(window).detach("scroll",a.__onScroll);a.__loading=false;c=c.data;var d=m(a.get("itemTpl")),f=[];e.each(c,function(j){j=d.render(j);f.push(g(j))});a.addItems(f)},complete:function(){a.fire("loadEnd")}},b))}var g=l.all;h.ATTRS={remote:{},diff:{getter:function(a){return a||0}},itemTpl:{}};e.extend(h,o,{_init:function(){h.superclass._init.apply(this,arguments);this.__onScroll=e.buffer(p,50,this).fn;g(window).on("scroll",this.__onScroll);p.call(this)},destroy:function(){h.superclass.destroy.apply(this,
arguments);g(window).detach("scroll",this.__onScroll)}});return h},{requires:["node","ajax","template","./base"]});
KISSY.add("waterfall/base",function(e,l,n){function m(){m.superclass.constructor.apply(this,arguments);this._init()}function o(a,b,c,d){var f=e.makeArray(a),j={},i;if(f.length>0)i=setTimeout(function(){var k=+new Date;do{var r=f.shift();b.call(c,r)}while(f.length>0&&+new Date-k<50);if(f.length>0)i=setTimeout(arguments.callee,25);else d&&d.call(c,a)},25);else d&&e.later(d,0,false,c,[a]);j.stop=function(){if(i){clearTimeout(i);f=[]}};return j}function h(){var a=this._containerRegion;a&&this.get("container").width()===
a.width||this.adjust()}function p(){var a=this.get("container").width(),b=this.get("curColHeights");b.length=Math.max(parseInt(a/this.get("colWidth")),this.get("minColCount"));this._containerRegion={width:a};e.each(b,function(c,d){b[d]=0})}function q(a){a=g(a);for(var b=this.get("curColHeights"),c=this.get("container"),d=b.length,f=0,j=this._containerRegion,i=Number.MAX_VALUE,k=0;k<d;k++)if(b[k]<i){i=b[k];f=k}d||(i=0);d=(j.width-d*this.get("colWidth"))/2;a.css({left:f*this.get("colWidth")+d,top:i});
c.contains(a)||c.append(a);b[f]+=a.height();return a}var g=l.all;m.ATTRS={container:{setter:function(a){return g(a)}},curColHeights:{value:[]},minColCount:{value:1},effect:{value:{effect:"fadeIn",duration:1}},colWidth:{}};e.extend(m,n,{isAdjusting:function(){return!!this._adjuster},_init:function(){h.call(this);this.__onResize=e.buffer(h,50,this).fn;g(window).on("resize",this.__onResize)},adjust:function(a){var b=this,c=b.get("container").all(".ks-waterfall");b.isAdjusting()&&b._adjuster.stop();p.call(b);
return b._adjuster=o(c,q,b,function(){b.get("container").height(Math.max.apply(Math,b.get("curColHeights")));b._adjuster=0;a&&a.call(b)})},addItems:function(a,b){var c=this;c._adder=o(a,c._addItem,c,function(){c.get("container").height(Math.max.apply(Math,c.get("curColHeights")));c._adder=0;b&&b.call(c)});return c._adder},_addItem:function(a){this.get("curColHeights");this.get("container");a=q.call(this,a);var b=this.get("effect");b.effect&&a[b.effect](b.duration,undefined,b.easing)},destroy:function(){g(window).detach("resize",
this.__onResize)}});return m},{requires:["node","base"]});KISSY.add("waterfall",function(e,l,n){l.Async=n;return l},{requires:["waterfall/base","waterfall/async"]});
