modulex.add("attribute",["modulex-util","modulex-event-custom"],function(t,r,e){var n,a=t("modulex-util"),i=t("modulex-event-custom");n=function(t){function r(t){return t===y.noop?function(){}:y.bind(t)}function e(t,r){return"string"==typeof r?t[r]:r}function n(t){return t.__attrVals||(t.__attrVals={})}function o(t,r){return t+y.ucfirst(r)+"Change"}function u(t,r,e,n,a,i,u,s){return u=u||e,t.fire(o(r,e),y.mix({attrName:u,subAttrName:i,prevVal:n,newVal:a},s))}function s(t,r,e){var n=t[r];return e||n||(t[r]=n={}),n||{}}function _(t,r){for(var e=0,n=r.length;void 0!==t&&n>e;e++)t=t[r[e]];return t}function f(t,r,e){var n=r.length-1,a=t;if(n>=0){for(var i=0;n>i;i++)t=t[r[i]];void 0!==t?t[r[i]]=e:a=void 0}return a}function l(t){var r;return-1!==t.indexOf(".")&&(r=t.split("."),t=r.shift()),{path:r,name:t}}function c(t,r,e){var n=e;return r&&(n=void 0===t?{}:y.clone(t),f(n,r,e)),n}function v(t,r){var e=s(t,"__defaultBeforeFns");if(!e[r]){e[r]=1;var n=o("before",r);t.publish(n,{defaultFn:h,defaultTargetOnly:!0})}}function d(t,r,e,n,a){var i,u,s,f=l(r),d=r;if(r=f.name,i=f.path,s=t.get(r),v(t,r),i&&(u=_(s,i)),!n.force){if(!i&&s===e)return void 0;if(i&&u===e)return void 0}e=c(s,i,e);var p=y.mix({attrName:r,subAttrName:d,prevVal:s,newVal:e,_opts:n,_attrs:a,target:t},n.data);if(n.silent){if(S===h.call(t,p))return S}else if(S===t.fire(o("before",r),p))return S;return t}function h(t){var r=this,e=t.newVal,a=t.prevVal,i=t.attrName,o=t.subAttrName,s=t._attrs,_=t._opts,f=r.setInternal(i,e);return f===S?f:(_.silent||(e=n(r)[i],u(r,"after",i,a,e,o,null,_.data),s?s.push({prevVal:a,newVal:e,attrName:i,subAttrName:o}):u(r,"","*",[a],[e],[o],[i],_.data)),void 0)}function p(t){var r=this,e=r.constructor;for(r.userConfig=t;e;)A(r,e.ATTRS),e=e.superclass?e.superclass.constructor:null;x(r,t)}function m(t,e){var n=e.__hooks__;if(n)for(var a in n)a in t&&(t[a]=n[a](t[a]));y.each(t,function(n,a){if("function"==typeof n){var i=0;if(n.__owner__){var o=n.__owner__;delete n.__owner__,delete n.__name__,i=n.__wrapped__=1;var u=r(n);u.__owner__=o,u.__name__=a,o.prototype[a]=u}else n.__wrapped__&&(i=1);i&&(t[a]=n=r(n)),n.__owner__=e,n.__name__=a}})}function g(t){var r=this;m(t,r),y.mix(r.prototype,t)}function A(t,r){if(r)for(var e in r)t.addAttr(e,r[e],!1)}function x(t,r){if(r)for(var e in r)t.setInternal(e,r[e])}function w(t,r){var n,a=t.getAttrs(),i=s(a,r,1),o=i.valueFn;return o&&(o=e(t,o))&&(n=o.call(t),void 0!==n&&(i.value=n),delete i.valueFn,a[r]=i),i.value}function b(t,r,n,a){var i,o,u;u=l(r),r=u.name,i=u.path,i&&(o=t.get(r),n=c(o,i,n));var _,f=s(t.getAttrs(),r),v=f.validator;return v&&(v=e(t,v))&&(_=v.call(t,n,r,a),void 0!==_&&_!==!0)?_:void 0}var y=a,V=i,N={},S=!1;return p.version="1.0.2",p.extend=function k(t,r){var e,n=this;r=y.merge(r),t=y.merge(t);var a,i=r.__hooks__;(a=n.__hooks__)&&(i=r.__hooks__=r.__hooks__||{},y.mix(i,a,!1));r.name||"AttributeDerived";e=t.hasOwnProperty("constructor")?t.constructor:function(){this.callSuper.apply(this,arguments)},t.constructor=e,e.__hooks__=i,m(t,e);var o,u=r.inheritedStatics;return(o=n.inheritedStatics)&&(u=r.inheritedStatics=r.inheritedStatics||{},y.mix(u,o,!1)),y.extend(e,n,t,r),u&&y.mix(e,u),e.extend=r.extend||k,e.addMembers=g,e},y.augment(p,V.Target,{INVALID:N,callSuper:function(){var t,r,e=this,n=arguments;"function"==typeof e&&e.__name__?(t=e,r=n[0],n=Array.prototype.slice.call(n,1)):(t=arguments.callee.caller,t.__wrapped__&&(t=t.caller),r=e);var a=t.__name__;if(!a)return void 0;var i=t.__owner__.superclass[a];return i?i.apply(r,n||[]):void 0},getAttrs:function(){return this.__attrs||(this.__attrs={})},getAttrVals:function(){var t,r=this,e={},n=r.getAttrs();for(t in n)e[t]=r.get(t);return e},addAttr:function(t,r,e){var n,a=this,i=a.getAttrs(),o=y.merge(r);return o.value&&"object"==typeof o.value&&(o.value=y.clone(o.value),console.log("please use valueFn instead of value for "+t+" attribute","warn")),(n=i[t])?y.mix(n,o,e):i[t]=o,a},addAttrs:function(t,r){var e=this;return y.each(t,function(t,r){e.addAttr(r,t)}),r&&e.set(r),e},hasAttr:function(t){return this.getAttrs().hasOwnProperty(t)},removeAttr:function(t){var r=this,e=n(r),a=r.getAttrs();return r.hasAttr(t)&&(delete a[t],delete e[t]),r},set:function(t,r,e){var n,a=this;if("string"!=typeof t){e=r,e=e||{};var i=Object(t),o=[],s=[];for(t in i)void 0!==(n=b(a,t,i[t],i))&&s.push(n);if(s.length)return e.error&&e.error(s),S;for(t in i)d(a,t,i[t],e,o);var _=[],f=[],l=[],c=[];return y.each(o,function(t){f.push(t.prevVal),l.push(t.newVal),_.push(t.attrName),c.push(t.subAttrName)}),_.length&&u(a,"","*",f,l,c,_,e.data),a}return e=e||{},n=b(a,t,r),void 0!==n?(e.error&&e.error(n),S):d(a,t,r,e)},setInternal:function(t,r){var a,i=this,o=s(i.getAttrs(),t),u=o.setter;return u&&(u=e(i,u))&&(a=u.call(i,r,t)),a===N?S:(void 0!==a&&(r=a),n(i)[t]=r,void 0)},get:function(t){var r,a,i,o,u=this,f=".",l=n(u);return-1!==t.indexOf(f)&&(r=t.split(f),t=r.shift()),a=s(u.getAttrs(),t,1),i=a.getter,o=t in l?l[t]:w(u,t),i&&(i=e(u,i))&&(o=i.call(u,o,t)),t in l||void 0===o||(l[t]=o),r&&(o=_(o,r)),o},reset:function(t,r){var e=this;if("string"==typeof t)return e.hasAttr(t)?e.set(t,w(e,t),r):e;r=t;var n=e.getAttrs(),a={};for(t in n)a[t]=w(e,t);return e.set(a,r),e}}),t=p}(),e.exports=n});