/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: Aug 14 23:59
*/
KISSY.add("io/form-serializer",function(f,g){function i(a){return a.replace(h,"\r\n")}var m=/^(?:select|textarea)/i,h=/\r?\n/g,c,a=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i;return c={serialize:function(a,b){return f.param(c.getFormData(a),void 0,void 0,b||!1)},getFormData:function(c){var b=[],l={};f.each(g.query(c),function(n){n=n.elements?f.makeArray(n.elements):[n];b.push.apply(b,n)});b=f.filter(b,function(n){return n.name&&!n.disabled&&
(n.checked||m.test(n.nodeName)||a.test(n.type))});f.each(b,function(n){var a=g.val(n),d;null!==a&&(a=f.isArray(a)?f.map(a,i):i(a),(d=l[n.name])?(d&&!f.isArray(d)&&(d=l[n.name]=[d]),d.push.apply(d,f.makeArray(a))):l[n.name]=a)});return l}}},{requires:["dom"]});
KISSY.add("io/base",function(f,g,i){function m(a){var d=a.context;delete a.context;a=f.mix(f.clone(k),a,{deep:!0});a.context=d||a;var b,c=a.type,l=a.dataType,d=a.uri=j.resolve(a.url);a.uri.setQuery("");"crossDomain"in a||(a.crossDomain=!a.uri.isSameOriginAs(j));c=a.type=c.toUpperCase();a.hasContent=!n.test(c);if(a.processData&&(b=a.data)&&"string"!=typeof b)a.data=f.param(b,i,i,a.serializeArray);l=a.dataType=f.trim(l||"*").split(e);!("cache"in a)&&f.inArray(l[0],["script","jsonp"])&&(a.cache=!1);
a.hasContent||(a.data&&d.query.add(f.unparam(a.data)),!1===a.cache&&d.query.set("_ksTS",f.now()+"_"+f.guid()));return a}function h(a,d){c.fire(a,{ajaxConfig:d.config,io:d})}function c(a){function n(d){return function(n){if(k=b.timeoutTimer)clearTimeout(k),b.timeoutTimer=0;var j=a[d];j&&j.apply(s,n);h(d,b)}}var b=this;if(!(b instanceof c))return new c(a);l.call(b);a=m(a);f.mix(b,{responseData:null,config:a||{},timeoutTimer:null,responseText:null,responseXML:null,responseHeadersString:"",responseHeaders:null,
requestHeaders:{},readyState:0,state:0,statusText:null,status:0,transport:null,_defer:new f.Defer(this)});var j;h("start",b);j=new (d[a.dataType[0]]||d["*"])(b);b.transport=j;a.contentType&&b.setRequestHeader("Content-Type",a.contentType);var e=a.dataType[0],k,g,i=a.timeout,s=a.context,r=a.headers,x=a.accepts;b.setRequestHeader("Accept",e&&x[e]?x[e]+("*"===e?"":", */*; q=0.01"):x["*"]);for(g in r)b.setRequestHeader(g,r[g]);if(a.beforeSend&&!1===a.beforeSend.call(s,b,a))return b;b.done(n("success"),
n("error"));b.fin(n("complete"));b.readyState=1;h("send",b);a.async&&0<i&&(b.timeoutTimer=setTimeout(function(){b.abort("timeout")},1E3*i));try{b.state=1,j.send()}catch(z){2>b.state&&b._ioReady(-1,z.message)}return b}var a=/^(?:about|app|app\-storage|.+\-extension|file|widget)$/,e=/\s+/,b=function(a){return a},l=f.Promise,n=/^(?:GET|HEAD)$/,j=new f.Uri((f.Env.host.location||{}).href),a=j&&a.test(j.getScheme()),d={},k={type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",async:!0,
serializeArray:!0,processData:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":"*/*"},converters:{text:{json:f.parseJson,html:b,text:b,xml:f.parseXML}},headers:{"X-Requested-With":"XMLHttpRequest"},contents:{xml:/xml/,html:/html/,json:/json/}};k.converters.html=k.converters.text;f.mix(c,g.Target);f.mix(c,{isLocal:a,setupConfig:function(a){f.mix(k,a,{deep:!0})},setupTransport:function(a,b){d[a]=b},getTransport:function(a){return d[a]},
getConfig:function(){return k}});return c},{requires:["event"]});
KISSY.add("io/xhr-transport-base",function(f,g){function i(a,b){try{return new (b||h).XMLHttpRequest}catch(d){}}function m(a){var b;a.ifModified&&(b=a.uri,!1===a.cache&&(b=b.clone(),b.query.remove("_ksTS")),b=b.toString());return b}var h=f.Env.host,c=7<f.UA.ie&&h.XDomainRequest,a={proto:{}},e={},b={};g.__lastModifiedCached=e;g.__eTagCached=b;a.nativeXhr=h.ActiveXObject?function(a,b){var d;if(!l&&a&&c)d=new c;else if(!(d=!g.isLocal&&i(a,b)))a:{try{d=new (b||h).ActiveXObject("Microsoft.XMLHTTP");break a}catch(e){}d=
void 0}return d}:i;a._XDomainRequest=c;var l=a.supportCORS="withCredentials"in a.nativeXhr();f.mix(a.proto,{sendInternal:function(){var a=this,j=a.io,d=j.config,k=a.nativeXhr,g=d.files,i=g?"post":d.type,h=d.async,o,v=j.mimeType,p=j.requestHeaders||{},j=j._getUrlForSend(),w=m(d),t,s;if(w){if(t=e[w])p["If-Modified-Since"]=t;if(t=b[w])p["If-None-Match"]=t}(o=d.username)?k.open(i,j,h,o,d.password):k.open(i,j,h);i=d.xhrFields||{};"withCredentials"in i?l||delete i.withCredentials:l&&(i.withCredentials=
!0);for(s in i)k[s]=i[s];v&&k.overrideMimeType&&k.overrideMimeType(v);!1===p["X-Requested-With"]&&delete p["X-Requested-With"];if("undefined"!==typeof k.setRequestHeader)for(s in p)k.setRequestHeader(s,p[s]);var r=d.hasContent&&d.data||null;g&&(v=r,p={},v&&(p=f.unparam(v)),p=f.mix(p,g),r=new FormData,f.each(p,function(a,b){f.isArray(a)?f.each(a,function(a){r.append(b+(d.serializeArray?"[]":""),a)}):r.append(b,a)}));k.send(r);!h||4==k.readyState?a._callback():c&&k instanceof c?(k.onload=function(){k.readyState=
4;k.status=200;a._callback()},k.onerror=function(){k.readyState=4;k.status=500;a._callback()}):k.onreadystatechange=function(){a._callback()}},abort:function(){this._callback(0,1)},_callback:function(a,j){var d=this.nativeXhr,l=this.io,i,h,q,o,v,p=l.config;try{if(j||4==d.readyState)if(c&&d instanceof c?(d.onerror=f.noop,d.onload=f.noop):d.onreadystatechange=f.noop,j)4!==d.readyState&&d.abort();else{i=m(p);var w=d.status;c&&d instanceof c||(l.responseHeadersString=d.getAllResponseHeaders());i&&(h=
d.getResponseHeader("Last-Modified"),q=d.getResponseHeader("ETag"),h&&(e[i]=h),q&&(b[q]=q));if((v=d.responseXML)&&v.documentElement)l.responseXML=v;var t=l.responseText=d.responseText;if(p.files&&t){var s,r;if(-1!=(s=t.indexOf("<body>")))r=t.lastIndexOf("</body>"),-1==r&&(r=t.length),t=t.slice(s+6,r);l.responseText=f.unEscapeHtml(t)}try{o=d.statusText}catch(x){o=""}!w&&g.isLocal&&!p.crossDomain?w=l.responseText?200:404:1223===w&&(w=204);l._ioReady(w,o)}}catch(z){d.onreadystatechange=f.noop,j||l._ioReady(-1,
z)}}});return a},{requires:["./base"]});
KISSY.add("io/sub-domain-transport",function(f,g,i,m){function h(a){var c=a.config;this.io=a;c.crossDomain=!1}function c(){var a=this.io.config.uri.getHostname(),a=e[a];a.ready=1;i.detach(a.iframe,"load",c,this);this.send()}var a=f.Env.host.document,e={};f.augment(h,g.proto,{send:function(){var b=this.io.config,l=b.uri,n=l.getHostname(),j;j=e[n];var d="/sub_domain_proxy.html";b.xdr&&b.xdr.subDomain&&b.xdr.subDomain.proxy&&(d=b.xdr.subDomain.proxy);j&&j.ready?(this.nativeXhr=g.nativeXhr(0,j.iframe.contentWindow))&&
this.sendInternal():(j?b=j.iframe:(j=e[n]={},b=j.iframe=a.createElement("iframe"),m.css(b,{position:"absolute",left:"-9999px",top:"-9999px"}),m.prepend(b,a.body||a.documentElement),j=new f.Uri,j.setScheme(l.getScheme()),j.setPort(l.getPort()),j.setHostname(n),j.setPath(d),b.src=j.toString()),i.on(b,"load",c,this))}});return h},{requires:["./xhr-transport-base","event","dom"]});
KISSY.add("io/xdr-flash-transport",function(f,g,i){function m(c,e,d){l||(l=!0,c='<object id="'+a+'" type="application/x-shockwave-flash" data="'+c+'" width="0" height="0"><param name="movie" value="'+c+'" /><param name="FlashVars" value="yid='+e+"&uid="+d+'&host=KISSY.IO" /><param name="allowScriptAccess" value="always" /></object>',e=b.createElement("div"),i.prepend(e,b.body||b.documentElement),e.innerHTML=c)}function h(a){this.io=a}var c={},a="io_swf",e,b=f.Env.host.document,l=!1;f.augment(h,{send:function(){var a=
this,b=a.io,d=b.config;m((d.xdr||{}).src||f.Config.base+"io/assets/io.swf",1,1);e?(a._uid=f.guid(),c[a._uid]=a,e.send(b._getUrlForSend(),{id:a._uid,uid:a._uid,method:d.type,data:d.hasContent&&d.data||{}})):setTimeout(function(){a.send()},200)},abort:function(){e.abort(this._uid)},_xdrResponse:function(a,b){var d,e=b.id,f,l=b.c,i=this.io;if(l&&(f=l.responseText))i.responseText=decodeURI(f);switch(a){case "success":d={status:200,statusText:"success"};delete c[e];break;case "abort":delete c[e];break;
case "timeout":case "transport error":case "failure":delete c[e],d={status:"status"in l?l.status:500,statusText:l.statusText||a}}d&&i._ioReady(d.status,d.statusText)}});g.applyTo=function(a,b,d){var a=b.split(".").slice(1),e=g;f.each(a,function(a){e=e[a]});e.apply(null,d)};g.xdrReady=function(){e=b.getElementById(a)};g.xdrResponse=function(a,b){var d=c[b.uid];d&&d._xdrResponse(a,b)};return h},{requires:["./base","dom"]});
KISSY.add("io/xhr-transport",function(f,g,i,m,h){function c(b){var c=b.config,n=c.crossDomain,j=c.xdr||{},d=j.subDomain=j.subDomain||{};this.io=b;if(n&&!i.supportCORS){c=c.uri.getHostname();if(a.domain&&f.endsWith(c,a.domain)&&!1!==d.proxy)return new m(b);if("flash"===""+j.use||!e)return new h(b)}this.nativeXhr=i.nativeXhr(n);return this}var a=f.Env.host.document,e=i._XDomainRequest;f.augment(c,i.proto,{send:function(){this.sendInternal()}});g.setupTransport("*",c);return g},{requires:["./base","./xhr-transport-base",
"./sub-domain-transport","./xdr-flash-transport"]});
KISSY.add("io/script-transport",function(f,g,i,m){function h(a){if(!a.config.crossDomain)return new (g.getTransport("*"))(a);this.io=a;return this}var c=f.Env.host,a=c.document;g.setupConfig({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{text:{script:function(a){f.globalEval(a);return a}}}});f.augment(h,{send:function(){var e=this,b,f=e.io,n=f.config,j=a.head||a.getElementsByTagName("head")[0]||
a.documentElement;e.head=j;b=a.createElement("script");e.script=b;b.async=!0;n.scriptCharset&&(b.charset=n.scriptCharset);b.src=f._getUrlForSend();b.onerror=b.onload=b.onreadystatechange=function(a){a=a||c.event;e._callback((a.type||"error").toLowerCase())};j.insertBefore(b,j.firstChild)},_callback:function(a,b){var c=this.script,f=this.io,j=this.head;if(c&&(b||!c.readyState||/loaded|complete/.test(c.readyState)||"error"==a))c.onerror=c.onload=c.onreadystatechange=null,j&&c.parentNode&&j.removeChild(c),
this.head=this.script=m,!b&&"error"!=a?f._ioReady(200,"success"):"error"==a&&f._ioReady(500,"script error")},abort:function(){this._callback(0,1)}});g.setupTransport("script",h);return g},{requires:["./base","./xhr-transport"]});
KISSY.add("io/jsonp",function(f,g){var i=f.Env.host;g.setupConfig({jsonp:"callback",jsonpCallback:function(){return f.guid("jsonp")}});g.on("start",function(g){var h=g.io,c=h.config,g=c.dataType;if("jsonp"==g[0]){delete c.contentType;var a,e=c.jsonpCallback,b="function"===typeof e?e():e,l=i[b];c.uri.query.set(c.jsonp,b);i[b]=function(b){1<arguments.length&&(b=f.makeArray(arguments));a=[b]};h.fin(function(){i[b]=l;if(void 0===l)try{delete i[b]}catch(c){}else a&&l(a[0])});h=c.converters;h.script=h.script||
{};h.script.json=function(){return a[0]};g.length=2;g[0]="script";g[1]="json"}});return g},{requires:["./base"]});
KISSY.add("io/form",function(f,g,i,m){var h=Array.prototype.slice,c=f.Env.host.FormData;g.on("start",function(a){var e,b,a=a.io.config;if(b=a.form){e=i.get(b);b=a.data;for(var l=!1,g={},j=i.query("input",e),d=0,k=j.length;d<k;d++){var y=j[d];if("file"==y.type.toLowerCase()){l=!0;if(!c)break;var u=h.call(y.files,0);g[i.attr(y,"name")]=1<u.length?u:u[0]||null}}l&&c&&(a.files=a.files||{},f.mix(a.files,g),delete a.contentType);!l||c?(e=m.getFormData(e),a.hasContent?(e=f.param(e,void 0,void 0,a.serializeArray),
a.data=b?a.data+("&"+e):e):a.uri.query.add(e)):(b=a.dataType,a=b[0],"*"==a&&(a="text"),b.length=2,b[0]="iframe",b[1]=a)}});return g},{requires:["./base","dom","./form-serializer"]});
KISSY.add("io/iframe-transport",function(f,g,i,m){function h(a){var b=f.guid("io-iframe"),c=g.getEmptyIframeSrc(),a=a.iframe=g.create("<iframe "+(c?' src="'+c+'" ':"")+' id="'+b+'" name="'+b+'" style="position:absolute;left:-9999px;top:-9999px;"/>');g.prepend(a,e.body||e.documentElement);return a}function c(a,b,c){var d=[],i,h,m,q;f.each(a,function(a,l){i=f.isArray(a);h=f.makeArray(a);for(m=0;m<h.length;m++)q=e.createElement("input"),q.type="hidden",q.name=l+(i&&c?"[]":""),q.value=h[m],g.append(q,
b),d.push(q)});return d}function a(a){this.io=a}var e=f.Env.host.document,b=f.clone(m.getConfig().converters.text);b.json=function(a){return f.parseJson(f.unEscapeHtml(a))};m.setupConfig({converters:{iframe:b,text:{iframe:function(a){return a}},xml:{iframe:function(a){return a}}}});f.augment(a,{send:function(){function a(){i.on(m,"load error",b._callback,b);o.submit()}var b=this,e=b.io,d=e.config,k,m,u,q=d.data,o=g.get(d.form);b.attrs={target:g.attr(o,"target")||"",action:g.attr(o,"action")||"",encoding:g.attr(o,
"encoding"),enctype:g.attr(o,"enctype"),method:g.attr(o,"method")};b.form=o;m=h(e);g.attr(o,{target:m.id,action:e._getUrlForSend(),method:"post",enctype:"multipart/form-data",encoding:"multipart/form-data"});q&&(u=f.unparam(q));u&&(k=c(u,o,d.serializeArray));b.fields=k;6==f.UA.ie?setTimeout(a,0):a()},_callback:function(a){var b=this,c=b.form,d=b.io,a=a.type,e,h=d.iframe;if(h)if("abort"==a&&6==f.UA.ie?setTimeout(function(){g.attr(c,b.attrs)},0):g.attr(c,b.attrs),g.remove(this.fields),i.detach(h),setTimeout(function(){g.remove(h)},
30),d.iframe=null,"load"==a)try{if((e=h.contentWindow.document)&&e.body)d.responseText=g.html(e.body),f.startsWith(d.responseText,"<?xml")&&(d.responseText=void 0);d.responseXML=e&&e.XMLDocument?e.XMLDocument:e;e?d._ioReady(200,"success"):d._ioReady(500,"parser error")}catch(m){d._ioReady(500,"parser error")}else"error"==a&&d._ioReady(500,"error")},abort:function(){this._callback({type:"abort"})}});m.setupTransport("iframe",a);return m},{requires:["dom","event","./base"]});
KISSY.add("io/methods",function(f,g,i){function m(c){var a=c.responseText,e=c.responseXML,b=c.config,g=b.converters,h,j,d=b.contents,k=b.dataType;if(a||e){for(b=c.mimeType||c.getResponseHeader("Content-Type");"*"==k[0];)k.shift();if(!k.length)for(h in d)if(d[h].test(b)){k[0]!=h&&k.unshift(h);break}k[0]=k[0]||"text";for(h=0;h<k.length;h++)if("text"==k[h]&&a!==i){j=a;break}else if("xml"==k[h]&&e!==i){j=e;break}if(!j){var m={text:a,xml:e};f.each(["text","xml"],function(b){var c=k[0];return g[b]&&g[b][c]&&
m[b]?(k.unshift(b),j="text"==b?a:e,!1):i})}}d=k[0];for(b=1;b<k.length;b++){h=k[b];var u=g[d]&&g[d][h];if(!u)throw"no covert for "+d+" => "+h;j=u(j);d=h}c.responseData=j}var h=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg;f.extend(g,f.Promise,{setRequestHeader:function(c,a){this.requestHeaders[c]=a;return this},getAllResponseHeaders:function(){return 2===this.state?this.responseHeadersString:null},getResponseHeader:function(c){var a,e;if(2===this.state){if(!(e=this.responseHeaders))for(e=this.responseHeaders={};a=
h.exec(this.responseHeadersString);)e[a[1]]=a[2];a=e[c]}return a===i?null:a},overrideMimeType:function(c){this.state||(this.mimeType=c);return this},abort:function(c){c=c||"abort";this.transport&&this.transport.abort(c);this._ioReady(0,c);return this},getNativeXhr:function(){var c;return(c=this.transport)?c.nativeXhr:null},_ioReady:function(c,a){if(2!=this.state){this.state=2;this.readyState=4;var e;if(200<=c&&300>c||304==c)if(304==c)a="not modified",e=!0;else try{m(this),a="success",e=!0}catch(b){a=
"parser error"}else 0>c&&(c=0);this.status=c;this.statusText=a;this._defer[e?"resolve":"reject"]([this.responseData,a,this])}},_getUrlForSend:function(){var c=this.config,a=c.uri,e=f.Uri.getComponents(c.url).query||"";return a.toString.call(a,c.serializeArray)+(e?(a.query.has()?"&":"?")+e:e)}})},{requires:["./base"]});
KISSY.add("io",function(f,g,i){function m(c,a,e,b,f){"function"===typeof a&&(b=e,e=a,a=h);return i({type:f||"get",url:c,data:a,success:e,dataType:b})}var h=void 0;f.mix(i,{serialize:g.serialize,get:m,post:function(c,a,e,b){"function"===typeof a&&(b=e,e=a,a=h);return m(c,a,e,b,"post")},jsonp:function(c,a,e){"function"===typeof a&&(e=a,a=h);return m(c,a,e,"jsonp")},getScript:f.getScript,getJSON:function(c,a,e){"function"===typeof a&&(e=a,a=h);return m(c,a,e,"json")},upload:function(c,a,e,b,f){"function"===
typeof e&&(f=b,b=e,e=h);return i({url:c,type:"post",dataType:f,form:a,data:e,success:b})}});f.mix(f,{Ajax:i,IO:i,ajax:i,io:i,jsonp:i.jsonp});return i},{requires:"io/form-serializer,io/base,io/xhr-transport,io/script-transport,io/jsonp,io/form,io/iframe-transport,io/methods".split(",")});
