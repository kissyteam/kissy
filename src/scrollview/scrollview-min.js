KISSY.add("scrollview",function(g){var c=YAHOO.util,b=c.Dom,w=c.Event,f=YAHOO.lang,h=b.getFirstChild,a=b.getLastChild,d=b.insertBefore,p=b.insertAfter,o=b.getAttribute,r=b.setAttribute;var t="prev",u="next",q="carousel:index",x="horizontal",n="vertical",l="onSwitch",i="onPause",e="onBeforeSwitch";var k={animDuration:0.5,interval:2,autoPlay:true,direction:n,pauseOnMouseOver:true,framesNum:1};var m=function(A){var A=b.get(A),B=A.offsetLeft,y=A.offsetTop,z=A.offsetParent;while(z){B+=z.offsetLeft;y+=z.offsetTop;z=z.offsetParent}return{top:y,left:B}};var s=function(B,z,C){var A=b[(C=="prev")?"getPreviousSibling":"getNextSibling"];for(var y=0;y<z;y++){B=A(B);if(!B){return false}}return B};var j=function(y,A,B){B=(B==t)?t:u;switch(B){case t:for(var z=0;z<A;z++){d(a(y),h(y))}break;default:for(var z=0;z<A;z++){p(h(y),a(y))}}};var v=function(y,z){var G=this,z=f.merge(k,z||{}),y,D,A,H,E,B,C,F;y=b.get(y),D=y.getElementsByTagName("li");A=D[0]||[],E=D.length;if(E<z.framesNum){return}for(B=0,C=E;B<C;B++){r(D[B],q,B)}H=parseInt(o(A,q),10);F={x:(z.direction==x)||(z.direction=="h"),y:(z.direction==n)||(z.direction=="v")};G.config=z,G.container=y,G.panels=D,G.activePanel=A,G.activeIndex=H,G.total=E,G.direction=F;G._init()};g.mix(v.prototype,{_init:function(){var y=this;y.createEvent(l);y.createEvent(i);y.createEvent(e);y._initAutoPlay()},_initAutoPlay:function(){var z=this,A=z.config,y=z.container;if(A.autoPlay){if(A.pauseOnMouseOver){w.on(y,"mouseenter",function(){z.paused=true});w.on(y,"mouseleave",function(){z.paused=false})}z.autoPlayTimer=f.later(A.interval*1000,z,function(){if(z.paused){return}z.play()},null,true)}},play:function(C){var z=this,A=z.config,y=z.activeIndex,B=z.total;C=(C==t)?t:u;y+=(C==u?1:-1)*A.framesNum;if(y>=B){y=0}else{if(y<0){y=B-1}}this.switchTo(y,C)},_decideOffset:function(E,G){var I=this,y=I.config,F=I.total,H,z,A,C,B,D;if(E>F){return}if(f.isUndefined(G)&&f.isNumber(I.prevIndex)){G=E>I.prevIndex?u:t}G=(G==t)?t:u;A=(G==t)?u:t;for(C=0,D=F;C<D;C++){B=o(I.panels[C],q);if(B==E){H=I.panels[C];break}}if(!H){return}do{z=s(H,y.framesNum,A);if(!z){j(H.parentNode,y.framesNum,G)}}while(!z);I.fromPanel=z;I.toPanel=H;I.prevIndex=E},switchTo:function(D,H){var I=this,y=I.container,C=I.activePanel,J=I.activeIndex,A=I.config,G=arguments.callee,B,F;if(I.prevIndex==D){return}I._decideOffset(D,H);var z=m(I.fromPanel),E=m(I.toPanel);containerOffset=m(y),prop=I.direction.y?"top":"left",from=z[prop]-containerOffset[prop],to=E[prop]-containerOffset[prop];if(I.direction.y){B={scroll:{from:[,from],to:[,to]}}}else{B={scroll:{from:[from],to:[to]}}}I.activePanel=I.toPanel;I.activeIndex=parseInt(o(I.toPanel,q),10);if(!I.fireEvent(e,I)){return I}if(I.anim){I.anim.stop()}I.anim=new c.Scroll(y,B,A.animDuration,A.easing||c.Easing.easeOut);I.anim.onComplete.subscribe(function(){I.scrolling=false;I.fireEvent(l,I)});I.scrolling=true;I.anim.animate()},next:function(){this.play(u)},prev:function(){this.play(t)}});g.augment(v,c.EventProvider);g.ScrollView=v});
